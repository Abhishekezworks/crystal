graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:3px,color:#000
    classDef itemplan fill:#fff,stroke-width:6px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:6px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:6px,text-align:left


    %% define steps
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    Access64["Access[64∈0]<br />ᐸ3.pgSettingsᐳ"]:::plan
    Access65["Access[65∈0]<br />ᐸ3.withPgClientᐳ"]:::plan
    Object66["Object[66∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"]:::plan
    Connection67["Connection[67∈0]<br />ᐸ63ᐳ"]:::plan
    PgSelect68[["PgSelect[68∈0]<br />ᐸgeomᐳ"]]:::plan
    __Item69>"__Item[69∈1]<br />ᐸ68ᐳ"]:::itemplan
    PgSelectSingle70["PgSelectSingle[70∈1]<br />ᐸgeomᐳ"]:::plan
    PgClassExpression71["PgClassExpression[71∈1]<br />ᐸ__geom__.”id”ᐳ"]:::plan
    PgClassExpression72["PgClassExpression[72∈1]<br />ᐸ__geom__.”point”ᐳ"]:::plan
    PgClassExpression73["PgClassExpression[73∈1]<br />ᐸ__geom__.”line”ᐳ"]:::plan
    PgClassExpression74["PgClassExpression[74∈1]<br />ᐸ__geom__.”lseg”ᐳ"]:::plan
    PgClassExpression75["PgClassExpression[75∈1]<br />ᐸ__geom__.”box”ᐳ"]:::plan
    PgClassExpression76["PgClassExpression[76∈1]<br />ᐸ__geom__.”open_path”ᐳ"]:::plan
    PgClassExpression77["PgClassExpression[77∈1]<br />ᐸ__geom__.”closed_path”ᐳ"]:::plan
    PgClassExpression78["PgClassExpression[78∈1]<br />ᐸ__geom__.”polygon”ᐳ"]:::plan
    PgClassExpression79["PgClassExpression[79∈1]<br />ᐸ__geom__.”circle”ᐳ"]:::plan
    Access80["Access[80∈1]<br />ᐸ72.xᐳ"]:::plan
    Access81["Access[81∈1]<br />ᐸ72.yᐳ"]:::plan
    Access82["Access[82∈1]<br />ᐸ73.aᐳ"]:::plan
    Access83["Access[83∈1]<br />ᐸ73.bᐳ"]:::plan
    Access84["Access[84∈1]<br />ᐸ82.xᐳ"]:::plan
    Access85["Access[85∈1]<br />ᐸ82.yᐳ"]:::plan
    Access86["Access[86∈1]<br />ᐸ83.xᐳ"]:::plan
    Access87["Access[87∈1]<br />ᐸ83.yᐳ"]:::plan
    Access88["Access[88∈1]<br />ᐸ74.aᐳ"]:::plan
    Access89["Access[89∈1]<br />ᐸ74.bᐳ"]:::plan
    Access90["Access[90∈1]<br />ᐸ88.xᐳ"]:::plan
    Access91["Access[91∈1]<br />ᐸ88.yᐳ"]:::plan
    Access92["Access[92∈1]<br />ᐸ89.xᐳ"]:::plan
    Access93["Access[93∈1]<br />ᐸ89.yᐳ"]:::plan
    Access94["Access[94∈1]<br />ᐸ75.aᐳ"]:::plan
    Access95["Access[95∈1]<br />ᐸ75.bᐳ"]:::plan
    Access96["Access[96∈1]<br />ᐸ94.xᐳ"]:::plan
    Access97["Access[97∈1]<br />ᐸ94.yᐳ"]:::plan
    Access98["Access[98∈1]<br />ᐸ95.xᐳ"]:::plan
    Access99["Access[99∈1]<br />ᐸ95.yᐳ"]:::plan
    Access100["Access[100∈1]<br />ᐸ76.isOpenᐳ"]:::plan
    Access101["Access[101∈1]<br />ᐸ76.pointsᐳ"]:::plan
    __Item102>"__Item[102∈2]<br />ᐸ101ᐳ"]:::itemplan
    Access103["Access[103∈2]<br />ᐸ102.xᐳ"]:::plan
    Access104["Access[104∈2]<br />ᐸ102.yᐳ"]:::plan
    Access105["Access[105∈1]<br />ᐸ77.isOpenᐳ"]:::plan
    Access106["Access[106∈1]<br />ᐸ77.pointsᐳ"]:::plan
    __Item107>"__Item[107∈3]<br />ᐸ106ᐳ"]:::itemplan
    Access108["Access[108∈3]<br />ᐸ107.xᐳ"]:::plan
    Access109["Access[109∈3]<br />ᐸ107.yᐳ"]:::plan
    Access110["Access[110∈1]<br />ᐸ78.pointsᐳ"]:::plan
    __Item111>"__Item[111∈4]<br />ᐸ110ᐳ"]:::itemplan
    Access112["Access[112∈4]<br />ᐸ111.xᐳ"]:::plan
    Access113["Access[113∈4]<br />ᐸ111.yᐳ"]:::plan
    Access114["Access[114∈1]<br />ᐸ79.centerᐳ"]:::plan
    Access115["Access[115∈1]<br />ᐸ79.radiusᐳ"]:::plan
    Access116["Access[116∈1]<br />ᐸ114.xᐳ"]:::plan
    Access117["Access[117∈1]<br />ᐸ114.yᐳ"]:::plan

    %% plan dependencies
    __Value3 --> Access64
    __Value3 --> Access65
    Access64 & Access65 --> Object66
    Object66 & Connection67 --> PgSelect68
    PgSelect68 ==> __Item69
    __Item69 --> PgSelectSingle70
    PgSelectSingle70 --> PgClassExpression71
    PgSelectSingle70 --> PgClassExpression72
    PgSelectSingle70 --> PgClassExpression73
    PgSelectSingle70 --> PgClassExpression74
    PgSelectSingle70 --> PgClassExpression75
    PgSelectSingle70 --> PgClassExpression76
    PgSelectSingle70 --> PgClassExpression77
    PgSelectSingle70 --> PgClassExpression78
    PgSelectSingle70 --> PgClassExpression79
    PgClassExpression72 --> Access80
    PgClassExpression72 --> Access81
    PgClassExpression73 --> Access82
    PgClassExpression73 --> Access83
    Access82 --> Access84
    Access82 --> Access85
    Access83 --> Access86
    Access83 --> Access87
    PgClassExpression74 --> Access88
    PgClassExpression74 --> Access89
    Access88 --> Access90
    Access88 --> Access91
    Access89 --> Access92
    Access89 --> Access93
    PgClassExpression75 --> Access94
    PgClassExpression75 --> Access95
    Access94 --> Access96
    Access94 --> Access97
    Access95 --> Access98
    Access95 --> Access99
    PgClassExpression76 --> Access100
    PgClassExpression76 --> Access101
    Access101 ==> __Item102
    __Item102 --> Access103
    __Item102 --> Access104
    PgClassExpression77 --> Access105
    PgClassExpression77 --> Access106
    Access106 ==> __Item107
    __Item107 --> Access108
    __Item107 --> Access109
    PgClassExpression78 --> Access110
    Access110 ==> __Item111
    __Item111 --> Access112
    __Item111 --> Access113
    PgClassExpression79 --> Access114
    PgClassExpression79 --> Access115
    Access114 --> Access116
    Access114 --> Access117

    %% plan-to-path relationships

    subgraph "Buckets for queries/v4/geometry.queries"
    Bucket0("Bucket 0<br />(root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value3,__Value5,Access64,Access65,Object66,Connection67,PgSelect68 bucket0
    Bucket1("Bucket 1<br />(listItem)<br />Deps: 68<br /><br />ROOT __Item{1}ᐸ68ᐳ[69]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item69,PgSelectSingle70,PgClassExpression71,PgClassExpression72,PgClassExpression73,PgClassExpression74,PgClassExpression75,PgClassExpression76,PgClassExpression77,PgClassExpression78,PgClassExpression79,Access80,Access81,Access82,Access83,Access84,Access85,Access86,Access87,Access88,Access89,Access90,Access91,Access92,Access93,Access94,Access95,Access96,Access97,Access98,Access99,Access100,Access101,Access105,Access106,Access110,Access114,Access115,Access116,Access117 bucket1
    Bucket2("Bucket 2<br />(listItem)<br />Deps: 101<br /><br />ROOT __Item{2}ᐸ101ᐳ[102]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item102,Access103,Access104 bucket2
    Bucket3("Bucket 3<br />(listItem)<br />Deps: 106<br /><br />ROOT __Item{3}ᐸ106ᐳ[107]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item107,Access108,Access109 bucket3
    Bucket4("Bucket 4<br />(listItem)<br />Deps: 110<br /><br />ROOT __Item{4}ᐸ110ᐳ[111]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item111,Access112,Access113 bucket4
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2 & Bucket3 & Bucket4
    end
