graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:3px,color:#000
    classDef itemplan fill:#fff,stroke-width:6px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:6px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:6px,text-align:left


    %% define steps
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    __InputStaticLeaf7["__InputStaticLeaf[7∈0]"]:::plan
    Access9["Access[9∈0]<br />ᐸ3.pgSettingsᐳ"]:::plan
    Access10["Access[10∈0]<br />ᐸ3.withPgClientᐳ"]:::plan
    Object11["Object[11∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"]:::plan
    PgSelect8[["PgSelect[8∈0]<br />ᐸpersonSecretᐳ"]]:::plan
    First12["First[12∈0]"]:::plan
    PgSelectSingle13["PgSelectSingle[13∈0]<br />ᐸpersonSecretᐳ"]:::plan
    Constant14["Constant[14∈0]"]:::plan
    PgClassExpression15["PgClassExpression[15∈0]<br />ᐸ__person_s...person_id”ᐳ"]:::plan
    List16["List[16∈0]<br />ᐸ14,15ᐳ"]:::plan
    Lambda17["Lambda[17∈0]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression19["PgClassExpression[19∈0]<br />ᐸ__person_s..._.”sekrit”ᐳ"]:::plan
    Connection35["Connection[35∈0]<br />ᐸ31ᐳ"]:::plan
    PgSelect36[["PgSelect[36∈0]<br />ᐸpersonSecretᐳ"]]:::plan
    __Item37>"__Item[37∈1]<br />ᐸ36ᐳ"]:::itemplan
    PgSelectSingle38["PgSelectSingle[38∈1]<br />ᐸpersonSecretᐳ"]:::plan
    Constant39["Constant[39∈0]"]:::plan
    PgClassExpression40["PgClassExpression[40∈1]<br />ᐸ__person_s...person_id”ᐳ"]:::plan
    List41["List[41∈1]<br />ᐸ39,40ᐳ"]:::plan
    Lambda42["Lambda[42∈1]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression44["PgClassExpression[44∈1]<br />ᐸ__person_s..._.”sekrit”ᐳ"]:::plan
    __InputStaticLeaf45["__InputStaticLeaf[45∈0]"]:::plan
    PgSelect46[["PgSelect[46∈0]<br />ᐸpersonᐳ"]]:::plan
    First50["First[50∈0]"]:::plan
    PgSelectSingle51["PgSelectSingle[51∈0]<br />ᐸpersonᐳ"]:::plan
    Constant52["Constant[52∈0]"]:::plan
    PgClassExpression53["PgClassExpression[53∈0]<br />ᐸ__person__.”id”ᐳ"]:::plan
    List54["List[54∈0]<br />ᐸ52,53ᐳ"]:::plan
    Lambda55["Lambda[55∈0]<br />ᐸencodeᐳ"]:::plan
    Map254["Map[254∈0]<br />ᐸ51:{”0”:0,”1”:1}ᐳ"]:::plan
    List255["List[255∈0]<br />ᐸ254ᐳ"]:::plan
    First61["First[61∈0]"]:::plan
    PgSelectSingle62["PgSelectSingle[62∈0]<br />ᐸpersonSecretᐳ"]:::plan
    Constant63["Constant[63∈0]"]:::plan
    PgClassExpression64["PgClassExpression[64∈0]<br />ᐸ__person_s...person_id”ᐳ"]:::plan
    List65["List[65∈0]<br />ᐸ63,64ᐳ"]:::plan
    Lambda66["Lambda[66∈0]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression68["PgClassExpression[68∈0]<br />ᐸ__person_s..._.”sekrit”ᐳ"]:::plan
    __InputStaticLeaf69["__InputStaticLeaf[69∈0]"]:::plan
    PgSelect70[["PgSelect[70∈0]<br />ᐸleftArmᐳ"]]:::plan
    First74["First[74∈0]"]:::plan
    PgSelectSingle75["PgSelectSingle[75∈0]<br />ᐸleftArmᐳ"]:::plan
    Constant76["Constant[76∈0]"]:::plan
    PgClassExpression77["PgClassExpression[77∈0]<br />ᐸ__left_arm__.”id”ᐳ"]:::plan
    List78["List[78∈0]<br />ᐸ76,77ᐳ"]:::plan
    Lambda79["Lambda[79∈0]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression81["PgClassExpression[81∈0]<br />ᐸ__left_arm...person_id”ᐳ"]:::plan
    PgClassExpression82["PgClassExpression[82∈0]<br />ᐸ__left_arm...in_metres”ᐳ"]:::plan
    PgClassExpression83["PgClassExpression[83∈0]<br />ᐸ__left_arm__.”mood”ᐳ"]:::plan
    Connection101["Connection[101∈0]<br />ᐸ97ᐳ"]:::plan
    PgSelect102[["PgSelect[102∈0]<br />ᐸleftArmᐳ"]]:::plan
    __Item103>"__Item[103∈2]<br />ᐸ102ᐳ"]:::itemplan
    PgSelectSingle104["PgSelectSingle[104∈2]<br />ᐸleftArmᐳ"]:::plan
    Constant105["Constant[105∈0]"]:::plan
    PgClassExpression106["PgClassExpression[106∈2]<br />ᐸ__left_arm__.”id”ᐳ"]:::plan
    List107["List[107∈2]<br />ᐸ105,106ᐳ"]:::plan
    Lambda108["Lambda[108∈2]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression110["PgClassExpression[110∈2]<br />ᐸ__left_arm...person_id”ᐳ"]:::plan
    PgClassExpression111["PgClassExpression[111∈2]<br />ᐸ__left_arm...in_metres”ᐳ"]:::plan
    PgClassExpression112["PgClassExpression[112∈2]<br />ᐸ__left_arm__.”mood”ᐳ"]:::plan
    __InputStaticLeaf113["__InputStaticLeaf[113∈0]"]:::plan
    PgSelect114[["PgSelect[114∈0]<br />ᐸpersonᐳ"]]:::plan
    First118["First[118∈0]"]:::plan
    PgSelectSingle119["PgSelectSingle[119∈0]<br />ᐸpersonᐳ"]:::plan
    Constant120["Constant[120∈0]"]:::plan
    PgClassExpression121["PgClassExpression[121∈0]<br />ᐸ__person__.”id”ᐳ"]:::plan
    List122["List[122∈0]<br />ᐸ120,121ᐳ"]:::plan
    Lambda123["Lambda[123∈0]<br />ᐸencodeᐳ"]:::plan
    Map252["Map[252∈0]<br />ᐸ119:{”0”:0,”1”:1,”2”:2,”3”:3}ᐳ"]:::plan
    List253["List[253∈0]<br />ᐸ252ᐳ"]:::plan
    First129["First[129∈0]"]:::plan
    PgSelectSingle130["PgSelectSingle[130∈0]<br />ᐸleftArmᐳ"]:::plan
    Constant131["Constant[131∈0]"]:::plan
    PgClassExpression132["PgClassExpression[132∈0]<br />ᐸ__left_arm__.”id”ᐳ"]:::plan
    List133["List[133∈0]<br />ᐸ131,132ᐳ"]:::plan
    Lambda134["Lambda[134∈0]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression136["PgClassExpression[136∈0]<br />ᐸ__left_arm...person_id”ᐳ"]:::plan
    PgClassExpression137["PgClassExpression[137∈0]<br />ᐸ__left_arm...in_metres”ᐳ"]:::plan
    PgClassExpression138["PgClassExpression[138∈0]<br />ᐸ__left_arm__.”mood”ᐳ"]:::plan
    __InputStaticLeaf139["__InputStaticLeaf[139∈0]"]:::plan
    PgSelect140[["PgSelect[140∈0]<br />ᐸpostᐳ"]]:::plan
    First144["First[144∈0]"]:::plan
    PgSelectSingle145["PgSelectSingle[145∈0]<br />ᐸpostᐳ"]:::plan
    Constant146["Constant[146∈0]"]:::plan
    PgClassExpression147["PgClassExpression[147∈0]<br />ᐸ__post__.”id”ᐳ"]:::plan
    List148["List[148∈0]<br />ᐸ146,147ᐳ"]:::plan
    Lambda149["Lambda[149∈0]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression151["PgClassExpression[151∈0]<br />ᐸ__post__.”headline”ᐳ"]:::plan
    PgClassExpression152["PgClassExpression[152∈0]<br />ᐸ__post__.”body”ᐳ"]:::plan
    PgClassExpression153["PgClassExpression[153∈0]<br />ᐸ__post__.”author_id”ᐳ"]:::plan
    Connection178["Connection[178∈0]<br />ᐸ174ᐳ"]:::plan
    PgSelect179[["PgSelect[179∈0]<br />ᐸpostᐳ"]]:::plan
    __Item180>"__Item[180∈3]<br />ᐸ179ᐳ"]:::itemplan
    PgSelectSingle181["PgSelectSingle[181∈3]<br />ᐸpostᐳ"]:::plan
    Constant182["Constant[182∈0]"]:::plan
    PgClassExpression183["PgClassExpression[183∈3]<br />ᐸ__post__.”id”ᐳ"]:::plan
    List184["List[184∈3]<br />ᐸ182,183ᐳ"]:::plan
    Lambda185["Lambda[185∈3]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression187["PgClassExpression[187∈3]<br />ᐸ__post__.”headline”ᐳ"]:::plan
    PgClassExpression188["PgClassExpression[188∈3]<br />ᐸ__post__.”body”ᐳ"]:::plan
    PgClassExpression189["PgClassExpression[189∈3]<br />ᐸ__post__.”author_id”ᐳ"]:::plan
    __InputStaticLeaf190["__InputStaticLeaf[190∈0]"]:::plan
    PgSelect191[["PgSelect[191∈0]<br />ᐸpersonᐳ"]]:::plan
    First195["First[195∈0]"]:::plan
    PgSelectSingle196["PgSelectSingle[196∈0]<br />ᐸpersonᐳ"]:::plan
    Constant197["Constant[197∈0]"]:::plan
    PgClassExpression198["PgClassExpression[198∈0]<br />ᐸ__person__.”id”ᐳ"]:::plan
    List199["List[199∈0]<br />ᐸ197,198ᐳ"]:::plan
    Lambda200["Lambda[200∈0]<br />ᐸencodeᐳ"]:::plan
    Connection226["Connection[226∈0]<br />ᐸ222ᐳ"]:::plan
    Access251["Access[251∈0]<br />ᐸ195.0ᐳ"]:::plan
    __Item228>"__Item[228∈4]<br />ᐸ251ᐳ"]:::itemplan
    PgSelectSingle229["PgSelectSingle[229∈4]<br />ᐸpostᐳ"]:::plan
    Constant230["Constant[230∈0]"]:::plan
    PgClassExpression231["PgClassExpression[231∈4]<br />ᐸ__post__.”id”ᐳ"]:::plan
    List232["List[232∈4]<br />ᐸ230,231ᐳ"]:::plan
    Lambda233["Lambda[233∈4]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression235["PgClassExpression[235∈4]<br />ᐸ__post__.”headline”ᐳ"]:::plan
    PgClassExpression236["PgClassExpression[236∈4]<br />ᐸ__post__.”body”ᐳ"]:::plan
    PgClassExpression237["PgClassExpression[237∈4]<br />ᐸ__post__.”author_id”ᐳ"]:::plan
    PgSelect238[["PgSelect[238∈0]<br />ᐸreturn_table_without_grantsᐳ"]]:::plan
    First242["First[242∈0]"]:::plan
    PgSelectSingle243["PgSelectSingle[243∈0]<br />ᐸreturn_table_without_grantsᐳ"]:::plan
    Constant244["Constant[244∈0]"]:::plan
    PgClassExpression245["PgClassExpression[245∈0]<br />ᐸ__return_t...rson_id_1”ᐳ"]:::plan
    PgClassExpression246["PgClassExpression[246∈0]<br />ᐸ__return_t...rson_id_2”ᐳ"]:::plan
    List247["List[247∈0]<br />ᐸ244,245,246ᐳ"]:::plan
    Lambda248["Lambda[248∈0]<br />ᐸencodeᐳ"]:::plan

    %% plan dependencies
    __Value3 --> Access9
    __Value3 --> Access10
    Access9 & Access10 --> Object11
    Object11 & __InputStaticLeaf7 --> PgSelect8
    PgSelect8 --> First12
    First12 --> PgSelectSingle13
    PgSelectSingle13 --> PgClassExpression15
    Constant14 & PgClassExpression15 --> List16
    List16 --> Lambda17
    PgSelectSingle13 --> PgClassExpression19
    Object11 & Connection35 --> PgSelect36
    PgSelect36 ==> __Item37
    __Item37 --> PgSelectSingle38
    PgSelectSingle38 --> PgClassExpression40
    Constant39 & PgClassExpression40 --> List41
    List41 --> Lambda42
    PgSelectSingle38 --> PgClassExpression44
    Object11 & __InputStaticLeaf45 --> PgSelect46
    PgSelect46 --> First50
    First50 --> PgSelectSingle51
    PgSelectSingle51 --> PgClassExpression53
    Constant52 & PgClassExpression53 --> List54
    List54 --> Lambda55
    PgSelectSingle51 --> Map254
    Map254 --> List255
    List255 --> First61
    First61 --> PgSelectSingle62
    PgSelectSingle62 --> PgClassExpression64
    Constant63 & PgClassExpression64 --> List65
    List65 --> Lambda66
    PgSelectSingle62 --> PgClassExpression68
    Object11 & __InputStaticLeaf69 --> PgSelect70
    PgSelect70 --> First74
    First74 --> PgSelectSingle75
    PgSelectSingle75 --> PgClassExpression77
    Constant76 & PgClassExpression77 --> List78
    List78 --> Lambda79
    PgSelectSingle75 --> PgClassExpression81
    PgSelectSingle75 --> PgClassExpression82
    PgSelectSingle75 --> PgClassExpression83
    Object11 & Connection101 --> PgSelect102
    PgSelect102 ==> __Item103
    __Item103 --> PgSelectSingle104
    PgSelectSingle104 --> PgClassExpression106
    Constant105 & PgClassExpression106 --> List107
    List107 --> Lambda108
    PgSelectSingle104 --> PgClassExpression110
    PgSelectSingle104 --> PgClassExpression111
    PgSelectSingle104 --> PgClassExpression112
    Object11 & __InputStaticLeaf113 --> PgSelect114
    PgSelect114 --> First118
    First118 --> PgSelectSingle119
    PgSelectSingle119 --> PgClassExpression121
    Constant120 & PgClassExpression121 --> List122
    List122 --> Lambda123
    PgSelectSingle119 --> Map252
    Map252 --> List253
    List253 --> First129
    First129 --> PgSelectSingle130
    PgSelectSingle130 --> PgClassExpression132
    Constant131 & PgClassExpression132 --> List133
    List133 --> Lambda134
    PgSelectSingle130 --> PgClassExpression136
    PgSelectSingle130 --> PgClassExpression137
    PgSelectSingle130 --> PgClassExpression138
    Object11 & __InputStaticLeaf139 --> PgSelect140
    PgSelect140 --> First144
    First144 --> PgSelectSingle145
    PgSelectSingle145 --> PgClassExpression147
    Constant146 & PgClassExpression147 --> List148
    List148 --> Lambda149
    PgSelectSingle145 --> PgClassExpression151
    PgSelectSingle145 --> PgClassExpression152
    PgSelectSingle145 --> PgClassExpression153
    Object11 & Connection178 --> PgSelect179
    PgSelect179 ==> __Item180
    __Item180 --> PgSelectSingle181
    PgSelectSingle181 --> PgClassExpression183
    Constant182 & PgClassExpression183 --> List184
    List184 --> Lambda185
    PgSelectSingle181 --> PgClassExpression187
    PgSelectSingle181 --> PgClassExpression188
    PgSelectSingle181 --> PgClassExpression189
    Object11 & __InputStaticLeaf190 --> PgSelect191
    PgSelect191 --> First195
    First195 --> PgSelectSingle196
    PgSelectSingle196 --> PgClassExpression198
    Constant197 & PgClassExpression198 --> List199
    List199 --> Lambda200
    First195 --> Access251
    Access251 ==> __Item228
    __Item228 --> PgSelectSingle229
    PgSelectSingle229 --> PgClassExpression231
    Constant230 & PgClassExpression231 --> List232
    List232 --> Lambda233
    PgSelectSingle229 --> PgClassExpression235
    PgSelectSingle229 --> PgClassExpression236
    PgSelectSingle229 --> PgClassExpression237
    Object11 --> PgSelect238
    PgSelect238 --> First242
    First242 --> PgSelectSingle243
    PgSelectSingle243 --> PgClassExpression245
    PgSelectSingle243 --> PgClassExpression246
    Constant244 & PgClassExpression245 & PgClassExpression246 --> List247
    List247 --> Lambda248

    %% plan-to-path relationships

    subgraph "Buckets for queries/v4/rbac.basic"
    Bucket0("Bucket 0<br />(root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value3,__Value5,__InputStaticLeaf7,PgSelect8,Access9,Access10,Object11,First12,PgSelectSingle13,Constant14,PgClassExpression15,List16,Lambda17,PgClassExpression19,Connection35,PgSelect36,Constant39,__InputStaticLeaf45,PgSelect46,First50,PgSelectSingle51,Constant52,PgClassExpression53,List54,Lambda55,First61,PgSelectSingle62,Constant63,PgClassExpression64,List65,Lambda66,PgClassExpression68,__InputStaticLeaf69,PgSelect70,First74,PgSelectSingle75,Constant76,PgClassExpression77,List78,Lambda79,PgClassExpression81,PgClassExpression82,PgClassExpression83,Connection101,PgSelect102,Constant105,__InputStaticLeaf113,PgSelect114,First118,PgSelectSingle119,Constant120,PgClassExpression121,List122,Lambda123,First129,PgSelectSingle130,Constant131,PgClassExpression132,List133,Lambda134,PgClassExpression136,PgClassExpression137,PgClassExpression138,__InputStaticLeaf139,PgSelect140,First144,PgSelectSingle145,Constant146,PgClassExpression147,List148,Lambda149,PgClassExpression151,PgClassExpression152,PgClassExpression153,Connection178,PgSelect179,Constant182,__InputStaticLeaf190,PgSelect191,First195,PgSelectSingle196,Constant197,PgClassExpression198,List199,Lambda200,Connection226,Constant230,PgSelect238,First242,PgSelectSingle243,Constant244,PgClassExpression245,PgClassExpression246,List247,Lambda248,Access251,Map252,List253,Map254,List255 bucket0
    Bucket1("Bucket 1<br />(listItem)<br />Deps: 36, 39<br /><br />ROOT __Item{1}ᐸ36ᐳ[37]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item37,PgSelectSingle38,PgClassExpression40,List41,Lambda42,PgClassExpression44 bucket1
    Bucket2("Bucket 2<br />(listItem)<br />Deps: 102, 105<br /><br />ROOT __Item{2}ᐸ102ᐳ[103]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item103,PgSelectSingle104,PgClassExpression106,List107,Lambda108,PgClassExpression110,PgClassExpression111,PgClassExpression112 bucket2
    Bucket3("Bucket 3<br />(listItem)<br />Deps: 179, 182<br /><br />ROOT __Item{3}ᐸ179ᐳ[180]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item180,PgSelectSingle181,PgClassExpression183,List184,Lambda185,PgClassExpression187,PgClassExpression188,PgClassExpression189 bucket3
    Bucket4("Bucket 4<br />(listItem)<br />Deps: 251, 230<br /><br />ROOT __Item{4}ᐸ251ᐳ[228]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item228,PgSelectSingle229,PgClassExpression231,List232,Lambda233,PgClassExpression235,PgClassExpression236,PgClassExpression237 bucket4
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4
    end
