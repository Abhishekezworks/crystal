graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:3px,color:#000
    classDef itemplan fill:#fff,stroke-width:6px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:6px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:6px,text-align:left


    %% define steps
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    __InputStaticLeaf7["__InputStaticLeaf[7∈0]"]:::plan
    Access9["Access[9∈0]<br />ᐸ3.pgSettingsᐳ"]:::plan
    Access10["Access[10∈0]<br />ᐸ3.withPgClientᐳ"]:::plan
    Object11["Object[11∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"]:::plan
    PgSelect8[["PgSelect[8∈0]<br />ᐸpersonSecretᐳ"]]:::plan
    First12["First[12∈0]"]:::plan
    PgSelectSingle13["PgSelectSingle[13∈0]<br />ᐸpersonSecretᐳ"]:::plan
    Connection29["Connection[29∈0]<br />ᐸ25ᐳ"]:::plan
    __InputStaticLeaf30["__InputStaticLeaf[30∈0]"]:::plan
    PgSelect31[["PgSelect[31∈0]<br />ᐸpersonᐳ"]]:::plan
    First35["First[35∈0]"]:::plan
    PgSelectSingle36["PgSelectSingle[36∈0]<br />ᐸpersonᐳ"]:::plan
    __InputStaticLeaf37["__InputStaticLeaf[37∈0]"]:::plan
    PgSelect38[["PgSelect[38∈0]<br />ᐸleftArmᐳ"]]:::plan
    First42["First[42∈0]"]:::plan
    PgSelectSingle43["PgSelectSingle[43∈0]<br />ᐸleftArmᐳ"]:::plan
    Connection61["Connection[61∈0]<br />ᐸ57ᐳ"]:::plan
    __InputStaticLeaf62["__InputStaticLeaf[62∈0]"]:::plan
    PgSelect63[["PgSelect[63∈0]<br />ᐸpersonᐳ"]]:::plan
    First67["First[67∈0]"]:::plan
    PgSelectSingle68["PgSelectSingle[68∈0]<br />ᐸpersonᐳ"]:::plan
    __InputStaticLeaf69["__InputStaticLeaf[69∈0]"]:::plan
    PgSelect70[["PgSelect[70∈0]<br />ᐸpostᐳ"]]:::plan
    First74["First[74∈0]"]:::plan
    PgSelectSingle75["PgSelectSingle[75∈0]<br />ᐸpostᐳ"]:::plan
    Connection100["Connection[100∈0]<br />ᐸ96ᐳ"]:::plan
    __InputStaticLeaf101["__InputStaticLeaf[101∈0]"]:::plan
    PgSelect102[["PgSelect[102∈0]<br />ᐸpersonᐳ"]]:::plan
    First106["First[106∈0]"]:::plan
    PgSelectSingle107["PgSelectSingle[107∈0]<br />ᐸpersonᐳ"]:::plan
    PgSelect108[["PgSelect[108∈0]<br />ᐸreturn_table_without_grantsᐳ"]]:::plan
    First112["First[112∈0]"]:::plan
    PgSelectSingle113["PgSelectSingle[113∈0]<br />ᐸreturn_table_without_grantsᐳ"]:::plan
    Constant114["Constant[114∈0]"]:::plan
    PgClassExpression115["PgClassExpression[115∈0]<br />ᐸ__person_s...person_id”ᐳ"]:::plan
    List116["List[116∈0]<br />ᐸ114,115ᐳ"]:::plan
    Lambda117["Lambda[117∈0]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression119["PgClassExpression[119∈0]<br />ᐸ__person_s..._.”sekrit”ᐳ"]:::plan
    PgSelect120[["PgSelect[120∈0]<br />ᐸpersonSecretᐳ"]]:::plan
    __Item121>"__Item[121∈1]<br />ᐸ120ᐳ"]:::itemplan
    PgSelectSingle122["PgSelectSingle[122∈1]<br />ᐸpersonSecretᐳ"]:::plan
    Constant123["Constant[123∈1]"]:::plan
    PgClassExpression124["PgClassExpression[124∈1]<br />ᐸ__person_s...person_id”ᐳ"]:::plan
    List125["List[125∈1]<br />ᐸ123,124ᐳ"]:::plan
    Lambda126["Lambda[126∈1]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression128["PgClassExpression[128∈1]<br />ᐸ__person_s..._.”sekrit”ᐳ"]:::plan
    Constant129["Constant[129∈0]"]:::plan
    PgClassExpression130["PgClassExpression[130∈0]<br />ᐸ__person__.”id”ᐳ"]:::plan
    List131["List[131∈0]<br />ᐸ129,130ᐳ"]:::plan
    Lambda132["Lambda[132∈0]<br />ᐸencodeᐳ"]:::plan
    Map254["Map[254∈0]<br />ᐸ36:{”0”:0,”1”:1}ᐳ"]:::plan
    List255["List[255∈0]<br />ᐸ254ᐳ"]:::plan
    First138["First[138∈0]"]:::plan
    PgSelectSingle139["PgSelectSingle[139∈0]<br />ᐸpersonSecretᐳ"]:::plan
    Constant140["Constant[140∈0]"]:::plan
    PgClassExpression141["PgClassExpression[141∈0]<br />ᐸ__person_s...person_id”ᐳ"]:::plan
    List142["List[142∈0]<br />ᐸ140,141ᐳ"]:::plan
    Lambda143["Lambda[143∈0]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression145["PgClassExpression[145∈0]<br />ᐸ__person_s..._.”sekrit”ᐳ"]:::plan
    Constant146["Constant[146∈0]"]:::plan
    PgClassExpression147["PgClassExpression[147∈0]<br />ᐸ__left_arm__.”id”ᐳ"]:::plan
    List148["List[148∈0]<br />ᐸ146,147ᐳ"]:::plan
    Lambda149["Lambda[149∈0]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression151["PgClassExpression[151∈0]<br />ᐸ__left_arm...person_id”ᐳ"]:::plan
    PgClassExpression152["PgClassExpression[152∈0]<br />ᐸ__left_arm...in_metres”ᐳ"]:::plan
    PgClassExpression153["PgClassExpression[153∈0]<br />ᐸ__left_arm__.”mood”ᐳ"]:::plan
    PgSelect154[["PgSelect[154∈0]<br />ᐸleftArmᐳ"]]:::plan
    __Item155>"__Item[155∈2]<br />ᐸ154ᐳ"]:::itemplan
    PgSelectSingle156["PgSelectSingle[156∈2]<br />ᐸleftArmᐳ"]:::plan
    Constant157["Constant[157∈2]"]:::plan
    PgClassExpression158["PgClassExpression[158∈2]<br />ᐸ__left_arm__.”id”ᐳ"]:::plan
    List159["List[159∈2]<br />ᐸ157,158ᐳ"]:::plan
    Lambda160["Lambda[160∈2]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression162["PgClassExpression[162∈2]<br />ᐸ__left_arm...person_id”ᐳ"]:::plan
    PgClassExpression163["PgClassExpression[163∈2]<br />ᐸ__left_arm...in_metres”ᐳ"]:::plan
    PgClassExpression164["PgClassExpression[164∈2]<br />ᐸ__left_arm__.”mood”ᐳ"]:::plan
    Constant165["Constant[165∈0]"]:::plan
    PgClassExpression166["PgClassExpression[166∈0]<br />ᐸ__person__.”id”ᐳ"]:::plan
    List167["List[167∈0]<br />ᐸ165,166ᐳ"]:::plan
    Lambda168["Lambda[168∈0]<br />ᐸencodeᐳ"]:::plan
    Map252["Map[252∈0]<br />ᐸ68:{”0”:0,”1”:1,”2”:2,”3”:3}ᐳ"]:::plan
    List253["List[253∈0]<br />ᐸ252ᐳ"]:::plan
    First174["First[174∈0]"]:::plan
    PgSelectSingle175["PgSelectSingle[175∈0]<br />ᐸleftArmᐳ"]:::plan
    Constant176["Constant[176∈0]"]:::plan
    PgClassExpression177["PgClassExpression[177∈0]<br />ᐸ__left_arm__.”id”ᐳ"]:::plan
    List178["List[178∈0]<br />ᐸ176,177ᐳ"]:::plan
    Lambda179["Lambda[179∈0]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression181["PgClassExpression[181∈0]<br />ᐸ__left_arm...person_id”ᐳ"]:::plan
    PgClassExpression182["PgClassExpression[182∈0]<br />ᐸ__left_arm...in_metres”ᐳ"]:::plan
    PgClassExpression183["PgClassExpression[183∈0]<br />ᐸ__left_arm__.”mood”ᐳ"]:::plan
    Constant184["Constant[184∈0]"]:::plan
    PgClassExpression185["PgClassExpression[185∈0]<br />ᐸ__post__.”id”ᐳ"]:::plan
    List186["List[186∈0]<br />ᐸ184,185ᐳ"]:::plan
    Lambda187["Lambda[187∈0]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression189["PgClassExpression[189∈0]<br />ᐸ__post__.”headline”ᐳ"]:::plan
    PgClassExpression190["PgClassExpression[190∈0]<br />ᐸ__post__.”body”ᐳ"]:::plan
    PgClassExpression191["PgClassExpression[191∈0]<br />ᐸ__post__.”author_id”ᐳ"]:::plan
    PgSelect192[["PgSelect[192∈0]<br />ᐸpostᐳ"]]:::plan
    __Item193>"__Item[193∈3]<br />ᐸ192ᐳ"]:::itemplan
    PgSelectSingle194["PgSelectSingle[194∈3]<br />ᐸpostᐳ"]:::plan
    Constant195["Constant[195∈3]"]:::plan
    PgClassExpression196["PgClassExpression[196∈3]<br />ᐸ__post__.”id”ᐳ"]:::plan
    List197["List[197∈3]<br />ᐸ195,196ᐳ"]:::plan
    Lambda198["Lambda[198∈3]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression200["PgClassExpression[200∈3]<br />ᐸ__post__.”headline”ᐳ"]:::plan
    PgClassExpression201["PgClassExpression[201∈3]<br />ᐸ__post__.”body”ᐳ"]:::plan
    PgClassExpression202["PgClassExpression[202∈3]<br />ᐸ__post__.”author_id”ᐳ"]:::plan
    Constant203["Constant[203∈0]"]:::plan
    PgClassExpression204["PgClassExpression[204∈0]<br />ᐸ__person__.”id”ᐳ"]:::plan
    List205["List[205∈0]<br />ᐸ203,204ᐳ"]:::plan
    Lambda206["Lambda[206∈0]<br />ᐸencodeᐳ"]:::plan
    Connection232["Connection[232∈0]<br />ᐸ228ᐳ"]:::plan
    Access251["Access[251∈0]<br />ᐸ106.0ᐳ"]:::plan
    __Item234>"__Item[234∈4]<br />ᐸ251ᐳ"]:::itemplan
    PgSelectSingle235["PgSelectSingle[235∈4]<br />ᐸpostᐳ"]:::plan
    Constant236["Constant[236∈4]"]:::plan
    PgClassExpression237["PgClassExpression[237∈4]<br />ᐸ__post__.”id”ᐳ"]:::plan
    List238["List[238∈4]<br />ᐸ236,237ᐳ"]:::plan
    Lambda239["Lambda[239∈4]<br />ᐸencodeᐳ"]:::plan
    PgClassExpression241["PgClassExpression[241∈4]<br />ᐸ__post__.”headline”ᐳ"]:::plan
    PgClassExpression242["PgClassExpression[242∈4]<br />ᐸ__post__.”body”ᐳ"]:::plan
    PgClassExpression243["PgClassExpression[243∈4]<br />ᐸ__post__.”author_id”ᐳ"]:::plan
    Constant244["Constant[244∈0]"]:::plan
    PgClassExpression245["PgClassExpression[245∈0]<br />ᐸ__return_t...rson_id_1”ᐳ"]:::plan
    PgClassExpression246["PgClassExpression[246∈0]<br />ᐸ__return_t...rson_id_2”ᐳ"]:::plan
    List247["List[247∈0]<br />ᐸ244,245,246ᐳ"]:::plan
    Lambda248["Lambda[248∈0]<br />ᐸencodeᐳ"]:::plan

    %% plan dependencies
    __Value3 --> Access9
    __Value3 --> Access10
    Access9 & Access10 --> Object11
    Object11 & __InputStaticLeaf7 --> PgSelect8
    PgSelect8 --> First12
    First12 --> PgSelectSingle13
    Object11 & __InputStaticLeaf30 --> PgSelect31
    PgSelect31 --> First35
    First35 --> PgSelectSingle36
    Object11 & __InputStaticLeaf37 --> PgSelect38
    PgSelect38 --> First42
    First42 --> PgSelectSingle43
    Object11 & __InputStaticLeaf62 --> PgSelect63
    PgSelect63 --> First67
    First67 --> PgSelectSingle68
    Object11 & __InputStaticLeaf69 --> PgSelect70
    PgSelect70 --> First74
    First74 --> PgSelectSingle75
    Object11 & __InputStaticLeaf101 --> PgSelect102
    PgSelect102 --> First106
    First106 --> PgSelectSingle107
    Object11 --> PgSelect108
    PgSelect108 --> First112
    First112 --> PgSelectSingle113
    PgSelectSingle13 --> PgClassExpression115
    Constant114 & PgClassExpression115 --> List116
    List116 --> Lambda117
    PgSelectSingle13 --> PgClassExpression119
    Object11 & Connection29 --> PgSelect120
    PgSelect120 ==> __Item121
    __Item121 --> PgSelectSingle122
    PgSelectSingle122 --> PgClassExpression124
    Constant123 & PgClassExpression124 --> List125
    List125 --> Lambda126
    PgSelectSingle122 --> PgClassExpression128
    PgSelectSingle36 --> PgClassExpression130
    Constant129 & PgClassExpression130 --> List131
    List131 --> Lambda132
    PgSelectSingle36 --> Map254
    Map254 --> List255
    List255 --> First138
    First138 --> PgSelectSingle139
    PgSelectSingle139 --> PgClassExpression141
    Constant140 & PgClassExpression141 --> List142
    List142 --> Lambda143
    PgSelectSingle139 --> PgClassExpression145
    PgSelectSingle43 --> PgClassExpression147
    Constant146 & PgClassExpression147 --> List148
    List148 --> Lambda149
    PgSelectSingle43 --> PgClassExpression151
    PgSelectSingle43 --> PgClassExpression152
    PgSelectSingle43 --> PgClassExpression153
    Object11 & Connection61 --> PgSelect154
    PgSelect154 ==> __Item155
    __Item155 --> PgSelectSingle156
    PgSelectSingle156 --> PgClassExpression158
    Constant157 & PgClassExpression158 --> List159
    List159 --> Lambda160
    PgSelectSingle156 --> PgClassExpression162
    PgSelectSingle156 --> PgClassExpression163
    PgSelectSingle156 --> PgClassExpression164
    PgSelectSingle68 --> PgClassExpression166
    Constant165 & PgClassExpression166 --> List167
    List167 --> Lambda168
    PgSelectSingle68 --> Map252
    Map252 --> List253
    List253 --> First174
    First174 --> PgSelectSingle175
    PgSelectSingle175 --> PgClassExpression177
    Constant176 & PgClassExpression177 --> List178
    List178 --> Lambda179
    PgSelectSingle175 --> PgClassExpression181
    PgSelectSingle175 --> PgClassExpression182
    PgSelectSingle175 --> PgClassExpression183
    PgSelectSingle75 --> PgClassExpression185
    Constant184 & PgClassExpression185 --> List186
    List186 --> Lambda187
    PgSelectSingle75 --> PgClassExpression189
    PgSelectSingle75 --> PgClassExpression190
    PgSelectSingle75 --> PgClassExpression191
    Object11 & Connection100 --> PgSelect192
    PgSelect192 ==> __Item193
    __Item193 --> PgSelectSingle194
    PgSelectSingle194 --> PgClassExpression196
    Constant195 & PgClassExpression196 --> List197
    List197 --> Lambda198
    PgSelectSingle194 --> PgClassExpression200
    PgSelectSingle194 --> PgClassExpression201
    PgSelectSingle194 --> PgClassExpression202
    PgSelectSingle107 --> PgClassExpression204
    Constant203 & PgClassExpression204 --> List205
    List205 --> Lambda206
    First106 --> Access251
    Access251 ==> __Item234
    __Item234 --> PgSelectSingle235
    PgSelectSingle235 --> PgClassExpression237
    Constant236 & PgClassExpression237 --> List238
    List238 --> Lambda239
    PgSelectSingle235 --> PgClassExpression241
    PgSelectSingle235 --> PgClassExpression242
    PgSelectSingle235 --> PgClassExpression243
    PgSelectSingle113 --> PgClassExpression245
    PgSelectSingle113 --> PgClassExpression246
    Constant244 & PgClassExpression245 & PgClassExpression246 --> List247
    List247 --> Lambda248

    %% plan-to-path relationships

    subgraph "Buckets for queries/v4/rbac.basic"
    Bucket0("Bucket 0<br />(root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value3,__Value5,__InputStaticLeaf7,PgSelect8,Access9,Access10,Object11,First12,PgSelectSingle13,Connection29,__InputStaticLeaf30,PgSelect31,First35,PgSelectSingle36,__InputStaticLeaf37,PgSelect38,First42,PgSelectSingle43,Connection61,__InputStaticLeaf62,PgSelect63,First67,PgSelectSingle68,__InputStaticLeaf69,PgSelect70,First74,PgSelectSingle75,Connection100,__InputStaticLeaf101,PgSelect102,First106,PgSelectSingle107,PgSelect108,First112,PgSelectSingle113,Constant114,PgClassExpression115,List116,Lambda117,PgClassExpression119,PgSelect120,Constant129,PgClassExpression130,List131,Lambda132,First138,PgSelectSingle139,Constant140,PgClassExpression141,List142,Lambda143,PgClassExpression145,Constant146,PgClassExpression147,List148,Lambda149,PgClassExpression151,PgClassExpression152,PgClassExpression153,PgSelect154,Constant165,PgClassExpression166,List167,Lambda168,First174,PgSelectSingle175,Constant176,PgClassExpression177,List178,Lambda179,PgClassExpression181,PgClassExpression182,PgClassExpression183,Constant184,PgClassExpression185,List186,Lambda187,PgClassExpression189,PgClassExpression190,PgClassExpression191,PgSelect192,Constant203,PgClassExpression204,List205,Lambda206,Connection232,Constant244,PgClassExpression245,PgClassExpression246,List247,Lambda248,Access251,Map252,List253,Map254,List255 bucket0
    Bucket1("Bucket 1<br />(listItem)<br />Deps: 120<br /><br />ROOT __Item{1}ᐸ120ᐳ[121]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item121,PgSelectSingle122,Constant123,PgClassExpression124,List125,Lambda126,PgClassExpression128 bucket1
    Bucket2("Bucket 2<br />(listItem)<br />Deps: 154<br /><br />ROOT __Item{2}ᐸ154ᐳ[155]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item155,PgSelectSingle156,Constant157,PgClassExpression158,List159,Lambda160,PgClassExpression162,PgClassExpression163,PgClassExpression164 bucket2
    Bucket3("Bucket 3<br />(listItem)<br />Deps: 192<br /><br />ROOT __Item{3}ᐸ192ᐳ[193]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item193,PgSelectSingle194,Constant195,PgClassExpression196,List197,Lambda198,PgClassExpression200,PgClassExpression201,PgClassExpression202 bucket3
    Bucket4("Bucket 4<br />(listItem)<br />Deps: 251<br /><br />ROOT __Item{4}ᐸ251ᐳ[234]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item234,PgSelectSingle235,Constant236,PgClassExpression237,List238,Lambda239,PgClassExpression241,PgClassExpression242,PgClassExpression243 bucket4
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4
    end
