graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:3px,color:#000
    classDef itemplan fill:#fff,stroke-width:6px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:6px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:6px,text-align:left


    %% define steps
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    Access20["Access[20∈0]<br />ᐸ3.pgSettingsᐳ"]:::plan
    Access21["Access[21∈0]<br />ᐸ3.withPgClientᐳ"]:::plan
    Object22["Object[22∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"]:::plan
    Connection23["Connection[23∈0]<br />ᐸ19ᐳ"]:::plan
    Connection42["Connection[42∈0]<br />ᐸ38ᐳ"]:::plan
    PgSelect43[["PgSelect[43∈0]<br />ᐸcompoundKeyᐳ"]]:::plan
    __Item44>"__Item[44∈1]<br />ᐸ43ᐳ"]:::itemplan
    PgSelectSingle45["PgSelectSingle[45∈1]<br />ᐸcompoundKeyᐳ"]:::plan
    PgClassExpression46["PgClassExpression[46∈1]<br />ᐸ__compound...rson_id_1”ᐳ"]:::plan
    PgClassExpression47["PgClassExpression[47∈1]<br />ᐸ__compound...rson_id_2”ᐳ"]:::plan
    PgClassExpression48["PgClassExpression[48∈1]<br />ᐸ__compound...__.”extra”ᐳ"]:::plan
    Map99["Map[99∈1]<br />ᐸ45:{”0”:2,”1”:3}ᐳ"]:::plan
    List100["List[100∈1]<br />ᐸ99ᐳ"]:::plan
    First54["First[54∈1]"]:::plan
    PgSelectSingle55["PgSelectSingle[55∈1]<br />ᐸpersonᐳ"]:::plan
    Map97["Map[97∈1]<br />ᐸ45:{”0”:0,”1”:1}ᐳ"]:::plan
    List98["List[98∈1]<br />ᐸ97ᐳ"]:::plan
    First61["First[61∈1]"]:::plan
    PgSelectSingle62["PgSelectSingle[62∈1]<br />ᐸpersonᐳ"]:::plan
    PgClassExpression63["PgClassExpression[63∈1]<br />ᐸ__person__...full_name”ᐳ"]:::plan
    PgClassExpression64["PgClassExpression[64∈1]<br />ᐸ__person__.”email”ᐳ"]:::plan
    PgClassExpression65["PgClassExpression[65∈1]<br />ᐸ__person__...full_name”ᐳ"]:::plan
    PgClassExpression66["PgClassExpression[66∈1]<br />ᐸ__person__.”email”ᐳ"]:::plan
    PgSelect67[["PgSelect[67∈0]<br />ᐸforeignKeyᐳ"]]:::plan
    __Item68>"__Item[68∈2]<br />ᐸ67ᐳ"]:::itemplan
    PgSelectSingle69["PgSelectSingle[69∈2]<br />ᐸforeignKeyᐳ"]:::plan
    PgClassExpression70["PgClassExpression[70∈2]<br />ᐸ__foreign_...person_id”ᐳ"]:::plan
    PgClassExpression71["PgClassExpression[71∈2]<br />ᐸ__foreign_...und_key_1”ᐳ"]:::plan
    PgClassExpression72["PgClassExpression[72∈2]<br />ᐸ__foreign_...und_key_2”ᐳ"]:::plan
    Map95["Map[95∈2]<br />ᐸ69:{”0”:3,”1”:4}ᐳ"]:::plan
    List96["List[96∈2]<br />ᐸ95ᐳ"]:::plan
    First78["First[78∈2]"]:::plan
    PgSelectSingle79["PgSelectSingle[79∈2]<br />ᐸpersonᐳ"]:::plan
    Map93["Map[93∈2]<br />ᐸ69:{”0”:0,”1”:1,”2”:2}ᐳ"]:::plan
    List94["List[94∈2]<br />ᐸ93ᐳ"]:::plan
    First86["First[86∈2]"]:::plan
    PgSelectSingle87["PgSelectSingle[87∈2]<br />ᐸcompoundKeyᐳ"]:::plan
    PgClassExpression88["PgClassExpression[88∈2]<br />ᐸ__person__...full_name”ᐳ"]:::plan
    PgClassExpression89["PgClassExpression[89∈2]<br />ᐸ__person__.”email”ᐳ"]:::plan
    PgClassExpression90["PgClassExpression[90∈2]<br />ᐸ__compound...rson_id_1”ᐳ"]:::plan
    PgClassExpression91["PgClassExpression[91∈2]<br />ᐸ__compound...rson_id_2”ᐳ"]:::plan
    PgClassExpression92["PgClassExpression[92∈2]<br />ᐸ__compound...__.”extra”ᐳ"]:::plan

    %% plan dependencies
    __Value3 --> Access20
    __Value3 --> Access21
    Access20 & Access21 --> Object22
    Object22 & Connection23 --> PgSelect43
    PgSelect43 ==> __Item44
    __Item44 --> PgSelectSingle45
    PgSelectSingle45 --> PgClassExpression46
    PgSelectSingle45 --> PgClassExpression47
    PgSelectSingle45 --> PgClassExpression48
    PgSelectSingle45 --> Map99
    Map99 --> List100
    List100 --> First54
    First54 --> PgSelectSingle55
    PgSelectSingle45 --> Map97
    Map97 --> List98
    List98 --> First61
    First61 --> PgSelectSingle62
    PgSelectSingle55 --> PgClassExpression63
    PgSelectSingle55 --> PgClassExpression64
    PgSelectSingle62 --> PgClassExpression65
    PgSelectSingle62 --> PgClassExpression66
    Object22 & Connection42 --> PgSelect67
    PgSelect67 ==> __Item68
    __Item68 --> PgSelectSingle69
    PgSelectSingle69 --> PgClassExpression70
    PgSelectSingle69 --> PgClassExpression71
    PgSelectSingle69 --> PgClassExpression72
    PgSelectSingle69 --> Map95
    Map95 --> List96
    List96 --> First78
    First78 --> PgSelectSingle79
    PgSelectSingle69 --> Map93
    Map93 --> List94
    List94 --> First86
    First86 --> PgSelectSingle87
    PgSelectSingle79 --> PgClassExpression88
    PgSelectSingle79 --> PgClassExpression89
    PgSelectSingle87 --> PgClassExpression90
    PgSelectSingle87 --> PgClassExpression91
    PgSelectSingle87 --> PgClassExpression92

    %% plan-to-path relationships

    subgraph "Buckets for queries/v4/relation-tail-head"
    Bucket0("Bucket 0<br />(root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value3,__Value5,Access20,Access21,Object22,Connection23,Connection42,PgSelect43,PgSelect67 bucket0
    Bucket1("Bucket 1<br />(listItem)<br />Deps: 43<br /><br />ROOT __Item{1}ᐸ43ᐳ[44]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item44,PgSelectSingle45,PgClassExpression46,PgClassExpression47,PgClassExpression48,First54,PgSelectSingle55,First61,PgSelectSingle62,PgClassExpression63,PgClassExpression64,PgClassExpression65,PgClassExpression66,Map97,List98,Map99,List100 bucket1
    Bucket2("Bucket 2<br />(listItem)<br />Deps: 67<br /><br />ROOT __Item{2}ᐸ67ᐳ[68]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item68,PgSelectSingle69,PgClassExpression70,PgClassExpression71,PgClassExpression72,First78,PgSelectSingle79,First86,PgSelectSingle87,PgClassExpression88,PgClassExpression89,PgClassExpression90,PgClassExpression91,PgClassExpression92,Map93,List94,Map95,List96 bucket2
    Bucket0 --> Bucket1 & Bucket2
    end
