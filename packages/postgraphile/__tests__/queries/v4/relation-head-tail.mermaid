graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:3px,color:#000
    classDef itemplan fill:#fff,stroke-width:6px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:6px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:6px,text-align:left


    %% define steps
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    Access31["Access[31∈0]<br />ᐸ3.pgSettingsᐳ"]:::plan
    Access32["Access[32∈0]<br />ᐸ3.withPgClientᐳ"]:::plan
    Object33["Object[33∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"]:::plan
    Connection34["Connection[34∈0]<br />ᐸ30ᐳ"]:::plan
    __InputStaticLeaf78["__InputStaticLeaf[78∈0]"]:::plan
    PgSelect35[["PgSelect[35∈0]<br />ᐸpersonᐳ"]]:::plan
    __Item36>"__Item[36∈1]<br />ᐸ35ᐳ"]:::itemplan
    PgSelectSingle37["PgSelectSingle[37∈1]<br />ᐸpersonᐳ"]:::plan
    PgClassExpression38["PgClassExpression[38∈1]<br />ᐸ__person__.”id”ᐳ"]:::plan
    PgClassExpression39["PgClassExpression[39∈1]<br />ᐸ__person__...full_name”ᐳ"]:::plan
    __InputStaticLeaf41["__InputStaticLeaf[41∈0]"]:::plan
    Connection65["Connection[65∈0]<br />ᐸ61ᐳ"]:::plan
    Access195["Access[195∈1]<br />ᐸ36.1ᐳ"]:::plan
    Reverse196["Reverse[196∈1]"]:::plan
    __Item67>"__Item[67∈2]<br />ᐸ196ᐳ"]:::itemplan
    PgSelectSingle68["PgSelectSingle[68∈2]<br />ᐸpostᐳ"]:::plan
    PgClassExpression69["PgClassExpression[69∈2]<br />ᐸ__post__.”headline”ᐳ"]:::plan
    PgClassExpression70["PgClassExpression[70∈2]<br />ᐸ__post__.”author_id”ᐳ"]:::plan
    Connection96["Connection[96∈0]<br />ᐸ92ᐳ"]:::plan
    Access198["Access[198∈1]<br />ᐸ36.2ᐳ"]:::plan
    __Item98>"__Item[98∈3]<br />ᐸ198ᐳ"]:::itemplan
    PgSelectSingle99["PgSelectSingle[99∈3]<br />ᐸpostᐳ"]:::plan
    PgClassExpression100["PgClassExpression[100∈3]<br />ᐸ__post__.”headline”ᐳ"]:::plan
    PgClassExpression101["PgClassExpression[101∈3]<br />ᐸ__post__.”author_id”ᐳ"]:::plan
    Connection119["Connection[119∈0]<br />ᐸ115ᐳ"]:::plan
    Access200["Access[200∈1]<br />ᐸ36.4ᐳ"]:::plan
    __Item121>"__Item[121∈4]<br />ᐸ200ᐳ"]:::itemplan
    PgSelectSingle122["PgSelectSingle[122∈4]<br />ᐸcompoundKeyᐳ"]:::plan
    PgClassExpression123["PgClassExpression[123∈4]<br />ᐸ__compound...rson_id_1”ᐳ"]:::plan
    PgClassExpression124["PgClassExpression[124∈4]<br />ᐸ__compound...rson_id_2”ᐳ"]:::plan
    Connection142["Connection[142∈0]<br />ᐸ138ᐳ"]:::plan
    Access199["Access[199∈1]<br />ᐸ36.3ᐳ"]:::plan
    __Item144>"__Item[144∈5]<br />ᐸ199ᐳ"]:::itemplan
    PgSelectSingle145["PgSelectSingle[145∈5]<br />ᐸcompoundKeyᐳ"]:::plan
    PgClassExpression146["PgClassExpression[146∈5]<br />ᐸ__compound...rson_id_1”ᐳ"]:::plan
    PgClassExpression147["PgClassExpression[147∈5]<br />ᐸ__compound...rson_id_2”ᐳ"]:::plan
    Connection164["Connection[164∈0]<br />ᐸ160ᐳ"]:::plan
    PgSelect165[["PgSelect[165∈0]<br />ᐸcompoundKeyᐳ"]]:::plan
    __Item166>"__Item[166∈6]<br />ᐸ165ᐳ"]:::itemplan
    PgSelectSingle167["PgSelectSingle[167∈6]<br />ᐸcompoundKeyᐳ"]:::plan
    PgClassExpression168["PgClassExpression[168∈6]<br />ᐸ__compound...rson_id_1”ᐳ"]:::plan
    PgClassExpression169["PgClassExpression[169∈6]<br />ᐸ__compound...rson_id_2”ᐳ"]:::plan
    Connection188["Connection[188∈0]<br />ᐸ184ᐳ"]:::plan
    Access197["Access[197∈6]<br />ᐸ166.0ᐳ"]:::plan
    __Item190>"__Item[190∈7]<br />ᐸ197ᐳ"]:::itemplan
    PgSelectSingle191["PgSelectSingle[191∈7]<br />ᐸforeignKeyᐳ"]:::plan
    PgClassExpression192["PgClassExpression[192∈7]<br />ᐸ__foreign_...person_id”ᐳ"]:::plan
    PgClassExpression193["PgClassExpression[193∈7]<br />ᐸ__foreign_...und_key_1”ᐳ"]:::plan
    PgClassExpression194["PgClassExpression[194∈7]<br />ᐸ__foreign_...und_key_2”ᐳ"]:::plan

    %% plan dependencies
    __Value3 --> Access31
    __Value3 --> Access32
    Access31 & Access32 --> Object33
    Object33 & Connection34 & __InputStaticLeaf78 --> PgSelect35
    PgSelect35 ==> __Item36
    __Item36 --> PgSelectSingle37
    PgSelectSingle37 --> PgClassExpression38
    PgSelectSingle37 --> PgClassExpression39
    __InputStaticLeaf41 --> Connection65
    __Item36 --> Access195
    Access195 --> Reverse196
    Reverse196 ==> __Item67
    __Item67 --> PgSelectSingle68
    PgSelectSingle68 --> PgClassExpression69
    PgSelectSingle68 --> PgClassExpression70
    __Item36 --> Access198
    Access198 ==> __Item98
    __Item98 --> PgSelectSingle99
    PgSelectSingle99 --> PgClassExpression100
    PgSelectSingle99 --> PgClassExpression101
    __Item36 --> Access200
    Access200 ==> __Item121
    __Item121 --> PgSelectSingle122
    PgSelectSingle122 --> PgClassExpression123
    PgSelectSingle122 --> PgClassExpression124
    __Item36 --> Access199
    Access199 ==> __Item144
    __Item144 --> PgSelectSingle145
    PgSelectSingle145 --> PgClassExpression146
    PgSelectSingle145 --> PgClassExpression147
    Object33 & Connection164 --> PgSelect165
    PgSelect165 ==> __Item166
    __Item166 --> PgSelectSingle167
    PgSelectSingle167 --> PgClassExpression168
    PgSelectSingle167 --> PgClassExpression169
    __Item166 --> Access197
    Access197 ==> __Item190
    __Item190 --> PgSelectSingle191
    PgSelectSingle191 --> PgClassExpression192
    PgSelectSingle191 --> PgClassExpression193
    PgSelectSingle191 --> PgClassExpression194

    %% plan-to-path relationships

    subgraph "Buckets for queries/v4/relation-head-tail"
    Bucket0("Bucket 0<br />(root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value3,__Value5,Access31,Access32,Object33,Connection34,PgSelect35,__InputStaticLeaf41,Connection65,__InputStaticLeaf78,Connection96,Connection119,Connection142,Connection164,PgSelect165,Connection188 bucket0
    Bucket1("Bucket 1<br />(listItem)<br />Deps: 65, 96, 119, 142<br /><br />ROOT __Item{1}ᐸ35ᐳ[36]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item36,PgSelectSingle37,PgClassExpression38,PgClassExpression39,Access195,Reverse196,Access198,Access199,Access200 bucket1
    Bucket2("Bucket 2<br />(listItem)<br />ROOT __Item{2}ᐸ196ᐳ[67]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item67,PgSelectSingle68,PgClassExpression69,PgClassExpression70 bucket2
    Bucket3("Bucket 3<br />(listItem)<br />ROOT __Item{3}ᐸ198ᐳ[98]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item98,PgSelectSingle99,PgClassExpression100,PgClassExpression101 bucket3
    Bucket4("Bucket 4<br />(listItem)<br />ROOT __Item{4}ᐸ200ᐳ[121]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item121,PgSelectSingle122,PgClassExpression123,PgClassExpression124 bucket4
    Bucket5("Bucket 5<br />(listItem)<br />ROOT __Item{5}ᐸ199ᐳ[144]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item144,PgSelectSingle145,PgClassExpression146,PgClassExpression147 bucket5
    Bucket6("Bucket 6<br />(listItem)<br />Deps: 188<br /><br />ROOT __Item{6}ᐸ165ᐳ[166]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item166,PgSelectSingle167,PgClassExpression168,PgClassExpression169,Access197 bucket6
    Bucket7("Bucket 7<br />(listItem)<br />ROOT __Item{7}ᐸ197ᐳ[190]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item190,PgSelectSingle191,PgClassExpression192,PgClassExpression193,PgClassExpression194 bucket7
    Bucket0 --> Bucket1 & Bucket6
    Bucket1 --> Bucket2 & Bucket3 & Bucket4 & Bucket5
    Bucket6 --> Bucket7
    end
