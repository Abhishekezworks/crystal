%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/relay/computed-id.minimal"
    Bucket0("Bucket 0 (root)<br /><br />1: 80, 84, 88<br />ᐳ: 11, 12, 18, 92, 93, 94, 7, 8, 13, 19, 20, 41, 42, 61, 62<br />2: 22, 44, 64<br />3: 27, 47, 67<br />ᐳ: 26, 28, 29, 38, 46, 48, 49, 58, 66, 68, 69, 78<br />4: PgSelect[10]<br />ᐳ: Access[81], Access[85], Access[89]<br />5: PgSelectRows[15]<br />ᐳ: First[14], PgSelectSingle[16]"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 16, 81, 85, 89<br /><br />ROOT PgSelectSingleᐸusersᐳ[16]<br />1: <br />ᐳ: 17, 82, 86, 90, 83, 87, 91<br />2: 35, 55, 75<br />ᐳ: 34, 36, 39, 54, 56, 59, 74, 76, 79"):::bucket
    end
    Bucket0 --> Bucket1

    %% plan dependencies
    PgSelect10[["PgSelect[10∈0] ➊<br />ᐸusersᐳ"]]:::plan
    Object13{{"Object[13∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access8{{"Access[8∈0] ➊<br />ᐸ7.1ᐳ"}}:::plan
    PgFromExpression38{{"PgFromExpression[38∈0] ➊"}}:::plan
    PgSelectInlineApply80["PgSelectInlineApply[80∈0] ➊"]:::plan
    PgFromExpression58{{"PgFromExpression[58∈0] ➊"}}:::plan
    PgSelectInlineApply84["PgSelectInlineApply[84∈0] ➊"]:::plan
    PgFromExpression78{{"PgFromExpression[78∈0] ➊"}}:::plan
    PgSelectInlineApply88["PgSelectInlineApply[88∈0] ➊"]:::plan
    Access8 -->|rejectNull| PgSelect10
    Object13 & PgFromExpression38 & PgSelectInlineApply80 & PgFromExpression58 & PgSelectInlineApply84 & PgFromExpression78 & PgSelectInlineApply88 --> PgSelect10
    Access11{{"Access[11∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access11 & Access12 --> Object13
    PgSelect22[["PgSelect[22∈0] ➊<br />ᐸspectaclesᐳ"]]:::plan
    Access20{{"Access[20∈0] ➊<br />ᐸ19.1ᐳ"}}:::plan
    Access20 -->|rejectNull| PgSelect22
    Object13 --> PgSelect22
    PgSelect44[["PgSelect[44∈0] ➊<br />ᐸspectaclesᐳ"]]:::plan
    Access42{{"Access[42∈0] ➊<br />ᐸ41.1ᐳ"}}:::plan
    Access42 -->|rejectNull| PgSelect44
    Object13 --> PgSelect44
    PgSelect64[["PgSelect[64∈0] ➊<br />ᐸspectaclesᐳ"]]:::plan
    Access62{{"Access[62∈0] ➊<br />ᐸ61.1ᐳ"}}:::plan
    Access62 -->|rejectNull| PgSelect64
    Object13 --> PgSelect64
    Lambda7{{"Lambda[7∈0] ➊<br />ᐸspecifier_User_base64JSONᐳ<br />More deps:<br />- Constantᐸ'WyJ1c2VycyIsMV0='ᐳ[92]"}}:::plan
    Lambda7 --> Access8
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access11
    __Value2 --> Access12
    First14{{"First[14∈0] ➊"}}:::plan
    PgSelectRows15[["PgSelectRows[15∈0] ➊"]]:::plan
    PgSelectRows15 --> First14
    PgSelect10 --> PgSelectRows15
    PgSelectSingle16{{"PgSelectSingle[16∈0] ➊<br />ᐸusersᐳ"}}:::plan
    First14 --> PgSelectSingle16
    Lambda19{{"Lambda[19∈0] ➊<br />ᐸspecifier_Spectacle_base64JSONᐳ<br />More deps:<br />- Constantᐸundefinedᐳ[18]"}}:::plan
    Lambda19 --> Access20
    First26{{"First[26∈0] ➊"}}:::plan
    PgSelectRows27[["PgSelectRows[27∈0] ➊"]]:::plan
    PgSelectRows27 --> First26
    PgSelect22 --> PgSelectRows27
    PgSelectSingle28{{"PgSelectSingle[28∈0] ➊<br />ᐸspectaclesᐳ"}}:::plan
    First26 --> PgSelectSingle28
    PgClassExpression29{{"PgClassExpression[29∈0] ➊<br />ᐸ__spectacles__ᐳ"}}:::plan
    PgSelectSingle28 --> PgClassExpression29
    PgClassExpression29 -->|trapInhibited| PgFromExpression38
    Lambda41{{"Lambda[41∈0] ➊<br />ᐸspecifier_Spectacle_base64JSONᐳ<br />More deps:<br />- Constantᐸ'WyJzcGVjdGFjbGVzIiwxXQ=='ᐳ[93]"}}:::plan
    Lambda41 --> Access42
    First46{{"First[46∈0] ➊"}}:::plan
    PgSelectRows47[["PgSelectRows[47∈0] ➊"]]:::plan
    PgSelectRows47 --> First46
    PgSelect44 --> PgSelectRows47
    PgSelectSingle48{{"PgSelectSingle[48∈0] ➊<br />ᐸspectaclesᐳ"}}:::plan
    First46 --> PgSelectSingle48
    PgClassExpression49{{"PgClassExpression[49∈0] ➊<br />ᐸ__spectacles__ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression49
    PgClassExpression49 -->|trapInhibited| PgFromExpression58
    Lambda61{{"Lambda[61∈0] ➊<br />ᐸspecifier_Spectacle_base64JSONᐳ<br />More deps:<br />- Constantᐸ'query'ᐳ[94]"}}:::plan
    Lambda61 --> Access62
    First66{{"First[66∈0] ➊"}}:::plan
    PgSelectRows67[["PgSelectRows[67∈0] ➊"]]:::plan
    PgSelectRows67 --> First66
    PgSelect64 --> PgSelectRows67
    PgSelectSingle68{{"PgSelectSingle[68∈0] ➊<br />ᐸspectaclesᐳ"}}:::plan
    First66 --> PgSelectSingle68
    PgClassExpression69{{"PgClassExpression[69∈0] ➊<br />ᐸ__spectacles__ᐳ"}}:::plan
    PgSelectSingle68 --> PgClassExpression69
    PgClassExpression69 -->|trapInhibited| PgFromExpression78
    Access81{{"Access[81∈0] ➊<br />ᐸ10.m.joinDetailsFor32ᐳ"}}:::plan
    PgSelect10 --> Access81
    Access85{{"Access[85∈0] ➊<br />ᐸ10.m.joinDetailsFor52ᐳ"}}:::plan
    PgSelect10 --> Access85
    Access89{{"Access[89∈0] ➊<br />ᐸ10.m.joinDetailsFor72ᐳ"}}:::plan
    PgSelect10 --> Access89
    List82{{"List[82∈1] ➊<br />ᐸ81,16ᐳ"}}:::plan
    Access81 & PgSelectSingle16 --> List82
    List86{{"List[86∈1] ➊<br />ᐸ85,16ᐳ"}}:::plan
    Access85 & PgSelectSingle16 --> List86
    List90{{"List[90∈1] ➊<br />ᐸ89,16ᐳ"}}:::plan
    Access89 & PgSelectSingle16 --> List90
    PgClassExpression17{{"PgClassExpression[17∈1] ➊<br />ᐸ__users__.”username”ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression17
    First34{{"First[34∈1] ➊"}}:::plan
    PgSelectRows35[["PgSelectRows[35∈1] ➊"]]:::plan
    PgSelectRows35 --> First34
    Lambda83{{"Lambda[83∈1] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda83 --> PgSelectRows35
    PgSelectSingle36{{"PgSelectSingle[36∈1] ➊<br />ᐸusersᐳ"}}:::plan
    First34 --> PgSelectSingle36
    PgClassExpression39{{"PgClassExpression[39∈1] ➊<br />ᐸ(1/0) /* E...ferred! */ᐳ"}}:::plan
    PgSelectSingle36 --> PgClassExpression39
    First54{{"First[54∈1] ➊"}}:::plan
    PgSelectRows55[["PgSelectRows[55∈1] ➊"]]:::plan
    PgSelectRows55 --> First54
    Lambda87{{"Lambda[87∈1] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda87 --> PgSelectRows55
    PgSelectSingle56{{"PgSelectSingle[56∈1] ➊<br />ᐸusersᐳ"}}:::plan
    First54 --> PgSelectSingle56
    PgClassExpression59{{"PgClassExpression[59∈1] ➊<br />ᐸ(1/0) /* E...ferred! */ᐳ"}}:::plan
    PgSelectSingle56 --> PgClassExpression59
    First74{{"First[74∈1] ➊"}}:::plan
    PgSelectRows75[["PgSelectRows[75∈1] ➊"]]:::plan
    PgSelectRows75 --> First74
    Lambda91{{"Lambda[91∈1] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda91 --> PgSelectRows75
    PgSelectSingle76{{"PgSelectSingle[76∈1] ➊<br />ᐸusersᐳ"}}:::plan
    First74 --> PgSelectSingle76
    PgClassExpression79{{"PgClassExpression[79∈1] ➊<br />ᐸ(1/0) /* E...ferred! */ᐳ"}}:::plan
    PgSelectSingle76 --> PgClassExpression79
    List82 --> Lambda83
    List86 --> Lambda87
    List90 --> Lambda91

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,Lambda7,Access8,PgSelect10,Access11,Access12,Object13,First14,PgSelectRows15,PgSelectSingle16,Lambda19,Access20,PgSelect22,First26,PgSelectRows27,PgSelectSingle28,PgClassExpression29,PgFromExpression38,Lambda41,Access42,PgSelect44,First46,PgSelectRows47,PgSelectSingle48,PgClassExpression49,PgFromExpression58,Lambda61,Access62,PgSelect64,First66,PgSelectRows67,PgSelectSingle68,PgClassExpression69,PgFromExpression78,PgSelectInlineApply80,Access81,PgSelectInlineApply84,Access85,PgSelectInlineApply88,Access89 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgClassExpression17,First34,PgSelectRows35,PgSelectSingle36,PgClassExpression39,First54,PgSelectRows55,PgSelectSingle56,PgClassExpression59,First74,PgSelectRows75,PgSelectSingle76,PgClassExpression79,List82,Lambda83,List86,Lambda87,List90,Lambda91 bucket1

