%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/relay/computed-id.minimal"
    Bucket0("Bucket 0 (root)<br /><br />1: 84, 89, 94<br />ᐳ: 11, 12, 18, 83, 98, 99, 100, 7, 8, 13, 19, 20, 42, 43, 63, 64<br />2: 22, 45, 66<br />3: 27, 48, 69<br />ᐳ: 26, 28, 29, 39, 47, 49, 50, 60, 68, 70, 71, 81<br />4: PgSelect[10]<br />ᐳ: Access[85], Access[90], Access[95]<br />5: PgSelectRows[15]<br />ᐳ: First[14], PgSelectSingle[16]"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 16, 85, 90, 95<br /><br />ROOT PgSelectSingleᐸusersᐳ[16]<br />1: <br />ᐳ: 17, 86, 91, 96, 87, 92, 97<br />2: 36, 57, 78<br />ᐳ: 35, 37, 40, 56, 58, 61, 77, 79, 82"):::bucket
    end
    Bucket0 --> Bucket1

    %% plan dependencies
    PgSelect10[["PgSelect[10∈0] ➊<br />ᐸusersᐳ"]]:::plan
    Object13{{"Object[13∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access8{{"Access[8∈0] ➊<br />ᐸ7.1ᐳ"}}:::plan
    PgFromExpression83{{"PgFromExpression[83∈0] ➊"}}:::plan
    PgFromExpression39{{"PgFromExpression[39∈0] ➊"}}:::plan
    PgSelectInlineApply84["PgSelectInlineApply[84∈0] ➊"]:::plan
    PgFromExpression60{{"PgFromExpression[60∈0] ➊"}}:::plan
    PgSelectInlineApply89["PgSelectInlineApply[89∈0] ➊"]:::plan
    PgFromExpression81{{"PgFromExpression[81∈0] ➊"}}:::plan
    PgSelectInlineApply94["PgSelectInlineApply[94∈0] ➊"]:::plan
    Access8 -->|rejectNull| PgSelect10
    Object13 & PgFromExpression39 & PgSelectInlineApply84 & PgFromExpression60 & PgSelectInlineApply89 & PgFromExpression81 & PgSelectInlineApply94 --> PgSelect10
    PgFromExpression83 -- 3 --> PgSelect10
    Access11{{"Access[11∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access11 & Access12 --> Object13
    PgSelect22[["PgSelect[22∈0] ➊<br />ᐸspectaclesᐳ"]]:::plan
    Access20{{"Access[20∈0] ➊<br />ᐸ19.1ᐳ"}}:::plan
    Access20 -->|rejectNull| PgSelect22
    Object13 --> PgSelect22
    PgSelect45[["PgSelect[45∈0] ➊<br />ᐸspectaclesᐳ"]]:::plan
    Access43{{"Access[43∈0] ➊<br />ᐸ42.1ᐳ"}}:::plan
    Access43 -->|rejectNull| PgSelect45
    Object13 --> PgSelect45
    PgSelect66[["PgSelect[66∈0] ➊<br />ᐸspectaclesᐳ"]]:::plan
    Access64{{"Access[64∈0] ➊<br />ᐸ63.1ᐳ"}}:::plan
    Access64 -->|rejectNull| PgSelect66
    Object13 --> PgSelect66
    Lambda7{{"Lambda[7∈0] ➊<br />ᐸspecifier_User_base64JSONᐳ<br />More deps:<br />- Constantᐸ'WyJ1c2VycyIsMV0='ᐳ[98]"}}:::plan
    Lambda7 --> Access8
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access11
    __Value2 --> Access12
    First14{{"First[14∈0] ➊"}}:::plan
    PgSelectRows15[["PgSelectRows[15∈0] ➊"]]:::plan
    PgSelectRows15 --> First14
    PgSelect10 --> PgSelectRows15
    PgSelectSingle16{{"PgSelectSingle[16∈0] ➊<br />ᐸusersᐳ"}}:::plan
    First14 --> PgSelectSingle16
    Lambda19{{"Lambda[19∈0] ➊<br />ᐸspecifier_Spectacle_base64JSONᐳ<br />More deps:<br />- Constantᐸundefinedᐳ[18]"}}:::plan
    Lambda19 --> Access20
    First26{{"First[26∈0] ➊"}}:::plan
    PgSelectRows27[["PgSelectRows[27∈0] ➊"]]:::plan
    PgSelectRows27 --> First26
    PgSelect22 --> PgSelectRows27
    PgSelectSingle28{{"PgSelectSingle[28∈0] ➊<br />ᐸspectaclesᐳ"}}:::plan
    First26 --> PgSelectSingle28
    PgClassExpression29{{"PgClassExpression[29∈0] ➊<br />ᐸ__spectacles__ᐳ"}}:::plan
    PgSelectSingle28 --> PgClassExpression29
    PgClassExpression29 -->|trapInhibited| PgFromExpression39
    Lambda42{{"Lambda[42∈0] ➊<br />ᐸspecifier_Spectacle_base64JSONᐳ<br />More deps:<br />- Constantᐸ'WyJzcGVjdGFjbGVzIiwxXQ=='ᐳ[99]"}}:::plan
    Lambda42 --> Access43
    First47{{"First[47∈0] ➊"}}:::plan
    PgSelectRows48[["PgSelectRows[48∈0] ➊"]]:::plan
    PgSelectRows48 --> First47
    PgSelect45 --> PgSelectRows48
    PgSelectSingle49{{"PgSelectSingle[49∈0] ➊<br />ᐸspectaclesᐳ"}}:::plan
    First47 --> PgSelectSingle49
    PgClassExpression50{{"PgClassExpression[50∈0] ➊<br />ᐸ__spectacles__ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression50
    PgClassExpression50 -->|trapInhibited| PgFromExpression60
    Lambda63{{"Lambda[63∈0] ➊<br />ᐸspecifier_Spectacle_base64JSONᐳ<br />More deps:<br />- Constantᐸ'query'ᐳ[100]"}}:::plan
    Lambda63 --> Access64
    First68{{"First[68∈0] ➊"}}:::plan
    PgSelectRows69[["PgSelectRows[69∈0] ➊"]]:::plan
    PgSelectRows69 --> First68
    PgSelect66 --> PgSelectRows69
    PgSelectSingle70{{"PgSelectSingle[70∈0] ➊<br />ᐸspectaclesᐳ"}}:::plan
    First68 --> PgSelectSingle70
    PgClassExpression71{{"PgClassExpression[71∈0] ➊<br />ᐸ__spectacles__ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression71
    PgClassExpression71 -->|trapInhibited| PgFromExpression81
    Access85{{"Access[85∈0] ➊<br />ᐸ10.m.joinDetailsFor32ᐳ"}}:::plan
    PgSelect10 --> Access85
    Access90{{"Access[90∈0] ➊<br />ᐸ10.m.joinDetailsFor53ᐳ"}}:::plan
    PgSelect10 --> Access90
    Access95{{"Access[95∈0] ➊<br />ᐸ10.m.joinDetailsFor74ᐳ"}}:::plan
    PgSelect10 --> Access95
    List86{{"List[86∈1] ➊<br />ᐸ85,16ᐳ"}}:::plan
    Access85 & PgSelectSingle16 --> List86
    List91{{"List[91∈1] ➊<br />ᐸ90,16ᐳ"}}:::plan
    Access90 & PgSelectSingle16 --> List91
    List96{{"List[96∈1] ➊<br />ᐸ95,16ᐳ"}}:::plan
    Access95 & PgSelectSingle16 --> List96
    PgClassExpression17{{"PgClassExpression[17∈1] ➊<br />ᐸ__users__.”username”ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression17
    First35{{"First[35∈1] ➊"}}:::plan
    PgSelectRows36[["PgSelectRows[36∈1] ➊"]]:::plan
    PgSelectRows36 --> First35
    Lambda87{{"Lambda[87∈1] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda87 --> PgSelectRows36
    PgSelectSingle37{{"PgSelectSingle[37∈1] ➊<br />ᐸusersᐳ"}}:::plan
    First35 --> PgSelectSingle37
    PgClassExpression40{{"PgClassExpression[40∈1] ➊<br />ᐸ(1/0) /* E...ferred! */ᐳ"}}:::plan
    PgSelectSingle37 --> PgClassExpression40
    First56{{"First[56∈1] ➊"}}:::plan
    PgSelectRows57[["PgSelectRows[57∈1] ➊"]]:::plan
    PgSelectRows57 --> First56
    Lambda92{{"Lambda[92∈1] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda92 --> PgSelectRows57
    PgSelectSingle58{{"PgSelectSingle[58∈1] ➊<br />ᐸusersᐳ"}}:::plan
    First56 --> PgSelectSingle58
    PgClassExpression61{{"PgClassExpression[61∈1] ➊<br />ᐸ(1/0) /* E...ferred! */ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression61
    First77{{"First[77∈1] ➊"}}:::plan
    PgSelectRows78[["PgSelectRows[78∈1] ➊"]]:::plan
    PgSelectRows78 --> First77
    Lambda97{{"Lambda[97∈1] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda97 --> PgSelectRows78
    PgSelectSingle79{{"PgSelectSingle[79∈1] ➊<br />ᐸusersᐳ"}}:::plan
    First77 --> PgSelectSingle79
    PgClassExpression82{{"PgClassExpression[82∈1] ➊<br />ᐸ(1/0) /* E...ferred! */ᐳ"}}:::plan
    PgSelectSingle79 --> PgClassExpression82
    List86 --> Lambda87
    List91 --> Lambda92
    List96 --> Lambda97

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,Lambda7,Access8,PgSelect10,Access11,Access12,Object13,First14,PgSelectRows15,PgSelectSingle16,Lambda19,Access20,PgSelect22,First26,PgSelectRows27,PgSelectSingle28,PgClassExpression29,PgFromExpression39,Lambda42,Access43,PgSelect45,First47,PgSelectRows48,PgSelectSingle49,PgClassExpression50,PgFromExpression60,Lambda63,Access64,PgSelect66,First68,PgSelectRows69,PgSelectSingle70,PgClassExpression71,PgFromExpression81,PgFromExpression83,PgSelectInlineApply84,Access85,PgSelectInlineApply89,Access90,PgSelectInlineApply94,Access95 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgClassExpression17,First35,PgSelectRows36,PgSelectSingle37,PgClassExpression40,First56,PgSelectRows57,PgSelectSingle58,PgClassExpression61,First77,PgSelectRows78,PgSelectSingle79,PgClassExpression82,List86,Lambda87,List91,Lambda92,List96,Lambda97 bucket1

