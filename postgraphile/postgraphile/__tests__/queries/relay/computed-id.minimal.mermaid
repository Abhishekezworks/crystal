%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/relay/computed-id.minimal"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 11, 12, 18, 57, 58, 59, 7, 9, 13, 19, 20, 32, 33, 45, 46<br />2: 21, 34, 47<br />3: 24, 37, 50<br />ᐳ: 23, 25, 26, 29, 36, 38, 39, 42, 49, 51, 52, 55<br />4: PgSelect[10]<br />5: PgSelectRows[15]<br />ᐳ: First[14], PgSelectSingle[16]"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 16<br /><br />ROOT PgSelectSingleᐸusersᐳ[16]"):::bucket
    end
    Bucket0 --> Bucket1

    %% plan dependencies
    PgSelect10[["PgSelect[10∈0] ➊<br />ᐸusersᐳ"]]:::plan
    Object13{{"Object[13∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ7.1ᐳ"}}:::plan
    PgFromExpression29{{"PgFromExpression[29∈0] ➊"}}:::plan
    PgFromExpression42{{"PgFromExpression[42∈0] ➊"}}:::plan
    PgFromExpression55{{"PgFromExpression[55∈0] ➊"}}:::plan
    Object13 & Access9 & PgFromExpression29 & PgFromExpression42 & PgFromExpression55 --> PgSelect10
    Access11{{"Access[11∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access11 & Access12 --> Object13
    PgSelect21[["PgSelect[21∈0] ➊<br />ᐸspectaclesᐳ"]]:::plan
    Access20{{"Access[20∈0] ➊<br />ᐸ19.1ᐳ"}}:::plan
    Object13 & Access20 --> PgSelect21
    PgSelect34[["PgSelect[34∈0] ➊<br />ᐸspectaclesᐳ"]]:::plan
    Access33{{"Access[33∈0] ➊<br />ᐸ32.1ᐳ"}}:::plan
    Object13 & Access33 --> PgSelect34
    PgSelect47[["PgSelect[47∈0] ➊<br />ᐸspectaclesᐳ"]]:::plan
    Access46{{"Access[46∈0] ➊<br />ᐸ45.1ᐳ"}}:::plan
    Object13 & Access46 --> PgSelect47
    Lambda7{{"Lambda[7∈0] ➊<br />ᐸspecifier_User_base64JSONᐳ<br />More deps:<br />- Constantᐸ'WyJ1c2VycyIsMV0='ᐳ[57]"}}:::plan
    Lambda7 -->|rejectNull| Access9
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access11
    __Value2 --> Access12
    First14{{"First[14∈0] ➊"}}:::plan
    PgSelectRows15[["PgSelectRows[15∈0] ➊"]]:::plan
    PgSelectRows15 --> First14
    PgSelect10 --> PgSelectRows15
    PgSelectSingle16{{"PgSelectSingle[16∈0] ➊<br />ᐸusersᐳ"}}:::plan
    First14 --> PgSelectSingle16
    Lambda19{{"Lambda[19∈0] ➊<br />ᐸspecifier_Spectacle_base64JSONᐳ<br />More deps:<br />- Constantᐸundefinedᐳ[18]"}}:::plan
    Lambda19 --> Access20
    First23{{"First[23∈0] ➊"}}:::plan
    PgSelectRows24[["PgSelectRows[24∈0] ➊"]]:::plan
    PgSelectRows24 --> First23
    PgSelect21 --> PgSelectRows24
    PgSelectSingle25{{"PgSelectSingle[25∈0] ➊<br />ᐸspectaclesᐳ"}}:::plan
    First23 --> PgSelectSingle25
    PgClassExpression26{{"PgClassExpression[26∈0] ➊<br />ᐸ__spectacles__ᐳ"}}:::plan
    PgSelectSingle25 --> PgClassExpression26
    PgClassExpression26 -->|trapInhibited| PgFromExpression29
    Lambda32{{"Lambda[32∈0] ➊<br />ᐸspecifier_Spectacle_base64JSONᐳ<br />More deps:<br />- Constantᐸ'WyJzcGVjdGFjbGVzIiwxXQ=='ᐳ[58]"}}:::plan
    Lambda32 --> Access33
    First36{{"First[36∈0] ➊"}}:::plan
    PgSelectRows37[["PgSelectRows[37∈0] ➊"]]:::plan
    PgSelectRows37 --> First36
    PgSelect34 --> PgSelectRows37
    PgSelectSingle38{{"PgSelectSingle[38∈0] ➊<br />ᐸspectaclesᐳ"}}:::plan
    First36 --> PgSelectSingle38
    PgClassExpression39{{"PgClassExpression[39∈0] ➊<br />ᐸ__spectacles__ᐳ"}}:::plan
    PgSelectSingle38 --> PgClassExpression39
    PgClassExpression39 -->|trapInhibited| PgFromExpression42
    Lambda45{{"Lambda[45∈0] ➊<br />ᐸspecifier_Spectacle_base64JSONᐳ<br />More deps:<br />- Constantᐸ'query'ᐳ[59]"}}:::plan
    Lambda45 --> Access46
    First49{{"First[49∈0] ➊"}}:::plan
    PgSelectRows50[["PgSelectRows[50∈0] ➊"]]:::plan
    PgSelectRows50 --> First49
    PgSelect47 --> PgSelectRows50
    PgSelectSingle51{{"PgSelectSingle[51∈0] ➊<br />ᐸspectaclesᐳ"}}:::plan
    First49 --> PgSelectSingle51
    PgClassExpression52{{"PgClassExpression[52∈0] ➊<br />ᐸ__spectacles__ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression52
    PgClassExpression52 -->|trapInhibited| PgFromExpression55
    PgClassExpression17{{"PgClassExpression[17∈1] ➊<br />ᐸ__users__.”username”ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression17
    PgClassExpression30{{"PgClassExpression[30∈1] ➊<br />ᐸ(1/0) /* E...ferred! */ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression30
    PgClassExpression43{{"PgClassExpression[43∈1] ➊<br />ᐸ(1/0) /* E...ferred! */ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression43
    PgClassExpression56{{"PgClassExpression[56∈1] ➊<br />ᐸ(1/0) /* E...ferred! */ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression56

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,Lambda7,Access9,PgSelect10,Access11,Access12,Object13,First14,PgSelectRows15,PgSelectSingle16,Lambda19,Access20,PgSelect21,First23,PgSelectRows24,PgSelectSingle25,PgClassExpression26,PgFromExpression29,Lambda32,Access33,PgSelect34,First36,PgSelectRows37,PgSelectSingle38,PgClassExpression39,PgFromExpression42,Lambda45,Access46,PgSelect47,First49,PgSelectRows50,PgSelectSingle51,PgClassExpression52,PgFromExpression55 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgClassExpression17,PgClassExpression30,PgClassExpression43,PgClassExpression56 bucket1

