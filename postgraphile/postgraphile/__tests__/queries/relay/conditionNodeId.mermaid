%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/relay/conditionNodeId"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 16, 19, 18, 142, 122<br /><br />ROOT Connectionᐸ12ᐳ[18]<br />1: PgSelect[50]<br />ᐳ: Access[143]<br />2: PgSelectRows[58]"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 16, 29, 28, 148, 122<br /><br />ROOT Connectionᐸ25ᐳ[28]<br />1: PgSelect[52]<br />ᐳ: Access[149]<br />2: PgSelectRows[61]"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 16, 38, 37, 160, 122<br /><br />ROOT Connectionᐸ34ᐳ[37]<br />1: PgSelect[54]<br />ᐳ: Access[161]<br />2: PgSelectRows[64]"):::bucket
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 16, 48, 47, 154, 122<br /><br />ROOT Connectionᐸ44ᐳ[47]<br />1: PgSelect[56]<br />ᐳ: Access[155]<br />2: PgSelectRows[67]"):::bucket
    Bucket5("Bucket 5 (listItem)<br />Deps: 143, 122<br /><br />ROOT __Item{5}ᐸ58ᐳ[59]"):::bucket
    Bucket6("Bucket 6 (listItem)<br />Deps: 149, 122<br /><br />ROOT __Item{6}ᐸ61ᐳ[62]"):::bucket
    Bucket7("Bucket 7 (listItem)<br />Deps: 161, 122<br /><br />ROOT __Item{7}ᐸ64ᐳ[65]"):::bucket
    Bucket8("Bucket 8 (listItem)<br />Deps: 155, 122<br /><br />ROOT __Item{8}ᐸ67ᐳ[68]"):::bucket
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 60, 143, 122<br /><br />ROOT PgSelectSingle{5}ᐸpostᐳ[60]<br />1: <br />ᐳ: 82, 145, 146<br />2: PgSelectRows[79]<br />ᐳ: First[78], PgSelectSingle[81]"):::bucket
    Bucket10("Bucket 10 (nullableBoundary)<br />Deps: 63, 149, 122<br /><br />ROOT PgSelectSingle{6}ᐸpostᐳ[63]<br />1: <br />ᐳ: 95, 151, 152<br />2: PgSelectRows[92]<br />ᐳ: First[91], PgSelectSingle[94]"):::bucket
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 66, 161, 122<br /><br />ROOT PgSelectSingle{7}ᐸpostᐳ[66]<br />1: <br />ᐳ: 108, 163, 164<br />2: PgSelectRows[105]<br />ᐳ: First[104], PgSelectSingle[107]"):::bucket
    Bucket12("Bucket 12 (nullableBoundary)<br />Deps: 69, 155, 122<br /><br />ROOT PgSelectSingle{8}ᐸpostᐳ[69]<br />1: <br />ᐳ: 121, 157, 158<br />2: PgSelectRows[118]<br />ᐳ: First[117], PgSelectSingle[120]"):::bucket
    Bucket13("Bucket 13 (nullableBoundary)<br />Deps: 81, 122<br /><br />ROOT PgSelectSingle{9}ᐸpersonᐳ[81]"):::bucket
    Bucket14("Bucket 14 (nullableBoundary)<br />Deps: 94, 122<br /><br />ROOT PgSelectSingle{10}ᐸpersonᐳ[94]"):::bucket
    Bucket15("Bucket 15 (nullableBoundary)<br />Deps: 107, 122<br /><br />ROOT PgSelectSingle{11}ᐸpersonᐳ[107]"):::bucket
    Bucket16("Bucket 16 (nullableBoundary)<br />Deps: 120, 122<br /><br />ROOT PgSelectSingle{12}ᐸpersonᐳ[120]"):::bucket
    end
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4
    Bucket1 --> Bucket5
    Bucket2 --> Bucket6
    Bucket3 --> Bucket7
    Bucket4 --> Bucket8
    Bucket5 --> Bucket9
    Bucket6 --> Bucket10
    Bucket7 --> Bucket11
    Bucket8 --> Bucket12
    Bucket9 --> Bucket13
    Bucket10 --> Bucket14
    Bucket11 --> Bucket15
    Bucket12 --> Bucket16

    %% plan dependencies
    __InputObject7{{"__InputObject[7∈0] ➊"}}:::plan
    Access8{{"Access[8∈0] ➊<br />ᐸ0.undefinedᐳ"}}:::plan
    Access8 --> __InputObject7
    Object16{{"Object[16∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access15{{"Access[15∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access13 & Access15 --> Object16
    __InputObject21{{"__InputObject[21∈0] ➊"}}:::plan
    Access22{{"Access[22∈0] ➊<br />ᐸ0.aliceᐳ"}}:::plan
    Access22 --> __InputObject21
    __InputObject31{{"__InputObject[31∈0] ➊"}}:::plan
    Constant32{{"Constant[32∈0] ➊<br />ᐸnullᐳ"}}:::plan
    Constant32 --> __InputObject31
    __InputObject40{{"__InputObject[40∈0] ➊"}}:::plan
    Access41{{"Access[41∈0] ➊<br />ᐸ0.post3ᐳ"}}:::plan
    Access41 --> __InputObject40
    __Value0["__Value[0∈0] ➊<br />ᐸvariableValuesᐳ"]:::plan
    __Value0 --> Access8
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access13
    __Value2 --> Access15
    ApplyInput19{{"ApplyInput[19∈0] ➊"}}:::plan
    __InputObject7 --> ApplyInput19
    __Value0 --> Access22
    ApplyInput29{{"ApplyInput[29∈0] ➊"}}:::plan
    __InputObject21 --> ApplyInput29
    ApplyInput38{{"ApplyInput[38∈0] ➊"}}:::plan
    __InputObject31 --> ApplyInput38
    __Value0 --> Access41
    ApplyInput48{{"ApplyInput[48∈0] ➊"}}:::plan
    __InputObject40 --> ApplyInput48
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection18{{"Connection[18∈0] ➊<br />ᐸ12ᐳ"}}:::plan
    Connection28{{"Connection[28∈0] ➊<br />ᐸ25ᐳ"}}:::plan
    Connection37{{"Connection[37∈0] ➊<br />ᐸ34ᐳ"}}:::plan
    Connection47{{"Connection[47∈0] ➊<br />ᐸ44ᐳ"}}:::plan
    Constant122{{"Constant[122∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    PgSelectInlineApply142["PgSelectInlineApply[142∈0] ➊"]:::plan
    PgSelectInlineApply148["PgSelectInlineApply[148∈0] ➊"]:::plan
    PgSelectInlineApply154["PgSelectInlineApply[154∈0] ➊"]:::plan
    PgSelectInlineApply160["PgSelectInlineApply[160∈0] ➊"]:::plan
    PgSelect50[["PgSelect[50∈1] ➊<br />ᐸpostᐳ"]]:::plan
    Object16 & ApplyInput19 & Connection18 & PgSelectInlineApply142 --> PgSelect50
    PgSelectRows58[["PgSelectRows[58∈1] ➊"]]:::plan
    PgSelect50 --> PgSelectRows58
    Access143{{"Access[143∈1] ➊<br />ᐸ50.m.joinDetailsFor71ᐳ"}}:::plan
    PgSelect50 --> Access143
    __Item59[/"__Item[59∈5]<br />ᐸ58ᐳ"\]:::itemplan
    PgSelectRows58 ==> __Item59
    PgSelectSingle60{{"PgSelectSingle[60∈5]<br />ᐸpostᐳ"}}:::plan
    __Item59 --> PgSelectSingle60
    List145{{"List[145∈9]<br />ᐸ143,60ᐳ"}}:::plan
    Access143 & PgSelectSingle60 --> List145
    First78{{"First[78∈9]"}}:::plan
    PgSelectRows79[["PgSelectRows[79∈9]"]]:::plan
    PgSelectRows79 --> First78
    Lambda146{{"Lambda[146∈9]<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda146 --> PgSelectRows79
    PgSelectSingle81{{"PgSelectSingle[81∈9]<br />ᐸpersonᐳ"}}:::plan
    First78 --> PgSelectSingle81
    PgClassExpression82{{"PgClassExpression[82∈9]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle60 --> PgClassExpression82
    List145 --> Lambda146
    List124{{"List[124∈13]<br />ᐸ122,123ᐳ"}}:::plan
    PgClassExpression123{{"PgClassExpression[123∈13]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant122 & PgClassExpression123 --> List124
    PgSelectSingle81 --> PgClassExpression123
    Lambda125{{"Lambda[125∈13]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List124 --> Lambda125
    PgSelect52[["PgSelect[52∈2] ➊<br />ᐸpostᐳ"]]:::plan
    Object16 & ApplyInput29 & Connection28 & PgSelectInlineApply148 --> PgSelect52
    PgSelectRows61[["PgSelectRows[61∈2] ➊"]]:::plan
    PgSelect52 --> PgSelectRows61
    Access149{{"Access[149∈2] ➊<br />ᐸ52.m.joinDetailsFor84ᐳ"}}:::plan
    PgSelect52 --> Access149
    __Item62[/"__Item[62∈6]<br />ᐸ61ᐳ"\]:::itemplan
    PgSelectRows61 ==> __Item62
    PgSelectSingle63{{"PgSelectSingle[63∈6]<br />ᐸpostᐳ"}}:::plan
    __Item62 --> PgSelectSingle63
    List151{{"List[151∈10]<br />ᐸ149,63ᐳ"}}:::plan
    Access149 & PgSelectSingle63 --> List151
    First91{{"First[91∈10]"}}:::plan
    PgSelectRows92[["PgSelectRows[92∈10]"]]:::plan
    PgSelectRows92 --> First91
    Lambda152{{"Lambda[152∈10]<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda152 --> PgSelectRows92
    PgSelectSingle94{{"PgSelectSingle[94∈10]<br />ᐸpersonᐳ"}}:::plan
    First91 --> PgSelectSingle94
    PgClassExpression95{{"PgClassExpression[95∈10]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression95
    List151 --> Lambda152
    List129{{"List[129∈14]<br />ᐸ122,128ᐳ"}}:::plan
    PgClassExpression128{{"PgClassExpression[128∈14]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant122 & PgClassExpression128 --> List129
    PgSelectSingle94 --> PgClassExpression128
    Lambda130{{"Lambda[130∈14]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List129 --> Lambda130
    PgSelect54[["PgSelect[54∈3] ➊<br />ᐸpostᐳ"]]:::plan
    Object16 & ApplyInput38 & Connection37 & PgSelectInlineApply160 --> PgSelect54
    PgSelectRows64[["PgSelectRows[64∈3] ➊"]]:::plan
    PgSelect54 --> PgSelectRows64
    Access161{{"Access[161∈3] ➊<br />ᐸ54.m.joinDetailsFor97ᐳ"}}:::plan
    PgSelect54 --> Access161
    __Item65[/"__Item[65∈7]<br />ᐸ64ᐳ"\]:::itemplan
    PgSelectRows64 ==> __Item65
    PgSelectSingle66{{"PgSelectSingle[66∈7]<br />ᐸpostᐳ"}}:::plan
    __Item65 --> PgSelectSingle66
    List163{{"List[163∈11]<br />ᐸ161,66ᐳ"}}:::plan
    Access161 & PgSelectSingle66 --> List163
    First104{{"First[104∈11]"}}:::plan
    PgSelectRows105[["PgSelectRows[105∈11]"]]:::plan
    PgSelectRows105 --> First104
    Lambda164{{"Lambda[164∈11]<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda164 --> PgSelectRows105
    PgSelectSingle107{{"PgSelectSingle[107∈11]<br />ᐸpersonᐳ"}}:::plan
    First104 --> PgSelectSingle107
    PgClassExpression108{{"PgClassExpression[108∈11]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle66 --> PgClassExpression108
    List163 --> Lambda164
    List134{{"List[134∈15]<br />ᐸ122,133ᐳ"}}:::plan
    PgClassExpression133{{"PgClassExpression[133∈15]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant122 & PgClassExpression133 --> List134
    PgSelectSingle107 --> PgClassExpression133
    Lambda135{{"Lambda[135∈15]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List134 --> Lambda135
    PgSelect56[["PgSelect[56∈4] ➊<br />ᐸpostᐳ"]]:::plan
    Object16 & ApplyInput48 & Connection47 & PgSelectInlineApply154 --> PgSelect56
    PgSelectRows67[["PgSelectRows[67∈4] ➊"]]:::plan
    PgSelect56 --> PgSelectRows67
    Access155{{"Access[155∈4] ➊<br />ᐸ56.m.joinDetailsFor110ᐳ"}}:::plan
    PgSelect56 --> Access155
    __Item68[/"__Item[68∈8]<br />ᐸ67ᐳ"\]:::itemplan
    PgSelectRows67 ==> __Item68
    PgSelectSingle69{{"PgSelectSingle[69∈8]<br />ᐸpostᐳ"}}:::plan
    __Item68 --> PgSelectSingle69
    List157{{"List[157∈12]<br />ᐸ155,69ᐳ"}}:::plan
    Access155 & PgSelectSingle69 --> List157
    First117{{"First[117∈12]"}}:::plan
    PgSelectRows118[["PgSelectRows[118∈12]"]]:::plan
    PgSelectRows118 --> First117
    Lambda158{{"Lambda[158∈12]<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda158 --> PgSelectRows118
    PgSelectSingle120{{"PgSelectSingle[120∈12]<br />ᐸpersonᐳ"}}:::plan
    First117 --> PgSelectSingle120
    PgClassExpression121{{"PgClassExpression[121∈12]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle69 --> PgClassExpression121
    List157 --> Lambda158
    List139{{"List[139∈16]<br />ᐸ122,138ᐳ"}}:::plan
    PgClassExpression138{{"PgClassExpression[138∈16]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant122 & PgClassExpression138 --> List139
    PgSelectSingle120 --> PgClassExpression138
    Lambda140{{"Lambda[140∈16]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List139 --> Lambda140

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value2,__Value4,__InputObject7,Access8,Access13,Access15,Object16,Connection18,ApplyInput19,__InputObject21,Access22,Connection28,ApplyInput29,__InputObject31,Constant32,Connection37,ApplyInput38,__InputObject40,Access41,Connection47,ApplyInput48,Constant122,PgSelectInlineApply142,PgSelectInlineApply148,PgSelectInlineApply154,PgSelectInlineApply160 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect50,PgSelectRows58,Access143 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgSelect52,PgSelectRows61,Access149 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgSelect54,PgSelectRows64,Access161 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect56,PgSelectRows67,Access155 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item59,PgSelectSingle60 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item62,PgSelectSingle63 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7,__Item65,PgSelectSingle66 bucket7
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item68,PgSelectSingle69 bucket8
    classDef bucket9 stroke:#ff0000
    class Bucket9,First78,PgSelectRows79,PgSelectSingle81,PgClassExpression82,List145,Lambda146 bucket9
    classDef bucket10 stroke:#ffff00
    class Bucket10,First91,PgSelectRows92,PgSelectSingle94,PgClassExpression95,List151,Lambda152 bucket10
    classDef bucket11 stroke:#00ffff
    class Bucket11,First104,PgSelectRows105,PgSelectSingle107,PgClassExpression108,List163,Lambda164 bucket11
    classDef bucket12 stroke:#4169e1
    class Bucket12,First117,PgSelectRows118,PgSelectSingle120,PgClassExpression121,List157,Lambda158 bucket12
    classDef bucket13 stroke:#3cb371
    class Bucket13,PgClassExpression123,List124,Lambda125 bucket13
    classDef bucket14 stroke:#a52a2a
    class Bucket14,PgClassExpression128,List129,Lambda130 bucket14
    classDef bucket15 stroke:#ff00ff
    class Bucket15,PgClassExpression133,List134,Lambda135 bucket15
    classDef bucket16 stroke:#f5deb3
    class Bucket16,PgClassExpression138,List139,Lambda140 bucket16

