%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object21{{"Object[21∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access19{{"Access[19∈0]<br />ᐸ3.pgSettingsᐳ"}}:::plan
    Access20{{"Access[20∈0]<br />ᐸ3.withPgClientᐳ"}}:::plan
    Access19 & Access20 --> Object21
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value3 --> Access19
    __Value3 --> Access20
    __Value0["__Value[0∈0]"]:::plan
    __Value1["__Value[1∈0]<br />ᐸvariableValuesᐳ"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    Connection22{{"Connection[22∈0]<br />ᐸ18ᐳ"}}:::plan
    Constant33{{"Constant[33∈0]<br />ᐸ'people'ᐳ"}}:::plan
    Connection53{{"Connection[53∈0]<br />ᐸ49ᐳ"}}:::plan
    Connection89{{"Connection[89∈0]<br />ᐸ85ᐳ"}}:::plan
    Connection126{{"Connection[126∈0]<br />ᐸ122ᐳ"}}:::plan
    PgSelect23[["PgSelect[23∈1]<br />ᐸpostᐳ"]]:::plan
    Object21 & Connection22 --> PgSelect23
    __Item24[/"__Item[24∈2]<br />ᐸ23ᐳ"\]:::itemplan
    PgSelect23 ==> __Item24
    PgSelectSingle25{{"PgSelectSingle[25∈2]<br />ᐸpostᐳ"}}:::plan
    __Item24 --> PgSelectSingle25
    PgSelectSingle32{{"PgSelectSingle[32∈3]<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle25 --> PgSelectSingle32
    PgClassExpression37{{"PgClassExpression[37∈3]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle25 --> PgClassExpression37
    List35{{"List[35∈4]<br />ᐸ33,34ᐳ"}}:::plan
    PgClassExpression34{{"PgClassExpression[34∈4]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant33 & PgClassExpression34 --> List35
    PgSelectSingle32 --> PgClassExpression34
    Lambda36{{"Lambda[36∈4]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List35 --> Lambda36
    PgSelect60[["PgSelect[60∈5]<br />ᐸpostᐳ"]]:::plan
    __Flag59[["__Flag[59∈5]<br />ᐸ58, if(54), rejectNull, onReject: Error: Invali…ᐳ"]]:::plan
    Object21 & __Flag59 & Connection53 --> PgSelect60
    __Flag58[["__Flag[58∈5]<br />ᐸ57, trapInhibited, onReject: INHIBITᐳ"]]:::plan
    Condition54{{"Condition[54∈5]<br />ᐸexistsᐳ"}}:::plan
    __Flag58 & Condition54 --> __Flag59
    Access47{{"Access[47∈5]<br />ᐸ1.aliceᐳ"}}:::plan
    __Value1 --> Access47
    Access47 --> Condition54
    Lambda55{{"Lambda[55∈5]<br />ᐸspecifier_Person_base64JSONᐳ"}}:::plan
    Access47 --> Lambda55
    Access56{{"Access[56∈5]<br />ᐸ55.1ᐳ"}}:::plan
    Lambda55 --> Access56
    __Flag57[["__Flag[57∈5]<br />ᐸ56, rejectNull, onReject: INHIBITᐳ"]]:::plan
    Access56 --> __Flag57
    __Flag57 --> __Flag58
    __Item61[/"__Item[61∈6]<br />ᐸ60ᐳ"\]:::itemplan
    PgSelect60 ==> __Item61
    PgSelectSingle62{{"PgSelectSingle[62∈6]<br />ᐸpostᐳ"}}:::plan
    __Item61 --> PgSelectSingle62
    PgSelectSingle69{{"PgSelectSingle[69∈7]<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle62 --> PgSelectSingle69
    PgClassExpression74{{"PgClassExpression[74∈7]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle62 --> PgClassExpression74
    List72{{"List[72∈8]<br />ᐸ33,71ᐳ"}}:::plan
    PgClassExpression71{{"PgClassExpression[71∈8]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant33 & PgClassExpression71 --> List72
    PgSelectSingle69 --> PgClassExpression71
    Lambda73{{"Lambda[73∈8]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List72 --> Lambda73
    PgSelect96[["PgSelect[96∈9]<br />ᐸpostᐳ"]]:::plan
    __Flag95[["__Flag[95∈9]<br />ᐸ94, if(90), rejectNull, onReject: Error: Invali…ᐳ"]]:::plan
    Object21 & __Flag95 & Connection89 --> PgSelect96
    __Flag94[["__Flag[94∈9]<br />ᐸ93, trapInhibited, onReject: INHIBITᐳ"]]:::plan
    Condition90{{"Condition[90∈9]<br />ᐸexistsᐳ"}}:::plan
    __Flag94 & Condition90 --> __Flag95
    Constant156{{"Constant[156∈9]<br />ᐸnullᐳ"}}:::plan
    Constant156 --> Condition90
    Lambda91{{"Lambda[91∈9]<br />ᐸspecifier_Person_base64JSONᐳ"}}:::plan
    Constant156 --> Lambda91
    Access92{{"Access[92∈9]<br />ᐸ91.1ᐳ"}}:::plan
    Lambda91 --> Access92
    __Flag93[["__Flag[93∈9]<br />ᐸ92, rejectNull, onReject: INHIBITᐳ"]]:::plan
    Access92 --> __Flag93
    __Flag93 --> __Flag94
    __Item97[/"__Item[97∈10]<br />ᐸ96ᐳ"\]:::itemplan
    PgSelect96 ==> __Item97
    PgSelectSingle98{{"PgSelectSingle[98∈10]<br />ᐸpostᐳ"}}:::plan
    __Item97 --> PgSelectSingle98
    PgSelectSingle105{{"PgSelectSingle[105∈11]<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle98 --> PgSelectSingle105
    PgClassExpression110{{"PgClassExpression[110∈11]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle98 --> PgClassExpression110
    List108{{"List[108∈12]<br />ᐸ33,107ᐳ"}}:::plan
    PgClassExpression107{{"PgClassExpression[107∈12]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant33 & PgClassExpression107 --> List108
    PgSelectSingle105 --> PgClassExpression107
    Lambda109{{"Lambda[109∈12]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List108 --> Lambda109
    PgSelect133[["PgSelect[133∈13]<br />ᐸpostᐳ"]]:::plan
    __Flag132[["__Flag[132∈13]<br />ᐸ131, if(127), rejectNull, onReject: Error: Invali…ᐳ"]]:::plan
    Object21 & __Flag132 & Connection126 --> PgSelect133
    __Flag131[["__Flag[131∈13]<br />ᐸ130, trapInhibited, onReject: INHIBITᐳ"]]:::plan
    Condition127{{"Condition[127∈13]<br />ᐸexistsᐳ"}}:::plan
    __Flag131 & Condition127 --> __Flag132
    Access120{{"Access[120∈13]<br />ᐸ1.post3ᐳ"}}:::plan
    __Value1 --> Access120
    Access120 --> Condition127
    Lambda128{{"Lambda[128∈13]<br />ᐸspecifier_Person_base64JSONᐳ"}}:::plan
    Access120 --> Lambda128
    Access129{{"Access[129∈13]<br />ᐸ128.1ᐳ"}}:::plan
    Lambda128 --> Access129
    __Flag130[["__Flag[130∈13]<br />ᐸ129, rejectNull, onReject: INHIBITᐳ"]]:::plan
    Access129 --> __Flag130
    __Flag130 --> __Flag131
    __Item134[/"__Item[134∈14]<br />ᐸ133ᐳ"\]:::itemplan
    PgSelect133 ==> __Item134
    PgSelectSingle135{{"PgSelectSingle[135∈14]<br />ᐸpostᐳ"}}:::plan
    __Item134 --> PgSelectSingle135
    PgSelectSingle142{{"PgSelectSingle[142∈15]<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle135 --> PgSelectSingle142
    PgClassExpression147{{"PgClassExpression[147∈15]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle135 --> PgClassExpression147
    List145{{"List[145∈16]<br />ᐸ33,144ᐳ"}}:::plan
    PgClassExpression144{{"PgClassExpression[144∈16]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant33 & PgClassExpression144 --> List145
    PgSelectSingle142 --> PgClassExpression144
    Lambda146{{"Lambda[146∈16]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List145 --> Lambda146

    %% define steps

    subgraph "Buckets for queries/relay/conditionNodeId"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value1,__Value3,__Value5,Access19,Access20,Object21,Connection22,Constant33,Connection53,Connection89,Connection126 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 21, 22, 33<br /><br />ROOT Connectionᐸ18ᐳ[22]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect23 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 33<br /><br />ROOT __Item{2}ᐸ23ᐳ[24]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item24,PgSelectSingle25 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 25, 33<br /><br />ROOT PgSelectSingle{2}ᐸpostᐳ[25]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgSelectSingle32,PgClassExpression37 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 32, 33<br /><br />ROOT PgSelectSingle{3}ᐸpersonᐳ[32]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression34,List35,Lambda36 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 1, 21, 53, 33<br /><br />ROOT Connectionᐸ49ᐳ[53]<br />1: <br />ᐳ: 47, 54, 55, 56<br />2: __Flag[57]<br />3: __Flag[58]<br />4: __Flag[59]<br />5: PgSelect[60]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,Access47,Condition54,Lambda55,Access56,__Flag57,__Flag58,__Flag59,PgSelect60 bucket5
    Bucket6("Bucket 6 (listItem)<br />Deps: 33<br /><br />ROOT __Item{6}ᐸ60ᐳ[61]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item61,PgSelectSingle62 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 62, 33<br /><br />ROOT PgSelectSingle{6}ᐸpostᐳ[62]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,PgSelectSingle69,PgClassExpression74 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 69, 33<br /><br />ROOT PgSelectSingle{7}ᐸpersonᐳ[69]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgClassExpression71,List72,Lambda73 bucket8
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 21, 89, 33<br /><br />ROOT Connectionᐸ85ᐳ[89]<br />1: <br />ᐳ: 156, 90, 91, 92<br />2: __Flag[93]<br />3: __Flag[94]<br />4: __Flag[95]<br />5: PgSelect[96]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,Condition90,Lambda91,Access92,__Flag93,__Flag94,__Flag95,PgSelect96,Constant156 bucket9
    Bucket10("Bucket 10 (listItem)<br />Deps: 33<br /><br />ROOT __Item{10}ᐸ96ᐳ[97]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item97,PgSelectSingle98 bucket10
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 98, 33<br /><br />ROOT PgSelectSingle{10}ᐸpostᐳ[98]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgSelectSingle105,PgClassExpression110 bucket11
    Bucket12("Bucket 12 (nullableBoundary)<br />Deps: 105, 33<br /><br />ROOT PgSelectSingle{11}ᐸpersonᐳ[105]"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,PgClassExpression107,List108,Lambda109 bucket12
    Bucket13("Bucket 13 (nullableBoundary)<br />Deps: 1, 21, 126, 33<br /><br />ROOT Connectionᐸ122ᐳ[126]<br />1: <br />ᐳ: 120, 127, 128, 129<br />2: __Flag[130]<br />3: __Flag[131]<br />4: __Flag[132]<br />5: PgSelect[133]"):::bucket
    classDef bucket13 stroke:#3cb371
    class Bucket13,Access120,Condition127,Lambda128,Access129,__Flag130,__Flag131,__Flag132,PgSelect133 bucket13
    Bucket14("Bucket 14 (listItem)<br />Deps: 33<br /><br />ROOT __Item{14}ᐸ133ᐳ[134]"):::bucket
    classDef bucket14 stroke:#a52a2a
    class Bucket14,__Item134,PgSelectSingle135 bucket14
    Bucket15("Bucket 15 (nullableBoundary)<br />Deps: 135, 33<br /><br />ROOT PgSelectSingle{14}ᐸpostᐳ[135]"):::bucket
    classDef bucket15 stroke:#ff00ff
    class Bucket15,PgSelectSingle142,PgClassExpression147 bucket15
    Bucket16("Bucket 16 (nullableBoundary)<br />Deps: 142, 33<br /><br />ROOT PgSelectSingle{15}ᐸpersonᐳ[142]"):::bucket
    classDef bucket16 stroke:#f5deb3
    class Bucket16,PgClassExpression144,List145,Lambda146 bucket16
    Bucket0 --> Bucket1 & Bucket5 & Bucket9 & Bucket13
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket5 --> Bucket6
    Bucket6 --> Bucket7
    Bucket7 --> Bucket8
    Bucket9 --> Bucket10
    Bucket10 --> Bucket11
    Bucket11 --> Bucket12
    Bucket13 --> Bucket14
    Bucket14 --> Bucket15
    Bucket15 --> Bucket16
    classDef unary fill:#fafffa,borderWidth:8px
    class Object21,Access19,Access20,__Value0,__Value1,__Value3,__Value5,Connection22,Constant33,Connection53,Connection89,Connection126,PgSelect23,PgSelect60,__Flag59,Access47,Condition54,Lambda55,Access56,__Flag57,__Flag58,PgSelect96,__Flag95,Condition90,Lambda91,Access92,__Flag93,__Flag94,Constant156,PgSelect133,__Flag132,Access120,Condition127,Lambda128,Access129,__Flag130,__Flag131 unary
    end
