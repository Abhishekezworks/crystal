%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object20{{"Object[20∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access18{{"Access[18∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access19{{"Access[19∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access18 & Access19 --> Object20
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access18
    __Value2 --> Access19
    __Value0["__Value[0∈0] ➊<br />ᐸvariableValuesᐳ"]:::plan
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection21{{"Connection[21∈0] ➊<br />ᐸ17ᐳ"}}:::plan
    Constant32{{"Constant[32∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    Connection52{{"Connection[52∈0] ➊<br />ᐸ48ᐳ"}}:::plan
    Connection88{{"Connection[88∈0] ➊<br />ᐸ84ᐳ"}}:::plan
    Connection125{{"Connection[125∈0] ➊<br />ᐸ121ᐳ"}}:::plan
    PgSelect22[["PgSelect[22∈1] ➊<br />ᐸpostᐳ"]]:::plan
    Object20 & Connection21 --> PgSelect22
    __Item23[/"__Item[23∈2]<br />ᐸ22ᐳ"\]:::itemplan
    PgSelect22 ==> __Item23
    PgSelectSingle24{{"PgSelectSingle[24∈2]<br />ᐸpostᐳ"}}:::plan
    __Item23 --> PgSelectSingle24
    PgSelectSingle31{{"PgSelectSingle[31∈3]<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle24 --> PgSelectSingle31
    PgClassExpression36{{"PgClassExpression[36∈3]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle24 --> PgClassExpression36
    List34{{"List[34∈4]<br />ᐸ32,33ᐳ"}}:::plan
    PgClassExpression33{{"PgClassExpression[33∈4]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant32 & PgClassExpression33 --> List34
    PgSelectSingle31 --> PgClassExpression33
    Lambda35{{"Lambda[35∈4]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List34 --> Lambda35
    PgSelect59[["PgSelect[59∈5] ➊<br />ᐸpostᐳ"]]:::plan
    __Flag58[["__Flag[58∈5] ➊<br />ᐸ57, if(53), rejectNull, onReject: Error: Invali…ᐳ"]]:::plan
    Object20 & __Flag58 & Connection52 --> PgSelect59
    __Flag57[["__Flag[57∈5] ➊<br />ᐸ56, trapInhibited, onReject: INHIBITᐳ"]]:::plan
    Condition53{{"Condition[53∈5] ➊<br />ᐸexistsᐳ"}}:::plan
    __Flag57 & Condition53 --> __Flag58
    Access46{{"Access[46∈5] ➊<br />ᐸ0.aliceᐳ"}}:::plan
    __Value0 --> Access46
    Access46 --> Condition53
    Lambda54{{"Lambda[54∈5] ➊<br />ᐸspecifier_Person_base64JSONᐳ"}}:::plan
    Access46 --> Lambda54
    Access55{{"Access[55∈5] ➊<br />ᐸ54.1ᐳ"}}:::plan
    Lambda54 --> Access55
    __Flag56[["__Flag[56∈5] ➊<br />ᐸ55, rejectNull, onReject: INHIBITᐳ"]]:::plan
    Access55 --> __Flag56
    __Flag56 --> __Flag57
    __Item60[/"__Item[60∈6]<br />ᐸ59ᐳ"\]:::itemplan
    PgSelect59 ==> __Item60
    PgSelectSingle61{{"PgSelectSingle[61∈6]<br />ᐸpostᐳ"}}:::plan
    __Item60 --> PgSelectSingle61
    PgSelectSingle68{{"PgSelectSingle[68∈7]<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle61 --> PgSelectSingle68
    PgClassExpression73{{"PgClassExpression[73∈7]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle61 --> PgClassExpression73
    List71{{"List[71∈8]<br />ᐸ32,70ᐳ"}}:::plan
    PgClassExpression70{{"PgClassExpression[70∈8]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant32 & PgClassExpression70 --> List71
    PgSelectSingle68 --> PgClassExpression70
    Lambda72{{"Lambda[72∈8]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List71 --> Lambda72
    PgSelect95[["PgSelect[95∈9] ➊<br />ᐸpostᐳ"]]:::plan
    __Flag94[["__Flag[94∈9] ➊<br />ᐸ93, if(89), rejectNull, onReject: Error: Invali…ᐳ"]]:::plan
    Object20 & __Flag94 & Connection88 --> PgSelect95
    __Flag93[["__Flag[93∈9] ➊<br />ᐸ92, trapInhibited, onReject: INHIBITᐳ"]]:::plan
    Condition89{{"Condition[89∈9] ➊<br />ᐸexistsᐳ"}}:::plan
    __Flag93 & Condition89 --> __Flag94
    Constant155{{"Constant[155∈9] ➊<br />ᐸnullᐳ"}}:::plan
    Constant155 --> Condition89
    Lambda90{{"Lambda[90∈9] ➊<br />ᐸspecifier_Person_base64JSONᐳ"}}:::plan
    Constant155 --> Lambda90
    Access91{{"Access[91∈9] ➊<br />ᐸ90.1ᐳ"}}:::plan
    Lambda90 --> Access91
    __Flag92[["__Flag[92∈9] ➊<br />ᐸ91, rejectNull, onReject: INHIBITᐳ"]]:::plan
    Access91 --> __Flag92
    __Flag92 --> __Flag93
    __Item96[/"__Item[96∈10]<br />ᐸ95ᐳ"\]:::itemplan
    PgSelect95 ==> __Item96
    PgSelectSingle97{{"PgSelectSingle[97∈10]<br />ᐸpostᐳ"}}:::plan
    __Item96 --> PgSelectSingle97
    PgSelectSingle104{{"PgSelectSingle[104∈11]<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle97 --> PgSelectSingle104
    PgClassExpression109{{"PgClassExpression[109∈11]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle97 --> PgClassExpression109
    List107{{"List[107∈12]<br />ᐸ32,106ᐳ"}}:::plan
    PgClassExpression106{{"PgClassExpression[106∈12]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant32 & PgClassExpression106 --> List107
    PgSelectSingle104 --> PgClassExpression106
    Lambda108{{"Lambda[108∈12]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List107 --> Lambda108
    PgSelect132[["PgSelect[132∈13] ➊<br />ᐸpostᐳ"]]:::plan
    __Flag131[["__Flag[131∈13] ➊<br />ᐸ130, if(126), rejectNull, onReject: Error: Invali…ᐳ"]]:::plan
    Object20 & __Flag131 & Connection125 --> PgSelect132
    __Flag130[["__Flag[130∈13] ➊<br />ᐸ129, trapInhibited, onReject: INHIBITᐳ"]]:::plan
    Condition126{{"Condition[126∈13] ➊<br />ᐸexistsᐳ"}}:::plan
    __Flag130 & Condition126 --> __Flag131
    Access119{{"Access[119∈13] ➊<br />ᐸ0.post3ᐳ"}}:::plan
    __Value0 --> Access119
    Access119 --> Condition126
    Lambda127{{"Lambda[127∈13] ➊<br />ᐸspecifier_Person_base64JSONᐳ"}}:::plan
    Access119 --> Lambda127
    Access128{{"Access[128∈13] ➊<br />ᐸ127.1ᐳ"}}:::plan
    Lambda127 --> Access128
    __Flag129[["__Flag[129∈13] ➊<br />ᐸ128, rejectNull, onReject: INHIBITᐳ"]]:::plan
    Access128 --> __Flag129
    __Flag129 --> __Flag130
    __Item133[/"__Item[133∈14]<br />ᐸ132ᐳ"\]:::itemplan
    PgSelect132 ==> __Item133
    PgSelectSingle134{{"PgSelectSingle[134∈14]<br />ᐸpostᐳ"}}:::plan
    __Item133 --> PgSelectSingle134
    PgSelectSingle141{{"PgSelectSingle[141∈15]<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle134 --> PgSelectSingle141
    PgClassExpression146{{"PgClassExpression[146∈15]<br />ᐸ__post__.”body”ᐳ"}}:::plan
    PgSelectSingle134 --> PgClassExpression146
    List144{{"List[144∈16]<br />ᐸ32,143ᐳ"}}:::plan
    PgClassExpression143{{"PgClassExpression[143∈16]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant32 & PgClassExpression143 --> List144
    PgSelectSingle141 --> PgClassExpression143
    Lambda145{{"Lambda[145∈16]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List144 --> Lambda145

    %% define steps

    subgraph "Buckets for queries/relay/conditionNodeId"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value2,__Value4,Access18,Access19,Object20,Connection21,Constant32,Connection52,Connection88,Connection125 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 20, 21, 32<br /><br />ROOT Connectionᐸ17ᐳ[21]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect22 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 32<br /><br />ROOT __Item{2}ᐸ22ᐳ[23]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item23,PgSelectSingle24 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 24, 32<br /><br />ROOT PgSelectSingle{2}ᐸpostᐳ[24]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgSelectSingle31,PgClassExpression36 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 31, 32<br /><br />ROOT PgSelectSingle{3}ᐸpersonᐳ[31]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression33,List34,Lambda35 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 0, 20, 52, 32<br /><br />ROOT Connectionᐸ48ᐳ[52]<br />1: <br />ᐳ: 46, 53, 54, 55<br />2: __Flag[56]<br />3: __Flag[57]<br />4: __Flag[58]<br />5: PgSelect[59]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,Access46,Condition53,Lambda54,Access55,__Flag56,__Flag57,__Flag58,PgSelect59 bucket5
    Bucket6("Bucket 6 (listItem)<br />Deps: 32<br /><br />ROOT __Item{6}ᐸ59ᐳ[60]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item60,PgSelectSingle61 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 61, 32<br /><br />ROOT PgSelectSingle{6}ᐸpostᐳ[61]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,PgSelectSingle68,PgClassExpression73 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 68, 32<br /><br />ROOT PgSelectSingle{7}ᐸpersonᐳ[68]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgClassExpression70,List71,Lambda72 bucket8
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 20, 88, 32<br /><br />ROOT Connectionᐸ84ᐳ[88]<br />1: <br />ᐳ: 155, 89, 90, 91<br />2: __Flag[92]<br />3: __Flag[93]<br />4: __Flag[94]<br />5: PgSelect[95]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,Condition89,Lambda90,Access91,__Flag92,__Flag93,__Flag94,PgSelect95,Constant155 bucket9
    Bucket10("Bucket 10 (listItem)<br />Deps: 32<br /><br />ROOT __Item{10}ᐸ95ᐳ[96]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item96,PgSelectSingle97 bucket10
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 97, 32<br /><br />ROOT PgSelectSingle{10}ᐸpostᐳ[97]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgSelectSingle104,PgClassExpression109 bucket11
    Bucket12("Bucket 12 (nullableBoundary)<br />Deps: 104, 32<br /><br />ROOT PgSelectSingle{11}ᐸpersonᐳ[104]"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,PgClassExpression106,List107,Lambda108 bucket12
    Bucket13("Bucket 13 (nullableBoundary)<br />Deps: 0, 20, 125, 32<br /><br />ROOT Connectionᐸ121ᐳ[125]<br />1: <br />ᐳ: 119, 126, 127, 128<br />2: __Flag[129]<br />3: __Flag[130]<br />4: __Flag[131]<br />5: PgSelect[132]"):::bucket
    classDef bucket13 stroke:#3cb371
    class Bucket13,Access119,Condition126,Lambda127,Access128,__Flag129,__Flag130,__Flag131,PgSelect132 bucket13
    Bucket14("Bucket 14 (listItem)<br />Deps: 32<br /><br />ROOT __Item{14}ᐸ132ᐳ[133]"):::bucket
    classDef bucket14 stroke:#a52a2a
    class Bucket14,__Item133,PgSelectSingle134 bucket14
    Bucket15("Bucket 15 (nullableBoundary)<br />Deps: 134, 32<br /><br />ROOT PgSelectSingle{14}ᐸpostᐳ[134]"):::bucket
    classDef bucket15 stroke:#ff00ff
    class Bucket15,PgSelectSingle141,PgClassExpression146 bucket15
    Bucket16("Bucket 16 (nullableBoundary)<br />Deps: 141, 32<br /><br />ROOT PgSelectSingle{15}ᐸpersonᐳ[141]"):::bucket
    classDef bucket16 stroke:#f5deb3
    class Bucket16,PgClassExpression143,List144,Lambda145 bucket16
    Bucket0 --> Bucket1 & Bucket5 & Bucket9 & Bucket13
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket5 --> Bucket6
    Bucket6 --> Bucket7
    Bucket7 --> Bucket8
    Bucket9 --> Bucket10
    Bucket10 --> Bucket11
    Bucket11 --> Bucket12
    Bucket13 --> Bucket14
    Bucket14 --> Bucket15
    Bucket15 --> Bucket16
    end
