%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸmachineᐳ"]]:::plan
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant181{{"Constant[181∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Lambda76{{"Lambda[76∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Access80{{"Access[80∈0] ➊<br />ᐸ79.0ᐳ"}}:::plan
    Lambda100{{"Lambda[100∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda105{{"Lambda[105∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object10 & Constant181 & Lambda76 & Access80 & Lambda100 & Lambda105 --> PgSelect7
    PgSelect26[["PgSelect[26∈0] ➊<br />ᐸbuildingᐳ"]]:::plan
    Constant182{{"Constant[182∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Lambda130{{"Lambda[130∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda135{{"Lambda[135∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object10 & Constant182 & Lambda76 & Access80 & Lambda130 & Lambda135 --> PgSelect26
    Object84{{"Object[84∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant81{{"Constant[81∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant82{{"Constant[82∈0] ➊<br />ᐸsql.identifier(”building”)ᐳ"}}:::plan
    Constant83{{"Constant[83∈0] ➊<br />ᐸRecordCodec(building)ᐳ"}}:::plan
    Lambda76 & Constant81 & Constant82 & Constant83 --> Object84
    Object99{{"Object[99∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant96{{"Constant[96∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant97{{"Constant[97∈0] ➊<br />ᐸsql.identifier(”machine”)ᐳ"}}:::plan
    Constant98{{"Constant[98∈0] ➊<br />ᐸRecordCodec(machine)ᐳ"}}:::plan
    Lambda76 & Constant96 & Constant97 & Constant98 --> Object99
    Object114{{"Object[114∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant111{{"Constant[111∈0] ➊<br />ᐸ[ { codec: Codec(int4), fragment: { n: [Array], f: 0, c: 266ᐳ"}}:::plan
    Constant112{{"Constant[112∈0] ➊<br />ᐸsql.identifier(”machine”)ᐳ"}}:::plan
    Lambda76 & Constant111 & Constant112 & Constant98 --> Object114
    Object129{{"Object[129∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant126{{"Constant[126∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant127{{"Constant[127∈0] ➊<br />ᐸsql.identifier(”building”)ᐳ"}}:::plan
    Lambda76 & Constant126 & Constant127 & Constant83 --> Object129
    Object144{{"Object[144∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant141{{"Constant[141∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant142{{"Constant[142∈0] ➊<br />ᐸsql.identifier(”relational_topics”)ᐳ"}}:::plan
    Constant143{{"Constant[143∈0] ➊<br />ᐸRecordCodec(relationalTopics)ᐳ"}}:::plan
    Lambda76 & Constant141 & Constant142 & Constant143 --> Object144
    Object159{{"Object[159∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant156{{"Constant[156∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant157{{"Constant[157∈0] ➊<br />ᐸsql.identifier(”relational_status”)ᐳ"}}:::plan
    Constant158{{"Constant[158∈0] ➊<br />ᐸRecordCodec(relationalStatus)ᐳ"}}:::plan
    Lambda76 & Constant156 & Constant157 & Constant158 --> Object159
    Object174{{"Object[174∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant171{{"Constant[171∈0] ➊<br />ᐸ[ { codec: Codec(int4), fragment: { n: [Array], f: 0, c: 266ᐳ"}}:::plan
    Constant172{{"Constant[172∈0] ➊<br />ᐸsql.identifier(”relational_items”)ᐳ"}}:::plan
    Constant173{{"Constant[173∈0] ➊<br />ᐸRecordCodec(relationalItems)ᐳ"}}:::plan
    Lambda76 & Constant171 & Constant172 & Constant173 --> Object174
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    First11{{"First[11∈0] ➊"}}:::plan
    PgSelectRows12[["PgSelectRows[12∈0] ➊"]]:::plan
    PgSelectRows12 --> First11
    PgSelect7 --> PgSelectRows12
    PgSelectSingle13{{"PgSelectSingle[13∈0] ➊<br />ᐸmachineᐳ"}}:::plan
    First11 --> PgSelectSingle13
    First28{{"First[28∈0] ➊"}}:::plan
    PgSelectRows29[["PgSelectRows[29∈0] ➊"]]:::plan
    PgSelectRows29 --> First28
    PgSelect26 --> PgSelectRows29
    PgSelectSingle30{{"PgSelectSingle[30∈0] ➊<br />ᐸbuildingᐳ"}}:::plan
    First28 --> PgSelectSingle30
    Constant183{{"Constant[183∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant183 --> Lambda76
    Lambda79{{"Lambda[79∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant184{{"Constant[184∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant184 --> Lambda79
    Lambda79 --> Access80
    Lambda85{{"Lambda[85∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object84 --> Lambda85
    Lambda90{{"Lambda[90∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant185{{"Constant[185∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”buildiᐳ"}}:::plan
    Constant185 --> Lambda90
    Object99 --> Lambda100
    Constant186{{"Constant[186∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”machinᐳ"}}:::plan
    Constant186 --> Lambda105
    Lambda115{{"Lambda[115∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object114 --> Lambda115
    Lambda120{{"Lambda[120∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant187{{"Constant[187∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: Codec(int4), fragment:ᐳ"}}:::plan
    Constant187 --> Lambda120
    Object129 --> Lambda130
    Constant188{{"Constant[188∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”buildiᐳ"}}:::plan
    Constant188 --> Lambda135
    Lambda145{{"Lambda[145∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object144 --> Lambda145
    Lambda150{{"Lambda[150∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant189{{"Constant[189∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”relatiᐳ"}}:::plan
    Constant189 --> Lambda150
    Lambda160{{"Lambda[160∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object159 --> Lambda160
    Lambda165{{"Lambda[165∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant190{{"Constant[190∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”relatiᐳ"}}:::plan
    Constant190 --> Lambda165
    Lambda175{{"Lambda[175∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object174 --> Lambda175
    Lambda180{{"Lambda[180∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant191{{"Constant[191∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: Codec(int4), fragment:ᐳ"}}:::plan
    Constant191 --> Lambda180
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection39{{"Connection[39∈0] ➊<br />ᐸ35ᐳ"}}:::plan
    Connection52{{"Connection[52∈0] ➊<br />ᐸ50ᐳ"}}:::plan
    PgSelect15[["PgSelect[15∈1] ➊<br />ᐸbuildingᐳ"]]:::plan
    PgClassExpression14{{"PgClassExpression[14∈1] ➊<br />ᐸ__machine_...nstructor”ᐳ"}}:::plan
    Object10 & PgClassExpression14 & Lambda76 & Access80 & Lambda85 & Lambda90 --> PgSelect15
    PgSelectSingle13 --> PgClassExpression14
    First19{{"First[19∈1] ➊"}}:::plan
    PgSelectRows20[["PgSelectRows[20∈1] ➊"]]:::plan
    PgSelectRows20 --> First19
    PgSelect15 --> PgSelectRows20
    PgSelectSingle21{{"PgSelectSingle[21∈1] ➊<br />ᐸbuildingᐳ"}}:::plan
    First19 --> PgSelectSingle21
    PgClassExpression24{{"PgClassExpression[24∈1] ➊<br />ᐸ__machine__.”input”ᐳ"}}:::plan
    PgSelectSingle13 --> PgClassExpression24
    PgClassExpression22{{"PgClassExpression[22∈2] ➊<br />ᐸ__building__.”id”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression22
    PgClassExpression23{{"PgClassExpression[23∈2] ➊<br />ᐸ__building...nstructor”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression23
    PgSelect40[["PgSelect[40∈3] ➊<br />ᐸmachineᐳ"]]:::plan
    PgClassExpression34{{"PgClassExpression[34∈3] ➊<br />ᐸ__building...nstructor”ᐳ"}}:::plan
    Object10 & PgClassExpression34 & Connection39 & Lambda76 & Access80 & Lambda115 & Lambda120 --> PgSelect40
    PgSelectSingle30 --> PgClassExpression34
    PgSelectRows41[["PgSelectRows[41∈3] ➊"]]:::plan
    PgSelect40 --> PgSelectRows41
    PgClassExpression47{{"PgClassExpression[47∈3] ➊<br />ᐸ__building__.”name”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression47
    __Item42[/"__Item[42∈4]<br />ᐸ41ᐳ"\]:::itemplan
    PgSelectRows41 ==> __Item42
    PgSelectSingle43{{"PgSelectSingle[43∈4]<br />ᐸmachineᐳ"}}:::plan
    __Item42 --> PgSelectSingle43
    PgClassExpression44{{"PgClassExpression[44∈5]<br />ᐸ__machine__.”id”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression44
    PgClassExpression45{{"PgClassExpression[45∈5]<br />ᐸ__machine_...nstructor”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression45
    PgClassExpression46{{"PgClassExpression[46∈5]<br />ᐸ__machine__.”input”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression46
    PgSelect53[["PgSelect[53∈6] ➊<br />ᐸrelational_itemsᐳ"]]:::plan
    Object10 & Connection52 & Lambda76 & Access80 & Lambda175 & Lambda180 --> PgSelect53
    PgSelectRows54[["PgSelectRows[54∈6] ➊"]]:::plan
    PgSelect53 --> PgSelectRows54
    __Item55[/"__Item[55∈7]<br />ᐸ54ᐳ"\]:::itemplan
    PgSelectRows54 ==> __Item55
    PgSelectSingle56{{"PgSelectSingle[56∈7]<br />ᐸrelational_itemsᐳ"}}:::plan
    __Item55 --> PgSelectSingle56
    PgSelect58[["PgSelect[58∈8]<br />ᐸrelational_topicsᐳ<br />ᐳRelationalTopic"]]:::plan
    PgClassExpression57{{"PgClassExpression[57∈8]<br />ᐸ__relation...ems__.”id”ᐳ<br />ᐳRelationalTopic"}}:::plan
    Object10 & PgClassExpression57 & Lambda76 & Access80 & Lambda145 & Lambda150 --> PgSelect58
    PgSelect68[["PgSelect[68∈8]<br />ᐸrelational_statusᐳ<br />ᐳRelationalStatus"]]:::plan
    Object10 & PgClassExpression57 & Lambda76 & Access80 & Lambda160 & Lambda165 --> PgSelect68
    PgSelectSingle56 --> PgClassExpression57
    First62{{"First[62∈8]"}}:::plan
    PgSelectRows63[["PgSelectRows[63∈8]"]]:::plan
    PgSelectRows63 --> First62
    PgSelect58 --> PgSelectRows63
    PgSelectSingle64{{"PgSelectSingle[64∈8]<br />ᐸrelational_topicsᐳ"}}:::plan
    First62 --> PgSelectSingle64
    PgClassExpression65{{"PgClassExpression[65∈8]<br />ᐸ__relation...nstructor”ᐳ<br />ᐳRelationalTopic"}}:::plan
    PgSelectSingle56 --> PgClassExpression65
    PgClassExpression66{{"PgClassExpression[66∈8]<br />ᐸ__relation...s__.”type”ᐳ<br />ᐳRelationalTopic"}}:::plan
    PgSelectSingle56 --> PgClassExpression66
    PgClassExpression67{{"PgClassExpression[67∈8]<br />ᐸ__relation...__.”title”ᐳ"}}:::plan
    PgSelectSingle64 --> PgClassExpression67
    First70{{"First[70∈8]"}}:::plan
    PgSelectRows71[["PgSelectRows[71∈8]"]]:::plan
    PgSelectRows71 --> First70
    PgSelect68 --> PgSelectRows71
    PgSelectSingle72{{"PgSelectSingle[72∈8]<br />ᐸrelational_statusᐳ"}}:::plan
    First70 --> PgSelectSingle72
    PgClassExpression73{{"PgClassExpression[73∈8]<br />ᐸ__relation...s__.”note”ᐳ"}}:::plan
    PgSelectSingle72 --> PgClassExpression73

    %% define steps

    subgraph "Buckets for queries/v4/js-reserved-keywords"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 8, 9, 39, 52, 81, 82, 83, 96, 97, 98, 111, 112, 126, 127, 141, 142, 143, 156, 157, 158, 171, 172, 173, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 10, 76, 79, 80, 84, 85, 90, 99, 100, 105, 114, 115, 120, 129, 130, 135, 144, 145, 150, 159, 160, 165, 174, 175, 180<br />2: PgSelect[7], PgSelect[26]<br />3: PgSelectRows[12], PgSelectRows[29]<br />ᐳ: 11, 13, 28, 30"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access9,Object10,First11,PgSelectRows12,PgSelectSingle13,PgSelect26,First28,PgSelectRows29,PgSelectSingle30,Connection39,Connection52,Lambda76,Lambda79,Access80,Constant81,Constant82,Constant83,Object84,Lambda85,Lambda90,Constant96,Constant97,Constant98,Object99,Lambda100,Lambda105,Constant111,Constant112,Object114,Lambda115,Lambda120,Constant126,Constant127,Object129,Lambda130,Lambda135,Constant141,Constant142,Constant143,Object144,Lambda145,Lambda150,Constant156,Constant157,Constant158,Object159,Lambda160,Lambda165,Constant171,Constant172,Constant173,Object174,Lambda175,Lambda180,Constant181,Constant182,Constant183,Constant184,Constant185,Constant186,Constant187,Constant188,Constant189,Constant190,Constant191 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 13, 10, 76, 80, 85, 90<br /><br />ROOT PgSelectSingleᐸmachineᐳ[13]<br />1: <br />ᐳ: 14, 24<br />2: PgSelect[15]<br />3: PgSelectRows[20]<br />ᐳ: First[19], PgSelectSingle[21]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgClassExpression14,PgSelect15,First19,PgSelectRows20,PgSelectSingle21,PgClassExpression24 bucket1
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 21<br /><br />ROOT PgSelectSingle{1}ᐸbuildingᐳ[21]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgClassExpression22,PgClassExpression23 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 30, 10, 39, 76, 80, 115, 120<br /><br />ROOT PgSelectSingleᐸbuildingᐳ[30]<br />1: <br />ᐳ: 34, 47<br />2: PgSelect[40]<br />3: PgSelectRows[41]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression34,PgSelect40,PgSelectRows41,PgClassExpression47 bucket3
    Bucket4("Bucket 4 (listItem)<br /><br />ROOT __Item{4}ᐸ41ᐳ[42]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item42,PgSelectSingle43 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 43<br /><br />ROOT PgSelectSingle{4}ᐸmachineᐳ[43]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression44,PgClassExpression45,PgClassExpression46 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 10, 52, 76, 80, 175, 180, 145, 150, 160, 165<br /><br />ROOT Connectionᐸ50ᐳ[52]<br />1: PgSelect[53]<br />2: PgSelectRows[54]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgSelect53,PgSelectRows54 bucket6
    Bucket7("Bucket 7 (listItem)<br />Deps: 10, 76, 80, 145, 150, 160, 165<br /><br />ROOT __Item{7}ᐸ54ᐳ[55]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item55,PgSelectSingle56 bucket7
    Bucket8("Bucket 8 (polymorphic)<br />RelationalTopic,RelationalStatus<br />Deps: 56, 10, 76, 80, 145, 150, 160, 165<br />ᐳRelationalTopic<br />ᐳRelationalStatus<br /><br />1: <br />ᐳ: 57, 65, 66<br />2: PgSelect[58], PgSelect[68]<br />3: PgSelectRows[63], PgSelectRows[71]<br />ᐳ: 62, 64, 67, 70, 72, 73"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgClassExpression57,PgSelect58,First62,PgSelectRows63,PgSelectSingle64,PgClassExpression65,PgClassExpression66,PgClassExpression67,PgSelect68,First70,PgSelectRows71,PgSelectSingle72,PgClassExpression73 bucket8
    Bucket0 --> Bucket1 & Bucket3 & Bucket6
    Bucket1 --> Bucket2
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    Bucket7 --> Bucket8
    end
