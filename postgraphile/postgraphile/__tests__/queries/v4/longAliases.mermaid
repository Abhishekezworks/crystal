%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/v4/longAliases"
    Bucket0("Bucket 0 (root)<br /><br />1: 57, 62<br />ᐳ: 8, 10, 18, 34, 41, 56, 66, 11<br />2: PgSelect[7]<br />ᐳ: Access[58], Access[63]<br />3: PgSelectRows[15]<br />ᐳ: 14, 17, 59, 60, 64, 65"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 17, 18, 60, 65, 34, 41<br /><br />ROOT PgSelectSingleᐸpersonᐳ[17]"):::bucket
    end
    Bucket0 --> Bucket1

    %% plan dependencies
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant66{{"Constant[66∈0] ➊<br />ᐸ'sara.smith@email.com'ᐳ"}}:::plan
    PgFromExpression56{{"PgFromExpression[56∈0] ➊"}}:::plan
    PgSelectInlineApply57["PgSelectInlineApply[57∈0] ➊"]:::plan
    PgSelectInlineApply62["PgSelectInlineApply[62∈0] ➊"]:::plan
    Object11 & Constant66 & PgSelectInlineApply57 & PgSelectInlineApply62 --> PgSelect7
    PgFromExpression56 -- 2 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access10 --> Object11
    List59{{"List[59∈0] ➊<br />ᐸ58,14ᐳ"}}:::plan
    Access58{{"Access[58∈0] ➊<br />ᐸ7.m.subqueryDetailsFor42ᐳ"}}:::plan
    First14{{"First[14∈0] ➊"}}:::plan
    Access58 & First14 --> List59
    List64{{"List[64∈0] ➊<br />ᐸ63,14ᐳ"}}:::plan
    Access63{{"Access[63∈0] ➊<br />ᐸ7.m.subqueryDetailsFor49ᐳ"}}:::plan
    Access63 & First14 --> List64
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access10
    PgSelectRows15[["PgSelectRows[15∈0] ➊"]]:::plan
    PgSelectRows15 --> First14
    PgSelect7 --> PgSelectRows15
    PgSelectSingle17{{"PgSelectSingle[17∈0] ➊<br />ᐸpersonᐳ"}}:::plan
    First14 --> PgSelectSingle17
    PgSelect7 --> Access58
    Lambda60{{"Lambda[60∈0] ➊<br />ᐸpgInlineViaSubqueryTransformᐳ"}}:::plan
    List59 --> Lambda60
    PgSelect7 --> Access63
    Lambda65{{"Lambda[65∈0] ➊<br />ᐸpgInlineViaSubqueryTransformᐳ"}}:::plan
    List64 --> Lambda65
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant18{{"Constant[18∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    Connection34{{"Connection[34∈0] ➊<br />ᐸ26ᐳ"}}:::plan
    Connection41{{"Connection[41∈0] ➊<br />ᐸ36ᐳ"}}:::plan
    List20{{"List[20∈1] ➊<br />ᐸ18,19ᐳ"}}:::plan
    PgClassExpression19{{"PgClassExpression[19∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant18 & PgClassExpression19 --> List20
    PgSelectSingle17 --> PgClassExpression19
    Lambda21{{"Lambda[21∈1] ➊<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List20 --> Lambda21
    PgClassExpression23{{"PgClassExpression[23∈1] ➊<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle17 --> PgClassExpression23
    First44{{"First[44∈1] ➊"}}:::plan
    PgSelectRows45[["PgSelectRows[45∈1] ➊"]]:::plan
    PgSelectRows45 --> First44
    Lambda60 --> PgSelectRows45
    PgSelectSingle47{{"PgSelectSingle[47∈1] ➊<br />ᐸperson_friendsᐳ"}}:::plan
    First44 --> PgSelectSingle47
    PgClassExpression48{{"PgClassExpression[48∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle47 --> PgClassExpression48
    First51{{"First[51∈1] ➊"}}:::plan
    PgSelectRows52[["PgSelectRows[52∈1] ➊"]]:::plan
    PgSelectRows52 --> First51
    Lambda65 --> PgSelectRows52
    PgSelectSingle54{{"PgSelectSingle[54∈1] ➊<br />ᐸperson_friendsᐳ"}}:::plan
    First51 --> PgSelectSingle54
    PgClassExpression55{{"PgClassExpression[55∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle54 --> PgClassExpression55

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access10,Object11,First14,PgSelectRows15,PgSelectSingle17,Constant18,Connection34,Connection41,PgFromExpression56,PgSelectInlineApply57,Access58,List59,Lambda60,PgSelectInlineApply62,Access63,List64,Lambda65,Constant66 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgClassExpression19,List20,Lambda21,PgClassExpression23,First44,PgSelectRows45,PgSelectSingle47,PgClassExpression48,First51,PgSelectRows52,PgSelectSingle54,PgClassExpression55 bucket1

