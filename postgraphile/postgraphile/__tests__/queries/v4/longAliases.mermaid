%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/v4/longAliases"
    Bucket0("Bucket 0 (root)<br /><br />1: 56, 61<br />ᐳ: 8, 10, 18, 34, 41, 55, 65, 11<br />2: PgSelect[7]<br />ᐳ: Access[57], Access[62]<br />3: PgSelectRows[15]<br />ᐳ: 14, 17, 58, 59, 63, 64"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 17, 18, 59, 64, 34, 41<br /><br />ROOT PgSelectSingleᐸpersonᐳ[17]"):::bucket
    end
    Bucket0 --> Bucket1

    %% plan dependencies
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant65{{"Constant[65∈0] ➊<br />ᐸ'sara.smith@email.com'ᐳ"}}:::plan
    PgFromExpression55{{"PgFromExpression[55∈0] ➊"}}:::plan
    PgSelectInlineApply56["PgSelectInlineApply[56∈0] ➊"]:::plan
    PgSelectInlineApply61["PgSelectInlineApply[61∈0] ➊"]:::plan
    Object11 & Constant65 & PgSelectInlineApply56 & PgSelectInlineApply61 --> PgSelect7
    PgFromExpression55 -- 2 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access10 --> Object11
    List58{{"List[58∈0] ➊<br />ᐸ57,14ᐳ"}}:::plan
    Access57{{"Access[57∈0] ➊<br />ᐸ7.m.subqueryDetailsFor42ᐳ"}}:::plan
    First14{{"First[14∈0] ➊"}}:::plan
    Access57 & First14 --> List58
    List63{{"List[63∈0] ➊<br />ᐸ62,14ᐳ"}}:::plan
    Access62{{"Access[62∈0] ➊<br />ᐸ7.m.subqueryDetailsFor49ᐳ"}}:::plan
    Access62 & First14 --> List63
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access10
    PgSelectRows15[["PgSelectRows[15∈0] ➊"]]:::plan
    PgSelectRows15 --> First14
    PgSelect7 --> PgSelectRows15
    PgSelectSingle17{{"PgSelectSingle[17∈0] ➊<br />ᐸpersonᐳ"}}:::plan
    First14 --> PgSelectSingle17
    PgSelect7 --> Access57
    Lambda59{{"Lambda[59∈0] ➊<br />ᐸpgInlineViaSubqueryTransformᐳ"}}:::plan
    List58 --> Lambda59
    PgSelect7 --> Access62
    Lambda64{{"Lambda[64∈0] ➊<br />ᐸpgInlineViaSubqueryTransformᐳ"}}:::plan
    List63 --> Lambda64
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant18{{"Constant[18∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    Connection34{{"Connection[34∈0] ➊<br />ᐸ26ᐳ"}}:::plan
    Connection41{{"Connection[41∈0] ➊<br />ᐸ36ᐳ"}}:::plan
    List20{{"List[20∈1] ➊<br />ᐸ18,19ᐳ"}}:::plan
    PgClassExpression19{{"PgClassExpression[19∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant18 & PgClassExpression19 --> List20
    PgSelectSingle17 --> PgClassExpression19
    Lambda21{{"Lambda[21∈1] ➊<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List20 --> Lambda21
    PgClassExpression23{{"PgClassExpression[23∈1] ➊<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle17 --> PgClassExpression23
    First44{{"First[44∈1] ➊"}}:::plan
    PgSelectRows45[["PgSelectRows[45∈1] ➊"]]:::plan
    PgSelectRows45 --> First44
    Lambda59 --> PgSelectRows45
    PgSelectSingle47{{"PgSelectSingle[47∈1] ➊<br />ᐸperson_friendsᐳ"}}:::plan
    First44 --> PgSelectSingle47
    PgClassExpression48{{"PgClassExpression[48∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle47 --> PgClassExpression48
    First50{{"First[50∈1] ➊"}}:::plan
    PgSelectRows51[["PgSelectRows[51∈1] ➊"]]:::plan
    PgSelectRows51 --> First50
    Lambda64 --> PgSelectRows51
    PgSelectSingle53{{"PgSelectSingle[53∈1] ➊<br />ᐸperson_friendsᐳ"}}:::plan
    First50 --> PgSelectSingle53
    PgClassExpression54{{"PgClassExpression[54∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression54

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access10,Object11,First14,PgSelectRows15,PgSelectSingle17,Constant18,Connection34,Connection41,PgFromExpression55,PgSelectInlineApply56,Access57,List58,Lambda59,PgSelectInlineApply61,Access62,List63,Lambda64,Constant65 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgClassExpression19,List20,Lambda21,PgClassExpression23,First44,PgSelectRows45,PgSelectSingle47,PgClassExpression48,First50,PgSelectRows51,PgSelectSingle53,PgClassExpression54 bucket1

