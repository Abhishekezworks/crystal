%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object14{{"Object[14∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access12{{"Access[12∈0]<br />ᐸ3.pgSettingsᐳ"}}:::plan
    Access13{{"Access[13∈0]<br />ᐸ3.withPgClientᐳ"}}:::plan
    Access12 & Access13 --> Object14
    PgSelect72[["PgSelect[72∈0]<br />ᐸpostᐳ"]]:::plan
    Constant177{{"Constant[177∈0]<br />ᐸ2ᐳ"}}:::plan
    Object14 & Constant177 --> PgSelect72
    PgSelect91[["PgSelect[91∈0]<br />ᐸpostᐳ"]]:::plan
    Object14 & Constant177 --> PgSelect91
    PgSelect11[["PgSelect[11∈0]<br />ᐸpersonᐳ"]]:::plan
    Object14 --> PgSelect11
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value3 --> Access12
    __Value3 --> Access13
    PgSelect24[["PgSelect[24∈0]<br />ᐸpersonᐳ"]]:::plan
    Object14 --> PgSelect24
    PgSelect38[["PgSelect[38∈0]<br />ᐸpersonᐳ"]]:::plan
    Object14 --> PgSelect38
    PgSelect52[["PgSelect[52∈0]<br />ᐸpersonᐳ"]]:::plan
    Object14 --> PgSelect52
    PgSelect103[["PgSelect[103∈0]<br />ᐸpersonᐳ"]]:::plan
    Object14 --> PgSelect103
    PgSelect116[["PgSelect[116∈0]<br />ᐸpersonᐳ"]]:::plan
    Object14 --> PgSelect116
    PgSelect154[["PgSelect[154∈0]<br />ᐸpersonᐳ"]]:::plan
    Object14 --> PgSelect154
    PgSelect169[["PgSelect[169∈0]<br />ᐸpostᐳ"]]:::plan
    Object14 --> PgSelect169
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    __Item15[/"__Item[15∈1]<br />ᐸ11ᐳ"\]:::itemplan
    PgSelect11 ==> __Item15
    PgSelectSingle16{{"PgSelectSingle[16∈1]<br />ᐸpersonᐳ"}}:::plan
    __Item15 --> PgSelectSingle16
    PgClassExpression17{{"PgClassExpression[17∈1]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression17
    PgClassExpression18{{"PgClassExpression[18∈1]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression18
    PgClassExpression19{{"PgClassExpression[19∈1]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression19
    __Item28[/"__Item[28∈2]<br />ᐸ24ᐳ"\]:::itemplan
    PgSelect24 ==> __Item28
    PgSelectSingle29{{"PgSelectSingle[29∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item28 --> PgSelectSingle29
    PgClassExpression30{{"PgClassExpression[30∈2]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression30
    PgClassExpression31{{"PgClassExpression[31∈2]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression31
    PgClassExpression32{{"PgClassExpression[32∈2]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression32
    __Item42[/"__Item[42∈3]<br />ᐸ38ᐳ"\]:::itemplan
    PgSelect38 ==> __Item42
    PgSelectSingle43{{"PgSelectSingle[43∈3]<br />ᐸpersonᐳ"}}:::plan
    __Item42 --> PgSelectSingle43
    PgClassExpression44{{"PgClassExpression[44∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression44
    PgClassExpression45{{"PgClassExpression[45∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression45
    PgClassExpression46{{"PgClassExpression[46∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression46
    __Item56[/"__Item[56∈4]<br />ᐸ52ᐳ"\]:::itemplan
    PgSelect52 ==> __Item56
    PgSelectSingle57{{"PgSelectSingle[57∈4]<br />ᐸpersonᐳ"}}:::plan
    __Item56 --> PgSelectSingle57
    PgClassExpression58{{"PgClassExpression[58∈4]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle57 --> PgClassExpression58
    PgClassExpression59{{"PgClassExpression[59∈4]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle57 --> PgClassExpression59
    PgClassExpression60{{"PgClassExpression[60∈4]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle57 --> PgClassExpression60
    __Item76[/"__Item[76∈5]<br />ᐸ72ᐳ"\]:::itemplan
    PgSelect72 ==> __Item76
    PgSelectSingle77{{"PgSelectSingle[77∈5]<br />ᐸpostᐳ"}}:::plan
    __Item76 --> PgSelectSingle77
    PgClassExpression78{{"PgClassExpression[78∈5]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle77 --> PgClassExpression78
    PgClassExpression79{{"PgClassExpression[79∈5]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle77 --> PgClassExpression79
    __Item95[/"__Item[95∈6]<br />ᐸ91ᐳ"\]:::itemplan
    PgSelect91 ==> __Item95
    PgSelectSingle96{{"PgSelectSingle[96∈6]<br />ᐸpostᐳ"}}:::plan
    __Item95 --> PgSelectSingle96
    PgClassExpression97{{"PgClassExpression[97∈6]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle96 --> PgClassExpression97
    PgClassExpression98{{"PgClassExpression[98∈6]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle96 --> PgClassExpression98
    __Item107[/"__Item[107∈7]<br />ᐸ103ᐳ"\]:::itemplan
    PgSelect103 ==> __Item107
    PgSelectSingle108{{"PgSelectSingle[108∈7]<br />ᐸpersonᐳ"}}:::plan
    __Item107 --> PgSelectSingle108
    PgClassExpression109{{"PgClassExpression[109∈7]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle108 --> PgClassExpression109
    PgClassExpression110{{"PgClassExpression[110∈7]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle108 --> PgClassExpression110
    PgClassExpression111{{"PgClassExpression[111∈7]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle108 --> PgClassExpression111
    __Item120[/"__Item[120∈8]<br />ᐸ116ᐳ"\]:::itemplan
    PgSelect116 ==> __Item120
    PgSelectSingle121{{"PgSelectSingle[121∈8]<br />ᐸpersonᐳ"}}:::plan
    __Item120 --> PgSelectSingle121
    PgClassExpression122{{"PgClassExpression[122∈8]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle121 --> PgClassExpression122
    PgClassExpression123{{"PgClassExpression[123∈8]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle121 --> PgClassExpression123
    PgClassExpression124{{"PgClassExpression[124∈8]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle121 --> PgClassExpression124
    __Item158[/"__Item[158∈9]<br />ᐸ154ᐳ"\]:::itemplan
    PgSelect154 ==> __Item158
    PgSelectSingle159{{"PgSelectSingle[159∈9]<br />ᐸpersonᐳ"}}:::plan
    __Item158 --> PgSelectSingle159
    PgClassExpression160{{"PgClassExpression[160∈9]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle159 --> PgClassExpression160
    PgClassExpression161{{"PgClassExpression[161∈9]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle159 --> PgClassExpression161
    PgClassExpression162{{"PgClassExpression[162∈9]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle159 --> PgClassExpression162
    __Item173[/"__Item[173∈10]<br />ᐸ169ᐳ"\]:::itemplan
    PgSelect169 ==> __Item173
    PgSelectSingle174{{"PgSelectSingle[174∈10]<br />ᐸpostᐳ"}}:::plan
    __Item173 --> PgSelectSingle174
    PgClassExpression175{{"PgClassExpression[175∈10]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle174 --> PgClassExpression175
    PgClassExpression176{{"PgClassExpression[176∈10]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle174 --> PgClassExpression176

    %% define steps

    subgraph "Buckets for queries/v4/simple-collections"
    Bucket0("Bucket 0 (root)<br />1: <br />ᐳ: 12, 13, 177, 14<br />2: 11, 24, 38, 52, 72, 91, 103, 116, 154, 169"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value3,__Value5,PgSelect11,Access12,Access13,Object14,PgSelect24,PgSelect38,PgSelect52,PgSelect72,PgSelect91,PgSelect103,PgSelect116,PgSelect154,PgSelect169,Constant177 bucket0
    Bucket1("Bucket 1 (listItem)<br />ROOT __Item{1}ᐸ11ᐳ[15]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item15,PgSelectSingle16,PgClassExpression17,PgClassExpression18,PgClassExpression19 bucket1
    Bucket2("Bucket 2 (listItem)<br />ROOT __Item{2}ᐸ24ᐳ[28]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item28,PgSelectSingle29,PgClassExpression30,PgClassExpression31,PgClassExpression32 bucket2
    Bucket3("Bucket 3 (listItem)<br />ROOT __Item{3}ᐸ38ᐳ[42]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item42,PgSelectSingle43,PgClassExpression44,PgClassExpression45,PgClassExpression46 bucket3
    Bucket4("Bucket 4 (listItem)<br />ROOT __Item{4}ᐸ52ᐳ[56]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item56,PgSelectSingle57,PgClassExpression58,PgClassExpression59,PgClassExpression60 bucket4
    Bucket5("Bucket 5 (listItem)<br />ROOT __Item{5}ᐸ72ᐳ[76]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item76,PgSelectSingle77,PgClassExpression78,PgClassExpression79 bucket5
    Bucket6("Bucket 6 (listItem)<br />ROOT __Item{6}ᐸ91ᐳ[95]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item95,PgSelectSingle96,PgClassExpression97,PgClassExpression98 bucket6
    Bucket7("Bucket 7 (listItem)<br />ROOT __Item{7}ᐸ103ᐳ[107]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item107,PgSelectSingle108,PgClassExpression109,PgClassExpression110,PgClassExpression111 bucket7
    Bucket8("Bucket 8 (listItem)<br />ROOT __Item{8}ᐸ116ᐳ[120]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item120,PgSelectSingle121,PgClassExpression122,PgClassExpression123,PgClassExpression124 bucket8
    Bucket9("Bucket 9 (listItem)<br />ROOT __Item{9}ᐸ154ᐳ[158]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,__Item158,PgSelectSingle159,PgClassExpression160,PgClassExpression161,PgClassExpression162 bucket9
    Bucket10("Bucket 10 (listItem)<br />ROOT __Item{10}ᐸ169ᐳ[173]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item173,PgSelectSingle174,PgClassExpression175,PgClassExpression176 bucket10
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4 & Bucket5 & Bucket6 & Bucket7 & Bucket8 & Bucket9 & Bucket10
    classDef unary fill:#fafffa,borderWidth:8px
    class Object14,PgSelect72,PgSelect91,PgSelect11,Access12,Access13,PgSelect24,PgSelect38,PgSelect52,PgSelect103,PgSelect116,PgSelect154,PgSelect169,__Value3,__Value5,Constant177 unary
    end
