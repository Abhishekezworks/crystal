%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object13{{"Object[13∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access11{{"Access[11∈0]<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access12{{"Access[12∈0]<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access11 & Access12 --> Object13
    PgSelect71[["PgSelect[71∈0]<br />ᐸpostᐳ"]]:::plan
    Constant176{{"Constant[176∈0]<br />ᐸ2ᐳ"}}:::plan
    Object13 & Constant176 --> PgSelect71
    PgSelect90[["PgSelect[90∈0]<br />ᐸpostᐳ"]]:::plan
    Object13 & Constant176 --> PgSelect90
    PgSelect10[["PgSelect[10∈0]<br />ᐸpersonᐳ"]]:::plan
    Object13 --> PgSelect10
    __Value2["__Value[2∈0]<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access11
    __Value2 --> Access12
    PgSelect23[["PgSelect[23∈0]<br />ᐸpersonᐳ"]]:::plan
    Object13 --> PgSelect23
    PgSelect37[["PgSelect[37∈0]<br />ᐸpersonᐳ"]]:::plan
    Object13 --> PgSelect37
    PgSelect51[["PgSelect[51∈0]<br />ᐸpersonᐳ"]]:::plan
    Object13 --> PgSelect51
    PgSelect102[["PgSelect[102∈0]<br />ᐸpersonᐳ"]]:::plan
    Object13 --> PgSelect102
    PgSelect115[["PgSelect[115∈0]<br />ᐸpersonᐳ"]]:::plan
    Object13 --> PgSelect115
    PgSelect153[["PgSelect[153∈0]<br />ᐸpersonᐳ"]]:::plan
    Object13 --> PgSelect153
    PgSelect168[["PgSelect[168∈0]<br />ᐸpostᐳ"]]:::plan
    Object13 --> PgSelect168
    __Value4["__Value[4∈0]<br />ᐸrootValueᐳ"]:::plan
    __Item14[/"__Item[14∈1]<br />ᐸ10ᐳ"\]:::itemplan
    PgSelect10 ==> __Item14
    PgSelectSingle15{{"PgSelectSingle[15∈1]<br />ᐸpersonᐳ"}}:::plan
    __Item14 --> PgSelectSingle15
    PgClassExpression16{{"PgClassExpression[16∈1]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle15 --> PgClassExpression16
    PgClassExpression17{{"PgClassExpression[17∈1]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle15 --> PgClassExpression17
    PgClassExpression18{{"PgClassExpression[18∈1]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle15 --> PgClassExpression18
    __Item27[/"__Item[27∈2]<br />ᐸ23ᐳ"\]:::itemplan
    PgSelect23 ==> __Item27
    PgSelectSingle28{{"PgSelectSingle[28∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item27 --> PgSelectSingle28
    PgClassExpression29{{"PgClassExpression[29∈2]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle28 --> PgClassExpression29
    PgClassExpression30{{"PgClassExpression[30∈2]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle28 --> PgClassExpression30
    PgClassExpression31{{"PgClassExpression[31∈2]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle28 --> PgClassExpression31
    __Item41[/"__Item[41∈3]<br />ᐸ37ᐳ"\]:::itemplan
    PgSelect37 ==> __Item41
    PgSelectSingle42{{"PgSelectSingle[42∈3]<br />ᐸpersonᐳ"}}:::plan
    __Item41 --> PgSelectSingle42
    PgClassExpression43{{"PgClassExpression[43∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle42 --> PgClassExpression43
    PgClassExpression44{{"PgClassExpression[44∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle42 --> PgClassExpression44
    PgClassExpression45{{"PgClassExpression[45∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle42 --> PgClassExpression45
    __Item55[/"__Item[55∈4]<br />ᐸ51ᐳ"\]:::itemplan
    PgSelect51 ==> __Item55
    PgSelectSingle56{{"PgSelectSingle[56∈4]<br />ᐸpersonᐳ"}}:::plan
    __Item55 --> PgSelectSingle56
    PgClassExpression57{{"PgClassExpression[57∈4]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle56 --> PgClassExpression57
    PgClassExpression58{{"PgClassExpression[58∈4]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle56 --> PgClassExpression58
    PgClassExpression59{{"PgClassExpression[59∈4]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle56 --> PgClassExpression59
    __Item75[/"__Item[75∈5]<br />ᐸ71ᐳ"\]:::itemplan
    PgSelect71 ==> __Item75
    PgSelectSingle76{{"PgSelectSingle[76∈5]<br />ᐸpostᐳ"}}:::plan
    __Item75 --> PgSelectSingle76
    PgClassExpression77{{"PgClassExpression[77∈5]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle76 --> PgClassExpression77
    PgClassExpression78{{"PgClassExpression[78∈5]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle76 --> PgClassExpression78
    __Item94[/"__Item[94∈6]<br />ᐸ90ᐳ"\]:::itemplan
    PgSelect90 ==> __Item94
    PgSelectSingle95{{"PgSelectSingle[95∈6]<br />ᐸpostᐳ"}}:::plan
    __Item94 --> PgSelectSingle95
    PgClassExpression96{{"PgClassExpression[96∈6]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle95 --> PgClassExpression96
    PgClassExpression97{{"PgClassExpression[97∈6]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle95 --> PgClassExpression97
    __Item106[/"__Item[106∈7]<br />ᐸ102ᐳ"\]:::itemplan
    PgSelect102 ==> __Item106
    PgSelectSingle107{{"PgSelectSingle[107∈7]<br />ᐸpersonᐳ"}}:::plan
    __Item106 --> PgSelectSingle107
    PgClassExpression108{{"PgClassExpression[108∈7]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle107 --> PgClassExpression108
    PgClassExpression109{{"PgClassExpression[109∈7]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle107 --> PgClassExpression109
    PgClassExpression110{{"PgClassExpression[110∈7]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle107 --> PgClassExpression110
    __Item119[/"__Item[119∈8]<br />ᐸ115ᐳ"\]:::itemplan
    PgSelect115 ==> __Item119
    PgSelectSingle120{{"PgSelectSingle[120∈8]<br />ᐸpersonᐳ"}}:::plan
    __Item119 --> PgSelectSingle120
    PgClassExpression121{{"PgClassExpression[121∈8]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle120 --> PgClassExpression121
    PgClassExpression122{{"PgClassExpression[122∈8]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle120 --> PgClassExpression122
    PgClassExpression123{{"PgClassExpression[123∈8]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle120 --> PgClassExpression123
    __Item157[/"__Item[157∈9]<br />ᐸ153ᐳ"\]:::itemplan
    PgSelect153 ==> __Item157
    PgSelectSingle158{{"PgSelectSingle[158∈9]<br />ᐸpersonᐳ"}}:::plan
    __Item157 --> PgSelectSingle158
    PgClassExpression159{{"PgClassExpression[159∈9]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle158 --> PgClassExpression159
    PgClassExpression160{{"PgClassExpression[160∈9]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle158 --> PgClassExpression160
    PgClassExpression161{{"PgClassExpression[161∈9]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle158 --> PgClassExpression161
    __Item172[/"__Item[172∈10]<br />ᐸ168ᐳ"\]:::itemplan
    PgSelect168 ==> __Item172
    PgSelectSingle173{{"PgSelectSingle[173∈10]<br />ᐸpostᐳ"}}:::plan
    __Item172 --> PgSelectSingle173
    PgClassExpression174{{"PgClassExpression[174∈10]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle173 --> PgClassExpression174
    PgClassExpression175{{"PgClassExpression[175∈10]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle173 --> PgClassExpression175

    %% define steps

    subgraph "Buckets for queries/v4/simple-collections"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 11, 12, 176, 13<br />2: 10, 23, 37, 51, 71, 90, 102, 115, 153, 168"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect10,Access11,Access12,Object13,PgSelect23,PgSelect37,PgSelect51,PgSelect71,PgSelect90,PgSelect102,PgSelect115,PgSelect153,PgSelect168,Constant176 bucket0
    Bucket1("Bucket 1 (listItem)<br /><br />ROOT __Item{1}ᐸ10ᐳ[14]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item14,PgSelectSingle15,PgClassExpression16,PgClassExpression17,PgClassExpression18 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ23ᐳ[27]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item27,PgSelectSingle28,PgClassExpression29,PgClassExpression30,PgClassExpression31 bucket2
    Bucket3("Bucket 3 (listItem)<br /><br />ROOT __Item{3}ᐸ37ᐳ[41]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item41,PgSelectSingle42,PgClassExpression43,PgClassExpression44,PgClassExpression45 bucket3
    Bucket4("Bucket 4 (listItem)<br /><br />ROOT __Item{4}ᐸ51ᐳ[55]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item55,PgSelectSingle56,PgClassExpression57,PgClassExpression58,PgClassExpression59 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ71ᐳ[75]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item75,PgSelectSingle76,PgClassExpression77,PgClassExpression78 bucket5
    Bucket6("Bucket 6 (listItem)<br /><br />ROOT __Item{6}ᐸ90ᐳ[94]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item94,PgSelectSingle95,PgClassExpression96,PgClassExpression97 bucket6
    Bucket7("Bucket 7 (listItem)<br /><br />ROOT __Item{7}ᐸ102ᐳ[106]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item106,PgSelectSingle107,PgClassExpression108,PgClassExpression109,PgClassExpression110 bucket7
    Bucket8("Bucket 8 (listItem)<br /><br />ROOT __Item{8}ᐸ115ᐳ[119]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item119,PgSelectSingle120,PgClassExpression121,PgClassExpression122,PgClassExpression123 bucket8
    Bucket9("Bucket 9 (listItem)<br /><br />ROOT __Item{9}ᐸ153ᐳ[157]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,__Item157,PgSelectSingle158,PgClassExpression159,PgClassExpression160,PgClassExpression161 bucket9
    Bucket10("Bucket 10 (listItem)<br /><br />ROOT __Item{10}ᐸ168ᐳ[172]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item172,PgSelectSingle173,PgClassExpression174,PgClassExpression175 bucket10
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4 & Bucket5 & Bucket6 & Bucket7 & Bucket8 & Bucket9 & Bucket10
    classDef unary fill:#fafffa,borderWidth:8px
    class Object13,PgSelect71,PgSelect90,PgSelect10,Access11,Access12,PgSelect23,PgSelect37,PgSelect51,PgSelect102,PgSelect115,PgSelect153,PgSelect168,__Value2,__Value4,Constant176 unary
    end
