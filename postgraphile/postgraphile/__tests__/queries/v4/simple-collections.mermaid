%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect45[["PgSelect[45∈0] ➊<br />ᐸpostᐳ"]]:::plan
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant117{{"Constant[117∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    ApplyInput47{{"ApplyInput[47∈0] ➊"}}:::plan
    Object10 & Constant117 & ApplyInput47 --> PgSelect45
    PgSelect53[["PgSelect[53∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Constant118{{"Constant[118∈0] ➊<br />ᐸ3ᐳ"}}:::plan
    Constant119{{"Constant[119∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Object10 & Constant118 & Constant119 --> PgSelect53
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    PgSelect15[["PgSelect[15∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Object10 & Constant117 --> PgSelect15
    __InputObject34{{"__InputObject[34∈0] ➊"}}:::plan
    Constant117 --> __InputObject34
    PgSelect36[["PgSelect[36∈0] ➊<br />ᐸpostᐳ"]]:::plan
    ApplyInput38{{"ApplyInput[38∈0] ➊"}}:::plan
    Object10 & ApplyInput38 --> PgSelect36
    __InputObject43{{"__InputObject[43∈0] ➊"}}:::plan
    Constant117 --> __InputObject43
    PgSelect59[["PgSelect[59∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Constant120{{"Constant[120∈0] ➊<br />ᐸ0ᐳ"}}:::plan
    Object10 & Constant120 --> PgSelect59
    __InputObject71{{"__InputObject[71∈0] ➊"}}:::plan
    Constant72{{"Constant[72∈0] ➊<br />ᐸnullᐳ"}}:::plan
    Constant72 --> __InputObject71
    PgSelect73[["PgSelect[73∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    ApplyInput75{{"ApplyInput[75∈0] ➊"}}:::plan
    Object10 & ApplyInput75 --> PgSelect73
    PgSelect81[["PgSelect[81∈0] ➊<br />ᐸpostᐳ"]]:::plan
    Object10 & Constant118 --> PgSelect81
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Object10 --> PgSelect7
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    PgSelectRows11[["PgSelectRows[11∈0] ➊"]]:::plan
    PgSelect7 --> PgSelectRows11
    PgSelectRows17[["PgSelectRows[17∈0] ➊"]]:::plan
    PgSelect15 --> PgSelectRows17
    PgSelect21[["PgSelect[21∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Object10 --> PgSelect21
    PgSelectRows24[["PgSelectRows[24∈0] ➊"]]:::plan
    PgSelect21 --> PgSelectRows24
    PgSelect28[["PgSelect[28∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Object10 --> PgSelect28
    PgSelectRows31[["PgSelectRows[31∈0] ➊"]]:::plan
    PgSelect28 --> PgSelectRows31
    __InputObject34 --> ApplyInput38
    PgSelectRows39[["PgSelectRows[39∈0] ➊"]]:::plan
    PgSelect36 --> PgSelectRows39
    __InputObject43 --> ApplyInput47
    PgSelectRows48[["PgSelectRows[48∈0] ➊"]]:::plan
    PgSelect45 --> PgSelectRows48
    PgSelectRows55[["PgSelectRows[55∈0] ➊"]]:::plan
    PgSelect53 --> PgSelectRows55
    PgSelectRows61[["PgSelectRows[61∈0] ➊"]]:::plan
    PgSelect59 --> PgSelectRows61
    PgSelect65[["PgSelect[65∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Object10 --> PgSelect65
    PgSelectRows68[["PgSelectRows[68∈0] ➊"]]:::plan
    PgSelect65 --> PgSelectRows68
    __InputObject71 --> ApplyInput75
    PgSelectRows76[["PgSelectRows[76∈0] ➊"]]:::plan
    PgSelect73 --> PgSelectRows76
    PgSelectRows84[["PgSelectRows[84∈0] ➊"]]:::plan
    PgSelect81 --> PgSelectRows84
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    __Item12[/"__Item[12∈1]<br />ᐸ11ᐳ"\]:::itemplan
    PgSelectRows11 ==> __Item12
    PgSelectSingle13{{"PgSelectSingle[13∈1]<br />ᐸpersonᐳ"}}:::plan
    __Item12 --> PgSelectSingle13
    PgClassExpression87{{"PgClassExpression[87∈1]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle13 --> PgClassExpression87
    PgClassExpression88{{"PgClassExpression[88∈1]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle13 --> PgClassExpression88
    PgClassExpression89{{"PgClassExpression[89∈1]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle13 --> PgClassExpression89
    __Item18[/"__Item[18∈2]<br />ᐸ17ᐳ"\]:::itemplan
    PgSelectRows17 ==> __Item18
    PgSelectSingle19{{"PgSelectSingle[19∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item18 --> PgSelectSingle19
    PgClassExpression90{{"PgClassExpression[90∈2]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle19 --> PgClassExpression90
    PgClassExpression91{{"PgClassExpression[91∈2]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle19 --> PgClassExpression91
    PgClassExpression92{{"PgClassExpression[92∈2]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle19 --> PgClassExpression92
    __Item25[/"__Item[25∈3]<br />ᐸ24ᐳ"\]:::itemplan
    PgSelectRows24 ==> __Item25
    PgSelectSingle26{{"PgSelectSingle[26∈3]<br />ᐸpersonᐳ"}}:::plan
    __Item25 --> PgSelectSingle26
    PgClassExpression93{{"PgClassExpression[93∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle26 --> PgClassExpression93
    PgClassExpression94{{"PgClassExpression[94∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle26 --> PgClassExpression94
    PgClassExpression95{{"PgClassExpression[95∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle26 --> PgClassExpression95
    __Item32[/"__Item[32∈4]<br />ᐸ31ᐳ"\]:::itemplan
    PgSelectRows31 ==> __Item32
    PgSelectSingle33{{"PgSelectSingle[33∈4]<br />ᐸpersonᐳ"}}:::plan
    __Item32 --> PgSelectSingle33
    PgClassExpression96{{"PgClassExpression[96∈4]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle33 --> PgClassExpression96
    PgClassExpression97{{"PgClassExpression[97∈4]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle33 --> PgClassExpression97
    PgClassExpression98{{"PgClassExpression[98∈4]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle33 --> PgClassExpression98
    __Item40[/"__Item[40∈5]<br />ᐸ39ᐳ"\]:::itemplan
    PgSelectRows39 ==> __Item40
    PgSelectSingle41{{"PgSelectSingle[41∈5]<br />ᐸpostᐳ"}}:::plan
    __Item40 --> PgSelectSingle41
    PgClassExpression99{{"PgClassExpression[99∈5]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression99
    PgClassExpression100{{"PgClassExpression[100∈5]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression100
    __Item49[/"__Item[49∈6]<br />ᐸ48ᐳ"\]:::itemplan
    PgSelectRows48 ==> __Item49
    PgSelectSingle50{{"PgSelectSingle[50∈6]<br />ᐸpostᐳ"}}:::plan
    __Item49 --> PgSelectSingle50
    PgClassExpression101{{"PgClassExpression[101∈6]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression101
    PgClassExpression102{{"PgClassExpression[102∈6]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression102
    __Item56[/"__Item[56∈7]<br />ᐸ55ᐳ"\]:::itemplan
    PgSelectRows55 ==> __Item56
    PgSelectSingle57{{"PgSelectSingle[57∈7]<br />ᐸpersonᐳ"}}:::plan
    __Item56 --> PgSelectSingle57
    PgClassExpression103{{"PgClassExpression[103∈7]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle57 --> PgClassExpression103
    PgClassExpression104{{"PgClassExpression[104∈7]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle57 --> PgClassExpression104
    PgClassExpression105{{"PgClassExpression[105∈7]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle57 --> PgClassExpression105
    __Item62[/"__Item[62∈8]<br />ᐸ61ᐳ"\]:::itemplan
    PgSelectRows61 ==> __Item62
    PgSelectSingle63{{"PgSelectSingle[63∈8]<br />ᐸpersonᐳ"}}:::plan
    __Item62 --> PgSelectSingle63
    PgClassExpression106{{"PgClassExpression[106∈8]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression106
    PgClassExpression107{{"PgClassExpression[107∈8]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression107
    PgClassExpression108{{"PgClassExpression[108∈8]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression108
    __Item69[/"__Item[69∈9]<br />ᐸ68ᐳ"\]:::itemplan
    PgSelectRows68 ==> __Item69
    PgSelectSingle70{{"PgSelectSingle[70∈9]<br />ᐸpersonᐳ"}}:::plan
    __Item69 --> PgSelectSingle70
    PgClassExpression109{{"PgClassExpression[109∈9]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression109
    PgClassExpression110{{"PgClassExpression[110∈9]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression110
    PgClassExpression111{{"PgClassExpression[111∈9]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression111
    __Item77[/"__Item[77∈10]<br />ᐸ76ᐳ"\]:::itemplan
    PgSelectRows76 ==> __Item77
    PgSelectSingle78{{"PgSelectSingle[78∈10]<br />ᐸpersonᐳ"}}:::plan
    __Item77 --> PgSelectSingle78
    PgClassExpression112{{"PgClassExpression[112∈10]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle78 --> PgClassExpression112
    PgClassExpression113{{"PgClassExpression[113∈10]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle78 --> PgClassExpression113
    PgClassExpression114{{"PgClassExpression[114∈10]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle78 --> PgClassExpression114
    __Item85[/"__Item[85∈11]<br />ᐸ84ᐳ"\]:::itemplan
    PgSelectRows84 ==> __Item85
    PgSelectSingle86{{"PgSelectSingle[86∈11]<br />ᐸpostᐳ"}}:::plan
    __Item85 --> PgSelectSingle86
    PgClassExpression115{{"PgClassExpression[115∈11]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle86 --> PgClassExpression115
    PgClassExpression116{{"PgClassExpression[116∈11]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle86 --> PgClassExpression116

    %% define steps

    subgraph "Buckets for queries/v4/simple-collections"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 6, 8, 9, 72, 117, 118, 119, 120, 10, 34, 38, 43, 47, 71, 75<br />2: 7, 15, 21, 28, 36, 45, 53, 59, 65, 73, 81<br />3: 11, 17, 24, 31, 39, 48, 55, 61, 68, 76, 84"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access9,Object10,PgSelectRows11,PgSelect15,PgSelectRows17,PgSelect21,PgSelectRows24,PgSelect28,PgSelectRows31,__InputObject34,PgSelect36,ApplyInput38,PgSelectRows39,__InputObject43,PgSelect45,ApplyInput47,PgSelectRows48,PgSelect53,PgSelectRows55,PgSelect59,PgSelectRows61,PgSelect65,PgSelectRows68,__InputObject71,Constant72,PgSelect73,ApplyInput75,PgSelectRows76,PgSelect81,PgSelectRows84,Constant117,Constant118,Constant119,Constant120 bucket0
    Bucket1("Bucket 1 (listItem)<br /><br />ROOT __Item{1}ᐸ11ᐳ[12]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item12,PgSelectSingle13,PgClassExpression87,PgClassExpression88,PgClassExpression89 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ17ᐳ[18]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item18,PgSelectSingle19,PgClassExpression90,PgClassExpression91,PgClassExpression92 bucket2
    Bucket3("Bucket 3 (listItem)<br /><br />ROOT __Item{3}ᐸ24ᐳ[25]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item25,PgSelectSingle26,PgClassExpression93,PgClassExpression94,PgClassExpression95 bucket3
    Bucket4("Bucket 4 (listItem)<br /><br />ROOT __Item{4}ᐸ31ᐳ[32]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item32,PgSelectSingle33,PgClassExpression96,PgClassExpression97,PgClassExpression98 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ39ᐳ[40]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item40,PgSelectSingle41,PgClassExpression99,PgClassExpression100 bucket5
    Bucket6("Bucket 6 (listItem)<br /><br />ROOT __Item{6}ᐸ48ᐳ[49]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item49,PgSelectSingle50,PgClassExpression101,PgClassExpression102 bucket6
    Bucket7("Bucket 7 (listItem)<br /><br />ROOT __Item{7}ᐸ55ᐳ[56]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item56,PgSelectSingle57,PgClassExpression103,PgClassExpression104,PgClassExpression105 bucket7
    Bucket8("Bucket 8 (listItem)<br /><br />ROOT __Item{8}ᐸ61ᐳ[62]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item62,PgSelectSingle63,PgClassExpression106,PgClassExpression107,PgClassExpression108 bucket8
    Bucket9("Bucket 9 (listItem)<br /><br />ROOT __Item{9}ᐸ68ᐳ[69]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,__Item69,PgSelectSingle70,PgClassExpression109,PgClassExpression110,PgClassExpression111 bucket9
    Bucket10("Bucket 10 (listItem)<br /><br />ROOT __Item{10}ᐸ76ᐳ[77]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item77,PgSelectSingle78,PgClassExpression112,PgClassExpression113,PgClassExpression114 bucket10
    Bucket11("Bucket 11 (listItem)<br /><br />ROOT __Item{11}ᐸ84ᐳ[85]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,__Item85,PgSelectSingle86,PgClassExpression115,PgClassExpression116 bucket11
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4 & Bucket5 & Bucket6 & Bucket7 & Bucket8 & Bucket9 & Bucket10 & Bucket11
    end
