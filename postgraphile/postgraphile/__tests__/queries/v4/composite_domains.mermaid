%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/v4/composite_domains"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 11, 12, 66, 31, 70, 45, 58<br /><br />ROOT Connectionᐸ8ᐳ[12]<br />1: PgSelect[14]<br />ᐳ: Access[67], Access[71]<br />2: PgSelectRows[15]"):::bucket
    Bucket2("Bucket 2 (listItem)<br />Deps: 67, 71, 11, 45, 58<br /><br />ROOT __Item{2}ᐸ15ᐳ[16]"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 17, 67, 71, 16, 11, 45, 58<br /><br />ROOT PgSelectSingle{2}ᐸpostsᐳ[17]<br />1: <br />ᐳ: 18, 19, 32, 68, 72, 69, 73<br />2: PgSelectRows[26], PgSelectRows[33]<br />ᐳ: 25, 27, 36, 37"):::bucket
    Bucket4("Bucket 4 (listItem)<br />Deps: 11, 58<br /><br />ROOT __Item{4}ᐸ33ᐳ[34]"):::bucket
    Bucket6("Bucket 6 (listItem)<br />Deps: 11, 45<br /><br />ROOT __Item{6}ᐸ37ᐳ[40]<br />1: PgSelect[41]<br />2: PgSelectRows[50]"):::bucket
    Bucket8("Bucket 8 (listItem)<br /><br />ROOT __Item{8}ᐸ50ᐳ[51]"):::bucket
    Bucket9("Bucket 9 (listItem)<br />Deps: 11, 58<br /><br />ROOT __Item{9}ᐸ47ᐳ[53]<br />1: PgSelect[54]<br />2: PgSelectRows[59]"):::bucket
    Bucket10("Bucket 10 (listItem)<br /><br />ROOT __Item{10}ᐸ59ᐳ[60]"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6
    Bucket4 --> Bucket9
    Bucket6 --> Bucket8
    Bucket9 --> Bucket10

    %% plan dependencies
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ<br />Dependents: 3"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access9 & Access10 --> Object11
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access9
    __Value2 --> Access10
    Connection12{{"Connection[12∈0] ➊<br />ᐸ8ᐳ"}}:::plan
    PgFromExpression31{{"PgFromExpression[31∈0] ➊"}}:::plan
    PgFromExpression45{{"PgFromExpression[45∈0] ➊"}}:::plan
    PgFromExpression58{{"PgFromExpression[58∈0] ➊"}}:::plan
    PgSelectInlineApply66["PgSelectInlineApply[66∈0] ➊"]:::plan
    PgSelectInlineApply70["PgSelectInlineApply[70∈0] ➊"]:::plan
    PgSelect14[["PgSelect[14∈1] ➊<br />ᐸpostsᐳ<br />More deps:<br />- Object[11]"]]:::plan
    Connection12 & PgSelectInlineApply66 & PgFromExpression31 & PgSelectInlineApply70 --> PgSelect14
    PgSelectRows15[["PgSelectRows[15∈1] ➊"]]:::plan
    PgSelect14 --> PgSelectRows15
    Access67{{"Access[67∈1] ➊<br />ᐸ14.m.joinDetailsFor21ᐳ"}}:::plan
    PgSelect14 --> Access67
    Access71{{"Access[71∈1] ➊<br />ᐸ14.m.subqueryDetailsFor29ᐳ"}}:::plan
    PgSelect14 --> Access71
    __Item16[/"__Item[16∈2]<br />ᐸ15ᐳ"\]:::itemplan
    PgSelectRows15 ==> __Item16
    PgSelectSingle17{{"PgSelectSingle[17∈2]<br />ᐸpostsᐳ"}}:::plan
    __Item16 --> PgSelectSingle17
    List68{{"List[68∈3]<br />ᐸ67,17ᐳ"}}:::plan
    Access67 & PgSelectSingle17 --> List68
    List72{{"List[72∈3]<br />ᐸ71,16ᐳ"}}:::plan
    Access71 & __Item16 --> List72
    PgClassExpression18{{"PgClassExpression[18∈3]<br />ᐸ__posts__.”id”ᐳ"}}:::plan
    PgSelectSingle17 --> PgClassExpression18
    PgClassExpression19{{"PgClassExpression[19∈3]<br />ᐸ__posts__.”user_id”ᐳ"}}:::plan
    PgSelectSingle17 --> PgClassExpression19
    First25{{"First[25∈3]"}}:::plan
    PgSelectRows26[["PgSelectRows[26∈3]"]]:::plan
    PgSelectRows26 --> First25
    Lambda69{{"Lambda[69∈3]<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda69 --> PgSelectRows26
    PgSelectSingle27{{"PgSelectSingle[27∈3]<br />ᐸfrmcdc_userUpdateContentᐳ"}}:::plan
    First25 --> PgSelectSingle27
    PgClassExpression32{{"PgClassExpression[32∈3]<br />ᐸ__posts__.”created_at”ᐳ"}}:::plan
    PgSelectSingle17 --> PgClassExpression32
    PgSelectRows33[["PgSelectRows[33∈3]"]]:::plan
    Lambda73{{"Lambda[73∈3]<br />ᐸpgInlineViaSubqueryTransformᐳ"}}:::plan
    Lambda73 --> PgSelectRows33
    PgClassExpression36{{"PgClassExpression[36∈3]<br />ᐸ__frmcdc_u....”img_url”ᐳ"}}:::plan
    PgSelectSingle27 --> PgClassExpression36
    PgClassExpression37{{"PgClassExpression[37∈3]<br />ᐸ__frmcdc_u...__.”lines”ᐳ"}}:::plan
    PgSelectSingle27 --> PgClassExpression37
    List68 --> Lambda69
    List72 --> Lambda73
    __Item34[/"__Item[34∈4]<br />ᐸ33ᐳ"\]:::itemplan
    PgSelectRows33 ==> __Item34
    PgSelectSingle35{{"PgSelectSingle[35∈4]<br />ᐸfrmcdc_userUpdateContentᐳ"}}:::plan
    __Item34 --> PgSelectSingle35
    PgClassExpression46{{"PgClassExpression[46∈4]<br />ᐸ__frmcdc_u....”img_url”ᐳ"}}:::plan
    PgSelectSingle35 --> PgClassExpression46
    PgClassExpression47{{"PgClassExpression[47∈4]<br />ᐸ__frmcdc_u...__.”lines”ᐳ"}}:::plan
    PgSelectSingle35 --> PgClassExpression47
    PgSelect41[["PgSelect[41∈6]<br />ᐸfrmcdc_userUpdateContentLineNodeᐳ<br />More deps:<br />- Object[11]"]]:::plan
    __Item40[/"__Item[40∈6]<br />ᐸ37ᐳ"\]:::itemplan
    __Item40 & PgFromExpression45 --> PgSelect41
    PgClassExpression37 ==> __Item40
    PgSelectRows50[["PgSelectRows[50∈6]"]]:::plan
    PgSelect41 --> PgSelectRows50
    __Item51[/"__Item[51∈8]<br />ᐸ50ᐳ"\]:::itemplan
    PgSelectRows50 ==> __Item51
    PgSelectSingle52{{"PgSelectSingle[52∈8]<br />ᐸfrmcdc_userUpdateContentLineNodeᐳ"}}:::plan
    __Item51 --> PgSelectSingle52
    PgClassExpression62{{"PgClassExpression[62∈8]<br />ᐸ__frmcdc_u...node_type”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression62
    PgClassExpression63{{"PgClassExpression[63∈8]<br />ᐸ__frmcdc_u...node_text”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression63
    PgSelect54[["PgSelect[54∈9]<br />ᐸfrmcdc_userUpdateContentLineNodeᐳ<br />More deps:<br />- Object[11]"]]:::plan
    __Item53[/"__Item[53∈9]<br />ᐸ47ᐳ"\]:::itemplan
    __Item53 & PgFromExpression58 --> PgSelect54
    PgClassExpression47 ==> __Item53
    PgSelectRows59[["PgSelectRows[59∈9]"]]:::plan
    PgSelect54 --> PgSelectRows59
    __Item60[/"__Item[60∈10]<br />ᐸ59ᐳ"\]:::itemplan
    PgSelectRows59 ==> __Item60
    PgSelectSingle61{{"PgSelectSingle[61∈10]<br />ᐸfrmcdc_userUpdateContentLineNodeᐳ"}}:::plan
    __Item60 --> PgSelectSingle61
    PgClassExpression64{{"PgClassExpression[64∈10]<br />ᐸ__frmcdc_u...node_type”ᐳ"}}:::plan
    PgSelectSingle61 --> PgClassExpression64
    PgClassExpression65{{"PgClassExpression[65∈10]<br />ᐸ__frmcdc_u...node_text”ᐳ"}}:::plan
    PgSelectSingle61 --> PgClassExpression65

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,Access9,Access10,Object11,Connection12,PgFromExpression31,PgFromExpression45,PgFromExpression58,PgSelectInlineApply66,PgSelectInlineApply70 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect14,PgSelectRows15,Access67,Access71 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item16,PgSelectSingle17 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression18,PgClassExpression19,First25,PgSelectRows26,PgSelectSingle27,PgClassExpression32,PgSelectRows33,PgClassExpression36,PgClassExpression37,List68,Lambda69,List72,Lambda73 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item34,PgSelectSingle35,PgClassExpression46,PgClassExpression47 bucket4
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item40,PgSelect41,PgSelectRows50 bucket6
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item51,PgSelectSingle52,PgClassExpression62,PgClassExpression63 bucket8
    classDef bucket9 stroke:#ff0000
    class Bucket9,__Item53,PgSelect54,PgSelectRows59 bucket9
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item60,PgSelectSingle61,PgClassExpression64,PgClassExpression65 bucket10

