%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect26[["PgSelect[26∈0] ➊<br />ᐸcompound_keyᐳ"]]:::plan
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant130{{"Constant[130∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Constant131{{"Constant[131∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Lambda53{{"Lambda[53∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Access57{{"Access[57∈0] ➊<br />ᐸ56.0ᐳ"}}:::plan
    Lambda92{{"Lambda[92∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda97{{"Lambda[97∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object10 & Constant130 & Constant131 & Lambda53 & Access57 & Lambda92 & Lambda97 --> PgSelect26
    PgSelect35[["PgSelect[35∈0] ➊<br />ᐸcompound_keyᐳ"]]:::plan
    Constant132{{"Constant[132∈0] ➊<br />ᐸ4ᐳ"}}:::plan
    Lambda107{{"Lambda[107∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda112{{"Lambda[112∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object10 & Constant132 & Constant132 & Lambda53 & Access57 & Lambda107 & Lambda112 --> PgSelect35
    PgSelect44[["PgSelect[44∈0] ➊<br />ᐸcompound_keyᐳ"]]:::plan
    Constant133{{"Constant[133∈0] ➊<br />ᐸ100ᐳ"}}:::plan
    Lambda122{{"Lambda[122∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda127{{"Lambda[127∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object10 & Constant130 & Constant133 & Lambda53 & Access57 & Lambda122 & Lambda127 --> PgSelect44
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Constant128{{"Constant[128∈0] ➊<br />ᐸ'sara.smith@email.com'ᐳ"}}:::plan
    Lambda62{{"Lambda[62∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda67{{"Lambda[67∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object10 & Constant128 & Lambda53 & Access57 & Lambda62 & Lambda67 --> PgSelect7
    PgSelect17[["PgSelect[17∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Constant129{{"Constant[129∈0] ➊<br />ᐸ'does.not.exist@email.com'ᐳ"}}:::plan
    Lambda77{{"Lambda[77∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda82{{"Lambda[82∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object10 & Constant129 & Lambda53 & Access57 & Lambda77 & Lambda82 --> PgSelect17
    Object61{{"Object[61∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant58{{"Constant[58∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant59{{"Constant[59∈0] ➊<br />ᐸsql.identifier(”person”)ᐳ"}}:::plan
    Constant60{{"Constant[60∈0] ➊<br />ᐸRecordCodec(person)ᐳ"}}:::plan
    Lambda53 & Constant58 & Constant59 & Constant60 --> Object61
    Object76{{"Object[76∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant73{{"Constant[73∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant74{{"Constant[74∈0] ➊<br />ᐸsql.identifier(”person”)ᐳ"}}:::plan
    Lambda53 & Constant73 & Constant74 & Constant60 --> Object76
    Object91{{"Object[91∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant88{{"Constant[88∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant89{{"Constant[89∈0] ➊<br />ᐸsql.identifier(”compound_key”)ᐳ"}}:::plan
    Constant90{{"Constant[90∈0] ➊<br />ᐸRecordCodec(compoundKey)ᐳ"}}:::plan
    Lambda53 & Constant88 & Constant89 & Constant90 --> Object91
    Object106{{"Object[106∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant103{{"Constant[103∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant104{{"Constant[104∈0] ➊<br />ᐸsql.identifier(”compound_key”)ᐳ"}}:::plan
    Lambda53 & Constant103 & Constant104 & Constant90 --> Object106
    Object121{{"Object[121∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant118{{"Constant[118∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant119{{"Constant[119∈0] ➊<br />ᐸsql.identifier(”compound_key”)ᐳ"}}:::plan
    Lambda53 & Constant118 & Constant119 & Constant90 --> Object121
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    First11{{"First[11∈0] ➊"}}:::plan
    PgSelectRows12[["PgSelectRows[12∈0] ➊"]]:::plan
    PgSelectRows12 --> First11
    PgSelect7 --> PgSelectRows12
    PgSelectSingle13{{"PgSelectSingle[13∈0] ➊<br />ᐸpersonᐳ"}}:::plan
    First11 --> PgSelectSingle13
    First19{{"First[19∈0] ➊"}}:::plan
    PgSelectRows20[["PgSelectRows[20∈0] ➊"]]:::plan
    PgSelectRows20 --> First19
    PgSelect17 --> PgSelectRows20
    PgSelectSingle21{{"PgSelectSingle[21∈0] ➊<br />ᐸpersonᐳ"}}:::plan
    First19 --> PgSelectSingle21
    First28{{"First[28∈0] ➊"}}:::plan
    PgSelectRows29[["PgSelectRows[29∈0] ➊"]]:::plan
    PgSelectRows29 --> First28
    PgSelect26 --> PgSelectRows29
    PgSelectSingle30{{"PgSelectSingle[30∈0] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First28 --> PgSelectSingle30
    First37{{"First[37∈0] ➊"}}:::plan
    PgSelectRows38[["PgSelectRows[38∈0] ➊"]]:::plan
    PgSelectRows38 --> First37
    PgSelect35 --> PgSelectRows38
    PgSelectSingle39{{"PgSelectSingle[39∈0] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First37 --> PgSelectSingle39
    First46{{"First[46∈0] ➊"}}:::plan
    PgSelectRows47[["PgSelectRows[47∈0] ➊"]]:::plan
    PgSelectRows47 --> First46
    PgSelect44 --> PgSelectRows47
    PgSelectSingle48{{"PgSelectSingle[48∈0] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First46 --> PgSelectSingle48
    Constant134{{"Constant[134∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant134 --> Lambda53
    Lambda56{{"Lambda[56∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant135{{"Constant[135∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant135 --> Lambda56
    Lambda56 --> Access57
    Object61 --> Lambda62
    Constant136{{"Constant[136∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”personᐳ"}}:::plan
    Constant136 --> Lambda67
    Object76 --> Lambda77
    Constant137{{"Constant[137∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”personᐳ"}}:::plan
    Constant137 --> Lambda82
    Object91 --> Lambda92
    Constant138{{"Constant[138∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”compouᐳ"}}:::plan
    Constant138 --> Lambda97
    Object106 --> Lambda107
    Constant139{{"Constant[139∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”compouᐳ"}}:::plan
    Constant139 --> Lambda112
    Object121 --> Lambda122
    Constant140{{"Constant[140∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”compouᐳ"}}:::plan
    Constant140 --> Lambda127
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgClassExpression14{{"PgClassExpression[14∈1] ➊<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle13 --> PgClassExpression14
    PgClassExpression15{{"PgClassExpression[15∈1] ➊<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle13 --> PgClassExpression15
    PgClassExpression22{{"PgClassExpression[22∈2] ➊<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression22
    PgClassExpression23{{"PgClassExpression[23∈2] ➊<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression23
    PgClassExpression31{{"PgClassExpression[31∈3] ➊<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression31
    PgClassExpression32{{"PgClassExpression[32∈3] ➊<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression32
    PgClassExpression40{{"PgClassExpression[40∈4] ➊<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle39 --> PgClassExpression40
    PgClassExpression41{{"PgClassExpression[41∈4] ➊<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle39 --> PgClassExpression41
    PgClassExpression49{{"PgClassExpression[49∈5] ➊<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression49
    PgClassExpression50{{"PgClassExpression[50∈5] ➊<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression50

    %% define steps

    subgraph "Buckets for queries/v4/unique-constraints"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 8, 9, 58, 59, 60, 73, 74, 88, 89, 90, 103, 104, 118, 119, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 10, 53, 56, 57, 61, 62, 67, 76, 77, 82, 91, 92, 97, 106, 107, 112, 121, 122, 127<br />2: 7, 17, 26, 35, 44<br />3: 12, 20, 29, 38, 47<br />ᐳ: 11, 13, 19, 21, 28, 30, 37, 39, 46, 48"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access9,Object10,First11,PgSelectRows12,PgSelectSingle13,PgSelect17,First19,PgSelectRows20,PgSelectSingle21,PgSelect26,First28,PgSelectRows29,PgSelectSingle30,PgSelect35,First37,PgSelectRows38,PgSelectSingle39,PgSelect44,First46,PgSelectRows47,PgSelectSingle48,Lambda53,Lambda56,Access57,Constant58,Constant59,Constant60,Object61,Lambda62,Lambda67,Constant73,Constant74,Object76,Lambda77,Lambda82,Constant88,Constant89,Constant90,Object91,Lambda92,Lambda97,Constant103,Constant104,Object106,Lambda107,Lambda112,Constant118,Constant119,Object121,Lambda122,Lambda127,Constant128,Constant129,Constant130,Constant131,Constant132,Constant133,Constant134,Constant135,Constant136,Constant137,Constant138,Constant139,Constant140 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 13<br /><br />ROOT PgSelectSingleᐸpersonᐳ[13]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgClassExpression14,PgClassExpression15 bucket1
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 21<br /><br />ROOT PgSelectSingleᐸpersonᐳ[21]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgClassExpression22,PgClassExpression23 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 30<br /><br />ROOT PgSelectSingleᐸcompound_keyᐳ[30]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression31,PgClassExpression32 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 39<br /><br />ROOT PgSelectSingleᐸcompound_keyᐳ[39]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression40,PgClassExpression41 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 48<br /><br />ROOT PgSelectSingleᐸcompound_keyᐳ[48]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression49,PgClassExpression50 bucket5
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4 & Bucket5
    end
