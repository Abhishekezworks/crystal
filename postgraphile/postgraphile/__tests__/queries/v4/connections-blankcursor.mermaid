%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection18{{"Connection[18∈0] ➊<br />ᐸ14ᐳ"}}:::plan
    Constant110{{"Constant[110∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Lambda19{{"Lambda[19∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor25["PgValidateParsedCursor[25∈0] ➊"]:::plan
    Constant110 & Lambda19 & PgValidateParsedCursor25 & PgValidateParsedCursor25 & PgValidateParsedCursor25 & PgValidateParsedCursor25 --> Connection18
    Connection69{{"Connection[69∈0] ➊<br />ᐸ67ᐳ"}}:::plan
    Lambda70{{"Lambda[70∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor76["PgValidateParsedCursor[76∈0] ➊"]:::plan
    Constant110 & Lambda70 & PgValidateParsedCursor76 & PgValidateParsedCursor76 & PgValidateParsedCursor76 & PgValidateParsedCursor76 --> Connection69
    Object17{{"Object[17∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access15{{"Access[15∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access15 & Access16 --> Object17
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access15
    __Value2 --> Access16
    Constant111{{"Constant[111∈0] ➊<br />ᐸ''ᐳ"}}:::plan
    Constant111 --> Lambda19
    Lambda19 --> PgValidateParsedCursor25
    Constant113{{"Constant[113∈0] ➊<br />ᐸ'27'ᐳ"}}:::plan
    Constant113 --> Lambda70
    Lambda70 --> PgValidateParsedCursor76
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant41{{"Constant[41∈0] ➊<br />ᐸfalseᐳ"}}:::plan
    PgSelect21[["PgSelect[21∈1] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Access26{{"Access[26∈1] ➊<br />ᐸ19.1ᐳ"}}:::plan
    Object17 & Connection18 & Lambda19 & Access26 --> PgSelect21
    PgSelect42[["PgSelect[42∈1] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object17 & Connection18 --> PgSelect42
    PgPageInfo20{{"PgPageInfo[20∈1] ➊"}}:::plan
    Connection18 --> PgPageInfo20
    First22{{"First[22∈1] ➊"}}:::plan
    PgSelect21 --> First22
    PgSelectSingle23{{"PgSelectSingle[23∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First22 --> PgSelectSingle23
    PgCursor24{{"PgCursor[24∈1] ➊"}}:::plan
    List28{{"List[28∈1] ➊<br />ᐸ27ᐳ"}}:::plan
    List28 --> PgCursor24
    Lambda19 --> Access26
    PgClassExpression27{{"PgClassExpression[27∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle23 --> PgClassExpression27
    PgClassExpression27 --> List28
    Last30{{"Last[30∈1] ➊"}}:::plan
    PgSelect21 --> Last30
    PgSelectSingle31{{"PgSelectSingle[31∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    Last30 --> PgSelectSingle31
    PgCursor32{{"PgCursor[32∈1] ➊"}}:::plan
    List36{{"List[36∈1] ➊<br />ᐸ35ᐳ"}}:::plan
    List36 --> PgCursor32
    PgClassExpression35{{"PgClassExpression[35∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle31 --> PgClassExpression35
    PgClassExpression35 --> List36
    Access38{{"Access[38∈1] ➊<br />ᐸ21.hasMoreᐳ"}}:::plan
    PgSelect21 --> Access38
    First43{{"First[43∈1] ➊"}}:::plan
    PgSelect42 --> First43
    PgSelectSingle44{{"PgSelectSingle[44∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First43 --> PgSelectSingle44
    PgClassExpression45{{"PgClassExpression[45∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle44 --> PgClassExpression45
    __Item49[/"__Item[49∈2]<br />ᐸ21ᐳ"\]:::itemplan
    PgSelect21 ==> __Item49
    PgSelectSingle50{{"PgSelectSingle[50∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item49 --> PgSelectSingle50
    PgCursor51{{"PgCursor[51∈3]"}}:::plan
    List53{{"List[53∈3]<br />ᐸ52ᐳ"}}:::plan
    List53 --> PgCursor51
    PgClassExpression52{{"PgClassExpression[52∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression52
    PgClassExpression52 --> List53
    PgClassExpression55{{"PgClassExpression[55∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression55
    PgClassExpression56{{"PgClassExpression[56∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression56
    PgClassExpression57{{"PgClassExpression[57∈3]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression57
    PgClassExpression58{{"PgClassExpression[58∈3]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression58
    PgSelect72[["PgSelect[72∈4] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Access77{{"Access[77∈4] ➊<br />ᐸ70.1ᐳ"}}:::plan
    Object17 & Connection69 & Lambda70 & Access77 --> PgSelect72
    PgSelect93[["PgSelect[93∈4] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object17 & Connection69 --> PgSelect93
    PgPageInfo71{{"PgPageInfo[71∈4] ➊"}}:::plan
    Connection69 --> PgPageInfo71
    First73{{"First[73∈4] ➊"}}:::plan
    PgSelect72 --> First73
    PgSelectSingle74{{"PgSelectSingle[74∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First73 --> PgSelectSingle74
    PgCursor75{{"PgCursor[75∈4] ➊"}}:::plan
    List79{{"List[79∈4] ➊<br />ᐸ78ᐳ"}}:::plan
    List79 --> PgCursor75
    Lambda70 --> Access77
    PgClassExpression78{{"PgClassExpression[78∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle74 --> PgClassExpression78
    PgClassExpression78 --> List79
    Last81{{"Last[81∈4] ➊"}}:::plan
    PgSelect72 --> Last81
    PgSelectSingle82{{"PgSelectSingle[82∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    Last81 --> PgSelectSingle82
    PgCursor83{{"PgCursor[83∈4] ➊"}}:::plan
    List87{{"List[87∈4] ➊<br />ᐸ86ᐳ"}}:::plan
    List87 --> PgCursor83
    PgClassExpression86{{"PgClassExpression[86∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle82 --> PgClassExpression86
    PgClassExpression86 --> List87
    Access89{{"Access[89∈4] ➊<br />ᐸ72.hasMoreᐳ"}}:::plan
    PgSelect72 --> Access89
    First94{{"First[94∈4] ➊"}}:::plan
    PgSelect93 --> First94
    PgSelectSingle95{{"PgSelectSingle[95∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First94 --> PgSelectSingle95
    PgClassExpression96{{"PgClassExpression[96∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle95 --> PgClassExpression96
    __Item100[/"__Item[100∈5]<br />ᐸ72ᐳ"\]:::itemplan
    PgSelect72 ==> __Item100
    PgSelectSingle101{{"PgSelectSingle[101∈5]<br />ᐸpersonᐳ"}}:::plan
    __Item100 --> PgSelectSingle101
    PgCursor102{{"PgCursor[102∈6]"}}:::plan
    List104{{"List[104∈6]<br />ᐸ103ᐳ"}}:::plan
    List104 --> PgCursor102
    PgClassExpression103{{"PgClassExpression[103∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle101 --> PgClassExpression103
    PgClassExpression103 --> List104
    PgClassExpression106{{"PgClassExpression[106∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle101 --> PgClassExpression106
    PgClassExpression107{{"PgClassExpression[107∈6]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle101 --> PgClassExpression107
    PgClassExpression108{{"PgClassExpression[108∈6]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle101 --> PgClassExpression108
    PgClassExpression109{{"PgClassExpression[109∈6]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle101 --> PgClassExpression109

    %% define steps

    subgraph "Buckets for queries/v4/connections-blankcursor"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 15, 16, 41, 110, 111, 113, 17, 19, 70<br />2: 25, 76<br />ᐳ: Connection[18], Connection[69]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access15,Access16,Object17,Connection18,Lambda19,PgValidateParsedCursor25,Constant41,Connection69,Lambda70,PgValidateParsedCursor76,Constant110,Constant111,Constant113 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 18, 17, 19, 41<br /><br />ROOT Connectionᐸ14ᐳ[18]<br />1: PgSelect[42]<br />ᐳ: 20, 26, 43, 44, 45<br />2: PgSelect[21]<br />ᐳ: 22, 23, 27, 28, 30, 31, 35, 36, 38, 24, 32"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgPageInfo20,PgSelect21,First22,PgSelectSingle23,PgCursor24,Access26,PgClassExpression27,List28,Last30,PgSelectSingle31,PgCursor32,PgClassExpression35,List36,Access38,PgSelect42,First43,PgSelectSingle44,PgClassExpression45 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ21ᐳ[49]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item49,PgSelectSingle50 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 50<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[50]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor51,PgClassExpression52,List53,PgClassExpression55,PgClassExpression56,PgClassExpression57,PgClassExpression58 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 69, 17, 70, 41<br /><br />ROOT Connectionᐸ67ᐳ[69]<br />1: PgSelect[93]<br />ᐳ: 71, 77, 94, 95, 96<br />2: PgSelect[72]<br />ᐳ: 73, 74, 78, 79, 81, 82, 86, 87, 89, 75, 83"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgPageInfo71,PgSelect72,First73,PgSelectSingle74,PgCursor75,Access77,PgClassExpression78,List79,Last81,PgSelectSingle82,PgCursor83,PgClassExpression86,List87,Access89,PgSelect93,First94,PgSelectSingle95,PgClassExpression96 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ72ᐳ[100]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item100,PgSelectSingle101 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 101<br /><br />ROOT PgSelectSingle{5}ᐸpersonᐳ[101]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor102,PgClassExpression103,List104,PgClassExpression106,PgClassExpression107,PgClassExpression108,PgClassExpression109 bucket6
    Bucket0 --> Bucket1 & Bucket4
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    end
