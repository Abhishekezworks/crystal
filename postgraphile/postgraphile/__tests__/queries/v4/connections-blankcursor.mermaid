%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection18{{"Connection[18∈0] ➊<br />ᐸ14ᐳ"}}:::plan
    Constant112{{"Constant[112∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Lambda19{{"Lambda[19∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor25["PgValidateParsedCursor[25∈0] ➊"]:::plan
    Constant112 & Lambda19 & PgValidateParsedCursor25 & PgValidateParsedCursor25 & PgValidateParsedCursor25 & PgValidateParsedCursor25 --> Connection18
    Connection71{{"Connection[71∈0] ➊<br />ᐸ67ᐳ"}}:::plan
    Lambda72{{"Lambda[72∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor78["PgValidateParsedCursor[78∈0] ➊"]:::plan
    Constant112 & Lambda72 & PgValidateParsedCursor78 & PgValidateParsedCursor78 & PgValidateParsedCursor78 & PgValidateParsedCursor78 --> Connection71
    Object17{{"Object[17∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access15{{"Access[15∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access15 & Access16 --> Object17
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access15
    __Value2 --> Access16
    Constant113{{"Constant[113∈0] ➊<br />ᐸ''ᐳ"}}:::plan
    Constant113 --> Lambda19
    Lambda19 --> PgValidateParsedCursor25
    Constant115{{"Constant[115∈0] ➊<br />ᐸ'27'ᐳ"}}:::plan
    Constant115 --> Lambda72
    Lambda72 --> PgValidateParsedCursor78
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant41{{"Constant[41∈0] ➊<br />ᐸfalseᐳ"}}:::plan
    PgSelect21[["PgSelect[21∈1] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Access26{{"Access[26∈1] ➊<br />ᐸ19.1ᐳ"}}:::plan
    Object17 & Connection18 & Lambda19 & Access26 --> PgSelect21
    PgSelect42[["PgSelect[42∈1] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object17 & Connection18 --> PgSelect42
    PgPageInfo20{{"PgPageInfo[20∈1] ➊"}}:::plan
    Connection18 --> PgPageInfo20
    First22{{"First[22∈1] ➊"}}:::plan
    PgSelect21 --> First22
    PgSelectSingle23{{"PgSelectSingle[23∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First22 --> PgSelectSingle23
    PgCursor24{{"PgCursor[24∈1] ➊"}}:::plan
    List28{{"List[28∈1] ➊<br />ᐸ27ᐳ"}}:::plan
    List28 --> PgCursor24
    Lambda19 --> Access26
    PgClassExpression27{{"PgClassExpression[27∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle23 --> PgClassExpression27
    PgClassExpression27 --> List28
    Last30{{"Last[30∈1] ➊"}}:::plan
    PgSelect21 --> Last30
    PgSelectSingle31{{"PgSelectSingle[31∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    Last30 --> PgSelectSingle31
    PgCursor32{{"PgCursor[32∈1] ➊"}}:::plan
    List36{{"List[36∈1] ➊<br />ᐸ35ᐳ"}}:::plan
    List36 --> PgCursor32
    PgClassExpression35{{"PgClassExpression[35∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle31 --> PgClassExpression35
    PgClassExpression35 --> List36
    Access38{{"Access[38∈1] ➊<br />ᐸ21.hasMoreᐳ"}}:::plan
    PgSelect21 --> Access38
    First43{{"First[43∈1] ➊"}}:::plan
    PgSelect42 --> First43
    PgSelectSingle44{{"PgSelectSingle[44∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First43 --> PgSelectSingle44
    PgClassExpression45{{"PgClassExpression[45∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle44 --> PgClassExpression45
    __Item49[/"__Item[49∈2]<br />ᐸ21ᐳ"\]:::itemplan
    PgSelect21 ==> __Item49
    PgSelectSingle50{{"PgSelectSingle[50∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item49 --> PgSelectSingle50
    PgCursor51{{"PgCursor[51∈3]"}}:::plan
    List53{{"List[53∈3]<br />ᐸ52ᐳ"}}:::plan
    List53 --> PgCursor51
    PgClassExpression52{{"PgClassExpression[52∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression52
    PgClassExpression52 --> List53
    PgClassExpression55{{"PgClassExpression[55∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression55
    PgClassExpression56{{"PgClassExpression[56∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression56
    PgClassExpression57{{"PgClassExpression[57∈3]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression57
    PgClassExpression58{{"PgClassExpression[58∈3]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression58
    PgSelect74[["PgSelect[74∈4] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Access79{{"Access[79∈4] ➊<br />ᐸ72.1ᐳ"}}:::plan
    Object17 & Connection71 & Lambda72 & Access79 --> PgSelect74
    PgSelect95[["PgSelect[95∈4] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object17 & Connection71 --> PgSelect95
    PgPageInfo73{{"PgPageInfo[73∈4] ➊"}}:::plan
    Connection71 --> PgPageInfo73
    First75{{"First[75∈4] ➊"}}:::plan
    PgSelect74 --> First75
    PgSelectSingle76{{"PgSelectSingle[76∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First75 --> PgSelectSingle76
    PgCursor77{{"PgCursor[77∈4] ➊"}}:::plan
    List81{{"List[81∈4] ➊<br />ᐸ80ᐳ"}}:::plan
    List81 --> PgCursor77
    Lambda72 --> Access79
    PgClassExpression80{{"PgClassExpression[80∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle76 --> PgClassExpression80
    PgClassExpression80 --> List81
    Last83{{"Last[83∈4] ➊"}}:::plan
    PgSelect74 --> Last83
    PgSelectSingle84{{"PgSelectSingle[84∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    Last83 --> PgSelectSingle84
    PgCursor85{{"PgCursor[85∈4] ➊"}}:::plan
    List89{{"List[89∈4] ➊<br />ᐸ88ᐳ"}}:::plan
    List89 --> PgCursor85
    PgClassExpression88{{"PgClassExpression[88∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle84 --> PgClassExpression88
    PgClassExpression88 --> List89
    Access91{{"Access[91∈4] ➊<br />ᐸ74.hasMoreᐳ"}}:::plan
    PgSelect74 --> Access91
    First96{{"First[96∈4] ➊"}}:::plan
    PgSelect95 --> First96
    PgSelectSingle97{{"PgSelectSingle[97∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First96 --> PgSelectSingle97
    PgClassExpression98{{"PgClassExpression[98∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle97 --> PgClassExpression98
    __Item102[/"__Item[102∈5]<br />ᐸ74ᐳ"\]:::itemplan
    PgSelect74 ==> __Item102
    PgSelectSingle103{{"PgSelectSingle[103∈5]<br />ᐸpersonᐳ"}}:::plan
    __Item102 --> PgSelectSingle103
    PgCursor104{{"PgCursor[104∈6]"}}:::plan
    List106{{"List[106∈6]<br />ᐸ105ᐳ"}}:::plan
    List106 --> PgCursor104
    PgClassExpression105{{"PgClassExpression[105∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle103 --> PgClassExpression105
    PgClassExpression105 --> List106
    PgClassExpression108{{"PgClassExpression[108∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle103 --> PgClassExpression108
    PgClassExpression109{{"PgClassExpression[109∈6]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle103 --> PgClassExpression109
    PgClassExpression110{{"PgClassExpression[110∈6]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle103 --> PgClassExpression110
    PgClassExpression111{{"PgClassExpression[111∈6]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle103 --> PgClassExpression111

    %% define steps

    subgraph "Buckets for queries/v4/connections-blankcursor"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 15, 16, 41, 112, 113, 115, 17, 19, 72<br />2: 25, 78<br />ᐳ: Connection[18], Connection[71]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access15,Access16,Object17,Connection18,Lambda19,PgValidateParsedCursor25,Constant41,Connection71,Lambda72,PgValidateParsedCursor78,Constant112,Constant113,Constant115 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 18, 17, 19, 41<br /><br />ROOT Connectionᐸ14ᐳ[18]<br />1: PgSelect[42]<br />ᐳ: 20, 26, 43, 44, 45<br />2: PgSelect[21]<br />ᐳ: 22, 23, 27, 28, 30, 31, 35, 36, 38, 24, 32"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgPageInfo20,PgSelect21,First22,PgSelectSingle23,PgCursor24,Access26,PgClassExpression27,List28,Last30,PgSelectSingle31,PgCursor32,PgClassExpression35,List36,Access38,PgSelect42,First43,PgSelectSingle44,PgClassExpression45 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ21ᐳ[49]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item49,PgSelectSingle50 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 50<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[50]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor51,PgClassExpression52,List53,PgClassExpression55,PgClassExpression56,PgClassExpression57,PgClassExpression58 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 71, 17, 72, 41<br /><br />ROOT Connectionᐸ67ᐳ[71]<br />1: PgSelect[95]<br />ᐳ: 73, 79, 96, 97, 98<br />2: PgSelect[74]<br />ᐳ: 75, 76, 80, 81, 83, 84, 88, 89, 91, 77, 85"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgPageInfo73,PgSelect74,First75,PgSelectSingle76,PgCursor77,Access79,PgClassExpression80,List81,Last83,PgSelectSingle84,PgCursor85,PgClassExpression88,List89,Access91,PgSelect95,First96,PgSelectSingle97,PgClassExpression98 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ74ᐳ[102]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item102,PgSelectSingle103 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 103<br /><br />ROOT PgSelectSingle{5}ᐸpersonᐳ[103]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor104,PgClassExpression105,List106,PgClassExpression108,PgClassExpression109,PgClassExpression110,PgClassExpression111 bucket6
    Bucket0 --> Bucket1 & Bucket4
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    end
