%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection15{{"Connection[15∈0] ➊<br />ᐸ11ᐳ"}}:::plan
    Constant178{{"Constant[178∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Lambda16{{"Lambda[16∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor18["PgValidateParsedCursor[18∈0] ➊"]:::plan
    Constant178 & Lambda16 & PgValidateParsedCursor18 & PgValidateParsedCursor18 & PgValidateParsedCursor18 & PgValidateParsedCursor18 & PgValidateParsedCursor18 & PgValidateParsedCursor18 --> Connection15
    Connection68{{"Connection[68∈0] ➊<br />ᐸ66ᐳ"}}:::plan
    Lambda69{{"Lambda[69∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor71["PgValidateParsedCursor[71∈0] ➊"]:::plan
    Constant178 & Lambda69 & PgValidateParsedCursor71 & PgValidateParsedCursor71 & PgValidateParsedCursor71 & PgValidateParsedCursor71 & PgValidateParsedCursor71 & PgValidateParsedCursor71 --> Connection68
    Object125{{"Object[125∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda117{{"Lambda[117∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Constant122{{"Constant[122∈0] ➊<br />ᐸ[ { codec: Codec(int4), fragment: { n: [Array], f: 0, c: 266ᐳ"}}:::plan
    Constant123{{"Constant[123∈0] ➊<br />ᐸsql.identifier(”person”)ᐳ"}}:::plan
    Constant124{{"Constant[124∈0] ➊<br />ᐸRecordCodec(person)ᐳ"}}:::plan
    Lambda117 & Constant122 & Constant123 & Constant124 --> Object125
    Object141{{"Object[141∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda134{{"Lambda[134∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Constant138{{"Constant[138∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Lambda134 & Constant138 & Constant123 & Constant124 --> Object141
    Object156{{"Object[156∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant153{{"Constant[153∈0] ➊<br />ᐸ[ { codec: Codec(int4), fragment: { n: [Array], f: 0, c: 266ᐳ"}}:::plan
    Lambda117 & Constant153 & Constant123 & Constant124 --> Object156
    Object171{{"Object[171∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant168{{"Constant[168∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Lambda134 & Constant168 & Constant123 & Constant124 --> Object171
    Object14{{"Object[14∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access12 & Access13 --> Object14
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access12
    __Value2 --> Access13
    Constant179{{"Constant[179∈0] ➊<br />ᐸ''ᐳ"}}:::plan
    Constant179 --> Lambda16
    Lambda16 --> PgValidateParsedCursor18
    Access19{{"Access[19∈0] ➊<br />ᐸ16.1ᐳ"}}:::plan
    Lambda16 --> Access19
    Constant180{{"Constant[180∈0] ➊<br />ᐸ'27'ᐳ"}}:::plan
    Constant180 --> Lambda69
    Lambda69 --> PgValidateParsedCursor71
    Access72{{"Access[72∈0] ➊<br />ᐸ69.1ᐳ"}}:::plan
    Lambda69 --> Access72
    Constant187{{"Constant[187∈0] ➊<br />ᐸ§{ first: 2, last: null, cursorLower: null, cursorUpper: nulᐳ"}}:::plan
    Constant187 --> Lambda117
    Lambda120{{"Lambda[120∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant188{{"Constant[188∈0] ➊<br />ᐸ§{ first: 2, last: null, cursorLower: null, cursorUpper: nulᐳ"}}:::plan
    Constant188 --> Lambda120
    Access121{{"Access[121∈0] ➊<br />ᐸ120.0ᐳ"}}:::plan
    Lambda120 --> Access121
    Lambda126{{"Lambda[126∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object125 --> Lambda126
    Lambda132{{"Lambda[132∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant183{{"Constant[183∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: Codec(int4), fragment:ᐳ"}}:::plan
    Constant183 --> Lambda132
    Constant181{{"Constant[181∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant181 --> Lambda134
    Lambda136{{"Lambda[136∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant182{{"Constant[182∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant182 --> Lambda136
    Access137{{"Access[137∈0] ➊<br />ᐸ136.0ᐳ"}}:::plan
    Lambda136 --> Access137
    Lambda142{{"Lambda[142∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object141 --> Lambda142
    Lambda147{{"Lambda[147∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant184{{"Constant[184∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”personᐳ"}}:::plan
    Constant184 --> Lambda147
    Lambda157{{"Lambda[157∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object156 --> Lambda157
    Lambda162{{"Lambda[162∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant185{{"Constant[185∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: Codec(int4), fragment:ᐳ"}}:::plan
    Constant185 --> Lambda162
    Lambda172{{"Lambda[172∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object171 --> Lambda172
    Lambda177{{"Lambda[177∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant186{{"Constant[186∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”personᐳ"}}:::plan
    Constant186 --> Lambda177
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant7{{"Constant[7∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    PgSelect17[["PgSelect[17∈1] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Object14 & Connection15 & Lambda16 & Constant178 & Access19 & Lambda117 & Access121 & Lambda126 & Lambda132 --> PgSelect17
    PgSelect46[["PgSelect[46∈1] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object14 & Connection15 & Lambda134 & Access137 & Lambda142 & Lambda147 --> PgSelect46
    Object43{{"Object[43∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access37{{"Access[37∈1] ➊<br />ᐸ17.hasMoreᐳ"}}:::plan
    Constant178 & Constant7 & Constant7 & Access37 --> Object43
    Object38{{"Object[38∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant178 & Constant7 & Access37 --> Object38
    PgPageInfo20{{"PgPageInfo[20∈1] ➊"}}:::plan
    Connection15 --> PgPageInfo20
    First22{{"First[22∈1] ➊"}}:::plan
    PgSelect17 --> First22
    PgSelectSingle23{{"PgSelectSingle[23∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First22 --> PgSelectSingle23
    PgCursor24{{"PgCursor[24∈1] ➊"}}:::plan
    List27{{"List[27∈1] ➊<br />ᐸ26ᐳ"}}:::plan
    List27 --> PgCursor24
    PgClassExpression26{{"PgClassExpression[26∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle23 --> PgClassExpression26
    PgClassExpression26 --> List27
    Last29{{"Last[29∈1] ➊"}}:::plan
    PgSelect17 --> Last29
    PgSelectSingle30{{"PgSelectSingle[30∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    Last29 --> PgSelectSingle30
    PgCursor31{{"PgCursor[31∈1] ➊"}}:::plan
    List34{{"List[34∈1] ➊<br />ᐸ33ᐳ"}}:::plan
    List34 --> PgCursor31
    PgClassExpression33{{"PgClassExpression[33∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression33
    PgClassExpression33 --> List34
    PgSelect17 --> Access37
    Lambda39{{"Lambda[39∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object38 --> Lambda39
    Lambda44{{"Lambda[44∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object43 --> Lambda44
    First47{{"First[47∈1] ➊"}}:::plan
    PgSelect46 --> First47
    PgSelectSingle48{{"PgSelectSingle[48∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First47 --> PgSelectSingle48
    PgClassExpression49{{"PgClassExpression[49∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression49
    __Item52[/"__Item[52∈2]<br />ᐸ17ᐳ"\]:::itemplan
    PgSelect17 ==> __Item52
    PgSelectSingle53{{"PgSelectSingle[53∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item52 --> PgSelectSingle53
    PgCursor54{{"PgCursor[54∈3]"}}:::plan
    List56{{"List[56∈3]<br />ᐸ55ᐳ"}}:::plan
    List56 --> PgCursor54
    PgClassExpression55{{"PgClassExpression[55∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression55
    PgClassExpression55 --> List56
    PgClassExpression58{{"PgClassExpression[58∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression58
    PgClassExpression59{{"PgClassExpression[59∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression59
    PgClassExpression60{{"PgClassExpression[60∈3]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression60
    PgClassExpression61{{"PgClassExpression[61∈3]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression61
    PgSelect70[["PgSelect[70∈4] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Object14 & Connection68 & Lambda69 & Constant178 & Access72 & Lambda117 & Access121 & Lambda157 & Lambda162 --> PgSelect70
    PgSelect99[["PgSelect[99∈4] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object14 & Connection68 & Lambda134 & Access137 & Lambda172 & Lambda177 --> PgSelect99
    Object96{{"Object[96∈4] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access90{{"Access[90∈4] ➊<br />ᐸ70.hasMoreᐳ"}}:::plan
    Constant178 & Constant7 & Constant7 & Access90 --> Object96
    Object91{{"Object[91∈4] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant178 & Constant7 & Access90 --> Object91
    PgPageInfo73{{"PgPageInfo[73∈4] ➊"}}:::plan
    Connection68 --> PgPageInfo73
    First75{{"First[75∈4] ➊"}}:::plan
    PgSelect70 --> First75
    PgSelectSingle76{{"PgSelectSingle[76∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First75 --> PgSelectSingle76
    PgCursor77{{"PgCursor[77∈4] ➊"}}:::plan
    List80{{"List[80∈4] ➊<br />ᐸ79ᐳ"}}:::plan
    List80 --> PgCursor77
    PgClassExpression79{{"PgClassExpression[79∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle76 --> PgClassExpression79
    PgClassExpression79 --> List80
    Last82{{"Last[82∈4] ➊"}}:::plan
    PgSelect70 --> Last82
    PgSelectSingle83{{"PgSelectSingle[83∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    Last82 --> PgSelectSingle83
    PgCursor84{{"PgCursor[84∈4] ➊"}}:::plan
    List87{{"List[87∈4] ➊<br />ᐸ86ᐳ"}}:::plan
    List87 --> PgCursor84
    PgClassExpression86{{"PgClassExpression[86∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle83 --> PgClassExpression86
    PgClassExpression86 --> List87
    PgSelect70 --> Access90
    Lambda92{{"Lambda[92∈4] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object91 --> Lambda92
    Lambda97{{"Lambda[97∈4] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object96 --> Lambda97
    First100{{"First[100∈4] ➊"}}:::plan
    PgSelect99 --> First100
    PgSelectSingle101{{"PgSelectSingle[101∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First100 --> PgSelectSingle101
    PgClassExpression102{{"PgClassExpression[102∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle101 --> PgClassExpression102
    __Item105[/"__Item[105∈5]<br />ᐸ70ᐳ"\]:::itemplan
    PgSelect70 ==> __Item105
    PgSelectSingle106{{"PgSelectSingle[106∈5]<br />ᐸpersonᐳ"}}:::plan
    __Item105 --> PgSelectSingle106
    PgCursor107{{"PgCursor[107∈6]"}}:::plan
    List109{{"List[109∈6]<br />ᐸ108ᐳ"}}:::plan
    List109 --> PgCursor107
    PgClassExpression108{{"PgClassExpression[108∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression108
    PgClassExpression108 --> List109
    PgClassExpression111{{"PgClassExpression[111∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression111
    PgClassExpression112{{"PgClassExpression[112∈6]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression112
    PgClassExpression113{{"PgClassExpression[113∈6]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression113
    PgClassExpression114{{"PgClassExpression[114∈6]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression114

    %% define steps

    subgraph "Buckets for queries/v4/connections-blankcursor"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 7, 12, 13, 122, 123, 124, 138, 153, 168, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 14, 16, 19, 69, 72, 117, 120, 121, 125, 126, 132, 134, 136, 137, 141, 142, 147, 156, 157, 162, 171, 172, 177<br />2: 18, 71<br />ᐳ: Connection[15], Connection[68]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant7,Access12,Access13,Object14,Connection15,Lambda16,PgValidateParsedCursor18,Access19,Connection68,Lambda69,PgValidateParsedCursor71,Access72,Lambda117,Lambda120,Access121,Constant122,Constant123,Constant124,Object125,Lambda126,Lambda132,Lambda134,Lambda136,Access137,Constant138,Object141,Lambda142,Lambda147,Constant153,Object156,Lambda157,Lambda162,Constant168,Object171,Lambda172,Lambda177,Constant178,Constant179,Constant180,Constant181,Constant182,Constant183,Constant184,Constant185,Constant186,Constant187,Constant188 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 14, 15, 16, 178, 19, 117, 121, 126, 132, 7, 134, 137, 142, 147<br /><br />ROOT Connectionᐸ11ᐳ[15]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect17,PgPageInfo20,First22,PgSelectSingle23,PgCursor24,PgClassExpression26,List27,Last29,PgSelectSingle30,PgCursor31,PgClassExpression33,List34,Access37,Object38,Lambda39,Object43,Lambda44,PgSelect46,First47,PgSelectSingle48,PgClassExpression49 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ17ᐳ[52]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item52,PgSelectSingle53 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 53<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[53]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor54,PgClassExpression55,List56,PgClassExpression58,PgClassExpression59,PgClassExpression60,PgClassExpression61 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 14, 68, 69, 178, 72, 117, 121, 157, 162, 7, 134, 137, 172, 177<br /><br />ROOT Connectionᐸ66ᐳ[68]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect70,PgPageInfo73,First75,PgSelectSingle76,PgCursor77,PgClassExpression79,List80,Last82,PgSelectSingle83,PgCursor84,PgClassExpression86,List87,Access90,Object91,Lambda92,Object96,Lambda97,PgSelect99,First100,PgSelectSingle101,PgClassExpression102 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ70ᐳ[105]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item105,PgSelectSingle106 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 106<br /><br />ROOT PgSelectSingle{5}ᐸpersonᐳ[106]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor107,PgClassExpression108,List109,PgClassExpression111,PgClassExpression112,PgClassExpression113,PgClassExpression114 bucket6
    Bucket0 --> Bucket1 & Bucket4
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    end
