%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/v4/connections-blankcursor"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 14, 16, 17, 140, 7<br /><br />ROOT Connectionᐸ10ᐳ[16]<br />1: PgSelect[30], PgSelect[33]<br />ᐳ: 32, 66, 80, 82, 83, 89, 90<br />2: PgSelectRows[36], PgSelectRows[54]<br />ᐳ: 35, 38, 39, 62, 65, 68, 71, 73, 76"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 14, 26, 27, 140, 7<br /><br />ROOT Connectionᐸ23ᐳ[26]<br />1: PgSelect[42], PgSelect[45]<br />ᐳ: 44, 98, 112, 114, 115, 121, 122<br />2: PgSelectRows[48], PgSelectRows[57]<br />ᐳ: 47, 50, 51, 94, 97, 100, 103, 105, 108"):::bucket
    Bucket3("Bucket 3 (listItem)<br />Deps: 66<br /><br />ROOT __Item{3}ᐸ54ᐳ[55]"):::bucket
    Bucket4("Bucket 4 (listItem)<br />Deps: 98<br /><br />ROOT __Item{4}ᐸ57ᐳ[58]"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 56, 66<br /><br />ROOT PgSelectSingle{3}ᐸpersonᐳ[56]"):::bucket
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 59, 98<br /><br />ROOT PgSelectSingle{4}ᐸpersonᐳ[59]"):::bucket
    end
    Bucket0 --> Bucket1 & Bucket2
    Bucket1 --> Bucket3
    Bucket2 --> Bucket4
    Bucket3 --> Bucket5
    Bucket4 --> Bucket6

    %% plan dependencies
    Object14{{"Object[14∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access11 & Access13 --> Object14
    Connection16{{"Connection[16∈0] ➊<br />ᐸ10ᐳ"}}:::plan
    Constant140{{"Constant[140∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Lambda17{{"Lambda[17∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant140 & Lambda17 --> Connection16
    Connection26{{"Connection[26∈0] ➊<br />ᐸ23ᐳ"}}:::plan
    Lambda27{{"Lambda[27∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant140 & Lambda27 --> Connection26
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access11
    __Value2 --> Access13
    Constant141{{"Constant[141∈0] ➊<br />ᐸ''ᐳ"}}:::plan
    Constant141 --> Lambda17
    Constant142{{"Constant[142∈0] ➊<br />ᐸ'27'ᐳ"}}:::plan
    Constant142 --> Lambda27
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgSelect30[["PgSelect[30∈1] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Object14 & Connection16 & Lambda17 & Constant140 --> PgSelect30
    Object89{{"Object[89∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access80{{"Access[80∈1] ➊<br />ᐸ30.hasMoreᐳ"}}:::plan
    Constant140 & Access80 --> Object89
    Object82{{"Object[82∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant140 & Access80 --> Object82
    PgSelect33[["PgSelect[33∈1] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object14 & Connection16 --> PgSelect33
    PgCursor68{{"PgCursor[68∈1] ➊"}}:::plan
    PgSelectSingle65{{"PgSelectSingle[65∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    Access66{{"Access[66∈1] ➊<br />ᐸ30.cursorDetailsᐳ"}}:::plan
    PgSelectSingle65 & Access66 --> PgCursor68
    PgCursor76{{"PgCursor[76∈1] ➊"}}:::plan
    PgSelectSingle73{{"PgSelectSingle[73∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle73 & Access66 --> PgCursor76
    PgPageInfo32{{"PgPageInfo[32∈1] ➊"}}:::plan
    Connection16 --> PgPageInfo32
    First35{{"First[35∈1] ➊"}}:::plan
    PgSelectRows36[["PgSelectRows[36∈1] ➊"]]:::plan
    PgSelectRows36 --> First35
    PgSelect33 --> PgSelectRows36
    PgSelectSingle38{{"PgSelectSingle[38∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First35 --> PgSelectSingle38
    PgClassExpression39{{"PgClassExpression[39∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle38 --> PgClassExpression39
    PgSelectRows54[["PgSelectRows[54∈1] ➊"]]:::plan
    PgSelect30 --> PgSelectRows54
    First62{{"First[62∈1] ➊"}}:::plan
    PgSelectRows54 --> First62
    First62 --> PgSelectSingle65
    PgSelect30 --> Access66
    Last71{{"Last[71∈1] ➊"}}:::plan
    PgSelectRows54 --> Last71
    Last71 --> PgSelectSingle73
    PgSelect30 --> Access80
    Lambda83{{"Lambda[83∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object82 --> Lambda83
    Lambda90{{"Lambda[90∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object89 --> Lambda90
    __Item55[/"__Item[55∈3]<br />ᐸ54ᐳ"\]:::itemplan
    PgSelectRows54 ==> __Item55
    PgSelectSingle56{{"PgSelectSingle[56∈3]<br />ᐸpersonᐳ"}}:::plan
    __Item55 --> PgSelectSingle56
    PgCursor126{{"PgCursor[126∈5]"}}:::plan
    PgSelectSingle56 & Access66 --> PgCursor126
    PgClassExpression130{{"PgClassExpression[130∈5]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle56 --> PgClassExpression130
    PgClassExpression131{{"PgClassExpression[131∈5]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle56 --> PgClassExpression131
    PgClassExpression132{{"PgClassExpression[132∈5]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle56 --> PgClassExpression132
    PgClassExpression133{{"PgClassExpression[133∈5]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle56 --> PgClassExpression133
    PgClassExpression134{{"PgClassExpression[134∈5]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle56 --> PgClassExpression134
    PgSelect42[["PgSelect[42∈2] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Object14 & Connection26 & Lambda27 & Constant140 --> PgSelect42
    Object121{{"Object[121∈2] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access112{{"Access[112∈2] ➊<br />ᐸ42.hasMoreᐳ"}}:::plan
    Constant140 & Access112 --> Object121
    Object114{{"Object[114∈2] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant140 & Access112 --> Object114
    PgSelect45[["PgSelect[45∈2] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object14 & Connection26 --> PgSelect45
    PgCursor100{{"PgCursor[100∈2] ➊"}}:::plan
    PgSelectSingle97{{"PgSelectSingle[97∈2] ➊<br />ᐸpersonᐳ"}}:::plan
    Access98{{"Access[98∈2] ➊<br />ᐸ42.cursorDetailsᐳ"}}:::plan
    PgSelectSingle97 & Access98 --> PgCursor100
    PgCursor108{{"PgCursor[108∈2] ➊"}}:::plan
    PgSelectSingle105{{"PgSelectSingle[105∈2] ➊<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle105 & Access98 --> PgCursor108
    PgPageInfo44{{"PgPageInfo[44∈2] ➊"}}:::plan
    Connection26 --> PgPageInfo44
    First47{{"First[47∈2] ➊"}}:::plan
    PgSelectRows48[["PgSelectRows[48∈2] ➊"]]:::plan
    PgSelectRows48 --> First47
    PgSelect45 --> PgSelectRows48
    PgSelectSingle50{{"PgSelectSingle[50∈2] ➊<br />ᐸpersonᐳ"}}:::plan
    First47 --> PgSelectSingle50
    PgClassExpression51{{"PgClassExpression[51∈2] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression51
    PgSelectRows57[["PgSelectRows[57∈2] ➊"]]:::plan
    PgSelect42 --> PgSelectRows57
    First94{{"First[94∈2] ➊"}}:::plan
    PgSelectRows57 --> First94
    First94 --> PgSelectSingle97
    PgSelect42 --> Access98
    Last103{{"Last[103∈2] ➊"}}:::plan
    PgSelectRows57 --> Last103
    Last103 --> PgSelectSingle105
    PgSelect42 --> Access112
    Lambda115{{"Lambda[115∈2] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object114 --> Lambda115
    Lambda122{{"Lambda[122∈2] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object121 --> Lambda122
    __Item58[/"__Item[58∈4]<br />ᐸ57ᐳ"\]:::itemplan
    PgSelectRows57 ==> __Item58
    PgSelectSingle59{{"PgSelectSingle[59∈4]<br />ᐸpersonᐳ"}}:::plan
    __Item58 --> PgSelectSingle59
    PgCursor129{{"PgCursor[129∈6]"}}:::plan
    PgSelectSingle59 & Access98 --> PgCursor129
    PgClassExpression135{{"PgClassExpression[135∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle59 --> PgClassExpression135
    PgClassExpression136{{"PgClassExpression[136∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle59 --> PgClassExpression136
    PgClassExpression137{{"PgClassExpression[137∈6]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle59 --> PgClassExpression137
    PgClassExpression138{{"PgClassExpression[138∈6]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle59 --> PgClassExpression138
    PgClassExpression139{{"PgClassExpression[139∈6]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle59 --> PgClassExpression139

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access11,Access13,Object14,Connection16,Lambda17,Connection26,Lambda27,Constant140,Constant141,Constant142 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect30,PgPageInfo32,PgSelect33,First35,PgSelectRows36,PgSelectSingle38,PgClassExpression39,PgSelectRows54,First62,PgSelectSingle65,Access66,PgCursor68,Last71,PgSelectSingle73,PgCursor76,Access80,Object82,Lambda83,Object89,Lambda90 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgSelect42,PgPageInfo44,PgSelect45,First47,PgSelectRows48,PgSelectSingle50,PgClassExpression51,PgSelectRows57,First94,PgSelectSingle97,Access98,PgCursor100,Last103,PgSelectSingle105,PgCursor108,Access112,Object114,Lambda115,Object121,Lambda122 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item55,PgSelectSingle56 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item58,PgSelectSingle59 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgCursor126,PgClassExpression130,PgClassExpression131,PgClassExpression132,PgClassExpression133,PgClassExpression134 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor129,PgClassExpression135,PgClassExpression136,PgClassExpression137,PgClassExpression138,PgClassExpression139 bucket6

