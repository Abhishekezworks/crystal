%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/v4/connections-blankcursor"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 14, 16, 17, 128, 7<br /><br />ROOT Connectionᐸ10ᐳ[16]<br />1: PgSelect[30], PgSelect[33]<br />ᐳ: 32, 61, 73, 75, 76, 81, 82<br />2: PgSelectRows[35], PgSelectRows[50]<br />ᐳ: 34, 37, 38, 57, 60, 63, 65, 67, 70"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 14, 26, 27, 128, 7<br /><br />ROOT Connectionᐸ23ᐳ[26]<br />1: PgSelect[40], PgSelect[43]<br />ᐳ: 42, 89, 101, 103, 104, 109, 110<br />2: PgSelectRows[45], PgSelectRows[53]<br />ᐳ: 44, 47, 48, 85, 88, 91, 93, 95, 98"):::bucket
    Bucket3("Bucket 3 (listItem)<br />Deps: 61<br /><br />ROOT __Item{3}ᐸ50ᐳ[51]"):::bucket
    Bucket4("Bucket 4 (listItem)<br />Deps: 89<br /><br />ROOT __Item{4}ᐸ53ᐳ[54]"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 52, 61<br /><br />ROOT PgSelectSingle{3}ᐸpersonᐳ[52]"):::bucket
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 55, 89<br /><br />ROOT PgSelectSingle{4}ᐸpersonᐳ[55]"):::bucket
    end
    Bucket0 --> Bucket1 & Bucket2
    Bucket1 --> Bucket3
    Bucket2 --> Bucket4
    Bucket3 --> Bucket5
    Bucket4 --> Bucket6

    %% plan dependencies
    Object14{{"Object[14∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access11 & Access13 --> Object14
    Connection16{{"Connection[16∈0] ➊<br />ᐸ10ᐳ"}}:::plan
    Constant128{{"Constant[128∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Lambda17{{"Lambda[17∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant128 & Lambda17 --> Connection16
    Connection26{{"Connection[26∈0] ➊<br />ᐸ23ᐳ"}}:::plan
    Lambda27{{"Lambda[27∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant128 & Lambda27 --> Connection26
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access11
    __Value2 --> Access13
    Constant129{{"Constant[129∈0] ➊<br />ᐸ''ᐳ"}}:::plan
    Constant129 --> Lambda17
    Constant130{{"Constant[130∈0] ➊<br />ᐸ'27'ᐳ"}}:::plan
    Constant130 --> Lambda27
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgSelect30[["PgSelect[30∈1] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Object14 & Connection16 & Lambda17 & Constant128 --> PgSelect30
    Object81{{"Object[81∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access73{{"Access[73∈1] ➊<br />ᐸ30.hasMoreᐳ"}}:::plan
    Constant128 & Access73 --> Object81
    Object75{{"Object[75∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant128 & Access73 --> Object75
    PgSelect33[["PgSelect[33∈1] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object14 & Connection16 --> PgSelect33
    PgCursor63{{"PgCursor[63∈1] ➊"}}:::plan
    PgSelectSingle60{{"PgSelectSingle[60∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    Access61{{"Access[61∈1] ➊<br />ᐸ30.cursorDetailsᐳ"}}:::plan
    PgSelectSingle60 & Access61 --> PgCursor63
    PgCursor70{{"PgCursor[70∈1] ➊"}}:::plan
    PgSelectSingle67{{"PgSelectSingle[67∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle67 & Access61 --> PgCursor70
    PgPageInfo32{{"PgPageInfo[32∈1] ➊"}}:::plan
    Connection16 --> PgPageInfo32
    First34{{"First[34∈1] ➊"}}:::plan
    PgSelectRows35[["PgSelectRows[35∈1] ➊"]]:::plan
    PgSelectRows35 --> First34
    PgSelect33 --> PgSelectRows35
    PgSelectSingle37{{"PgSelectSingle[37∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First34 --> PgSelectSingle37
    PgClassExpression38{{"PgClassExpression[38∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle37 --> PgClassExpression38
    PgSelectRows50[["PgSelectRows[50∈1] ➊"]]:::plan
    PgSelect30 --> PgSelectRows50
    First57{{"First[57∈1] ➊"}}:::plan
    PgSelectRows50 --> First57
    First57 --> PgSelectSingle60
    PgSelect30 --> Access61
    Last65{{"Last[65∈1] ➊"}}:::plan
    PgSelectRows50 --> Last65
    Last65 --> PgSelectSingle67
    PgSelect30 --> Access73
    Lambda76{{"Lambda[76∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object75 --> Lambda76
    Lambda82{{"Lambda[82∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object81 --> Lambda82
    __Item51[/"__Item[51∈3]<br />ᐸ50ᐳ"\]:::itemplan
    PgSelectRows50 ==> __Item51
    PgSelectSingle52{{"PgSelectSingle[52∈3]<br />ᐸpersonᐳ"}}:::plan
    __Item51 --> PgSelectSingle52
    PgCursor114{{"PgCursor[114∈5]"}}:::plan
    PgSelectSingle52 & Access61 --> PgCursor114
    PgClassExpression118{{"PgClassExpression[118∈5]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression118
    PgClassExpression119{{"PgClassExpression[119∈5]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression119
    PgClassExpression120{{"PgClassExpression[120∈5]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression120
    PgClassExpression121{{"PgClassExpression[121∈5]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression121
    PgClassExpression122{{"PgClassExpression[122∈5]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression122
    PgSelect40[["PgSelect[40∈2] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Object14 & Connection26 & Lambda27 & Constant128 --> PgSelect40
    Object109{{"Object[109∈2] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access101{{"Access[101∈2] ➊<br />ᐸ40.hasMoreᐳ"}}:::plan
    Constant128 & Access101 --> Object109
    Object103{{"Object[103∈2] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant128 & Access101 --> Object103
    PgSelect43[["PgSelect[43∈2] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object14 & Connection26 --> PgSelect43
    PgCursor91{{"PgCursor[91∈2] ➊"}}:::plan
    PgSelectSingle88{{"PgSelectSingle[88∈2] ➊<br />ᐸpersonᐳ"}}:::plan
    Access89{{"Access[89∈2] ➊<br />ᐸ40.cursorDetailsᐳ"}}:::plan
    PgSelectSingle88 & Access89 --> PgCursor91
    PgCursor98{{"PgCursor[98∈2] ➊"}}:::plan
    PgSelectSingle95{{"PgSelectSingle[95∈2] ➊<br />ᐸpersonᐳ"}}:::plan
    PgSelectSingle95 & Access89 --> PgCursor98
    PgPageInfo42{{"PgPageInfo[42∈2] ➊"}}:::plan
    Connection26 --> PgPageInfo42
    First44{{"First[44∈2] ➊"}}:::plan
    PgSelectRows45[["PgSelectRows[45∈2] ➊"]]:::plan
    PgSelectRows45 --> First44
    PgSelect43 --> PgSelectRows45
    PgSelectSingle47{{"PgSelectSingle[47∈2] ➊<br />ᐸpersonᐳ"}}:::plan
    First44 --> PgSelectSingle47
    PgClassExpression48{{"PgClassExpression[48∈2] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle47 --> PgClassExpression48
    PgSelectRows53[["PgSelectRows[53∈2] ➊"]]:::plan
    PgSelect40 --> PgSelectRows53
    First85{{"First[85∈2] ➊"}}:::plan
    PgSelectRows53 --> First85
    First85 --> PgSelectSingle88
    PgSelect40 --> Access89
    Last93{{"Last[93∈2] ➊"}}:::plan
    PgSelectRows53 --> Last93
    Last93 --> PgSelectSingle95
    PgSelect40 --> Access101
    Lambda104{{"Lambda[104∈2] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object103 --> Lambda104
    Lambda110{{"Lambda[110∈2] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object109 --> Lambda110
    __Item54[/"__Item[54∈4]<br />ᐸ53ᐳ"\]:::itemplan
    PgSelectRows53 ==> __Item54
    PgSelectSingle55{{"PgSelectSingle[55∈4]<br />ᐸpersonᐳ"}}:::plan
    __Item54 --> PgSelectSingle55
    PgCursor117{{"PgCursor[117∈6]"}}:::plan
    PgSelectSingle55 & Access89 --> PgCursor117
    PgClassExpression123{{"PgClassExpression[123∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression123
    PgClassExpression124{{"PgClassExpression[124∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression124
    PgClassExpression125{{"PgClassExpression[125∈6]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression125
    PgClassExpression126{{"PgClassExpression[126∈6]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression126
    PgClassExpression127{{"PgClassExpression[127∈6]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression127

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access11,Access13,Object14,Connection16,Lambda17,Connection26,Lambda27,Constant128,Constant129,Constant130 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect30,PgPageInfo32,PgSelect33,First34,PgSelectRows35,PgSelectSingle37,PgClassExpression38,PgSelectRows50,First57,PgSelectSingle60,Access61,PgCursor63,Last65,PgSelectSingle67,PgCursor70,Access73,Object75,Lambda76,Object81,Lambda82 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgSelect40,PgPageInfo42,PgSelect43,First44,PgSelectRows45,PgSelectSingle47,PgClassExpression48,PgSelectRows53,First85,PgSelectSingle88,Access89,PgCursor91,Last93,PgSelectSingle95,PgCursor98,Access101,Object103,Lambda104,Object109,Lambda110 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item51,PgSelectSingle52 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item54,PgSelectSingle55 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgCursor114,PgClassExpression118,PgClassExpression119,PgClassExpression120,PgClassExpression121,PgClassExpression122 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor117,PgClassExpression123,PgClassExpression124,PgClassExpression125,PgClassExpression126,PgClassExpression127 bucket6

