%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection19{{"Connection[19∈0]<br />ᐸ15ᐳ"}}:::plan
    Constant121{{"Constant[121∈0]<br />ᐸ2ᐳ"}}:::plan
    Lambda20{{"Lambda[20∈0]<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor26["PgValidateParsedCursor[26∈0]"]:::plan
    Constant121 & Lambda20 & PgValidateParsedCursor26 & PgValidateParsedCursor26 & PgValidateParsedCursor26 & PgValidateParsedCursor26 --> Connection19
    Connection76{{"Connection[76∈0]<br />ᐸ72ᐳ"}}:::plan
    Lambda77{{"Lambda[77∈0]<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor83["PgValidateParsedCursor[83∈0]"]:::plan
    Constant121 & Lambda77 & PgValidateParsedCursor83 & PgValidateParsedCursor83 & PgValidateParsedCursor83 & PgValidateParsedCursor83 --> Connection76
    Object18{{"Object[18∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access16{{"Access[16∈0]<br />ᐸ3.pgSettingsᐳ"}}:::plan
    Access17{{"Access[17∈0]<br />ᐸ3.withPgClientᐳ"}}:::plan
    Access16 & Access17 --> Object18
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value3 --> Access16
    __Value3 --> Access17
    Constant122{{"Constant[122∈0]<br />ᐸ''ᐳ"}}:::plan
    Constant122 --> Lambda20
    Lambda20 --> PgValidateParsedCursor26
    Constant124{{"Constant[124∈0]<br />ᐸ'27'ᐳ"}}:::plan
    Constant124 --> Lambda77
    Lambda77 --> PgValidateParsedCursor83
    __Value0["__Value[0∈0]"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    Constant45{{"Constant[45∈0]<br />ᐸfalseᐳ"}}:::plan
    PgSelect79[["PgSelect[79∈4]<br />ᐸperson+1ᐳ"]]:::plan
    ToPg85{{"ToPg[85∈4]"}}:::plan
    Object18 & Connection76 & Lambda77 & ToPg85 --> PgSelect79
    PgSelect103[["PgSelect[103∈4]<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object18 & Connection76 --> PgSelect103
    PgPageInfo78{{"PgPageInfo[78∈4]"}}:::plan
    Connection76 --> PgPageInfo78
    Access84{{"Access[84∈4]<br />ᐸ77.1ᐳ"}}:::plan
    Lambda77 --> Access84
    Access84 --> ToPg85
    First80{{"First[80∈4]"}}:::plan
    PgSelect79 --> First80
    PgSelectSingle81{{"PgSelectSingle[81∈4]<br />ᐸpersonᐳ"}}:::plan
    First80 --> PgSelectSingle81
    PgClassExpression86{{"PgClassExpression[86∈4]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle81 --> PgClassExpression86
    List87{{"List[87∈4]<br />ᐸ86ᐳ"}}:::plan
    PgClassExpression86 --> List87
    PgCursor82{{"PgCursor[82∈4]"}}:::plan
    List87 --> PgCursor82
    Last89{{"Last[89∈4]"}}:::plan
    PgSelect79 --> Last89
    PgSelectSingle90{{"PgSelectSingle[90∈4]<br />ᐸpersonᐳ"}}:::plan
    Last89 --> PgSelectSingle90
    PgClassExpression95{{"PgClassExpression[95∈4]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle90 --> PgClassExpression95
    List96{{"List[96∈4]<br />ᐸ95ᐳ"}}:::plan
    PgClassExpression95 --> List96
    PgCursor91{{"PgCursor[91∈4]"}}:::plan
    List96 --> PgCursor91
    Lambda98{{"Lambda[98∈4]<br />ᐸlistHasMoreᐳ"}}:::plan
    PgSelect79 --> Lambda98
    First104{{"First[104∈4]"}}:::plan
    PgSelect103 --> First104
    PgSelectSingle105{{"PgSelectSingle[105∈4]<br />ᐸpersonᐳ"}}:::plan
    First104 --> PgSelectSingle105
    PgClassExpression106{{"PgClassExpression[106∈4]<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle105 --> PgClassExpression106
    PgSelect22[["PgSelect[22∈1]<br />ᐸperson+1ᐳ"]]:::plan
    ToPg28{{"ToPg[28∈1]"}}:::plan
    Object18 & Connection19 & Lambda20 & ToPg28 --> PgSelect22
    PgSelect46[["PgSelect[46∈1]<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object18 & Connection19 --> PgSelect46
    PgPageInfo21{{"PgPageInfo[21∈1]"}}:::plan
    Connection19 --> PgPageInfo21
    Access27{{"Access[27∈1]<br />ᐸ20.1ᐳ"}}:::plan
    Lambda20 --> Access27
    Access27 --> ToPg28
    First23{{"First[23∈1]"}}:::plan
    PgSelect22 --> First23
    PgSelectSingle24{{"PgSelectSingle[24∈1]<br />ᐸpersonᐳ"}}:::plan
    First23 --> PgSelectSingle24
    PgClassExpression29{{"PgClassExpression[29∈1]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle24 --> PgClassExpression29
    List30{{"List[30∈1]<br />ᐸ29ᐳ"}}:::plan
    PgClassExpression29 --> List30
    PgCursor25{{"PgCursor[25∈1]"}}:::plan
    List30 --> PgCursor25
    Last32{{"Last[32∈1]"}}:::plan
    PgSelect22 --> Last32
    PgSelectSingle33{{"PgSelectSingle[33∈1]<br />ᐸpersonᐳ"}}:::plan
    Last32 --> PgSelectSingle33
    PgClassExpression38{{"PgClassExpression[38∈1]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle33 --> PgClassExpression38
    List39{{"List[39∈1]<br />ᐸ38ᐳ"}}:::plan
    PgClassExpression38 --> List39
    PgCursor34{{"PgCursor[34∈1]"}}:::plan
    List39 --> PgCursor34
    Lambda41{{"Lambda[41∈1]<br />ᐸlistHasMoreᐳ"}}:::plan
    PgSelect22 --> Lambda41
    First47{{"First[47∈1]"}}:::plan
    PgSelect46 --> First47
    PgSelectSingle48{{"PgSelectSingle[48∈1]<br />ᐸpersonᐳ"}}:::plan
    First47 --> PgSelectSingle48
    PgClassExpression49{{"PgClassExpression[49∈1]<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression49
    __Item54[/"__Item[54∈2]<br />ᐸ22ᐳ"\]:::itemplan
    PgSelect22 ==> __Item54
    PgSelectSingle55{{"PgSelectSingle[55∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item54 --> PgSelectSingle55
    __Item111[/"__Item[111∈5]<br />ᐸ79ᐳ"\]:::itemplan
    PgSelect79 ==> __Item111
    PgSelectSingle112{{"PgSelectSingle[112∈5]<br />ᐸpersonᐳ"}}:::plan
    __Item111 --> PgSelectSingle112
    PgClassExpression57{{"PgClassExpression[57∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression57
    List58{{"List[58∈3]<br />ᐸ57ᐳ"}}:::plan
    PgClassExpression57 --> List58
    PgCursor56{{"PgCursor[56∈3]"}}:::plan
    List58 --> PgCursor56
    PgClassExpression60{{"PgClassExpression[60∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression60
    PgClassExpression61{{"PgClassExpression[61∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression61
    PgClassExpression62{{"PgClassExpression[62∈3]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression62
    PgClassExpression63{{"PgClassExpression[63∈3]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression63
    PgClassExpression114{{"PgClassExpression[114∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression114
    List115{{"List[115∈6]<br />ᐸ114ᐳ"}}:::plan
    PgClassExpression114 --> List115
    PgCursor113{{"PgCursor[113∈6]"}}:::plan
    List115 --> PgCursor113
    PgClassExpression117{{"PgClassExpression[117∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression117
    PgClassExpression118{{"PgClassExpression[118∈6]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression118
    PgClassExpression119{{"PgClassExpression[119∈6]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression119
    PgClassExpression120{{"PgClassExpression[120∈6]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression120

    %% define steps

    subgraph "Buckets for queries/v4/connections-blankcursor"
    Bucket0("Bucket 0 (root)<br />1: <br />ᐳ: 16, 17, 45, 121, 122, 124, 18, 20, 77<br />2: 26, 83<br />ᐳ: Connection[19], Connection[76]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value3,__Value5,Access16,Access17,Object18,Connection19,Lambda20,PgValidateParsedCursor26,Constant45,Connection76,Lambda77,PgValidateParsedCursor83,Constant121,Constant122,Constant124 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 19, 18, 20, 45<br /><br />ROOT Connectionᐸ15ᐳ[19]<br />1: PgSelect[46]<br />ᐳ: 21, 27, 28, 47, 48, 49<br />2: PgSelect[22]<br />ᐳ: 23, 24, 29, 30, 32, 33, 38, 39, 41, 25, 34"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgPageInfo21,PgSelect22,First23,PgSelectSingle24,PgCursor25,Access27,ToPg28,PgClassExpression29,List30,Last32,PgSelectSingle33,PgCursor34,PgClassExpression38,List39,Lambda41,PgSelect46,First47,PgSelectSingle48,PgClassExpression49 bucket1
    Bucket2("Bucket 2 (listItem)<br />ROOT __Item{2}ᐸ22ᐳ[54]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item54,PgSelectSingle55 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 55<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[55]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor56,PgClassExpression57,List58,PgClassExpression60,PgClassExpression61,PgClassExpression62,PgClassExpression63 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 76, 18, 77, 45<br /><br />ROOT Connectionᐸ72ᐳ[76]<br />1: PgSelect[103]<br />ᐳ: 78, 84, 85, 104, 105, 106<br />2: PgSelect[79]<br />ᐳ: 80, 81, 86, 87, 89, 90, 95, 96, 98, 82, 91"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgPageInfo78,PgSelect79,First80,PgSelectSingle81,PgCursor82,Access84,ToPg85,PgClassExpression86,List87,Last89,PgSelectSingle90,PgCursor91,PgClassExpression95,List96,Lambda98,PgSelect103,First104,PgSelectSingle105,PgClassExpression106 bucket4
    Bucket5("Bucket 5 (listItem)<br />ROOT __Item{5}ᐸ79ᐳ[111]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item111,PgSelectSingle112 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 112<br /><br />ROOT PgSelectSingle{5}ᐸpersonᐳ[112]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor113,PgClassExpression114,List115,PgClassExpression117,PgClassExpression118,PgClassExpression119,PgClassExpression120 bucket6
    Bucket0 --> Bucket1 & Bucket4
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    end
