%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection15{{"Connection[15∈0] ➊<br />ᐸ11ᐳ"}}:::plan
    Constant186{{"Constant[186∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Lambda16{{"Lambda[16∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor18{{"PgValidateParsedCursor[18∈0] ➊"}}:::plan
    Constant186 & Lambda16 & PgValidateParsedCursor18 & PgValidateParsedCursor18 & PgValidateParsedCursor18 & PgValidateParsedCursor18 & PgValidateParsedCursor18 & PgValidateParsedCursor18 --> Connection15
    Connection72{{"Connection[72∈0] ➊<br />ᐸ70ᐳ"}}:::plan
    Lambda73{{"Lambda[73∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor75{{"PgValidateParsedCursor[75∈0] ➊"}}:::plan
    Constant186 & Lambda73 & PgValidateParsedCursor75 & PgValidateParsedCursor75 & PgValidateParsedCursor75 & PgValidateParsedCursor75 & PgValidateParsedCursor75 & PgValidateParsedCursor75 --> Connection72
    Object133{{"Object[133∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda125{{"Lambda[125∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Constant130{{"Constant[130∈0] ➊<br />ᐸ[ { codec: Codec(int4), fragment: { n: [Array], f: 0, c: 266ᐳ"}}:::plan
    Constant131{{"Constant[131∈0] ➊<br />ᐸsql.identifier(”person”)ᐳ"}}:::plan
    Constant132{{"Constant[132∈0] ➊<br />ᐸRecordCodec(person)ᐳ"}}:::plan
    Lambda125 & Constant130 & Constant131 & Constant132 --> Object133
    Object149{{"Object[149∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda142{{"Lambda[142∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Constant146{{"Constant[146∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Lambda142 & Constant146 & Constant131 & Constant132 --> Object149
    Object164{{"Object[164∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant161{{"Constant[161∈0] ➊<br />ᐸ[ { codec: Codec(int4), fragment: { n: [Array], f: 0, c: 266ᐳ"}}:::plan
    Lambda125 & Constant161 & Constant131 & Constant132 --> Object164
    Object179{{"Object[179∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant176{{"Constant[176∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Lambda142 & Constant176 & Constant131 & Constant132 --> Object179
    Object14{{"Object[14∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access12 & Access13 --> Object14
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access12
    __Value2 --> Access13
    Constant187{{"Constant[187∈0] ➊<br />ᐸ''ᐳ"}}:::plan
    Constant187 --> Lambda16
    Lambda16 --> PgValidateParsedCursor18
    Access19{{"Access[19∈0] ➊<br />ᐸ16.1ᐳ"}}:::plan
    Lambda16 --> Access19
    Constant188{{"Constant[188∈0] ➊<br />ᐸ'27'ᐳ"}}:::plan
    Constant188 --> Lambda73
    Lambda73 --> PgValidateParsedCursor75
    Access76{{"Access[76∈0] ➊<br />ᐸ73.1ᐳ"}}:::plan
    Lambda73 --> Access76
    Constant195{{"Constant[195∈0] ➊<br />ᐸ§{ first: 2, last: null, cursorLower: null, cursorUpper: nulᐳ"}}:::plan
    Constant195 --> Lambda125
    Lambda128{{"Lambda[128∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant196{{"Constant[196∈0] ➊<br />ᐸ§{ first: 2, last: null, cursorLower: null, cursorUpper: nulᐳ"}}:::plan
    Constant196 --> Lambda128
    Access129{{"Access[129∈0] ➊<br />ᐸ128.0ᐳ"}}:::plan
    Lambda128 --> Access129
    Lambda134{{"Lambda[134∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object133 --> Lambda134
    Lambda140{{"Lambda[140∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant191{{"Constant[191∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: Codec(int4), fragment:ᐳ"}}:::plan
    Constant191 --> Lambda140
    Constant189{{"Constant[189∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant189 --> Lambda142
    Lambda144{{"Lambda[144∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant190{{"Constant[190∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant190 --> Lambda144
    Access145{{"Access[145∈0] ➊<br />ᐸ144.0ᐳ"}}:::plan
    Lambda144 --> Access145
    Lambda150{{"Lambda[150∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object149 --> Lambda150
    Lambda155{{"Lambda[155∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant192{{"Constant[192∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”personᐳ"}}:::plan
    Constant192 --> Lambda155
    Lambda165{{"Lambda[165∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object164 --> Lambda165
    Lambda170{{"Lambda[170∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant193{{"Constant[193∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: Codec(int4), fragment:ᐳ"}}:::plan
    Constant193 --> Lambda170
    Lambda180{{"Lambda[180∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object179 --> Lambda180
    Lambda185{{"Lambda[185∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant194{{"Constant[194∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”personᐳ"}}:::plan
    Constant194 --> Lambda185
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant7{{"Constant[7∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    PgSelect17[["PgSelect[17∈1] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Object14 & Connection15 & Lambda16 & Constant186 & Access19 & Lambda125 & Access129 & Lambda134 & Lambda140 --> PgSelect17
    PgSelect48[["PgSelect[48∈1] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object14 & Connection15 & Lambda142 & Access145 & Lambda150 & Lambda155 --> PgSelect48
    Object45{{"Object[45∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access39{{"Access[39∈1] ➊<br />ᐸ17.hasMoreᐳ"}}:::plan
    Constant186 & Constant7 & Constant7 & Access39 --> Object45
    Object40{{"Object[40∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant186 & Constant7 & Access39 --> Object40
    PgPageInfo20{{"PgPageInfo[20∈1] ➊"}}:::plan
    Connection15 --> PgPageInfo20
    First22{{"First[22∈1] ➊"}}:::plan
    PgSelectRows23[["PgSelectRows[23∈1] ➊"]]:::plan
    PgSelectRows23 --> First22
    PgSelect17 --> PgSelectRows23
    PgSelectSingle24{{"PgSelectSingle[24∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First22 --> PgSelectSingle24
    PgCursor25{{"PgCursor[25∈1] ➊"}}:::plan
    List28{{"List[28∈1] ➊<br />ᐸ27ᐳ"}}:::plan
    List28 --> PgCursor25
    PgClassExpression27{{"PgClassExpression[27∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle24 --> PgClassExpression27
    PgClassExpression27 --> List28
    Last30{{"Last[30∈1] ➊"}}:::plan
    PgSelectRows31[["PgSelectRows[31∈1] ➊"]]:::plan
    PgSelectRows31 --> Last30
    PgSelect17 --> PgSelectRows31
    PgSelectSingle32{{"PgSelectSingle[32∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    Last30 --> PgSelectSingle32
    PgCursor33{{"PgCursor[33∈1] ➊"}}:::plan
    List36{{"List[36∈1] ➊<br />ᐸ35ᐳ"}}:::plan
    List36 --> PgCursor33
    PgClassExpression35{{"PgClassExpression[35∈1] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle32 --> PgClassExpression35
    PgClassExpression35 --> List36
    PgSelect17 --> Access39
    Lambda41{{"Lambda[41∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object40 --> Lambda41
    Lambda46{{"Lambda[46∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object45 --> Lambda46
    First49{{"First[49∈1] ➊"}}:::plan
    PgSelectRows50[["PgSelectRows[50∈1] ➊"]]:::plan
    PgSelectRows50 --> First49
    PgSelect48 --> PgSelectRows50
    PgSelectSingle51{{"PgSelectSingle[51∈1] ➊<br />ᐸpersonᐳ"}}:::plan
    First49 --> PgSelectSingle51
    PgClassExpression52{{"PgClassExpression[52∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression52
    PgSelectRows55[["PgSelectRows[55∈1] ➊"]]:::plan
    PgSelect17 --> PgSelectRows55
    __Item56[/"__Item[56∈2]<br />ᐸ55ᐳ"\]:::itemplan
    PgSelectRows55 ==> __Item56
    PgSelectSingle57{{"PgSelectSingle[57∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item56 --> PgSelectSingle57
    PgCursor58{{"PgCursor[58∈3]"}}:::plan
    List60{{"List[60∈3]<br />ᐸ59ᐳ"}}:::plan
    List60 --> PgCursor58
    PgClassExpression59{{"PgClassExpression[59∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle57 --> PgClassExpression59
    PgClassExpression59 --> List60
    PgClassExpression62{{"PgClassExpression[62∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle57 --> PgClassExpression62
    PgClassExpression63{{"PgClassExpression[63∈3]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle57 --> PgClassExpression63
    PgClassExpression64{{"PgClassExpression[64∈3]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle57 --> PgClassExpression64
    PgClassExpression65{{"PgClassExpression[65∈3]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle57 --> PgClassExpression65
    PgSelect74[["PgSelect[74∈4] ➊<br />ᐸperson+1ᐳ"]]:::plan
    Object14 & Connection72 & Lambda73 & Constant186 & Access76 & Lambda125 & Access129 & Lambda165 & Lambda170 --> PgSelect74
    PgSelect105[["PgSelect[105∈4] ➊<br />ᐸperson(aggregate)ᐳ"]]:::plan
    Object14 & Connection72 & Lambda142 & Access145 & Lambda180 & Lambda185 --> PgSelect105
    Object102{{"Object[102∈4] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access96{{"Access[96∈4] ➊<br />ᐸ74.hasMoreᐳ"}}:::plan
    Constant186 & Constant7 & Constant7 & Access96 --> Object102
    Object97{{"Object[97∈4] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant186 & Constant7 & Access96 --> Object97
    PgPageInfo77{{"PgPageInfo[77∈4] ➊"}}:::plan
    Connection72 --> PgPageInfo77
    First79{{"First[79∈4] ➊"}}:::plan
    PgSelectRows80[["PgSelectRows[80∈4] ➊"]]:::plan
    PgSelectRows80 --> First79
    PgSelect74 --> PgSelectRows80
    PgSelectSingle81{{"PgSelectSingle[81∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First79 --> PgSelectSingle81
    PgCursor82{{"PgCursor[82∈4] ➊"}}:::plan
    List85{{"List[85∈4] ➊<br />ᐸ84ᐳ"}}:::plan
    List85 --> PgCursor82
    PgClassExpression84{{"PgClassExpression[84∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle81 --> PgClassExpression84
    PgClassExpression84 --> List85
    Last87{{"Last[87∈4] ➊"}}:::plan
    PgSelectRows88[["PgSelectRows[88∈4] ➊"]]:::plan
    PgSelectRows88 --> Last87
    PgSelect74 --> PgSelectRows88
    PgSelectSingle89{{"PgSelectSingle[89∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    Last87 --> PgSelectSingle89
    PgCursor90{{"PgCursor[90∈4] ➊"}}:::plan
    List93{{"List[93∈4] ➊<br />ᐸ92ᐳ"}}:::plan
    List93 --> PgCursor90
    PgClassExpression92{{"PgClassExpression[92∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle89 --> PgClassExpression92
    PgClassExpression92 --> List93
    PgSelect74 --> Access96
    Lambda98{{"Lambda[98∈4] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object97 --> Lambda98
    Lambda103{{"Lambda[103∈4] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object102 --> Lambda103
    First106{{"First[106∈4] ➊"}}:::plan
    PgSelectRows107[["PgSelectRows[107∈4] ➊"]]:::plan
    PgSelectRows107 --> First106
    PgSelect105 --> PgSelectRows107
    PgSelectSingle108{{"PgSelectSingle[108∈4] ➊<br />ᐸpersonᐳ"}}:::plan
    First106 --> PgSelectSingle108
    PgClassExpression109{{"PgClassExpression[109∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle108 --> PgClassExpression109
    PgSelectRows112[["PgSelectRows[112∈4] ➊"]]:::plan
    PgSelect74 --> PgSelectRows112
    __Item113[/"__Item[113∈5]<br />ᐸ112ᐳ"\]:::itemplan
    PgSelectRows112 ==> __Item113
    PgSelectSingle114{{"PgSelectSingle[114∈5]<br />ᐸpersonᐳ"}}:::plan
    __Item113 --> PgSelectSingle114
    PgCursor115{{"PgCursor[115∈6]"}}:::plan
    List117{{"List[117∈6]<br />ᐸ116ᐳ"}}:::plan
    List117 --> PgCursor115
    PgClassExpression116{{"PgClassExpression[116∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression116
    PgClassExpression116 --> List117
    PgClassExpression119{{"PgClassExpression[119∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression119
    PgClassExpression120{{"PgClassExpression[120∈6]<br />ᐸ__person__.”email”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression120
    PgClassExpression121{{"PgClassExpression[121∈6]<br />ᐸ__person__.”config”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression121
    PgClassExpression122{{"PgClassExpression[122∈6]<br />ᐸ__person__...n_from_ip”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression122

    %% define steps

    subgraph "Buckets for queries/v4/connections-blankcursor"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant7,Access12,Access13,Object14,Connection15,Lambda16,PgValidateParsedCursor18,Access19,Connection72,Lambda73,PgValidateParsedCursor75,Access76,Lambda125,Lambda128,Access129,Constant130,Constant131,Constant132,Object133,Lambda134,Lambda140,Lambda142,Lambda144,Access145,Constant146,Object149,Lambda150,Lambda155,Constant161,Object164,Lambda165,Lambda170,Constant176,Object179,Lambda180,Lambda185,Constant186,Constant187,Constant188,Constant189,Constant190,Constant191,Constant192,Constant193,Constant194,Constant195,Constant196 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 14, 15, 16, 186, 19, 125, 129, 134, 140, 7, 142, 145, 150, 155<br /><br />ROOT Connectionᐸ11ᐳ[15]<br />1: PgSelect[17], PgSelect[48]<br />ᐳ: 20, 39, 40, 41, 45, 46<br />2: 23, 31, 50, 55<br />ᐳ: 22, 24, 27, 28, 30, 32, 35, 36, 49, 51, 52, 25, 33"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect17,PgPageInfo20,First22,PgSelectRows23,PgSelectSingle24,PgCursor25,PgClassExpression27,List28,Last30,PgSelectRows31,PgSelectSingle32,PgCursor33,PgClassExpression35,List36,Access39,Object40,Lambda41,Object45,Lambda46,PgSelect48,First49,PgSelectRows50,PgSelectSingle51,PgClassExpression52,PgSelectRows55 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ55ᐳ[56]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item56,PgSelectSingle57 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 57<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[57]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor58,PgClassExpression59,List60,PgClassExpression62,PgClassExpression63,PgClassExpression64,PgClassExpression65 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 14, 72, 73, 186, 76, 125, 129, 165, 170, 7, 142, 145, 180, 185<br /><br />ROOT Connectionᐸ70ᐳ[72]<br />1: PgSelect[74], PgSelect[105]<br />ᐳ: 77, 96, 97, 98, 102, 103<br />2: 80, 88, 107, 112<br />ᐳ: 79, 81, 84, 85, 87, 89, 92, 93, 106, 108, 109, 82, 90"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect74,PgPageInfo77,First79,PgSelectRows80,PgSelectSingle81,PgCursor82,PgClassExpression84,List85,Last87,PgSelectRows88,PgSelectSingle89,PgCursor90,PgClassExpression92,List93,Access96,Object97,Lambda98,Object102,Lambda103,PgSelect105,First106,PgSelectRows107,PgSelectSingle108,PgClassExpression109,PgSelectRows112 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ112ᐳ[113]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item113,PgSelectSingle114 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 114<br /><br />ROOT PgSelectSingle{5}ᐸpersonᐳ[114]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor115,PgClassExpression116,List117,PgClassExpression119,PgClassExpression120,PgClassExpression121,PgClassExpression122 bucket6
    Bucket0 --> Bucket1 & Bucket4
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    end
