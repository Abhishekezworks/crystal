%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect7[["PgSelect[7∈0]<br />ᐸjson_identityᐳ"]]:::plan
    Object10{{"Object[10∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant120{{"Constant[120∈0]<br />ᐸtrueᐳ"}}:::plan
    Object10 & Constant120 --> PgSelect7
    Access8{{"Access[8∈0]<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0]<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    PgSelect15[["PgSelect[15∈0]<br />ᐸjson_identityᐳ"]]:::plan
    Constant121{{"Constant[121∈0]<br />ᐸfalseᐳ"}}:::plan
    Object10 & Constant121 --> PgSelect15
    PgSelect23[["PgSelect[23∈0]<br />ᐸjson_identityᐳ"]]:::plan
    Constant122{{"Constant[122∈0]<br />ᐸ42ᐳ"}}:::plan
    Object10 & Constant122 --> PgSelect23
    PgSelect31[["PgSelect[31∈0]<br />ᐸjson_identityᐳ"]]:::plan
    Constant123{{"Constant[123∈0]<br />ᐸ3.1415ᐳ"}}:::plan
    Object10 & Constant123 --> PgSelect31
    PgSelect39[["PgSelect[39∈0]<br />ᐸjson_identityᐳ"]]:::plan
    Constant124{{"Constant[124∈0]<br />ᐸ'hello, world!'ᐳ"}}:::plan
    Object10 & Constant124 --> PgSelect39
    PgSelect47[["PgSelect[47∈0]<br />ᐸjson_identityᐳ"]]:::plan
    __InputDynamicScalar46{{"__InputDynamicScalar[46∈0]"}}:::plan
    Object10 & __InputDynamicScalar46 --> PgSelect47
    PgSelect55[["PgSelect[55∈0]<br />ᐸjson_identityᐳ"]]:::plan
    __InputDynamicScalar54{{"__InputDynamicScalar[54∈0]"}}:::plan
    Object10 & __InputDynamicScalar54 --> PgSelect55
    PgSelect63[["PgSelect[63∈0]<br />ᐸjson_identityᐳ"]]:::plan
    __InputDynamicScalar62{{"__InputDynamicScalar[62∈0]"}}:::plan
    Object10 & __InputDynamicScalar62 --> PgSelect63
    PgSelect71[["PgSelect[71∈0]<br />ᐸjson_identityᐳ"]]:::plan
    __InputDynamicScalar70{{"__InputDynamicScalar[70∈0]"}}:::plan
    Object10 & __InputDynamicScalar70 --> PgSelect71
    PgSelect79[["PgSelect[79∈0]<br />ᐸjson_identityᐳ"]]:::plan
    __InputDynamicScalar78{{"__InputDynamicScalar[78∈0]"}}:::plan
    Object10 & __InputDynamicScalar78 --> PgSelect79
    PgSelect87[["PgSelect[87∈0]<br />ᐸjsonb_identityᐳ"]]:::plan
    __InputDynamicScalar86{{"__InputDynamicScalar[86∈0]"}}:::plan
    Object10 & __InputDynamicScalar86 --> PgSelect87
    PgSelect95[["PgSelect[95∈0]<br />ᐸjsonb_identityᐳ"]]:::plan
    __InputDynamicScalar94{{"__InputDynamicScalar[94∈0]"}}:::plan
    Object10 & __InputDynamicScalar94 --> PgSelect95
    __Value2["__Value[2∈0]<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    First11{{"First[11∈0]"}}:::plan
    PgSelect7 --> First11
    PgSelectSingle12{{"PgSelectSingle[12∈0]<br />ᐸjson_identityᐳ"}}:::plan
    First11 --> PgSelectSingle12
    PgClassExpression13{{"PgClassExpression[13∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle12 --> PgClassExpression13
    First19{{"First[19∈0]"}}:::plan
    PgSelect15 --> First19
    PgSelectSingle20{{"PgSelectSingle[20∈0]<br />ᐸjson_identityᐳ"}}:::plan
    First19 --> PgSelectSingle20
    PgClassExpression21{{"PgClassExpression[21∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle20 --> PgClassExpression21
    First27{{"First[27∈0]"}}:::plan
    PgSelect23 --> First27
    PgSelectSingle28{{"PgSelectSingle[28∈0]<br />ᐸjson_identityᐳ"}}:::plan
    First27 --> PgSelectSingle28
    PgClassExpression29{{"PgClassExpression[29∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle28 --> PgClassExpression29
    First35{{"First[35∈0]"}}:::plan
    PgSelect31 --> First35
    PgSelectSingle36{{"PgSelectSingle[36∈0]<br />ᐸjson_identityᐳ"}}:::plan
    First35 --> PgSelectSingle36
    PgClassExpression37{{"PgClassExpression[37∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle36 --> PgClassExpression37
    First43{{"First[43∈0]"}}:::plan
    PgSelect39 --> First43
    PgSelectSingle44{{"PgSelectSingle[44∈0]<br />ᐸjson_identityᐳ"}}:::plan
    First43 --> PgSelectSingle44
    PgClassExpression45{{"PgClassExpression[45∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle44 --> PgClassExpression45
    First51{{"First[51∈0]"}}:::plan
    PgSelect47 --> First51
    PgSelectSingle52{{"PgSelectSingle[52∈0]<br />ᐸjson_identityᐳ"}}:::plan
    First51 --> PgSelectSingle52
    PgClassExpression53{{"PgClassExpression[53∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression53
    First59{{"First[59∈0]"}}:::plan
    PgSelect55 --> First59
    PgSelectSingle60{{"PgSelectSingle[60∈0]<br />ᐸjson_identityᐳ"}}:::plan
    First59 --> PgSelectSingle60
    PgClassExpression61{{"PgClassExpression[61∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle60 --> PgClassExpression61
    First67{{"First[67∈0]"}}:::plan
    PgSelect63 --> First67
    PgSelectSingle68{{"PgSelectSingle[68∈0]<br />ᐸjson_identityᐳ"}}:::plan
    First67 --> PgSelectSingle68
    PgClassExpression69{{"PgClassExpression[69∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle68 --> PgClassExpression69
    First75{{"First[75∈0]"}}:::plan
    PgSelect71 --> First75
    PgSelectSingle76{{"PgSelectSingle[76∈0]<br />ᐸjson_identityᐳ"}}:::plan
    First75 --> PgSelectSingle76
    PgClassExpression77{{"PgClassExpression[77∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle76 --> PgClassExpression77
    First83{{"First[83∈0]"}}:::plan
    PgSelect79 --> First83
    PgSelectSingle84{{"PgSelectSingle[84∈0]<br />ᐸjson_identityᐳ"}}:::plan
    First83 --> PgSelectSingle84
    PgClassExpression85{{"PgClassExpression[85∈0]<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle84 --> PgClassExpression85
    First91{{"First[91∈0]"}}:::plan
    PgSelect87 --> First91
    PgSelectSingle92{{"PgSelectSingle[92∈0]<br />ᐸjsonb_identityᐳ"}}:::plan
    First91 --> PgSelectSingle92
    PgClassExpression93{{"PgClassExpression[93∈0]<br />ᐸ__jsonb_identity__.vᐳ"}}:::plan
    PgSelectSingle92 --> PgClassExpression93
    First99{{"First[99∈0]"}}:::plan
    PgSelect95 --> First99
    PgSelectSingle100{{"PgSelectSingle[100∈0]<br />ᐸjsonb_identityᐳ"}}:::plan
    First99 --> PgSelectSingle100
    PgClassExpression101{{"PgClassExpression[101∈0]<br />ᐸ__jsonb_identity__.vᐳ"}}:::plan
    PgSelectSingle100 --> PgClassExpression101
    __Value4["__Value[4∈0]<br />ᐸrootValueᐳ"]:::plan
    Connection114{{"Connection[114∈0]<br />ᐸ110ᐳ"}}:::plan
    PgSelect115[["PgSelect[115∈1]<br />ᐸtypesᐳ"]]:::plan
    Object10 & Connection114 --> PgSelect115
    __Item116[/"__Item[116∈2]<br />ᐸ115ᐳ"\]:::itemplan
    PgSelect115 ==> __Item116
    PgSelectSingle117{{"PgSelectSingle[117∈2]<br />ᐸtypesᐳ"}}:::plan
    __Item116 --> PgSelectSingle117
    PgClassExpression118{{"PgClassExpression[118∈3]<br />ᐸ__types__.”json”ᐳ"}}:::plan
    PgSelectSingle117 --> PgClassExpression118
    PgClassExpression119{{"PgClassExpression[119∈3]<br />ᐸ__types__.”jsonb”ᐳ"}}:::plan
    PgSelectSingle117 --> PgClassExpression119

    %% define steps

    subgraph "Buckets for queries/v4/dynamic-json"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 8, 9, 46, 54, 62, 70, 78, 86, 94, 114, 120, 121, 122, 123, 124, 10<br />2: 7, 15, 23, 31, 39, 47, 55, 63, 71, 79, 87, 95<br />ᐳ: 11, 12, 13, 19, 20, 21, 27, 28, 29, 35, 36, 37, 43, 44, 45, 51, 52, 53, 59, 60, 61, 67, 68, 69, 75, 76, 77, 83, 84, 85, 91, 92, 93, 99, 100, 101"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access9,Object10,First11,PgSelectSingle12,PgClassExpression13,PgSelect15,First19,PgSelectSingle20,PgClassExpression21,PgSelect23,First27,PgSelectSingle28,PgClassExpression29,PgSelect31,First35,PgSelectSingle36,PgClassExpression37,PgSelect39,First43,PgSelectSingle44,PgClassExpression45,__InputDynamicScalar46,PgSelect47,First51,PgSelectSingle52,PgClassExpression53,__InputDynamicScalar54,PgSelect55,First59,PgSelectSingle60,PgClassExpression61,__InputDynamicScalar62,PgSelect63,First67,PgSelectSingle68,PgClassExpression69,__InputDynamicScalar70,PgSelect71,First75,PgSelectSingle76,PgClassExpression77,__InputDynamicScalar78,PgSelect79,First83,PgSelectSingle84,PgClassExpression85,__InputDynamicScalar86,PgSelect87,First91,PgSelectSingle92,PgClassExpression93,__InputDynamicScalar94,PgSelect95,First99,PgSelectSingle100,PgClassExpression101,Connection114,Constant120,Constant121,Constant122,Constant123,Constant124 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 10, 114<br /><br />ROOT Connectionᐸ110ᐳ[114]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect115 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ115ᐳ[116]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item116,PgSelectSingle117 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 117<br /><br />ROOT PgSelectSingle{2}ᐸtypesᐳ[117]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression118,PgClassExpression119 bucket3
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    classDef unary fill:#fafffa,borderWidth:8px
    class PgSelect7,Object10,PgSelect15,PgSelect23,PgSelect31,PgSelect39,PgSelect47,PgSelect55,PgSelect63,PgSelect71,PgSelect79,PgSelect87,PgSelect95,Access8,Access9,First11,PgSelectSingle12,PgClassExpression13,First19,PgSelectSingle20,PgClassExpression21,First27,PgSelectSingle28,PgClassExpression29,First35,PgSelectSingle36,PgClassExpression37,First43,PgSelectSingle44,PgClassExpression45,First51,PgSelectSingle52,PgClassExpression53,First59,PgSelectSingle60,PgClassExpression61,First67,PgSelectSingle68,PgClassExpression69,First75,PgSelectSingle76,PgClassExpression77,First83,PgSelectSingle84,PgClassExpression85,First91,PgSelectSingle92,PgClassExpression93,First99,PgSelectSingle100,PgClassExpression101,__Value2,__Value4,__InputDynamicScalar46,__InputDynamicScalar54,__InputDynamicScalar62,__InputDynamicScalar70,__InputDynamicScalar78,__InputDynamicScalar86,__InputDynamicScalar94,Connection114,Constant120,Constant121,Constant122,Constant123,Constant124,PgSelect115 unary
    end
