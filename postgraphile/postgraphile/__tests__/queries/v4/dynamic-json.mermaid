%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/v4/dynamic-json"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 8, 10, 64, 75, 86, 97, 108, 119, 130, 146, 155, 156, 157, 158, 159, 11, 13, 24, 35, 46, 57, 68, 79, 90, 101, 112, 123, 134<br />2: 7, 21, 32, 43, 54, 65, 76, 87, 98, 109, 120, 131<br />3: 16, 27, 38, 49, 60, 71, 82, 93, 104, 115, 126, 137<br />ᐳ: 15, 18, 19, 26, 29, 30, 37, 40, 41, 48, 51, 52, 59, 62, 63, 70, 73, 74, 81, 84, 85, 92, 95, 96, 103, 106, 107, 114, 117, 118, 125, 128, 129, 136, 139, 140"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 11, 146<br /><br />ROOT Connectionᐸ143ᐳ[146]<br />1: PgSelect[148]<br />2: PgSelectRows[150]"):::bucket
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ150ᐳ[151]"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 152<br /><br />ROOT PgSelectSingle{2}ᐸtypesᐳ[152]"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3

    %% plan dependencies
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    PgFromExpression13{{"PgFromExpression[13∈0] ➊"}}:::plan
    Object11 & PgFromExpression13 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access10 --> Object11
    PgSelect21[["PgSelect[21∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression24{{"PgFromExpression[24∈0] ➊"}}:::plan
    Object11 & PgFromExpression24 --> PgSelect21
    PgSelect32[["PgSelect[32∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression35{{"PgFromExpression[35∈0] ➊"}}:::plan
    Object11 & PgFromExpression35 --> PgSelect32
    PgSelect43[["PgSelect[43∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression46{{"PgFromExpression[46∈0] ➊"}}:::plan
    Object11 & PgFromExpression46 --> PgSelect43
    PgSelect54[["PgSelect[54∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression57{{"PgFromExpression[57∈0] ➊"}}:::plan
    Object11 & PgFromExpression57 --> PgSelect54
    PgSelect65[["PgSelect[65∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression68{{"PgFromExpression[68∈0] ➊"}}:::plan
    Object11 & PgFromExpression68 --> PgSelect65
    PgSelect76[["PgSelect[76∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression79{{"PgFromExpression[79∈0] ➊"}}:::plan
    Object11 & PgFromExpression79 --> PgSelect76
    PgSelect87[["PgSelect[87∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression90{{"PgFromExpression[90∈0] ➊"}}:::plan
    Object11 & PgFromExpression90 --> PgSelect87
    PgSelect98[["PgSelect[98∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression101{{"PgFromExpression[101∈0] ➊"}}:::plan
    Object11 & PgFromExpression101 --> PgSelect98
    PgSelect109[["PgSelect[109∈0] ➊<br />ᐸjson_identityᐳ"]]:::plan
    PgFromExpression112{{"PgFromExpression[112∈0] ➊"}}:::plan
    Object11 & PgFromExpression112 --> PgSelect109
    PgSelect120[["PgSelect[120∈0] ➊<br />ᐸjsonb_identityᐳ"]]:::plan
    PgFromExpression123{{"PgFromExpression[123∈0] ➊"}}:::plan
    Object11 & PgFromExpression123 --> PgSelect120
    PgSelect131[["PgSelect[131∈0] ➊<br />ᐸjsonb_identityᐳ"]]:::plan
    PgFromExpression134{{"PgFromExpression[134∈0] ➊"}}:::plan
    Object11 & PgFromExpression134 --> PgSelect131
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access10
    Constant155{{"Constant[155∈0] ➊<br />ᐸtrueᐳ"}}:::plan
    Constant155 --> PgFromExpression13
    First15{{"First[15∈0] ➊"}}:::plan
    PgSelectRows16[["PgSelectRows[16∈0] ➊"]]:::plan
    PgSelectRows16 --> First15
    PgSelect7 --> PgSelectRows16
    PgSelectSingle18{{"PgSelectSingle[18∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First15 --> PgSelectSingle18
    PgClassExpression19{{"PgClassExpression[19∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle18 --> PgClassExpression19
    Constant156{{"Constant[156∈0] ➊<br />ᐸfalseᐳ"}}:::plan
    Constant156 --> PgFromExpression24
    First26{{"First[26∈0] ➊"}}:::plan
    PgSelectRows27[["PgSelectRows[27∈0] ➊"]]:::plan
    PgSelectRows27 --> First26
    PgSelect21 --> PgSelectRows27
    PgSelectSingle29{{"PgSelectSingle[29∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First26 --> PgSelectSingle29
    PgClassExpression30{{"PgClassExpression[30∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression30
    Constant157{{"Constant[157∈0] ➊<br />ᐸ42ᐳ"}}:::plan
    Constant157 --> PgFromExpression35
    First37{{"First[37∈0] ➊"}}:::plan
    PgSelectRows38[["PgSelectRows[38∈0] ➊"]]:::plan
    PgSelectRows38 --> First37
    PgSelect32 --> PgSelectRows38
    PgSelectSingle40{{"PgSelectSingle[40∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First37 --> PgSelectSingle40
    PgClassExpression41{{"PgClassExpression[41∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle40 --> PgClassExpression41
    Constant158{{"Constant[158∈0] ➊<br />ᐸ3.1415ᐳ"}}:::plan
    Constant158 --> PgFromExpression46
    First48{{"First[48∈0] ➊"}}:::plan
    PgSelectRows49[["PgSelectRows[49∈0] ➊"]]:::plan
    PgSelectRows49 --> First48
    PgSelect43 --> PgSelectRows49
    PgSelectSingle51{{"PgSelectSingle[51∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First48 --> PgSelectSingle51
    PgClassExpression52{{"PgClassExpression[52∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression52
    Constant159{{"Constant[159∈0] ➊<br />ᐸ'hello, world!'ᐳ"}}:::plan
    Constant159 --> PgFromExpression57
    First59{{"First[59∈0] ➊"}}:::plan
    PgSelectRows60[["PgSelectRows[60∈0] ➊"]]:::plan
    PgSelectRows60 --> First59
    PgSelect54 --> PgSelectRows60
    PgSelectSingle62{{"PgSelectSingle[62∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First59 --> PgSelectSingle62
    PgClassExpression63{{"PgClassExpression[63∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle62 --> PgClassExpression63
    __InputDynamicScalar64{{"__InputDynamicScalar[64∈0] ➊"}}:::plan
    __InputDynamicScalar64 --> PgFromExpression68
    First70{{"First[70∈0] ➊"}}:::plan
    PgSelectRows71[["PgSelectRows[71∈0] ➊"]]:::plan
    PgSelectRows71 --> First70
    PgSelect65 --> PgSelectRows71
    PgSelectSingle73{{"PgSelectSingle[73∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First70 --> PgSelectSingle73
    PgClassExpression74{{"PgClassExpression[74∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle73 --> PgClassExpression74
    __InputDynamicScalar75{{"__InputDynamicScalar[75∈0] ➊"}}:::plan
    __InputDynamicScalar75 --> PgFromExpression79
    First81{{"First[81∈0] ➊"}}:::plan
    PgSelectRows82[["PgSelectRows[82∈0] ➊"]]:::plan
    PgSelectRows82 --> First81
    PgSelect76 --> PgSelectRows82
    PgSelectSingle84{{"PgSelectSingle[84∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First81 --> PgSelectSingle84
    PgClassExpression85{{"PgClassExpression[85∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle84 --> PgClassExpression85
    __InputDynamicScalar86{{"__InputDynamicScalar[86∈0] ➊"}}:::plan
    __InputDynamicScalar86 --> PgFromExpression90
    First92{{"First[92∈0] ➊"}}:::plan
    PgSelectRows93[["PgSelectRows[93∈0] ➊"]]:::plan
    PgSelectRows93 --> First92
    PgSelect87 --> PgSelectRows93
    PgSelectSingle95{{"PgSelectSingle[95∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First92 --> PgSelectSingle95
    PgClassExpression96{{"PgClassExpression[96∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle95 --> PgClassExpression96
    __InputDynamicScalar97{{"__InputDynamicScalar[97∈0] ➊"}}:::plan
    __InputDynamicScalar97 --> PgFromExpression101
    First103{{"First[103∈0] ➊"}}:::plan
    PgSelectRows104[["PgSelectRows[104∈0] ➊"]]:::plan
    PgSelectRows104 --> First103
    PgSelect98 --> PgSelectRows104
    PgSelectSingle106{{"PgSelectSingle[106∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First103 --> PgSelectSingle106
    PgClassExpression107{{"PgClassExpression[107∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression107
    __InputDynamicScalar108{{"__InputDynamicScalar[108∈0] ➊"}}:::plan
    __InputDynamicScalar108 --> PgFromExpression112
    First114{{"First[114∈0] ➊"}}:::plan
    PgSelectRows115[["PgSelectRows[115∈0] ➊"]]:::plan
    PgSelectRows115 --> First114
    PgSelect109 --> PgSelectRows115
    PgSelectSingle117{{"PgSelectSingle[117∈0] ➊<br />ᐸjson_identityᐳ"}}:::plan
    First114 --> PgSelectSingle117
    PgClassExpression118{{"PgClassExpression[118∈0] ➊<br />ᐸ__json_identity__.vᐳ"}}:::plan
    PgSelectSingle117 --> PgClassExpression118
    __InputDynamicScalar119{{"__InputDynamicScalar[119∈0] ➊"}}:::plan
    __InputDynamicScalar119 --> PgFromExpression123
    First125{{"First[125∈0] ➊"}}:::plan
    PgSelectRows126[["PgSelectRows[126∈0] ➊"]]:::plan
    PgSelectRows126 --> First125
    PgSelect120 --> PgSelectRows126
    PgSelectSingle128{{"PgSelectSingle[128∈0] ➊<br />ᐸjsonb_identityᐳ"}}:::plan
    First125 --> PgSelectSingle128
    PgClassExpression129{{"PgClassExpression[129∈0] ➊<br />ᐸ__jsonb_identity__.vᐳ"}}:::plan
    PgSelectSingle128 --> PgClassExpression129
    __InputDynamicScalar130{{"__InputDynamicScalar[130∈0] ➊"}}:::plan
    __InputDynamicScalar130 --> PgFromExpression134
    First136{{"First[136∈0] ➊"}}:::plan
    PgSelectRows137[["PgSelectRows[137∈0] ➊"]]:::plan
    PgSelectRows137 --> First136
    PgSelect131 --> PgSelectRows137
    PgSelectSingle139{{"PgSelectSingle[139∈0] ➊<br />ᐸjsonb_identityᐳ"}}:::plan
    First136 --> PgSelectSingle139
    PgClassExpression140{{"PgClassExpression[140∈0] ➊<br />ᐸ__jsonb_identity__.vᐳ"}}:::plan
    PgSelectSingle139 --> PgClassExpression140
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection146{{"Connection[146∈0] ➊<br />ᐸ143ᐳ"}}:::plan
    PgSelect148[["PgSelect[148∈1] ➊<br />ᐸtypesᐳ"]]:::plan
    Object11 & Connection146 --> PgSelect148
    PgSelectRows150[["PgSelectRows[150∈1] ➊"]]:::plan
    PgSelect148 --> PgSelectRows150
    __Item151[/"__Item[151∈2]<br />ᐸ150ᐳ"\]:::itemplan
    PgSelectRows150 ==> __Item151
    PgSelectSingle152{{"PgSelectSingle[152∈2]<br />ᐸtypesᐳ"}}:::plan
    __Item151 --> PgSelectSingle152
    PgClassExpression153{{"PgClassExpression[153∈3]<br />ᐸ__types__.”json”ᐳ"}}:::plan
    PgSelectSingle152 --> PgClassExpression153
    PgClassExpression154{{"PgClassExpression[154∈3]<br />ᐸ__types__.”jsonb”ᐳ"}}:::plan
    PgSelectSingle152 --> PgClassExpression154

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access10,Object11,PgFromExpression13,First15,PgSelectRows16,PgSelectSingle18,PgClassExpression19,PgSelect21,PgFromExpression24,First26,PgSelectRows27,PgSelectSingle29,PgClassExpression30,PgSelect32,PgFromExpression35,First37,PgSelectRows38,PgSelectSingle40,PgClassExpression41,PgSelect43,PgFromExpression46,First48,PgSelectRows49,PgSelectSingle51,PgClassExpression52,PgSelect54,PgFromExpression57,First59,PgSelectRows60,PgSelectSingle62,PgClassExpression63,__InputDynamicScalar64,PgSelect65,PgFromExpression68,First70,PgSelectRows71,PgSelectSingle73,PgClassExpression74,__InputDynamicScalar75,PgSelect76,PgFromExpression79,First81,PgSelectRows82,PgSelectSingle84,PgClassExpression85,__InputDynamicScalar86,PgSelect87,PgFromExpression90,First92,PgSelectRows93,PgSelectSingle95,PgClassExpression96,__InputDynamicScalar97,PgSelect98,PgFromExpression101,First103,PgSelectRows104,PgSelectSingle106,PgClassExpression107,__InputDynamicScalar108,PgSelect109,PgFromExpression112,First114,PgSelectRows115,PgSelectSingle117,PgClassExpression118,__InputDynamicScalar119,PgSelect120,PgFromExpression123,First125,PgSelectRows126,PgSelectSingle128,PgClassExpression129,__InputDynamicScalar130,PgSelect131,PgFromExpression134,First136,PgSelectRows137,PgSelectSingle139,PgClassExpression140,Connection146,Constant155,Constant156,Constant157,Constant158,Constant159 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect148,PgSelectRows150 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item151,PgSelectSingle152 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression153,PgClassExpression154 bucket3

