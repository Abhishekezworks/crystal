%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    __InputObject11{{"__InputObject[11∈0] ➊"}}:::plan
    Constant67{{"Constant[67∈0] ➊<br />ᐸ'Twenty Seventwo'ᐳ"}}:::plan
    Constant67 --> __InputObject11
    Object17{{"Object[17∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access15{{"Access[15∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access15 & Access16 --> Object17
    PgSelect25[["PgSelect[25∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Access23{{"Access[23∈0] ➊<br />ᐸ22.1ᐳ"}}:::plan
    Object17 -->|rejectNull| PgSelect25
    Access23 --> PgSelect25
    __InputObject30{{"__InputObject[30∈0] ➊"}}:::plan
    Constant69{{"Constant[69∈0] ➊<br />ᐸ'Is that a cooking show?'ᐳ"}}:::plan
    Constant69 --> __InputObject30
    PgSelect42[["PgSelect[42∈0] ➊<br />ᐸpersonᐳ"]]:::plan
    Access40{{"Access[40∈0] ➊<br />ᐸ39.1ᐳ"}}:::plan
    Object17 -->|rejectNull| PgSelect42
    Access40 --> PgSelect42
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access15
    __Value2 --> Access16
    ApplyInput19{{"ApplyInput[19∈0] ➊"}}:::plan
    __InputObject11 --> ApplyInput19
    Lambda22{{"Lambda[22∈0] ➊<br />ᐸspecifier_Person_base64JSONᐳ"}}:::plan
    Constant68{{"Constant[68∈0] ➊<br />ᐸ'WyJwZW9wbGUiLDZd'ᐳ"}}:::plan
    Constant68 --> Lambda22
    Lambda22 --> Access23
    First27{{"First[27∈0] ➊"}}:::plan
    PgSelectRows28[["PgSelectRows[28∈0] ➊"]]:::plan
    PgSelectRows28 --> First27
    PgSelect25 --> PgSelectRows28
    PgSelectSingle29{{"PgSelectSingle[29∈0] ➊<br />ᐸpersonᐳ"}}:::plan
    First27 --> PgSelectSingle29
    ApplyInput36{{"ApplyInput[36∈0] ➊"}}:::plan
    __InputObject30 --> ApplyInput36
    Lambda39{{"Lambda[39∈0] ➊<br />ᐸspecifier_Person_base64JSONᐳ"}}:::plan
    Constant70{{"Constant[70∈0] ➊<br />ᐸ'WyJwb3N0cyIsM10='ᐳ"}}:::plan
    Constant70 --> Lambda39
    Lambda39 --> Access40
    First44{{"First[44∈0] ➊"}}:::plan
    PgSelectRows45[["PgSelectRows[45∈0] ➊"]]:::plan
    PgSelectRows45 --> First44
    PgSelect42 --> PgSelectRows45
    PgSelectSingle46{{"PgSelectSingle[46∈0] ➊<br />ᐸpersonᐳ"}}:::plan
    First44 --> PgSelectSingle46
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection18{{"Connection[18∈0] ➊<br />ᐸ14ᐳ"}}:::plan
    Connection35{{"Connection[35∈0] ➊<br />ᐸ33ᐳ"}}:::plan
    Constant57{{"Constant[57∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    Constant62{{"Constant[62∈0] ➊<br />ᐸ'posts'ᐳ"}}:::plan
    PgSelect47[["PgSelect[47∈1] ➊<br />ᐸpersonᐳ"]]:::plan
    Object17 & ApplyInput19 & Connection18 --> PgSelect47
    PgSelectRows48[["PgSelectRows[48∈1] ➊"]]:::plan
    PgSelect47 --> PgSelectRows48
    __Item49[/"__Item[49∈5]<br />ᐸ48ᐳ"\]:::itemplan
    PgSelectRows48 ==> __Item49
    PgSelectSingle50{{"PgSelectSingle[50∈5]<br />ᐸpersonᐳ"}}:::plan
    __Item49 --> PgSelectSingle50
    List59{{"List[59∈6]<br />ᐸ57,58ᐳ"}}:::plan
    PgClassExpression58{{"PgClassExpression[58∈6]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant57 & PgClassExpression58 --> List59
    PgSelectSingle50 --> PgClassExpression58
    Lambda60{{"Lambda[60∈6]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List59 --> Lambda60
    PgClassExpression61{{"PgClassExpression[61∈6]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression61
    PgClassExpression51{{"PgClassExpression[51∈2] ➊<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression51
    PgSelect52[["PgSelect[52∈3] ➊<br />ᐸpostᐳ"]]:::plan
    Object17 & ApplyInput36 & Connection35 --> PgSelect52
    PgSelectRows53[["PgSelectRows[53∈3] ➊"]]:::plan
    PgSelect52 --> PgSelectRows53
    __Item54[/"__Item[54∈7]<br />ᐸ53ᐳ"\]:::itemplan
    PgSelectRows53 ==> __Item54
    PgSelectSingle55{{"PgSelectSingle[55∈7]<br />ᐸpostᐳ"}}:::plan
    __Item54 --> PgSelectSingle55
    List64{{"List[64∈8]<br />ᐸ62,63ᐳ"}}:::plan
    PgClassExpression63{{"PgClassExpression[63∈8]<br />ᐸ__post__.”id”ᐳ"}}:::plan
    Constant62 & PgClassExpression63 --> List64
    PgSelectSingle55 --> PgClassExpression63
    Lambda65{{"Lambda[65∈8]<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List64 --> Lambda65
    PgClassExpression66{{"PgClassExpression[66∈8]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression66
    PgClassExpression56{{"PgClassExpression[56∈4] ➊<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle46 --> PgClassExpression56

    %% define steps

    subgraph "Buckets for queries/v4/nodeId-earlyExit"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 10, 15, 16, 18, 35, 57, 62, 67, 68, 69, 70, 11, 17, 19, 22, 23, 30, 36, 39, 40<br />2: PgSelect[25], PgSelect[42]<br />3: PgSelectRows[28], PgSelectRows[45]<br />ᐳ: 27, 29, 44, 46"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,__InputObject11,Access15,Access16,Object17,Connection18,ApplyInput19,Lambda22,Access23,PgSelect25,First27,PgSelectRows28,PgSelectSingle29,__InputObject30,Connection35,ApplyInput36,Lambda39,Access40,PgSelect42,First44,PgSelectRows45,PgSelectSingle46,Constant57,Constant62,Constant67,Constant68,Constant69,Constant70 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 17, 19, 18, 57<br /><br />ROOT Connectionᐸ14ᐳ[18]<br />1: PgSelect[47]<br />2: PgSelectRows[48]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect47,PgSelectRows48 bucket1
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 29<br /><br />ROOT PgSelectSingleᐸpersonᐳ[29]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgClassExpression51 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 17, 36, 35, 62<br /><br />ROOT Connectionᐸ33ᐳ[35]<br />1: PgSelect[52]<br />2: PgSelectRows[53]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgSelect52,PgSelectRows53 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 46<br /><br />ROOT PgSelectSingleᐸpersonᐳ[46]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression56 bucket4
    Bucket5("Bucket 5 (listItem)<br />Deps: 57<br /><br />ROOT __Item{5}ᐸ48ᐳ[49]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item49,PgSelectSingle50 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 50, 57<br /><br />ROOT PgSelectSingle{5}ᐸpersonᐳ[50]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgClassExpression58,List59,Lambda60,PgClassExpression61 bucket6
    Bucket7("Bucket 7 (listItem)<br />Deps: 62<br /><br />ROOT __Item{7}ᐸ53ᐳ[54]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item54,PgSelectSingle55 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 55, 62<br /><br />ROOT PgSelectSingle{7}ᐸpostᐳ[55]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgClassExpression63,List64,Lambda65,PgClassExpression66 bucket8
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4
    Bucket1 --> Bucket5
    Bucket3 --> Bucket7
    Bucket5 --> Bucket6
    Bucket7 --> Bucket8
    end
