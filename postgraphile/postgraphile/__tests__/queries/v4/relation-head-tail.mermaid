%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% define steps
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    Access31{{"Access[31∈0]<br />ᐸ3.pgSettingsᐳ"}}:::plan
    Access32{{"Access[32∈0]<br />ᐸ3.withPgClientᐳ"}}:::plan
    Object33{{"Object[33∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Connection34{{"Connection[34∈0]<br />ᐸ30ᐳ"}}:::plan
    __InputStaticLeaf81{{"__InputStaticLeaf[81∈1]"}}:::plan
    PgSelect35[["PgSelect[35∈1]<br />ᐸpersonᐳ"]]:::plan
    __Item36[/"__Item[36∈2]<br />ᐸ35ᐳ"\]:::itemplan
    PgSelectSingle37{{"PgSelectSingle[37∈2]<br />ᐸpersonᐳ"}}:::plan
    PgClassExpression38{{"PgClassExpression[38∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgClassExpression39{{"PgClassExpression[39∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    __InputStaticLeaf41{{"__InputStaticLeaf[41∈1]"}}:::plan
    Connection65{{"Connection[65∈1]<br />ᐸ61ᐳ"}}:::plan
    Access195{{"Access[195∈3]<br />ᐸ36.1ᐳ"}}:::plan
    Reverse196{{"Reverse[196∈3]"}}:::plan
    __Item67[/"__Item[67∈4]<br />ᐸ196ᐳ"\]:::itemplan
    PgSelectSingle68{{"PgSelectSingle[68∈4]<br />ᐸpostᐳ"}}:::plan
    PgClassExpression69{{"PgClassExpression[69∈5]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgClassExpression70{{"PgClassExpression[70∈5]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    Connection96{{"Connection[96∈1]<br />ᐸ92ᐳ"}}:::plan
    Access198{{"Access[198∈3]<br />ᐸ36.2ᐳ"}}:::plan
    __Item98[/"__Item[98∈6]<br />ᐸ198ᐳ"\]:::itemplan
    PgSelectSingle99{{"PgSelectSingle[99∈6]<br />ᐸpostᐳ"}}:::plan
    PgClassExpression100{{"PgClassExpression[100∈7]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgClassExpression101{{"PgClassExpression[101∈7]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    Connection119{{"Connection[119∈1]<br />ᐸ115ᐳ"}}:::plan
    Access200{{"Access[200∈3]<br />ᐸ36.4ᐳ"}}:::plan
    __Item121[/"__Item[121∈8]<br />ᐸ200ᐳ"\]:::itemplan
    PgSelectSingle122{{"PgSelectSingle[122∈8]<br />ᐸcompoundKeyᐳ"}}:::plan
    PgClassExpression123{{"PgClassExpression[123∈9]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression124{{"PgClassExpression[124∈9]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    Connection142{{"Connection[142∈1]<br />ᐸ138ᐳ"}}:::plan
    Access199{{"Access[199∈3]<br />ᐸ36.3ᐳ"}}:::plan
    __Item144[/"__Item[144∈10]<br />ᐸ199ᐳ"\]:::itemplan
    PgSelectSingle145{{"PgSelectSingle[145∈10]<br />ᐸcompoundKeyᐳ"}}:::plan
    PgClassExpression146{{"PgClassExpression[146∈11]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression147{{"PgClassExpression[147∈11]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    Connection164{{"Connection[164∈0]<br />ᐸ160ᐳ"}}:::plan
    PgSelect165[["PgSelect[165∈12]<br />ᐸcompoundKeyᐳ"]]:::plan
    __Item166[/"__Item[166∈13]<br />ᐸ165ᐳ"\]:::itemplan
    PgSelectSingle167{{"PgSelectSingle[167∈13]<br />ᐸcompoundKeyᐳ"}}:::plan
    PgClassExpression168{{"PgClassExpression[168∈14]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression169{{"PgClassExpression[169∈14]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    Connection188{{"Connection[188∈12]<br />ᐸ184ᐳ"}}:::plan
    Access197{{"Access[197∈14]<br />ᐸ166.0ᐳ"}}:::plan
    __Item190[/"__Item[190∈15]<br />ᐸ197ᐳ"\]:::itemplan
    PgSelectSingle191{{"PgSelectSingle[191∈15]<br />ᐸforeignKeyᐳ"}}:::plan
    PgClassExpression192{{"PgClassExpression[192∈16]<br />ᐸ__foreign_...person_id”ᐳ"}}:::plan
    PgClassExpression193{{"PgClassExpression[193∈16]<br />ᐸ__foreign_...und_key_1”ᐳ"}}:::plan
    PgClassExpression194{{"PgClassExpression[194∈16]<br />ᐸ__foreign_...und_key_2”ᐳ"}}:::plan

    %% plan dependencies
    __Value3 --> Access31
    __Value3 --> Access32
    Access31 & Access32 --> Object33
    Object33 & Connection34 & __InputStaticLeaf81 --> PgSelect35
    PgSelect35 ==> __Item36
    __Item36 --> PgSelectSingle37
    PgSelectSingle37 --> PgClassExpression38
    PgSelectSingle37 --> PgClassExpression39
    __InputStaticLeaf41 --> Connection65
    __Item36 --> Access195
    Access195 --> Reverse196
    Reverse196 ==> __Item67
    __Item67 --> PgSelectSingle68
    PgSelectSingle68 --> PgClassExpression69
    PgSelectSingle68 --> PgClassExpression70
    __Item36 --> Access198
    Access198 ==> __Item98
    __Item98 --> PgSelectSingle99
    PgSelectSingle99 --> PgClassExpression100
    PgSelectSingle99 --> PgClassExpression101
    __Item36 --> Access200
    Access200 ==> __Item121
    __Item121 --> PgSelectSingle122
    PgSelectSingle122 --> PgClassExpression123
    PgSelectSingle122 --> PgClassExpression124
    __Item36 --> Access199
    Access199 ==> __Item144
    __Item144 --> PgSelectSingle145
    PgSelectSingle145 --> PgClassExpression146
    PgSelectSingle145 --> PgClassExpression147
    Object33 & Connection164 --> PgSelect165
    PgSelect165 ==> __Item166
    __Item166 --> PgSelectSingle167
    PgSelectSingle167 --> PgClassExpression168
    PgSelectSingle167 --> PgClassExpression169
    __Item166 --> Access197
    Access197 ==> __Item190
    __Item190 --> PgSelectSingle191
    PgSelectSingle191 --> PgClassExpression192
    PgSelectSingle191 --> PgClassExpression193
    PgSelectSingle191 --> PgClassExpression194

    subgraph "Buckets for queries/v4/relation-head-tail"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value3,__Value5,Access31,Access32,Object33,Connection34,Connection164 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 33, 34<br /><br />ROOT Connectionᐸ30ᐳ[34]<br />1:  / __InputStaticLeaf[41],__InputStaticLeaf[81],Connection[96],Connection[119],Connection[142],Connection[65]<br />2: PgSelect[35]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect35,__InputStaticLeaf41,Connection65,__InputStaticLeaf81,Connection96,Connection119,Connection142 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 65, 96, 119, 142<br /><br />ROOT __Item{2}ᐸ35ᐳ[36]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item36,PgSelectSingle37 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 37, 36, 65, 96, 119, 142<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[37]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression38,PgClassExpression39,Access195,Reverse196,Access198,Access199,Access200 bucket3
    Bucket4("Bucket 4 (listItem)<br />ROOT __Item{4}ᐸ196ᐳ[67]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item67,PgSelectSingle68 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 68<br /><br />ROOT PgSelectSingle{4}ᐸpostᐳ[68]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression69,PgClassExpression70 bucket5
    Bucket6("Bucket 6 (listItem)<br />ROOT __Item{6}ᐸ198ᐳ[98]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item98,PgSelectSingle99 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 99<br /><br />ROOT PgSelectSingle{6}ᐸpostᐳ[99]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,PgClassExpression100,PgClassExpression101 bucket7
    Bucket8("Bucket 8 (listItem)<br />ROOT __Item{8}ᐸ200ᐳ[121]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item121,PgSelectSingle122 bucket8
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 122<br /><br />ROOT PgSelectSingle{8}ᐸcompoundKeyᐳ[122]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgClassExpression123,PgClassExpression124 bucket9
    Bucket10("Bucket 10 (listItem)<br />ROOT __Item{10}ᐸ199ᐳ[144]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item144,PgSelectSingle145 bucket10
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 145<br /><br />ROOT PgSelectSingle{10}ᐸcompoundKeyᐳ[145]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgClassExpression146,PgClassExpression147 bucket11
    Bucket12("Bucket 12 (nullableBoundary)<br />Deps: 33, 164<br /><br />ROOT Connectionᐸ160ᐳ[164]"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,PgSelect165,Connection188 bucket12
    Bucket13("Bucket 13 (listItem)<br />Deps: 188<br /><br />ROOT __Item{13}ᐸ165ᐳ[166]"):::bucket
    classDef bucket13 stroke:#3cb371
    class Bucket13,__Item166,PgSelectSingle167 bucket13
    Bucket14("Bucket 14 (nullableBoundary)<br />Deps: 167, 166, 188<br /><br />ROOT PgSelectSingle{13}ᐸcompoundKeyᐳ[167]"):::bucket
    classDef bucket14 stroke:#a52a2a
    class Bucket14,PgClassExpression168,PgClassExpression169,Access197 bucket14
    Bucket15("Bucket 15 (listItem)<br />ROOT __Item{15}ᐸ197ᐳ[190]"):::bucket
    classDef bucket15 stroke:#ff00ff
    class Bucket15,__Item190,PgSelectSingle191 bucket15
    Bucket16("Bucket 16 (nullableBoundary)<br />Deps: 191<br /><br />ROOT PgSelectSingle{15}ᐸforeignKeyᐳ[191]"):::bucket
    classDef bucket16 stroke:#f5deb3
    class Bucket16,PgClassExpression192,PgClassExpression193,PgClassExpression194 bucket16
    Bucket0 --> Bucket1 & Bucket12
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6 & Bucket8 & Bucket10
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    Bucket8 --> Bucket9
    Bucket10 --> Bucket11
    Bucket12 --> Bucket13
    Bucket13 --> Bucket14
    Bucket14 --> Bucket15
    Bucket15 --> Bucket16
    end
