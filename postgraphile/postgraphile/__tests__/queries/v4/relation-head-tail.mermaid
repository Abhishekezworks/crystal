%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object97{{"Object[97∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda89{{"Lambda[89∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Constant94{{"Constant[94∈0] ➊<br />ᐸ[ { codec: Codec(int4), fragment: { n: [Array], f: 0, c: 266ᐳ"}}:::plan
    Constant95{{"Constant[95∈0] ➊<br />ᐸsql.identifier(”post”)ᐳ"}}:::plan
    Constant96{{"Constant[96∈0] ➊<br />ᐸRecordCodec(post)ᐳ"}}:::plan
    Lambda89 & Constant94 & Constant95 & Constant96 --> Object97
    Object112{{"Object[112∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda105{{"Lambda[105∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Constant109{{"Constant[109∈0] ➊<br />ᐸ[ { codec: Codec(int4), fragment: { n: [Array], f: 0, c: 266ᐳ"}}:::plan
    Constant110{{"Constant[110∈0] ➊<br />ᐸsql.identifier(”post”)ᐳ"}}:::plan
    Lambda105 & Constant109 & Constant110 & Constant96 --> Object112
    Object127{{"Object[127∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant124{{"Constant[124∈0] ➊<br />ᐸ[ { codec: Codec(int4), fragment: { n: [Array], f: 0, c: 116ᐳ"}}:::plan
    Constant125{{"Constant[125∈0] ➊<br />ᐸsql.identifier(”compound_key”)ᐳ"}}:::plan
    Constant126{{"Constant[126∈0] ➊<br />ᐸRecordCodec(compoundKey)ᐳ"}}:::plan
    Lambda105 & Constant124 & Constant125 & Constant126 --> Object127
    Object142{{"Object[142∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant139{{"Constant[139∈0] ➊<br />ᐸ[ { codec: Codec(int4), fragment: { n: [Array], f: 0, c: 116ᐳ"}}:::plan
    Constant140{{"Constant[140∈0] ➊<br />ᐸsql.identifier(”compound_key”)ᐳ"}}:::plan
    Lambda105 & Constant139 & Constant140 & Constant126 --> Object142
    Object157{{"Object[157∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant154{{"Constant[154∈0] ➊<br />ᐸ[ { codec: Codec(int4), fragment: { n: [Array], f: 0, c: 266ᐳ"}}:::plan
    Constant155{{"Constant[155∈0] ➊<br />ᐸsql.identifier(”person”)ᐳ"}}:::plan
    Constant156{{"Constant[156∈0] ➊<br />ᐸRecordCodec(person)ᐳ"}}:::plan
    Lambda105 & Constant154 & Constant155 & Constant156 --> Object157
    Object172{{"Object[172∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant169{{"Constant[169∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant170{{"Constant[170∈0] ➊<br />ᐸsql.identifier(”foreign_key”)ᐳ"}}:::plan
    Constant171{{"Constant[171∈0] ➊<br />ᐸRecordCodec(foreignKey)ᐳ"}}:::plan
    Lambda105 & Constant169 & Constant170 & Constant171 --> Object172
    Object187{{"Object[187∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant184{{"Constant[184∈0] ➊<br />ᐸ[ { codec: Codec(int4), fragment: { n: [Array], f: 0, c: 116ᐳ"}}:::plan
    Constant185{{"Constant[185∈0] ➊<br />ᐸsql.identifier(”compound_key”)ᐳ"}}:::plan
    Lambda105 & Constant184 & Constant185 & Constant126 --> Object187
    Object12{{"Object[12∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access10 & Access11 --> Object12
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access10
    __Value2 --> Access11
    Connection26{{"Connection[26∈0] ➊<br />ᐸ22ᐳ"}}:::plan
    Constant194{{"Constant[194∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Constant194 --> Connection26
    Constant205{{"Constant[205∈0] ➊<br />ᐸ§{ first: null, last: 2, cursorLower: null, cursorUpper: nulᐳ"}}:::plan
    Constant205 --> Lambda89
    Lambda92{{"Lambda[92∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant206{{"Constant[206∈0] ➊<br />ᐸ§{ first: null, last: 2, cursorLower: null, cursorUpper: nulᐳ"}}:::plan
    Constant206 --> Lambda92
    Access93{{"Access[93∈0] ➊<br />ᐸ92.0ᐳ"}}:::plan
    Lambda92 --> Access93
    Lambda98{{"Lambda[98∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object97 --> Lambda98
    Lambda103{{"Lambda[103∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant198{{"Constant[198∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: Codec(int4), fragment:ᐳ"}}:::plan
    Constant198 --> Lambda103
    Constant196{{"Constant[196∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant196 --> Lambda105
    Lambda107{{"Lambda[107∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant197{{"Constant[197∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant197 --> Lambda107
    Access108{{"Access[108∈0] ➊<br />ᐸ107.0ᐳ"}}:::plan
    Lambda107 --> Access108
    Lambda113{{"Lambda[113∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object112 --> Lambda113
    Lambda118{{"Lambda[118∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant199{{"Constant[199∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: Codec(int4), fragment:ᐳ"}}:::plan
    Constant199 --> Lambda118
    Lambda128{{"Lambda[128∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object127 --> Lambda128
    Lambda133{{"Lambda[133∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant200{{"Constant[200∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: Codec(int4), fragment:ᐳ"}}:::plan
    Constant200 --> Lambda133
    Lambda143{{"Lambda[143∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object142 --> Lambda143
    Lambda148{{"Lambda[148∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant201{{"Constant[201∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: Codec(int4), fragment:ᐳ"}}:::plan
    Constant201 --> Lambda148
    Lambda158{{"Lambda[158∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object157 --> Lambda158
    Lambda163{{"Lambda[163∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant202{{"Constant[202∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: Codec(int4), fragment:ᐳ"}}:::plan
    Constant202 --> Lambda163
    Lambda173{{"Lambda[173∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object172 --> Lambda173
    Lambda178{{"Lambda[178∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant203{{"Constant[203∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”foreigᐳ"}}:::plan
    Constant203 --> Lambda178
    Lambda188{{"Lambda[188∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object187 --> Lambda188
    Lambda193{{"Lambda[193∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant204{{"Constant[204∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { codec: Codec(int4), fragment:ᐳ"}}:::plan
    Constant204 --> Lambda193
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection13{{"Connection[13∈0] ➊<br />ᐸ9ᐳ"}}:::plan
    Connection38{{"Connection[38∈0] ➊<br />ᐸ36ᐳ"}}:::plan
    Connection48{{"Connection[48∈0] ➊<br />ᐸ46ᐳ"}}:::plan
    Connection58{{"Connection[58∈0] ➊<br />ᐸ56ᐳ"}}:::plan
    Connection68{{"Connection[68∈0] ➊<br />ᐸ66ᐳ"}}:::plan
    Connection80{{"Connection[80∈0] ➊<br />ᐸ76ᐳ"}}:::plan
    Constant195{{"Constant[195∈0] ➊<br />ᐸ'Large bet on myself in round one.'ᐳ"}}:::plan
    PgSelect14[["PgSelect[14∈1] ➊<br />ᐸpersonᐳ"]]:::plan
    Object12 & Connection13 & Lambda105 & Access108 & Lambda158 & Lambda163 --> PgSelect14
    __Item15[/"__Item[15∈2]<br />ᐸ14ᐳ"\]:::itemplan
    PgSelect14 ==> __Item15
    PgSelectSingle16{{"PgSelectSingle[16∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item15 --> PgSelectSingle16
    PgSelect27[["PgSelect[27∈3]<br />ᐸpostᐳ"]]:::plan
    PgClassExpression17{{"PgClassExpression[17∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Object12 & PgClassExpression17 & Connection26 & Constant194 & Lambda89 & Access93 & Lambda98 & Lambda103 --> PgSelect27
    PgSelect39[["PgSelect[39∈3]<br />ᐸpostᐳ"]]:::plan
    Object12 & PgClassExpression17 & Constant195 & Connection38 & Lambda105 & Access108 & Lambda113 & Lambda118 --> PgSelect39
    PgSelect49[["PgSelect[49∈3]<br />ᐸcompound_keyᐳ"]]:::plan
    Object12 & PgClassExpression17 & Connection48 & Lambda105 & Access108 & Lambda128 & Lambda133 --> PgSelect49
    PgSelect59[["PgSelect[59∈3]<br />ᐸcompound_keyᐳ"]]:::plan
    Object12 & PgClassExpression17 & Connection58 & Lambda105 & Access108 & Lambda143 & Lambda148 --> PgSelect59
    PgSelectSingle16 --> PgClassExpression17
    PgClassExpression18{{"PgClassExpression[18∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle16 --> PgClassExpression18
    __Item28[/"__Item[28∈4]<br />ᐸ27ᐳ"\]:::itemplan
    PgSelect27 ==> __Item28
    PgSelectSingle29{{"PgSelectSingle[29∈4]<br />ᐸpostᐳ"}}:::plan
    __Item28 --> PgSelectSingle29
    PgClassExpression30{{"PgClassExpression[30∈5]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression30
    PgClassExpression31{{"PgClassExpression[31∈5]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression31
    __Item40[/"__Item[40∈6]<br />ᐸ39ᐳ"\]:::itemplan
    PgSelect39 ==> __Item40
    PgSelectSingle41{{"PgSelectSingle[41∈6]<br />ᐸpostᐳ"}}:::plan
    __Item40 --> PgSelectSingle41
    PgClassExpression42{{"PgClassExpression[42∈7]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression42
    PgClassExpression43{{"PgClassExpression[43∈7]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression43
    __Item50[/"__Item[50∈8]<br />ᐸ49ᐳ"\]:::itemplan
    PgSelect49 ==> __Item50
    PgSelectSingle51{{"PgSelectSingle[51∈8]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item50 --> PgSelectSingle51
    PgClassExpression52{{"PgClassExpression[52∈9]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression52
    PgClassExpression53{{"PgClassExpression[53∈9]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression53
    __Item60[/"__Item[60∈10]<br />ᐸ59ᐳ"\]:::itemplan
    PgSelect59 ==> __Item60
    PgSelectSingle61{{"PgSelectSingle[61∈10]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item60 --> PgSelectSingle61
    PgClassExpression62{{"PgClassExpression[62∈11]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle61 --> PgClassExpression62
    PgClassExpression63{{"PgClassExpression[63∈11]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle61 --> PgClassExpression63
    PgSelect69[["PgSelect[69∈12] ➊<br />ᐸcompound_keyᐳ"]]:::plan
    Object12 & Connection68 & Lambda105 & Access108 & Lambda188 & Lambda193 --> PgSelect69
    __Item70[/"__Item[70∈13]<br />ᐸ69ᐳ"\]:::itemplan
    PgSelect69 ==> __Item70
    PgSelectSingle71{{"PgSelectSingle[71∈13]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item70 --> PgSelectSingle71
    PgSelect81[["PgSelect[81∈14]<br />ᐸforeign_keyᐳ"]]:::plan
    PgClassExpression72{{"PgClassExpression[72∈14]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression73{{"PgClassExpression[73∈14]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    Object12 & PgClassExpression72 & PgClassExpression73 & Connection80 & Lambda105 & Access108 & Lambda173 & Lambda178 --> PgSelect81
    PgSelectSingle71 --> PgClassExpression72
    PgSelectSingle71 --> PgClassExpression73
    __Item82[/"__Item[82∈15]<br />ᐸ81ᐳ"\]:::itemplan
    PgSelect81 ==> __Item82
    PgSelectSingle83{{"PgSelectSingle[83∈15]<br />ᐸforeign_keyᐳ"}}:::plan
    __Item82 --> PgSelectSingle83
    PgClassExpression84{{"PgClassExpression[84∈16]<br />ᐸ__foreign_...person_id”ᐳ"}}:::plan
    PgSelectSingle83 --> PgClassExpression84
    PgClassExpression85{{"PgClassExpression[85∈16]<br />ᐸ__foreign_...und_key_1”ᐳ"}}:::plan
    PgSelectSingle83 --> PgClassExpression85
    PgClassExpression86{{"PgClassExpression[86∈16]<br />ᐸ__foreign_...und_key_2”ᐳ"}}:::plan
    PgSelectSingle83 --> PgClassExpression86

    %% define steps

    subgraph "Buckets for queries/v4/relation-head-tail"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access10,Access11,Object12,Connection13,Connection26,Connection38,Connection48,Connection58,Connection68,Connection80,Lambda89,Lambda92,Access93,Constant94,Constant95,Constant96,Object97,Lambda98,Lambda103,Lambda105,Lambda107,Access108,Constant109,Constant110,Object112,Lambda113,Lambda118,Constant124,Constant125,Constant126,Object127,Lambda128,Lambda133,Constant139,Constant140,Object142,Lambda143,Lambda148,Constant154,Constant155,Constant156,Object157,Lambda158,Lambda163,Constant169,Constant170,Constant171,Object172,Lambda173,Lambda178,Constant184,Constant185,Object187,Lambda188,Lambda193,Constant194,Constant195,Constant196,Constant197,Constant198,Constant199,Constant200,Constant201,Constant202,Constant203,Constant204,Constant205,Constant206 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 12, 13, 105, 108, 158, 163, 26, 194, 89, 93, 98, 103, 195, 38, 113, 118, 48, 128, 133, 58, 143, 148<br /><br />ROOT Connectionᐸ9ᐳ[13]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect14 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 12, 26, 194, 89, 93, 98, 103, 195, 38, 105, 108, 113, 118, 48, 128, 133, 58, 143, 148<br /><br />ROOT __Item{2}ᐸ14ᐳ[15]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item15,PgSelectSingle16 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 16, 12, 26, 194, 89, 93, 98, 103, 195, 38, 105, 108, 113, 118, 48, 128, 133, 58, 143, 148<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[16]<br />1: <br />ᐳ: 17, 18<br />2: 27, 39, 49, 59"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression17,PgClassExpression18,PgSelect27,PgSelect39,PgSelect49,PgSelect59 bucket3
    Bucket4("Bucket 4 (listItem)<br /><br />ROOT __Item{4}ᐸ27ᐳ[28]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item28,PgSelectSingle29 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 29<br /><br />ROOT PgSelectSingle{4}ᐸpostᐳ[29]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression30,PgClassExpression31 bucket5
    Bucket6("Bucket 6 (listItem)<br /><br />ROOT __Item{6}ᐸ39ᐳ[40]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item40,PgSelectSingle41 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 41<br /><br />ROOT PgSelectSingle{6}ᐸpostᐳ[41]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,PgClassExpression42,PgClassExpression43 bucket7
    Bucket8("Bucket 8 (listItem)<br /><br />ROOT __Item{8}ᐸ49ᐳ[50]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item50,PgSelectSingle51 bucket8
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 51<br /><br />ROOT PgSelectSingle{8}ᐸcompound_keyᐳ[51]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgClassExpression52,PgClassExpression53 bucket9
    Bucket10("Bucket 10 (listItem)<br /><br />ROOT __Item{10}ᐸ59ᐳ[60]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item60,PgSelectSingle61 bucket10
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 61<br /><br />ROOT PgSelectSingle{10}ᐸcompound_keyᐳ[61]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgClassExpression62,PgClassExpression63 bucket11
    Bucket12("Bucket 12 (nullableBoundary)<br />Deps: 12, 68, 105, 108, 188, 193, 80, 173, 178<br /><br />ROOT Connectionᐸ66ᐳ[68]"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,PgSelect69 bucket12
    Bucket13("Bucket 13 (listItem)<br />Deps: 12, 80, 105, 108, 173, 178<br /><br />ROOT __Item{13}ᐸ69ᐳ[70]"):::bucket
    classDef bucket13 stroke:#3cb371
    class Bucket13,__Item70,PgSelectSingle71 bucket13
    Bucket14("Bucket 14 (nullableBoundary)<br />Deps: 71, 12, 80, 105, 108, 173, 178<br /><br />ROOT PgSelectSingle{13}ᐸcompound_keyᐳ[71]<br />1: <br />ᐳ: 72, 73<br />2: PgSelect[81]"):::bucket
    classDef bucket14 stroke:#a52a2a
    class Bucket14,PgClassExpression72,PgClassExpression73,PgSelect81 bucket14
    Bucket15("Bucket 15 (listItem)<br /><br />ROOT __Item{15}ᐸ81ᐳ[82]"):::bucket
    classDef bucket15 stroke:#ff00ff
    class Bucket15,__Item82,PgSelectSingle83 bucket15
    Bucket16("Bucket 16 (nullableBoundary)<br />Deps: 83<br /><br />ROOT PgSelectSingle{15}ᐸforeign_keyᐳ[83]"):::bucket
    classDef bucket16 stroke:#f5deb3
    class Bucket16,PgClassExpression84,PgClassExpression85,PgClassExpression86 bucket16
    Bucket0 --> Bucket1 & Bucket12
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6 & Bucket8 & Bucket10
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    Bucket8 --> Bucket9
    Bucket10 --> Bucket11
    Bucket12 --> Bucket13
    Bucket13 --> Bucket14
    Bucket14 --> Bucket15
    Bucket15 --> Bucket16
    end
