%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access9 & Access10 --> Object11
    __InputObject37{{"__InputObject[37∈0] ➊"}}:::plan
    Constant116{{"Constant[116∈0] ➊<br />ᐸ'Large bet on myself in round one.'ᐳ"}}:::plan
    Constant116 --> __InputObject37
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access9
    __Value2 --> Access10
    Connection35{{"Connection[35∈0] ➊<br />ᐸ31ᐳ"}}:::plan
    Constant115{{"Constant[115∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Constant115 --> Connection35
    ApplyInput43{{"ApplyInput[43∈0] ➊"}}:::plan
    __InputObject37 --> ApplyInput43
    PgSelectInlineApply95["PgSelectInlineApply[95∈0] ➊"]:::plan
    Constant115 --> PgSelectInlineApply95
    PgSelectInlineApply99["PgSelectInlineApply[99∈0] ➊"]:::plan
    ApplyInput43 --> PgSelectInlineApply99
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection12{{"Connection[12∈0] ➊<br />ᐸ8ᐳ"}}:::plan
    Connection17{{"Connection[17∈0] ➊<br />ᐸ15ᐳ"}}:::plan
    Connection42{{"Connection[42∈0] ➊<br />ᐸ40ᐳ"}}:::plan
    Connection48{{"Connection[48∈0] ➊<br />ᐸ46ᐳ"}}:::plan
    Connection53{{"Connection[53∈0] ➊<br />ᐸ51ᐳ"}}:::plan
    Connection62{{"Connection[62∈0] ➊<br />ᐸ58ᐳ"}}:::plan
    PgSelectInlineApply103["PgSelectInlineApply[103∈0] ➊"]:::plan
    PgSelectInlineApply107["PgSelectInlineApply[107∈0] ➊"]:::plan
    PgSelectInlineApply111["PgSelectInlineApply[111∈0] ➊"]:::plan
    PgSelect19[["PgSelect[19∈1] ➊<br />ᐸpersonᐳ"]]:::plan
    Object11 & Connection12 & PgSelectInlineApply95 & PgSelectInlineApply99 & PgSelectInlineApply103 & PgSelectInlineApply107 --> PgSelect19
    PgSelectRows20[["PgSelectRows[20∈1] ➊"]]:::plan
    PgSelect19 --> PgSelectRows20
    Access96{{"Access[96∈1] ➊<br />ᐸ19.m.subqueryDetailsFor64ᐳ"}}:::plan
    PgSelect19 --> Access96
    Access100{{"Access[100∈1] ➊<br />ᐸ19.m.subqueryDetailsFor68ᐳ"}}:::plan
    PgSelect19 --> Access100
    Access104{{"Access[104∈1] ➊<br />ᐸ19.m.subqueryDetailsFor72ᐳ"}}:::plan
    PgSelect19 --> Access104
    Access108{{"Access[108∈1] ➊<br />ᐸ19.m.subqueryDetailsFor76ᐳ"}}:::plan
    PgSelect19 --> Access108
    __Item21[/"__Item[21∈3]<br />ᐸ20ᐳ"\]:::itemplan
    PgSelectRows20 ==> __Item21
    PgSelectSingle22{{"PgSelectSingle[22∈3]<br />ᐸpersonᐳ"}}:::plan
    __Item21 --> PgSelectSingle22
    List97{{"List[97∈4]<br />ᐸ96,21ᐳ"}}:::plan
    Access96 & __Item21 --> List97
    List101{{"List[101∈4]<br />ᐸ100,21ᐳ"}}:::plan
    Access100 & __Item21 --> List101
    List105{{"List[105∈4]<br />ᐸ104,21ᐳ"}}:::plan
    Access104 & __Item21 --> List105
    List109{{"List[109∈4]<br />ᐸ108,21ᐳ"}}:::plan
    Access108 & __Item21 --> List109
    PgClassExpression27{{"PgClassExpression[27∈4]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle22 --> PgClassExpression27
    PgClassExpression28{{"PgClassExpression[28∈4]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle22 --> PgClassExpression28
    PgSelectRows65[["PgSelectRows[65∈4]"]]:::plan
    Lambda98{{"Lambda[98∈4]<br />ᐸpgInlineViaSubqueryTransformᐳ"}}:::plan
    Lambda98 --> PgSelectRows65
    PgSelectRows69[["PgSelectRows[69∈4]"]]:::plan
    Lambda102{{"Lambda[102∈4]<br />ᐸpgInlineViaSubqueryTransformᐳ"}}:::plan
    Lambda102 --> PgSelectRows69
    PgSelectRows73[["PgSelectRows[73∈4]"]]:::plan
    Lambda106{{"Lambda[106∈4]<br />ᐸpgInlineViaSubqueryTransformᐳ"}}:::plan
    Lambda106 --> PgSelectRows73
    PgSelectRows77[["PgSelectRows[77∈4]"]]:::plan
    Lambda110{{"Lambda[110∈4]<br />ᐸpgInlineViaSubqueryTransformᐳ"}}:::plan
    Lambda110 --> PgSelectRows77
    List97 --> Lambda98
    List101 --> Lambda102
    List105 --> Lambda106
    List109 --> Lambda110
    __Item66[/"__Item[66∈7]<br />ᐸ65ᐳ"\]:::itemplan
    PgSelectRows65 ==> __Item66
    PgSelectSingle67{{"PgSelectSingle[67∈7]<br />ᐸpostᐳ"}}:::plan
    __Item66 --> PgSelectSingle67
    PgClassExpression84{{"PgClassExpression[84∈8]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle67 --> PgClassExpression84
    PgClassExpression85{{"PgClassExpression[85∈8]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle67 --> PgClassExpression85
    __Item70[/"__Item[70∈9]<br />ᐸ69ᐳ"\]:::itemplan
    PgSelectRows69 ==> __Item70
    PgSelectSingle71{{"PgSelectSingle[71∈9]<br />ᐸpostᐳ"}}:::plan
    __Item70 --> PgSelectSingle71
    PgClassExpression86{{"PgClassExpression[86∈10]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle71 --> PgClassExpression86
    PgClassExpression87{{"PgClassExpression[87∈10]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle71 --> PgClassExpression87
    __Item74[/"__Item[74∈11]<br />ᐸ73ᐳ"\]:::itemplan
    PgSelectRows73 ==> __Item74
    PgSelectSingle75{{"PgSelectSingle[75∈11]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item74 --> PgSelectSingle75
    PgClassExpression88{{"PgClassExpression[88∈12]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle75 --> PgClassExpression88
    PgClassExpression89{{"PgClassExpression[89∈12]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle75 --> PgClassExpression89
    __Item78[/"__Item[78∈13]<br />ᐸ77ᐳ"\]:::itemplan
    PgSelectRows77 ==> __Item78
    PgSelectSingle79{{"PgSelectSingle[79∈13]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item78 --> PgSelectSingle79
    PgClassExpression90{{"PgClassExpression[90∈14]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle79 --> PgClassExpression90
    PgClassExpression91{{"PgClassExpression[91∈14]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle79 --> PgClassExpression91
    PgSelect23[["PgSelect[23∈2] ➊<br />ᐸcompound_keyᐳ"]]:::plan
    Object11 & Connection17 & PgSelectInlineApply111 --> PgSelect23
    PgSelectRows24[["PgSelectRows[24∈2] ➊"]]:::plan
    PgSelect23 --> PgSelectRows24
    Access112{{"Access[112∈2] ➊<br />ᐸ23.m.subqueryDetailsFor80ᐳ"}}:::plan
    PgSelect23 --> Access112
    __Item25[/"__Item[25∈5]<br />ᐸ24ᐳ"\]:::itemplan
    PgSelectRows24 ==> __Item25
    PgSelectSingle26{{"PgSelectSingle[26∈5]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item25 --> PgSelectSingle26
    List113{{"List[113∈6]<br />ᐸ112,25ᐳ"}}:::plan
    Access112 & __Item25 --> List113
    PgClassExpression55{{"PgClassExpression[55∈6]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle26 --> PgClassExpression55
    PgClassExpression56{{"PgClassExpression[56∈6]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle26 --> PgClassExpression56
    PgSelectRows81[["PgSelectRows[81∈6]"]]:::plan
    Lambda114{{"Lambda[114∈6]<br />ᐸpgInlineViaSubqueryTransformᐳ"}}:::plan
    Lambda114 --> PgSelectRows81
    List113 --> Lambda114
    __Item82[/"__Item[82∈15]<br />ᐸ81ᐳ"\]:::itemplan
    PgSelectRows81 ==> __Item82
    PgSelectSingle83{{"PgSelectSingle[83∈15]<br />ᐸforeign_keyᐳ"}}:::plan
    __Item82 --> PgSelectSingle83
    PgClassExpression92{{"PgClassExpression[92∈16]<br />ᐸ__foreign_...person_id”ᐳ"}}:::plan
    PgSelectSingle83 --> PgClassExpression92
    PgClassExpression93{{"PgClassExpression[93∈16]<br />ᐸ__foreign_...und_key_1”ᐳ"}}:::plan
    PgSelectSingle83 --> PgClassExpression93
    PgClassExpression94{{"PgClassExpression[94∈16]<br />ᐸ__foreign_...und_key_2”ᐳ"}}:::plan
    PgSelectSingle83 --> PgClassExpression94

    %% define steps

    subgraph "Buckets for queries/v4/relation-head-tail"
    Bucket0("Bucket 0 (root)<br /><br />1: 103, 107, 111<br />ᐳ: 6, 9, 10, 12, 17, 42, 48, 53, 62, 115, 116, 11, 35, 37, 43<br />2: 95, 99"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access9,Access10,Object11,Connection12,Connection17,Connection35,__InputObject37,Connection42,ApplyInput43,Connection48,Connection53,Connection62,PgSelectInlineApply95,PgSelectInlineApply99,PgSelectInlineApply103,PgSelectInlineApply107,PgSelectInlineApply111,Constant115,Constant116 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 11, 12, 95, 99, 103, 107, 35, 42, 48, 53<br /><br />ROOT Connectionᐸ8ᐳ[12]<br />1: PgSelect[19]<br />ᐳ: 96, 100, 104, 108<br />2: PgSelectRows[20]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect19,PgSelectRows20,Access96,Access100,Access104,Access108 bucket1
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 11, 17, 111, 62<br /><br />ROOT Connectionᐸ15ᐳ[17]<br />1: PgSelect[23]<br />ᐳ: Access[112]<br />2: PgSelectRows[24]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgSelect23,PgSelectRows24,Access112 bucket2
    Bucket3("Bucket 3 (listItem)<br />Deps: 96, 100, 104, 108, 35, 42, 48, 53<br /><br />ROOT __Item{3}ᐸ20ᐳ[21]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item21,PgSelectSingle22 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 22, 96, 21, 100, 104, 108, 35, 42, 48, 53<br /><br />ROOT PgSelectSingle{3}ᐸpersonᐳ[22]<br />1: <br />ᐳ: 27, 28, 97, 101, 105, 109, 98, 102, 106, 110<br />2: 65, 69, 73, 77"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression27,PgClassExpression28,PgSelectRows65,PgSelectRows69,PgSelectRows73,PgSelectRows77,List97,Lambda98,List101,Lambda102,List105,Lambda106,List109,Lambda110 bucket4
    Bucket5("Bucket 5 (listItem)<br />Deps: 112, 62<br /><br />ROOT __Item{5}ᐸ24ᐳ[25]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item25,PgSelectSingle26 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 26, 112, 25, 62<br /><br />ROOT PgSelectSingle{5}ᐸcompound_keyᐳ[26]<br />1: <br />ᐳ: 55, 56, 113, 114<br />2: PgSelectRows[81]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgClassExpression55,PgClassExpression56,PgSelectRows81,List113,Lambda114 bucket6
    Bucket7("Bucket 7 (listItem)<br /><br />ROOT __Item{7}ᐸ65ᐳ[66]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item66,PgSelectSingle67 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 67<br /><br />ROOT PgSelectSingle{7}ᐸpostᐳ[67]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgClassExpression84,PgClassExpression85 bucket8
    Bucket9("Bucket 9 (listItem)<br /><br />ROOT __Item{9}ᐸ69ᐳ[70]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,__Item70,PgSelectSingle71 bucket9
    Bucket10("Bucket 10 (nullableBoundary)<br />Deps: 71<br /><br />ROOT PgSelectSingle{9}ᐸpostᐳ[71]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,PgClassExpression86,PgClassExpression87 bucket10
    Bucket11("Bucket 11 (listItem)<br /><br />ROOT __Item{11}ᐸ73ᐳ[74]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,__Item74,PgSelectSingle75 bucket11
    Bucket12("Bucket 12 (nullableBoundary)<br />Deps: 75<br /><br />ROOT PgSelectSingle{11}ᐸcompound_keyᐳ[75]"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,PgClassExpression88,PgClassExpression89 bucket12
    Bucket13("Bucket 13 (listItem)<br /><br />ROOT __Item{13}ᐸ77ᐳ[78]"):::bucket
    classDef bucket13 stroke:#3cb371
    class Bucket13,__Item78,PgSelectSingle79 bucket13
    Bucket14("Bucket 14 (nullableBoundary)<br />Deps: 79<br /><br />ROOT PgSelectSingle{13}ᐸcompound_keyᐳ[79]"):::bucket
    classDef bucket14 stroke:#a52a2a
    class Bucket14,PgClassExpression90,PgClassExpression91 bucket14
    Bucket15("Bucket 15 (listItem)<br /><br />ROOT __Item{15}ᐸ81ᐳ[82]"):::bucket
    classDef bucket15 stroke:#ff00ff
    class Bucket15,__Item82,PgSelectSingle83 bucket15
    Bucket16("Bucket 16 (nullableBoundary)<br />Deps: 83<br /><br />ROOT PgSelectSingle{15}ᐸforeign_keyᐳ[83]"):::bucket
    classDef bucket16 stroke:#f5deb3
    class Bucket16,PgClassExpression92,PgClassExpression93,PgClassExpression94 bucket16
    Bucket0 --> Bucket1 & Bucket2
    Bucket1 --> Bucket3
    Bucket2 --> Bucket5
    Bucket3 --> Bucket4
    Bucket4 --> Bucket7 & Bucket9 & Bucket11 & Bucket13
    Bucket5 --> Bucket6
    Bucket6 --> Bucket15
    Bucket7 --> Bucket8
    Bucket9 --> Bucket10
    Bucket11 --> Bucket12
    Bucket13 --> Bucket14
    Bucket15 --> Bucket16
    end
