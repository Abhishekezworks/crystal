%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object18{{"Object[18∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access16{{"Access[16∈0]<br />ᐸ3.pgSettingsᐳ"}}:::plan
    Access17{{"Access[17∈0]<br />ᐸ3.withPgClientᐳ"}}:::plan
    Access16 & Access17 --> Object18
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value3 --> Access16
    __Value3 --> Access17
    __Value0["__Value[0∈0]"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    Connection19{{"Connection[19∈0]<br />ᐸ15ᐳ"}}:::plan
    Connection120{{"Connection[120∈0]<br />ᐸ116ᐳ"}}:::plan
    PgSelect121[["PgSelect[121∈12]<br />ᐸcompound_keyᐳ"]]:::plan
    Object18 & Connection120 --> PgSelect121
    Connection140{{"Connection[140∈12]<br />ᐸ136ᐳ"}}:::plan
    PgSelect20[["PgSelect[20∈1]<br />ᐸpersonᐳ"]]:::plan
    Constant154{{"Constant[154∈1]<br />ᐸ'Large bet on myself in round one.'ᐳ"}}:::plan
    Object18 & Connection19 & Constant154 --> PgSelect20
    Connection38{{"Connection[38∈1]<br />ᐸ34ᐳ"}}:::plan
    Constant153{{"Constant[153∈1]<br />ᐸ2ᐳ"}}:::plan
    Constant153 --> Connection38
    Connection64{{"Connection[64∈1]<br />ᐸ60ᐳ"}}:::plan
    Connection83{{"Connection[83∈1]<br />ᐸ79ᐳ"}}:::plan
    Connection102{{"Connection[102∈1]<br />ᐸ98ᐳ"}}:::plan
    __Item21[/"__Item[21∈2]<br />ᐸ20ᐳ"\]:::itemplan
    PgSelect20 ==> __Item21
    PgSelectSingle22{{"PgSelectSingle[22∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item21 --> PgSelectSingle22
    __Item122[/"__Item[122∈13]<br />ᐸ121ᐳ"\]:::itemplan
    PgSelect121 ==> __Item122
    PgSelectSingle123{{"PgSelectSingle[123∈13]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item122 --> PgSelectSingle123
    PgClassExpression23{{"PgClassExpression[23∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle22 --> PgClassExpression23
    PgClassExpression24{{"PgClassExpression[24∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle22 --> PgClassExpression24
    Access147{{"Access[147∈3]<br />ᐸ21.0ᐳ"}}:::plan
    __Item21 --> Access147
    Reverse148{{"Reverse[148∈3]"}}:::plan
    Access147 --> Reverse148
    Access149{{"Access[149∈3]<br />ᐸ21.1ᐳ"}}:::plan
    __Item21 --> Access149
    Access150{{"Access[150∈3]<br />ᐸ21.2ᐳ"}}:::plan
    __Item21 --> Access150
    Access151{{"Access[151∈3]<br />ᐸ21.3ᐳ"}}:::plan
    __Item21 --> Access151
    PgClassExpression124{{"PgClassExpression[124∈14]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle123 --> PgClassExpression124
    PgClassExpression125{{"PgClassExpression[125∈14]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle123 --> PgClassExpression125
    Access152{{"Access[152∈14]<br />ᐸ122.0ᐳ"}}:::plan
    __Item122 --> Access152
    __Item104[/"__Item[104∈10]<br />ᐸ151ᐳ"\]:::itemplan
    Access151 ==> __Item104
    PgSelectSingle105{{"PgSelectSingle[105∈10]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item104 --> PgSelectSingle105
    __Item85[/"__Item[85∈8]<br />ᐸ150ᐳ"\]:::itemplan
    Access150 ==> __Item85
    PgSelectSingle86{{"PgSelectSingle[86∈8]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item85 --> PgSelectSingle86
    __Item66[/"__Item[66∈6]<br />ᐸ149ᐳ"\]:::itemplan
    Access149 ==> __Item66
    PgSelectSingle67{{"PgSelectSingle[67∈6]<br />ᐸpostᐳ"}}:::plan
    __Item66 --> PgSelectSingle67
    __Item40[/"__Item[40∈4]<br />ᐸ148ᐳ"\]:::itemplan
    Reverse148 ==> __Item40
    PgSelectSingle41{{"PgSelectSingle[41∈4]<br />ᐸpostᐳ"}}:::plan
    __Item40 --> PgSelectSingle41
    __Item142[/"__Item[142∈15]<br />ᐸ152ᐳ"\]:::itemplan
    Access152 ==> __Item142
    PgSelectSingle143{{"PgSelectSingle[143∈15]<br />ᐸforeign_keyᐳ"}}:::plan
    __Item142 --> PgSelectSingle143
    PgClassExpression42{{"PgClassExpression[42∈5]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression42
    PgClassExpression43{{"PgClassExpression[43∈5]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression43
    PgClassExpression68{{"PgClassExpression[68∈7]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle67 --> PgClassExpression68
    PgClassExpression69{{"PgClassExpression[69∈7]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle67 --> PgClassExpression69
    PgClassExpression87{{"PgClassExpression[87∈9]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle86 --> PgClassExpression87
    PgClassExpression88{{"PgClassExpression[88∈9]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle86 --> PgClassExpression88
    PgClassExpression106{{"PgClassExpression[106∈11]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle105 --> PgClassExpression106
    PgClassExpression107{{"PgClassExpression[107∈11]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle105 --> PgClassExpression107
    PgClassExpression144{{"PgClassExpression[144∈16]<br />ᐸ__foreign_...person_id”ᐳ"}}:::plan
    PgSelectSingle143 --> PgClassExpression144
    PgClassExpression145{{"PgClassExpression[145∈16]<br />ᐸ__foreign_...und_key_1”ᐳ"}}:::plan
    PgSelectSingle143 --> PgClassExpression145
    PgClassExpression146{{"PgClassExpression[146∈16]<br />ᐸ__foreign_...und_key_2”ᐳ"}}:::plan
    PgSelectSingle143 --> PgClassExpression146

    %% define steps

    subgraph "Buckets for queries/v4/relation-head-tail"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value3,__Value5,Access16,Access17,Object18,Connection19,Connection120 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 18, 19<br /><br />ROOT Connectionᐸ15ᐳ[19]<br />1: <br />ᐳ: 64, 83, 102, 153, 154, 38<br />2: PgSelect[20]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect20,Connection38,Connection64,Connection83,Connection102,Constant153,Constant154 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 38, 64, 83, 102<br /><br />ROOT __Item{2}ᐸ20ᐳ[21]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item21,PgSelectSingle22 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 22, 21, 38, 64, 83, 102<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[22]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression23,PgClassExpression24,Access147,Reverse148,Access149,Access150,Access151 bucket3
    Bucket4("Bucket 4 (listItem)<br />ROOT __Item{4}ᐸ148ᐳ[40]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item40,PgSelectSingle41 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 41<br /><br />ROOT PgSelectSingle{4}ᐸpostᐳ[41]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression42,PgClassExpression43 bucket5
    Bucket6("Bucket 6 (listItem)<br />ROOT __Item{6}ᐸ149ᐳ[66]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item66,PgSelectSingle67 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 67<br /><br />ROOT PgSelectSingle{6}ᐸpostᐳ[67]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,PgClassExpression68,PgClassExpression69 bucket7
    Bucket8("Bucket 8 (listItem)<br />ROOT __Item{8}ᐸ150ᐳ[85]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item85,PgSelectSingle86 bucket8
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 86<br /><br />ROOT PgSelectSingle{8}ᐸcompound_keyᐳ[86]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgClassExpression87,PgClassExpression88 bucket9
    Bucket10("Bucket 10 (listItem)<br />ROOT __Item{10}ᐸ151ᐳ[104]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item104,PgSelectSingle105 bucket10
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 105<br /><br />ROOT PgSelectSingle{10}ᐸcompound_keyᐳ[105]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgClassExpression106,PgClassExpression107 bucket11
    Bucket12("Bucket 12 (nullableBoundary)<br />Deps: 18, 120<br /><br />ROOT Connectionᐸ116ᐳ[120]"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,PgSelect121,Connection140 bucket12
    Bucket13("Bucket 13 (listItem)<br />Deps: 140<br /><br />ROOT __Item{13}ᐸ121ᐳ[122]"):::bucket
    classDef bucket13 stroke:#3cb371
    class Bucket13,__Item122,PgSelectSingle123 bucket13
    Bucket14("Bucket 14 (nullableBoundary)<br />Deps: 123, 122, 140<br /><br />ROOT PgSelectSingle{13}ᐸcompound_keyᐳ[123]"):::bucket
    classDef bucket14 stroke:#a52a2a
    class Bucket14,PgClassExpression124,PgClassExpression125,Access152 bucket14
    Bucket15("Bucket 15 (listItem)<br />ROOT __Item{15}ᐸ152ᐳ[142]"):::bucket
    classDef bucket15 stroke:#ff00ff
    class Bucket15,__Item142,PgSelectSingle143 bucket15
    Bucket16("Bucket 16 (nullableBoundary)<br />Deps: 143<br /><br />ROOT PgSelectSingle{15}ᐸforeign_keyᐳ[143]"):::bucket
    classDef bucket16 stroke:#f5deb3
    class Bucket16,PgClassExpression144,PgClassExpression145,PgClassExpression146 bucket16
    Bucket0 --> Bucket1 & Bucket12
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6 & Bucket8 & Bucket10
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    Bucket8 --> Bucket9
    Bucket10 --> Bucket11
    Bucket12 --> Bucket13
    Bucket13 --> Bucket14
    Bucket14 --> Bucket15
    Bucket15 --> Bucket16
    end
