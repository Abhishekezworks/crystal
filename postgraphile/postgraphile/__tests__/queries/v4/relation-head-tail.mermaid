%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object17{{"Object[17∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access15{{"Access[15∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access15 & Access16 --> Object17
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access15
    __Value2 --> Access16
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection18{{"Connection[18∈0] ➊<br />ᐸ14ᐳ"}}:::plan
    Connection119{{"Connection[119∈0] ➊<br />ᐸ115ᐳ"}}:::plan
    PgSelect19[["PgSelect[19∈1] ➊<br />ᐸpersonᐳ"]]:::plan
    Constant153{{"Constant[153∈1] ➊<br />ᐸ'Large bet on myself in round one.'ᐳ"}}:::plan
    Object17 & Connection18 & Constant153 --> PgSelect19
    Connection37{{"Connection[37∈1] ➊<br />ᐸ33ᐳ"}}:::plan
    Constant152{{"Constant[152∈1] ➊<br />ᐸ2ᐳ"}}:::plan
    Constant152 --> Connection37
    Connection63{{"Connection[63∈1] ➊<br />ᐸ59ᐳ"}}:::plan
    Connection82{{"Connection[82∈1] ➊<br />ᐸ78ᐳ"}}:::plan
    Connection101{{"Connection[101∈1] ➊<br />ᐸ97ᐳ"}}:::plan
    __Item20[/"__Item[20∈2]<br />ᐸ19ᐳ"\]:::itemplan
    PgSelect19 ==> __Item20
    PgSelectSingle21{{"PgSelectSingle[21∈2]<br />ᐸpersonᐳ"}}:::plan
    __Item20 --> PgSelectSingle21
    PgClassExpression22{{"PgClassExpression[22∈3]<br />ᐸ__person__.”id”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression22
    PgClassExpression23{{"PgClassExpression[23∈3]<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression23
    Access146{{"Access[146∈3]<br />ᐸ20.0ᐳ"}}:::plan
    __Item20 --> Access146
    Reverse147{{"Reverse[147∈3]"}}:::plan
    Access146 --> Reverse147
    Access148{{"Access[148∈3]<br />ᐸ20.1ᐳ"}}:::plan
    __Item20 --> Access148
    Access149{{"Access[149∈3]<br />ᐸ20.2ᐳ"}}:::plan
    __Item20 --> Access149
    Access150{{"Access[150∈3]<br />ᐸ20.3ᐳ"}}:::plan
    __Item20 --> Access150
    __Item39[/"__Item[39∈4]<br />ᐸ147ᐳ"\]:::itemplan
    Reverse147 ==> __Item39
    PgSelectSingle40{{"PgSelectSingle[40∈4]<br />ᐸpostᐳ"}}:::plan
    __Item39 --> PgSelectSingle40
    PgClassExpression41{{"PgClassExpression[41∈5]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle40 --> PgClassExpression41
    PgClassExpression42{{"PgClassExpression[42∈5]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle40 --> PgClassExpression42
    __Item65[/"__Item[65∈6]<br />ᐸ148ᐳ"\]:::itemplan
    Access148 ==> __Item65
    PgSelectSingle66{{"PgSelectSingle[66∈6]<br />ᐸpostᐳ"}}:::plan
    __Item65 --> PgSelectSingle66
    PgClassExpression67{{"PgClassExpression[67∈7]<br />ᐸ__post__.”headline”ᐳ"}}:::plan
    PgSelectSingle66 --> PgClassExpression67
    PgClassExpression68{{"PgClassExpression[68∈7]<br />ᐸ__post__.”author_id”ᐳ"}}:::plan
    PgSelectSingle66 --> PgClassExpression68
    __Item84[/"__Item[84∈8]<br />ᐸ149ᐳ"\]:::itemplan
    Access149 ==> __Item84
    PgSelectSingle85{{"PgSelectSingle[85∈8]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item84 --> PgSelectSingle85
    PgClassExpression86{{"PgClassExpression[86∈9]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle85 --> PgClassExpression86
    PgClassExpression87{{"PgClassExpression[87∈9]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle85 --> PgClassExpression87
    __Item103[/"__Item[103∈10]<br />ᐸ150ᐳ"\]:::itemplan
    Access150 ==> __Item103
    PgSelectSingle104{{"PgSelectSingle[104∈10]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item103 --> PgSelectSingle104
    PgClassExpression105{{"PgClassExpression[105∈11]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle104 --> PgClassExpression105
    PgClassExpression106{{"PgClassExpression[106∈11]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle104 --> PgClassExpression106
    PgSelect120[["PgSelect[120∈12] ➊<br />ᐸcompound_keyᐳ"]]:::plan
    Object17 & Connection119 --> PgSelect120
    Connection139{{"Connection[139∈12] ➊<br />ᐸ135ᐳ"}}:::plan
    __Item121[/"__Item[121∈13]<br />ᐸ120ᐳ"\]:::itemplan
    PgSelect120 ==> __Item121
    PgSelectSingle122{{"PgSelectSingle[122∈13]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item121 --> PgSelectSingle122
    PgClassExpression123{{"PgClassExpression[123∈14]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgSelectSingle122 --> PgClassExpression123
    PgClassExpression124{{"PgClassExpression[124∈14]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgSelectSingle122 --> PgClassExpression124
    Access151{{"Access[151∈14]<br />ᐸ121.0ᐳ"}}:::plan
    __Item121 --> Access151
    __Item141[/"__Item[141∈15]<br />ᐸ151ᐳ"\]:::itemplan
    Access151 ==> __Item141
    PgSelectSingle142{{"PgSelectSingle[142∈15]<br />ᐸforeign_keyᐳ"}}:::plan
    __Item141 --> PgSelectSingle142
    PgClassExpression143{{"PgClassExpression[143∈16]<br />ᐸ__foreign_...person_id”ᐳ"}}:::plan
    PgSelectSingle142 --> PgClassExpression143
    PgClassExpression144{{"PgClassExpression[144∈16]<br />ᐸ__foreign_...und_key_1”ᐳ"}}:::plan
    PgSelectSingle142 --> PgClassExpression144
    PgClassExpression145{{"PgClassExpression[145∈16]<br />ᐸ__foreign_...und_key_2”ᐳ"}}:::plan
    PgSelectSingle142 --> PgClassExpression145

    %% define steps

    subgraph "Buckets for queries/v4/relation-head-tail"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access15,Access16,Object17,Connection18,Connection119 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 17, 18<br /><br />ROOT Connectionᐸ14ᐳ[18]<br />1: <br />ᐳ: 63, 82, 101, 152, 153, 37<br />2: PgSelect[19]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect19,Connection37,Connection63,Connection82,Connection101,Constant152,Constant153 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 37, 63, 82, 101<br /><br />ROOT __Item{2}ᐸ19ᐳ[20]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item20,PgSelectSingle21 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 21, 20, 37, 63, 82, 101<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[21]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression22,PgClassExpression23,Access146,Reverse147,Access148,Access149,Access150 bucket3
    Bucket4("Bucket 4 (listItem)<br /><br />ROOT __Item{4}ᐸ147ᐳ[39]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item39,PgSelectSingle40 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 40<br /><br />ROOT PgSelectSingle{4}ᐸpostᐳ[40]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression41,PgClassExpression42 bucket5
    Bucket6("Bucket 6 (listItem)<br /><br />ROOT __Item{6}ᐸ148ᐳ[65]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item65,PgSelectSingle66 bucket6
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 66<br /><br />ROOT PgSelectSingle{6}ᐸpostᐳ[66]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,PgClassExpression67,PgClassExpression68 bucket7
    Bucket8("Bucket 8 (listItem)<br /><br />ROOT __Item{8}ᐸ149ᐳ[84]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item84,PgSelectSingle85 bucket8
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 85<br /><br />ROOT PgSelectSingle{8}ᐸcompound_keyᐳ[85]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgClassExpression86,PgClassExpression87 bucket9
    Bucket10("Bucket 10 (listItem)<br /><br />ROOT __Item{10}ᐸ150ᐳ[103]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item103,PgSelectSingle104 bucket10
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 104<br /><br />ROOT PgSelectSingle{10}ᐸcompound_keyᐳ[104]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgClassExpression105,PgClassExpression106 bucket11
    Bucket12("Bucket 12 (nullableBoundary)<br />Deps: 17, 119<br /><br />ROOT Connectionᐸ115ᐳ[119]"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,PgSelect120,Connection139 bucket12
    Bucket13("Bucket 13 (listItem)<br />Deps: 139<br /><br />ROOT __Item{13}ᐸ120ᐳ[121]"):::bucket
    classDef bucket13 stroke:#3cb371
    class Bucket13,__Item121,PgSelectSingle122 bucket13
    Bucket14("Bucket 14 (nullableBoundary)<br />Deps: 122, 121, 139<br /><br />ROOT PgSelectSingle{13}ᐸcompound_keyᐳ[122]"):::bucket
    classDef bucket14 stroke:#a52a2a
    class Bucket14,PgClassExpression123,PgClassExpression124,Access151 bucket14
    Bucket15("Bucket 15 (listItem)<br /><br />ROOT __Item{15}ᐸ151ᐳ[141]"):::bucket
    classDef bucket15 stroke:#ff00ff
    class Bucket15,__Item141,PgSelectSingle142 bucket15
    Bucket16("Bucket 16 (nullableBoundary)<br />Deps: 142<br /><br />ROOT PgSelectSingle{15}ᐸforeign_keyᐳ[142]"):::bucket
    classDef bucket16 stroke:#f5deb3
    class Bucket16,PgClassExpression143,PgClassExpression144,PgClassExpression145 bucket16
    Bucket0 --> Bucket1 & Bucket12
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6 & Bucket8 & Bucket10
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    Bucket8 --> Bucket9
    Bucket10 --> Bucket11
    Bucket12 --> Bucket13
    Bucket13 --> Bucket14
    Bucket14 --> Bucket15
    Bucket15 --> Bucket16
    end
