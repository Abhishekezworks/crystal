%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection70{{"Connection[70∈0] ➊<br />ᐸ66ᐳ"}}:::plan
    Constant123{{"Constant[123∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Lambda71{{"Lambda[71∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor77["PgValidateParsedCursor[77∈0] ➊"]:::plan
    Constant123 & Lambda71 & PgValidateParsedCursor77 & PgValidateParsedCursor77 & PgValidateParsedCursor77 & PgValidateParsedCursor77 --> Connection70
    Object19{{"Object[19∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access17{{"Access[17∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access18{{"Access[18∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access17 & Access18 --> Object19
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access17
    __Value2 --> Access18
    Connection20{{"Connection[20∈0] ➊<br />ᐸ16ᐳ"}}:::plan
    Constant123 --> Connection20
    Constant125{{"Constant[125∈0] ➊<br />ᐸ'WyIzNjY0MzE3ZDgwIixmYWxzZSwyLDFd'ᐳ"}}:::plan
    Constant125 --> Lambda71
    Lambda71 --> PgValidateParsedCursor77
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant40{{"Constant[40∈0] ➊<br />ᐸfalseᐳ"}}:::plan
    List29{{"List[29∈1] ➊<br />ᐸ26,27,28ᐳ"}}:::plan
    PgClassExpression26{{"PgClassExpression[26∈1] ➊<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgClassExpression27{{"PgClassExpression[27∈1] ➊<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression28{{"PgClassExpression[28∈1] ➊<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgClassExpression26 & PgClassExpression27 & PgClassExpression28 --> List29
    List37{{"List[37∈1] ➊<br />ᐸ34,35,36ᐳ"}}:::plan
    PgClassExpression34{{"PgClassExpression[34∈1] ➊<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgClassExpression35{{"PgClassExpression[35∈1] ➊<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression36{{"PgClassExpression[36∈1] ➊<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgClassExpression34 & PgClassExpression35 & PgClassExpression36 --> List37
    PgSelect22[["PgSelect[22∈1] ➊<br />ᐸcompound_key+1ᐳ"]]:::plan
    Object19 & Connection20 --> PgSelect22
    PgSelect41[["PgSelect[41∈1] ➊<br />ᐸcompound_key(aggregate)ᐳ"]]:::plan
    Object19 & Connection20 --> PgSelect41
    PgPageInfo21{{"PgPageInfo[21∈1] ➊"}}:::plan
    Connection20 --> PgPageInfo21
    First23{{"First[23∈1] ➊"}}:::plan
    PgSelect22 --> First23
    PgSelectSingle24{{"PgSelectSingle[24∈1] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First23 --> PgSelectSingle24
    PgCursor25{{"PgCursor[25∈1] ➊"}}:::plan
    List29 --> PgCursor25
    PgSelectSingle24 --> PgClassExpression26
    PgSelectSingle24 --> PgClassExpression27
    PgSelectSingle24 --> PgClassExpression28
    Last31{{"Last[31∈1] ➊"}}:::plan
    PgSelect22 --> Last31
    PgSelectSingle32{{"PgSelectSingle[32∈1] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    Last31 --> PgSelectSingle32
    PgCursor33{{"PgCursor[33∈1] ➊"}}:::plan
    List37 --> PgCursor33
    PgSelectSingle32 --> PgClassExpression34
    PgSelectSingle32 --> PgClassExpression35
    PgSelectSingle32 --> PgClassExpression36
    Access39{{"Access[39∈1] ➊<br />ᐸ22.hasMoreᐳ"}}:::plan
    PgSelect22 --> Access39
    First42{{"First[42∈1] ➊"}}:::plan
    PgSelect41 --> First42
    PgSelectSingle43{{"PgSelectSingle[43∈1] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First42 --> PgSelectSingle43
    PgClassExpression44{{"PgClassExpression[44∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression44
    __Item46[/"__Item[46∈2]<br />ᐸ22ᐳ"\]:::itemplan
    PgSelect22 ==> __Item46
    PgSelectSingle47{{"PgSelectSingle[47∈2]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item46 --> PgSelectSingle47
    List52{{"List[52∈3]<br />ᐸ49,50,51ᐳ"}}:::plan
    PgClassExpression49{{"PgClassExpression[49∈3]<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgClassExpression50{{"PgClassExpression[50∈3]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression51{{"PgClassExpression[51∈3]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgClassExpression49 & PgClassExpression50 & PgClassExpression51 --> List52
    PgCursor48{{"PgCursor[48∈3]"}}:::plan
    List52 --> PgCursor48
    PgSelectSingle47 --> PgClassExpression49
    PgSelectSingle47 --> PgClassExpression50
    PgSelectSingle47 --> PgClassExpression51
    PgSelect73[["PgSelect[73∈4] ➊<br />ᐸcompound_key+1ᐳ"]]:::plan
    Access78{{"Access[78∈4] ➊<br />ᐸ71.1ᐳ"}}:::plan
    Access79{{"Access[79∈4] ➊<br />ᐸ71.2ᐳ"}}:::plan
    Access80{{"Access[80∈4] ➊<br />ᐸ71.3ᐳ"}}:::plan
    Object19 & Connection70 & Lambda71 & Access78 & Access79 & Access80 --> PgSelect73
    List84{{"List[84∈4] ➊<br />ᐸ81,82,83ᐳ"}}:::plan
    PgClassExpression81{{"PgClassExpression[81∈4] ➊<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgClassExpression82{{"PgClassExpression[82∈4] ➊<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression83{{"PgClassExpression[83∈4] ➊<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgClassExpression81 & PgClassExpression82 & PgClassExpression83 --> List84
    List96{{"List[96∈4] ➊<br />ᐸ93,94,95ᐳ"}}:::plan
    PgClassExpression93{{"PgClassExpression[93∈4] ➊<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgClassExpression94{{"PgClassExpression[94∈4] ➊<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression95{{"PgClassExpression[95∈4] ➊<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgClassExpression93 & PgClassExpression94 & PgClassExpression95 --> List96
    PgSelect104[["PgSelect[104∈4] ➊<br />ᐸcompound_key(aggregate)ᐳ"]]:::plan
    Object19 & Connection70 --> PgSelect104
    PgPageInfo72{{"PgPageInfo[72∈4] ➊"}}:::plan
    Connection70 --> PgPageInfo72
    First74{{"First[74∈4] ➊"}}:::plan
    PgSelect73 --> First74
    PgSelectSingle75{{"PgSelectSingle[75∈4] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First74 --> PgSelectSingle75
    PgCursor76{{"PgCursor[76∈4] ➊"}}:::plan
    List84 --> PgCursor76
    Lambda71 --> Access78
    Lambda71 --> Access79
    Lambda71 --> Access80
    PgSelectSingle75 --> PgClassExpression81
    PgSelectSingle75 --> PgClassExpression82
    PgSelectSingle75 --> PgClassExpression83
    Last86{{"Last[86∈4] ➊"}}:::plan
    PgSelect73 --> Last86
    PgSelectSingle87{{"PgSelectSingle[87∈4] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    Last86 --> PgSelectSingle87
    PgCursor88{{"PgCursor[88∈4] ➊"}}:::plan
    List96 --> PgCursor88
    PgSelectSingle87 --> PgClassExpression93
    PgSelectSingle87 --> PgClassExpression94
    PgSelectSingle87 --> PgClassExpression95
    Access98{{"Access[98∈4] ➊<br />ᐸ73.hasMoreᐳ"}}:::plan
    PgSelect73 --> Access98
    First105{{"First[105∈4] ➊"}}:::plan
    PgSelect104 --> First105
    PgSelectSingle106{{"PgSelectSingle[106∈4] ➊<br />ᐸcompound_keyᐳ"}}:::plan
    First105 --> PgSelectSingle106
    PgClassExpression107{{"PgClassExpression[107∈4] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression107
    __Item113[/"__Item[113∈5]<br />ᐸ73ᐳ"\]:::itemplan
    PgSelect73 ==> __Item113
    PgSelectSingle114{{"PgSelectSingle[114∈5]<br />ᐸcompound_keyᐳ"}}:::plan
    __Item113 --> PgSelectSingle114
    List119{{"List[119∈6]<br />ᐸ116,117,118ᐳ"}}:::plan
    PgClassExpression116{{"PgClassExpression[116∈6]<br />ᐸ__compound...__.”extra”ᐳ"}}:::plan
    PgClassExpression117{{"PgClassExpression[117∈6]<br />ᐸ__compound...rson_id_1”ᐳ"}}:::plan
    PgClassExpression118{{"PgClassExpression[118∈6]<br />ᐸ__compound...rson_id_2”ᐳ"}}:::plan
    PgClassExpression116 & PgClassExpression117 & PgClassExpression118 --> List119
    PgCursor115{{"PgCursor[115∈6]"}}:::plan
    List119 --> PgCursor115
    PgSelectSingle114 --> PgClassExpression116
    PgSelectSingle114 --> PgClassExpression117
    PgSelectSingle114 --> PgClassExpression118

    %% define steps

    subgraph "Buckets for queries/v4/connections.boolean"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 17, 18, 40, 123, 125, 19, 20, 71<br />2: PgValidateParsedCursor[77]<br />ᐳ: Connection[70]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access17,Access18,Object19,Connection20,Constant40,Connection70,Lambda71,PgValidateParsedCursor77,Constant123,Constant125 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 20, 19, 40<br /><br />ROOT Connectionᐸ16ᐳ[20]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgPageInfo21,PgSelect22,First23,PgSelectSingle24,PgCursor25,PgClassExpression26,PgClassExpression27,PgClassExpression28,List29,Last31,PgSelectSingle32,PgCursor33,PgClassExpression34,PgClassExpression35,PgClassExpression36,List37,Access39,PgSelect41,First42,PgSelectSingle43,PgClassExpression44 bucket1
    Bucket2("Bucket 2 (listItem)<br /><br />ROOT __Item{2}ᐸ22ᐳ[46]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item46,PgSelectSingle47 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 47<br /><br />ROOT PgSelectSingle{2}ᐸcompound_keyᐳ[47]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor48,PgClassExpression49,PgClassExpression50,PgClassExpression51,List52 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 70, 19, 71, 40<br /><br />ROOT Connectionᐸ66ᐳ[70]<br />1: PgSelect[104]<br />ᐳ: 72, 78, 79, 80, 105, 106, 107<br />2: PgSelect[73]<br />ᐳ: 74, 75, 81, 82, 83, 84, 86, 87, 93, 94, 95, 96, 98, 76, 88"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgPageInfo72,PgSelect73,First74,PgSelectSingle75,PgCursor76,Access78,Access79,Access80,PgClassExpression81,PgClassExpression82,PgClassExpression83,List84,Last86,PgSelectSingle87,PgCursor88,PgClassExpression93,PgClassExpression94,PgClassExpression95,List96,Access98,PgSelect104,First105,PgSelectSingle106,PgClassExpression107 bucket4
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ73ᐳ[113]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item113,PgSelectSingle114 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 114<br /><br />ROOT PgSelectSingle{5}ᐸcompound_keyᐳ[114]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgCursor115,PgClassExpression116,PgClassExpression117,PgClassExpression118,List119 bucket6
    Bucket0 --> Bucket1 & Bucket4
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    end
