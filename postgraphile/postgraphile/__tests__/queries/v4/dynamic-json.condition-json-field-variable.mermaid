%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/v4/dynamic-json.condition-json-field-variable"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 17, 20, 19<br /><br />ROOT Connectionᐸ13ᐳ[19]<br />1: PgSelect[41]<br />2: PgSelectRows[47]"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 17, 29, 28<br /><br />ROOT Connectionᐸ25ᐳ[28]<br />1: PgSelect[43]<br />2: PgSelectRows[50]"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 17, 39, 38<br /><br />ROOT Connectionᐸ35ᐳ[38]<br />1: PgSelect[45]<br />2: PgSelectRows[53]"):::bucket
    Bucket4("Bucket 4 (listItem)<br /><br />ROOT __Item{4}ᐸ47ᐳ[48]"):::bucket
    Bucket5("Bucket 5 (listItem)<br /><br />ROOT __Item{5}ᐸ50ᐳ[51]"):::bucket
    Bucket6("Bucket 6 (listItem)<br /><br />ROOT __Item{6}ᐸ53ᐳ[54]"):::bucket
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 49<br /><br />ROOT PgSelectSingle{4}ᐸmy_tableᐳ[49]"):::bucket
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 52<br /><br />ROOT PgSelectSingle{5}ᐸmy_tableᐳ[52]"):::bucket
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 55<br /><br />ROOT PgSelectSingle{6}ᐸmy_tableᐳ[55]"):::bucket
    end
    Bucket0 --> Bucket1 & Bucket2 & Bucket3
    Bucket1 --> Bucket4
    Bucket2 --> Bucket5
    Bucket3 --> Bucket6
    Bucket4 --> Bucket7
    Bucket5 --> Bucket8
    Bucket6 --> Bucket9

    %% plan dependencies
    __InputObject7{{"__InputObject[7∈0] ➊"}}:::plan
    __InputDynamicScalar8{{"__InputDynamicScalar[8∈0] ➊"}}:::plan
    __InputDynamicScalar8 --> __InputObject7
    Object17{{"Object[17∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access14{{"Access[14∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access14 & Access16 --> Object17
    __InputObject22{{"__InputObject[22∈0] ➊"}}:::plan
    __InputDynamicScalar23{{"__InputDynamicScalar[23∈0] ➊"}}:::plan
    __InputDynamicScalar23 --> __InputObject22
    __InputObject31{{"__InputObject[31∈0] ➊"}}:::plan
    Access32{{"Access[32∈0] ➊<br />ᐸ0.myVal2ᐳ"}}:::plan
    Access32 --> __InputObject31
    Access9{{"Access[9∈0] ➊<br />ᐸ0.myValᐳ"}}:::plan
    Access9 --> __InputDynamicScalar8
    __Value0["__Value[0∈0] ➊<br />ᐸvariableValuesᐳ"]:::plan
    __Value0 --> Access9
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access14
    __Value2 --> Access16
    ApplyInput20{{"ApplyInput[20∈0] ➊"}}:::plan
    __InputObject7 --> ApplyInput20
    ApplyInput29{{"ApplyInput[29∈0] ➊"}}:::plan
    __InputObject22 --> ApplyInput29
    __Value0 --> Access32
    ApplyInput39{{"ApplyInput[39∈0] ➊"}}:::plan
    __InputObject31 --> ApplyInput39
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection19{{"Connection[19∈0] ➊<br />ᐸ13ᐳ"}}:::plan
    Connection28{{"Connection[28∈0] ➊<br />ᐸ25ᐳ"}}:::plan
    Connection38{{"Connection[38∈0] ➊<br />ᐸ35ᐳ"}}:::plan
    PgSelect41[["PgSelect[41∈1] ➊<br />ᐸmy_tableᐳ"]]:::plan
    Object17 & ApplyInput20 & Connection19 --> PgSelect41
    PgSelectRows47[["PgSelectRows[47∈1] ➊"]]:::plan
    PgSelect41 --> PgSelectRows47
    __Item48[/"__Item[48∈4]<br />ᐸ47ᐳ"\]:::itemplan
    PgSelectRows47 ==> __Item48
    PgSelectSingle49{{"PgSelectSingle[49∈4]<br />ᐸmy_tableᐳ"}}:::plan
    __Item48 --> PgSelectSingle49
    PgClassExpression56{{"PgClassExpression[56∈7]<br />ᐸ__my_table__.”id”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression56
    PgClassExpression57{{"PgClassExpression[57∈7]<br />ᐸ__my_table...json_data”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression57
    PgSelect43[["PgSelect[43∈2] ➊<br />ᐸmy_tableᐳ"]]:::plan
    Object17 & ApplyInput29 & Connection28 --> PgSelect43
    PgSelectRows50[["PgSelectRows[50∈2] ➊"]]:::plan
    PgSelect43 --> PgSelectRows50
    __Item51[/"__Item[51∈5]<br />ᐸ50ᐳ"\]:::itemplan
    PgSelectRows50 ==> __Item51
    PgSelectSingle52{{"PgSelectSingle[52∈5]<br />ᐸmy_tableᐳ"}}:::plan
    __Item51 --> PgSelectSingle52
    PgClassExpression58{{"PgClassExpression[58∈8]<br />ᐸ__my_table__.”id”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression58
    PgClassExpression59{{"PgClassExpression[59∈8]<br />ᐸ__my_table...json_data”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression59
    PgSelect45[["PgSelect[45∈3] ➊<br />ᐸmy_tableᐳ"]]:::plan
    Object17 & ApplyInput39 & Connection38 --> PgSelect45
    PgSelectRows53[["PgSelectRows[53∈3] ➊"]]:::plan
    PgSelect45 --> PgSelectRows53
    __Item54[/"__Item[54∈6]<br />ᐸ53ᐳ"\]:::itemplan
    PgSelectRows53 ==> __Item54
    PgSelectSingle55{{"PgSelectSingle[55∈6]<br />ᐸmy_tableᐳ"}}:::plan
    __Item54 --> PgSelectSingle55
    PgClassExpression60{{"PgClassExpression[60∈9]<br />ᐸ__my_table__.”id”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression60
    PgClassExpression61{{"PgClassExpression[61∈9]<br />ᐸ__my_table...json_data”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression61

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value2,__Value4,__InputObject7,__InputDynamicScalar8,Access9,Access14,Access16,Object17,Connection19,ApplyInput20,__InputObject22,__InputDynamicScalar23,Connection28,ApplyInput29,__InputObject31,Access32,Connection38,ApplyInput39 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect41,PgSelectRows47 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgSelect43,PgSelectRows50 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgSelect45,PgSelectRows53 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item48,PgSelectSingle49 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item51,PgSelectSingle52 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item54,PgSelectSingle55 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7,PgClassExpression56,PgClassExpression57 bucket7
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgClassExpression58,PgClassExpression59 bucket8
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgClassExpression60,PgClassExpression61 bucket9

