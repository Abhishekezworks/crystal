%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/v4/js-reserved-pgreserved"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 8, 10, 67, 68, 69, 70, 11<br />2: 7, 14, 23, 32, 41<br />3: 19, 28, 37, 46, 49<br />ᐳ: 18, 21, 27, 30, 36, 39, 45, 48"):::bucket
    Bucket1("Bucket 1 (listItem)<br /><br />ROOT __Item{1}ᐸ49ᐳ[50]"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 21<br /><br />ROOT PgSelectSingleᐸreservedᐳ[21]"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 30<br /><br />ROOT PgSelectSingleᐸreservedᐳ[30]"):::bucket
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 39<br /><br />ROOT PgSelectSingleᐸreservedᐳ[39]"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 48<br /><br />ROOT PgSelectSingleᐸreservedᐳ[48]"):::bucket
    end
    Bucket0 --> Bucket1 & Bucket2 & Bucket3 & Bucket4 & Bucket5

    %% plan dependencies
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access10 --> Object11
    PgSelect14[["PgSelect[14∈0] ➊<br />ᐸreservedᐳ"]]:::plan
    Constant67{{"Constant[67∈0] ➊<br />ᐸ'2 Unlimited'ᐳ"}}:::plan
    Object11 & Constant67 --> PgSelect14
    PgSelect23[["PgSelect[23∈0] ➊<br />ᐸreservedᐳ"]]:::plan
    Constant68{{"Constant[68∈0] ➊<br />ᐸ'1973'ᐳ"}}:::plan
    Object11 & Constant68 --> PgSelect23
    PgSelect32[["PgSelect[32∈0] ➊<br />ᐸreservedᐳ"]]:::plan
    Constant69{{"Constant[69∈0] ➊<br />ᐸ4ᐳ"}}:::plan
    Object11 & Constant69 --> PgSelect32
    PgSelect41[["PgSelect[41∈0] ➊<br />ᐸreservedᐳ"]]:::plan
    Constant70{{"Constant[70∈0] ➊<br />ᐸ'No Limit'ᐳ"}}:::plan
    Object11 & Constant70 --> PgSelect41
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸreservedᐳ"]]:::plan
    Object11 --> PgSelect7
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access10
    First18{{"First[18∈0] ➊"}}:::plan
    PgSelectRows19[["PgSelectRows[19∈0] ➊"]]:::plan
    PgSelectRows19 --> First18
    PgSelect14 --> PgSelectRows19
    PgSelectSingle21{{"PgSelectSingle[21∈0] ➊<br />ᐸreservedᐳ"}}:::plan
    First18 --> PgSelectSingle21
    First27{{"First[27∈0] ➊"}}:::plan
    PgSelectRows28[["PgSelectRows[28∈0] ➊"]]:::plan
    PgSelectRows28 --> First27
    PgSelect23 --> PgSelectRows28
    PgSelectSingle30{{"PgSelectSingle[30∈0] ➊<br />ᐸreservedᐳ"}}:::plan
    First27 --> PgSelectSingle30
    First36{{"First[36∈0] ➊"}}:::plan
    PgSelectRows37[["PgSelectRows[37∈0] ➊"]]:::plan
    PgSelectRows37 --> First36
    PgSelect32 --> PgSelectRows37
    PgSelectSingle39{{"PgSelectSingle[39∈0] ➊<br />ᐸreservedᐳ"}}:::plan
    First36 --> PgSelectSingle39
    First45{{"First[45∈0] ➊"}}:::plan
    PgSelectRows46[["PgSelectRows[46∈0] ➊"]]:::plan
    PgSelectRows46 --> First45
    PgSelect41 --> PgSelectRows46
    PgSelectSingle48{{"PgSelectSingle[48∈0] ➊<br />ᐸreservedᐳ"}}:::plan
    First45 --> PgSelectSingle48
    PgSelectRows49[["PgSelectRows[49∈0] ➊"]]:::plan
    PgSelect7 --> PgSelectRows49
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    __Item50[/"__Item[50∈1]<br />ᐸ49ᐳ"\]:::itemplan
    PgSelectRows49 ==> __Item50
    PgSelectSingle51{{"PgSelectSingle[51∈1]<br />ᐸreservedᐳ"}}:::plan
    __Item50 --> PgSelectSingle51
    PgClassExpression63{{"PgClassExpression[63∈1]<br />ᐸ__reserved__.”case”ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression63
    PgClassExpression64{{"PgClassExpression[64∈1]<br />ᐸ__reserved__.”do”ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression64
    PgClassExpression65{{"PgClassExpression[65∈1]<br />ᐸ__reserved__.”id”ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression65
    PgClassExpression66{{"PgClassExpression[66∈1]<br />ᐸ__reserved__.”null”ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression66
    PgClassExpression52{{"PgClassExpression[52∈2] ➊<br />ᐸ__reserved__.”do”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression52
    PgClassExpression53{{"PgClassExpression[53∈2] ➊<br />ᐸ__reserved__.”id”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression53
    PgClassExpression54{{"PgClassExpression[54∈2] ➊<br />ᐸ__reserved__.”null”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression54
    PgClassExpression55{{"PgClassExpression[55∈3] ➊<br />ᐸ__reserved__.”case”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression55
    PgClassExpression56{{"PgClassExpression[56∈3] ➊<br />ᐸ__reserved__.”id”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression56
    PgClassExpression57{{"PgClassExpression[57∈3] ➊<br />ᐸ__reserved__.”null”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression57
    PgClassExpression58{{"PgClassExpression[58∈4] ➊<br />ᐸ__reserved__.”case”ᐳ"}}:::plan
    PgSelectSingle39 --> PgClassExpression58
    PgClassExpression59{{"PgClassExpression[59∈4] ➊<br />ᐸ__reserved__.”do”ᐳ"}}:::plan
    PgSelectSingle39 --> PgClassExpression59
    PgClassExpression60{{"PgClassExpression[60∈4] ➊<br />ᐸ__reserved__.”null”ᐳ"}}:::plan
    PgSelectSingle39 --> PgClassExpression60
    PgClassExpression61{{"PgClassExpression[61∈5] ➊<br />ᐸ__reserved__.”case”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression61
    PgClassExpression62{{"PgClassExpression[62∈5] ➊<br />ᐸ__reserved__.”do”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression62

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access10,Object11,PgSelect14,First18,PgSelectRows19,PgSelectSingle21,PgSelect23,First27,PgSelectRows28,PgSelectSingle30,PgSelect32,First36,PgSelectRows37,PgSelectSingle39,PgSelect41,First45,PgSelectRows46,PgSelectSingle48,PgSelectRows49,Constant67,Constant68,Constant69,Constant70 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item50,PgSelectSingle51,PgClassExpression63,PgClassExpression64,PgClassExpression65,PgClassExpression66 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgClassExpression52,PgClassExpression53,PgClassExpression54 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression55,PgClassExpression56,PgClassExpression57 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression58,PgClassExpression59,PgClassExpression60 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression61,PgClassExpression62 bucket5

