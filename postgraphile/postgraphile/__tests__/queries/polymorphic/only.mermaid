%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object13{{"Object[13∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access11 & Access12 --> Object13
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access11
    __Value2 --> Access12
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection14{{"Connection[14∈0] ➊<br />ᐸ10ᐳ"}}:::plan
    PgUnionAll15[["PgUnionAll[15∈1] ➊"]]:::plan
    Object13 & Connection14 --> PgUnionAll15
    Access106{{"Access[106∈1] ➊<br />ᐸ15.itemsᐳ"}}:::plan
    PgUnionAll15 --> Access106
    __Item17[/"__Item[17∈2]<br />ᐸ106ᐳ"\]:::itemplan
    Access106 ==> __Item17
    PgUnionAllSingle18["PgUnionAllSingle[18∈2]"]:::plan
    __Item17 --> PgUnionAllSingle18
    PgUnionAll36[["PgUnionAll[36∈3]<br />ᐳAwsApplication"]]:::plan
    PgClassExpression32{{"PgClassExpression[32∈3]<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    Connection35{{"Connection[35∈3] ➊<br />ᐸ33ᐳ<br />ᐳAwsApplication"}}:::plan
    Object13 & PgClassExpression32 & Connection35 --> PgUnionAll36
    PgUnionAll77[["PgUnionAll[77∈3]<br />ᐳGcpApplication"]]:::plan
    PgClassExpression73{{"PgClassExpression[73∈3]<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    Connection76{{"Connection[76∈3] ➊<br />ᐸ74ᐳ<br />ᐳGcpApplication"}}:::plan
    Object13 & PgClassExpression73 & Connection76 --> PgUnionAll77
    PgSelect22[["PgSelect[22∈3]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Access21{{"Access[21∈3]<br />ᐸ20.0ᐳ"}}:::plan
    Object13 & Access21 --> PgSelect22
    PgSelect65[["PgSelect[65∈3]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Access64{{"Access[64∈3]<br />ᐸ63.0ᐳ"}}:::plan
    Object13 & Access64 --> PgSelect65
    Access19{{"Access[19∈3]<br />ᐸ18.1ᐳ<br />ᐳAwsApplication"}}:::plan
    PgUnionAllSingle18 --> Access19
    JSONParse20[["JSONParse[20∈3]<br />ᐸ19ᐳ"]]:::plan
    Access19 --> JSONParse20
    JSONParse20 --> Access21
    First26{{"First[26∈3]"}}:::plan
    PgSelectRows27[["PgSelectRows[27∈3]"]]:::plan
    PgSelectRows27 --> First26
    PgSelect22 --> PgSelectRows27
    PgSelectSingle28{{"PgSelectSingle[28∈3]<br />ᐸaws_applicationsᐳ"}}:::plan
    First26 --> PgSelectSingle28
    PgClassExpression29{{"PgClassExpression[29∈3]<br />ᐸ__aws_appl..._.”aws_id”ᐳ"}}:::plan
    PgSelectSingle28 --> PgClassExpression29
    PgSelectSingle28 --> PgClassExpression32
    JSONParse63[["JSONParse[63∈3]<br />ᐸ19ᐳ<br />ᐳGcpApplication"]]:::plan
    Access19 --> JSONParse63
    JSONParse63 --> Access64
    First67{{"First[67∈3]"}}:::plan
    PgSelectRows68[["PgSelectRows[68∈3]"]]:::plan
    PgSelectRows68 --> First67
    PgSelect65 --> PgSelectRows68
    PgSelectSingle69{{"PgSelectSingle[69∈3]<br />ᐸgcp_applicationsᐳ"}}:::plan
    First67 --> PgSelectSingle69
    PgClassExpression70{{"PgClassExpression[70∈3]<br />ᐸ__gcp_appl..._.”gcp_id”ᐳ"}}:::plan
    PgSelectSingle69 --> PgClassExpression70
    PgSelectSingle69 --> PgClassExpression73
    Access104{{"Access[104∈3]<br />ᐸ36.itemsᐳ"}}:::plan
    PgUnionAll36 --> Access104
    Access105{{"Access[105∈3]<br />ᐸ77.itemsᐳ"}}:::plan
    PgUnionAll77 --> Access105
    __Item38[/"__Item[38∈4]<br />ᐸ104ᐳ"\]:::itemplan
    Access104 ==> __Item38
    PgUnionAllSingle39["PgUnionAllSingle[39∈4]"]:::plan
    __Item38 --> PgUnionAllSingle39
    PgSelect43[["PgSelect[43∈5]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access42{{"Access[42∈5]<br />ᐸ41.0ᐳ"}}:::plan
    Object13 & Access42 --> PgSelect43
    PgSelect55[["PgSelect[55∈5]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access54{{"Access[54∈5]<br />ᐸ53.0ᐳ"}}:::plan
    Object13 & Access54 --> PgSelect55
    Access40{{"Access[40∈5]<br />ᐸ39.1ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"}}:::plan
    PgUnionAllSingle39 --> Access40
    JSONParse41[["JSONParse[41∈5]<br />ᐸ40ᐳ"]]:::plan
    Access40 --> JSONParse41
    JSONParse41 --> Access42
    First47{{"First[47∈5]"}}:::plan
    PgSelectRows48[["PgSelectRows[48∈5]"]]:::plan
    PgSelectRows48 --> First47
    PgSelect43 --> PgSelectRows48
    PgSelectSingle49{{"PgSelectSingle[49∈5]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First47 --> PgSelectSingle49
    PgClassExpression50{{"PgClassExpression[50∈5]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression50
    PgClassExpression51{{"PgClassExpression[51∈5]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression51
    PgClassExpression52{{"PgClassExpression[52∈5]<br />ᐸ__first_pa...team_name”ᐳ"}}:::plan
    PgSelectSingle49 --> PgClassExpression52
    JSONParse53[["JSONParse[53∈5]<br />ᐸ40ᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access40 --> JSONParse53
    JSONParse53 --> Access54
    First57{{"First[57∈5]"}}:::plan
    PgSelectRows58[["PgSelectRows[58∈5]"]]:::plan
    PgSelectRows58 --> First57
    PgSelect55 --> PgSelectRows58
    PgSelectSingle59{{"PgSelectSingle[59∈5]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First57 --> PgSelectSingle59
    PgClassExpression60{{"PgClassExpression[60∈5]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle59 --> PgClassExpression60
    PgClassExpression61{{"PgClassExpression[61∈5]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle59 --> PgClassExpression61
    PgClassExpression62{{"PgClassExpression[62∈5]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle59 --> PgClassExpression62
    __Item79[/"__Item[79∈6]<br />ᐸ105ᐳ"\]:::itemplan
    Access105 ==> __Item79
    PgUnionAllSingle80["PgUnionAllSingle[80∈6]"]:::plan
    __Item79 --> PgUnionAllSingle80
    PgSelect84[["PgSelect[84∈7]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access83{{"Access[83∈7]<br />ᐸ82.0ᐳ"}}:::plan
    Object13 & Access83 --> PgSelect84
    PgSelect96[["PgSelect[96∈7]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access95{{"Access[95∈7]<br />ᐸ94.0ᐳ"}}:::plan
    Object13 & Access95 --> PgSelect96
    Access81{{"Access[81∈7]<br />ᐸ80.1ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"}}:::plan
    PgUnionAllSingle80 --> Access81
    JSONParse82[["JSONParse[82∈7]<br />ᐸ81ᐳ"]]:::plan
    Access81 --> JSONParse82
    JSONParse82 --> Access83
    First88{{"First[88∈7]"}}:::plan
    PgSelectRows89[["PgSelectRows[89∈7]"]]:::plan
    PgSelectRows89 --> First88
    PgSelect84 --> PgSelectRows89
    PgSelectSingle90{{"PgSelectSingle[90∈7]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First88 --> PgSelectSingle90
    PgClassExpression91{{"PgClassExpression[91∈7]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle90 --> PgClassExpression91
    PgClassExpression92{{"PgClassExpression[92∈7]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle90 --> PgClassExpression92
    PgClassExpression93{{"PgClassExpression[93∈7]<br />ᐸ__first_pa...team_name”ᐳ"}}:::plan
    PgSelectSingle90 --> PgClassExpression93
    JSONParse94[["JSONParse[94∈7]<br />ᐸ81ᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access81 --> JSONParse94
    JSONParse94 --> Access95
    First98{{"First[98∈7]"}}:::plan
    PgSelectRows99[["PgSelectRows[99∈7]"]]:::plan
    PgSelectRows99 --> First98
    PgSelect96 --> PgSelectRows99
    PgSelectSingle100{{"PgSelectSingle[100∈7]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First98 --> PgSelectSingle100
    PgClassExpression101{{"PgClassExpression[101∈7]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle100 --> PgClassExpression101
    PgClassExpression102{{"PgClassExpression[102∈7]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle100 --> PgClassExpression102
    PgClassExpression103{{"PgClassExpression[103∈7]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle100 --> PgClassExpression103

    %% define steps

    subgraph "Buckets for queries/polymorphic/only"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access11,Access12,Object13,Connection14 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 13, 14<br /><br />ROOT Connectionᐸ10ᐳ[14]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll15,Access106 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 13<br /><br />ROOT __Item{2}ᐸ106ᐳ[17]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item17,PgUnionAllSingle18 bucket2
    Bucket3("Bucket 3 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 18, 13<br />ᐳAwsApplication<br />ᐳGcpApplication<br /><br />1: <br />ᐳ: 19, 35, 76<br />2: JSONParse[20], JSONParse[63]<br />ᐳ: Access[21], Access[64]<br />3: PgSelect[22], PgSelect[65]<br />4: PgSelectRows[27], PgSelectRows[68]<br />ᐳ: 26, 28, 29, 32, 67, 69, 70, 73<br />5: PgUnionAll[36], PgUnionAll[77]<br />ᐳ: Access[104], Access[105]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,Access19,JSONParse20,Access21,PgSelect22,First26,PgSelectRows27,PgSelectSingle28,PgClassExpression29,PgClassExpression32,Connection35,PgUnionAll36,JSONParse63,Access64,PgSelect65,First67,PgSelectRows68,PgSelectSingle69,PgClassExpression70,PgClassExpression73,Connection76,PgUnionAll77,Access104,Access105 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 13<br /><br />ROOT __Item{4}ᐸ104ᐳ[38]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item38,PgUnionAllSingle39 bucket4
    Bucket5("Bucket 5 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 39, 13<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br /><br />1: <br />ᐳ: Access[40]<br />2: JSONParse[41], JSONParse[53]<br />ᐳ: Access[42], Access[54]<br />3: PgSelect[43], PgSelect[55]<br />4: PgSelectRows[48], PgSelectRows[58]<br />ᐳ: 47, 49, 50, 51, 52, 57, 59, 60, 61, 62"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,Access40,JSONParse41,Access42,PgSelect43,First47,PgSelectRows48,PgSelectSingle49,PgClassExpression50,PgClassExpression51,PgClassExpression52,JSONParse53,Access54,PgSelect55,First57,PgSelectRows58,PgSelectSingle59,PgClassExpression60,PgClassExpression61,PgClassExpression62 bucket5
    Bucket6("Bucket 6 (listItem)<br />Deps: 13<br /><br />ROOT __Item{6}ᐸ105ᐳ[79]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item79,PgUnionAllSingle80 bucket6
    Bucket7("Bucket 7 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 80, 13<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br /><br />1: <br />ᐳ: Access[81]<br />2: JSONParse[82], JSONParse[94]<br />ᐳ: Access[83], Access[95]<br />3: PgSelect[84], PgSelect[96]<br />4: PgSelectRows[89], PgSelectRows[99]<br />ᐳ: 88, 90, 91, 92, 93, 98, 100, 101, 102, 103"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,Access81,JSONParse82,Access83,PgSelect84,First88,PgSelectRows89,PgSelectSingle90,PgClassExpression91,PgClassExpression92,PgClassExpression93,JSONParse94,Access95,PgSelect96,First98,PgSelectRows99,PgSelectSingle100,PgClassExpression101,PgClassExpression102,PgClassExpression103 bucket7
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    end
