%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object19{{"Object[19∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access17{{"Access[17∈0]<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access18{{"Access[18∈0]<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access17 & Access18 --> Object19
    __Value2["__Value[2∈0]<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access17
    __Value2 --> Access18
    __Value4["__Value[4∈0]<br />ᐸrootValueᐳ"]:::plan
    Connection20{{"Connection[20∈0]<br />ᐸ16ᐳ"}}:::plan
    PgUnionAll21[["PgUnionAll[21∈1]"]]:::plan
    Object19 & Connection20 --> PgUnionAll21
    __Item22[/"__Item[22∈2]<br />ᐸ21ᐳ"\]:::itemplan
    PgUnionAll21 ==> __Item22
    PgUnionAllSingle23["PgUnionAllSingle[23∈2]"]:::plan
    __Item22 --> PgUnionAllSingle23
    Access24{{"Access[24∈2]<br />ᐸ23.1ᐳ"}}:::plan
    PgUnionAllSingle23 --> Access24
    PgUnionAll50[["PgUnionAll[50∈3]<br />ᐳAwsApplication"]]:::plan
    PgClassExpression43{{"PgClassExpression[43∈3]<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    Connection49{{"Connection[49∈3]<br />ᐸ45ᐳ<br />ᐳAwsApplication"}}:::plan
    Object19 & PgClassExpression43 & PgClassExpression43 & Connection49 --> PgUnionAll50
    PgUnionAll103[["PgUnionAll[103∈3]<br />ᐳGcpApplication"]]:::plan
    PgClassExpression96{{"PgClassExpression[96∈3]<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    Connection102{{"Connection[102∈3]<br />ᐸ98ᐳ<br />ᐳGcpApplication"}}:::plan
    Object19 & PgClassExpression96 & PgClassExpression96 & Connection102 --> PgUnionAll103
    PgSelect27[["PgSelect[27∈3]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Access26{{"Access[26∈3]<br />ᐸ25.0ᐳ"}}:::plan
    Object19 & Access26 --> PgSelect27
    PgSelect80[["PgSelect[80∈3]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Access79{{"Access[79∈3]<br />ᐸ78.0ᐳ"}}:::plan
    Object19 & Access79 --> PgSelect80
    JSONParse25[["JSONParse[25∈3]<br />ᐸ24ᐳ<br />ᐳAwsApplication"]]:::plan
    Access24 --> JSONParse25
    JSONParse25 --> Access26
    First31{{"First[31∈3]"}}:::plan
    PgSelect27 --> First31
    PgSelectSingle32{{"PgSelectSingle[32∈3]<br />ᐸaws_applicationsᐳ"}}:::plan
    First31 --> PgSelectSingle32
    PgClassExpression33{{"PgClassExpression[33∈3]<br />ᐸ__aws_appl..._.”aws_id”ᐳ"}}:::plan
    PgSelectSingle32 --> PgClassExpression33
    PgSelectSingle32 --> PgClassExpression43
    JSONParse78[["JSONParse[78∈3]<br />ᐸ24ᐳ<br />ᐳGcpApplication"]]:::plan
    Access24 --> JSONParse78
    JSONParse78 --> Access79
    First84{{"First[84∈3]"}}:::plan
    PgSelect80 --> First84
    PgSelectSingle85{{"PgSelectSingle[85∈3]<br />ᐸgcp_applicationsᐳ"}}:::plan
    First84 --> PgSelectSingle85
    PgClassExpression86{{"PgClassExpression[86∈3]<br />ᐸ__gcp_appl..._.”gcp_id”ᐳ"}}:::plan
    PgSelectSingle85 --> PgClassExpression86
    PgSelectSingle85 --> PgClassExpression96
    __Item51[/"__Item[51∈4]<br />ᐸ50ᐳ"\]:::itemplan
    PgUnionAll50 ==> __Item51
    PgUnionAllSingle52["PgUnionAllSingle[52∈4]"]:::plan
    __Item51 --> PgUnionAllSingle52
    Access53{{"Access[53∈4]<br />ᐸ52.1ᐳ"}}:::plan
    PgUnionAllSingle52 --> Access53
    PgSelect56[["PgSelect[56∈5]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access55{{"Access[55∈5]<br />ᐸ54.0ᐳ"}}:::plan
    Object19 & Access55 --> PgSelect56
    PgSelect68[["PgSelect[68∈5]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access67{{"Access[67∈5]<br />ᐸ66.0ᐳ"}}:::plan
    Object19 & Access67 --> PgSelect68
    JSONParse54[["JSONParse[54∈5]<br />ᐸ53ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access53 --> JSONParse54
    JSONParse54 --> Access55
    First60{{"First[60∈5]"}}:::plan
    PgSelect56 --> First60
    PgSelectSingle61{{"PgSelectSingle[61∈5]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First60 --> PgSelectSingle61
    PgClassExpression62{{"PgClassExpression[62∈5]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle61 --> PgClassExpression62
    PgClassExpression63{{"PgClassExpression[63∈5]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle61 --> PgClassExpression63
    PgClassExpression64{{"PgClassExpression[64∈5]<br />ᐸ__first_pa...team_name”ᐳ"}}:::plan
    PgSelectSingle61 --> PgClassExpression64
    JSONParse66[["JSONParse[66∈5]<br />ᐸ53ᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access53 --> JSONParse66
    JSONParse66 --> Access67
    First72{{"First[72∈5]"}}:::plan
    PgSelect68 --> First72
    PgSelectSingle73{{"PgSelectSingle[73∈5]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First72 --> PgSelectSingle73
    PgClassExpression74{{"PgClassExpression[74∈5]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle73 --> PgClassExpression74
    PgClassExpression75{{"PgClassExpression[75∈5]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle73 --> PgClassExpression75
    PgClassExpression76{{"PgClassExpression[76∈5]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle73 --> PgClassExpression76
    __Item104[/"__Item[104∈6]<br />ᐸ103ᐳ"\]:::itemplan
    PgUnionAll103 ==> __Item104
    PgUnionAllSingle105["PgUnionAllSingle[105∈6]"]:::plan
    __Item104 --> PgUnionAllSingle105
    Access106{{"Access[106∈6]<br />ᐸ105.1ᐳ"}}:::plan
    PgUnionAllSingle105 --> Access106
    PgSelect109[["PgSelect[109∈7]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access108{{"Access[108∈7]<br />ᐸ107.0ᐳ"}}:::plan
    Object19 & Access108 --> PgSelect109
    PgSelect121[["PgSelect[121∈7]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access120{{"Access[120∈7]<br />ᐸ119.0ᐳ"}}:::plan
    Object19 & Access120 --> PgSelect121
    JSONParse107[["JSONParse[107∈7]<br />ᐸ106ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access106 --> JSONParse107
    JSONParse107 --> Access108
    First113{{"First[113∈7]"}}:::plan
    PgSelect109 --> First113
    PgSelectSingle114{{"PgSelectSingle[114∈7]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First113 --> PgSelectSingle114
    PgClassExpression115{{"PgClassExpression[115∈7]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression115
    PgClassExpression116{{"PgClassExpression[116∈7]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression116
    PgClassExpression117{{"PgClassExpression[117∈7]<br />ᐸ__first_pa...team_name”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression117
    JSONParse119[["JSONParse[119∈7]<br />ᐸ106ᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access106 --> JSONParse119
    JSONParse119 --> Access120
    First125{{"First[125∈7]"}}:::plan
    PgSelect121 --> First125
    PgSelectSingle126{{"PgSelectSingle[126∈7]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First125 --> PgSelectSingle126
    PgClassExpression127{{"PgClassExpression[127∈7]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle126 --> PgClassExpression127
    PgClassExpression128{{"PgClassExpression[128∈7]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle126 --> PgClassExpression128
    PgClassExpression129{{"PgClassExpression[129∈7]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle126 --> PgClassExpression129

    %% define steps

    subgraph "Buckets for queries/polymorphic/only"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access17,Access18,Object19,Connection20 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 19, 20<br /><br />ROOT Connectionᐸ16ᐳ[20]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll21 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 19<br /><br />ROOT __Item{2}ᐸ21ᐳ[22]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item22,PgUnionAllSingle23,Access24 bucket2
    Bucket3("Bucket 3 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 24, 19, 23<br />ᐳAwsApplication<br />ᐳGcpApplication<br />1: JSONParse[25], JSONParse[78]<br />ᐳ: 49, 102, 26, 79<br />2: PgSelect[27], PgSelect[80]<br />ᐳ: 31, 32, 33, 43, 84, 85, 86, 96<br />3: PgUnionAll[50], PgUnionAll[103]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,JSONParse25,Access26,PgSelect27,First31,PgSelectSingle32,PgClassExpression33,PgClassExpression43,Connection49,PgUnionAll50,JSONParse78,Access79,PgSelect80,First84,PgSelectSingle85,PgClassExpression86,PgClassExpression96,Connection102,PgUnionAll103 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 19<br /><br />ROOT __Item{4}ᐸ50ᐳ[51]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item51,PgUnionAllSingle52,Access53 bucket4
    Bucket5("Bucket 5 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 53, 19, 52<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br />1: JSONParse[54], JSONParse[66]<br />ᐳ: Access[55], Access[67]<br />2: PgSelect[56], PgSelect[68]<br />ᐳ: 60, 61, 62, 63, 64, 72, 73, 74, 75, 76"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,JSONParse54,Access55,PgSelect56,First60,PgSelectSingle61,PgClassExpression62,PgClassExpression63,PgClassExpression64,JSONParse66,Access67,PgSelect68,First72,PgSelectSingle73,PgClassExpression74,PgClassExpression75,PgClassExpression76 bucket5
    Bucket6("Bucket 6 (listItem)<br />Deps: 19<br /><br />ROOT __Item{6}ᐸ103ᐳ[104]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item104,PgUnionAllSingle105,Access106 bucket6
    Bucket7("Bucket 7 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 106, 19, 105<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br />1: JSONParse[107], JSONParse[119]<br />ᐳ: Access[108], Access[120]<br />2: PgSelect[109], PgSelect[121]<br />ᐳ: 113, 114, 115, 116, 117, 125, 126, 127, 128, 129"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,JSONParse107,Access108,PgSelect109,First113,PgSelectSingle114,PgClassExpression115,PgClassExpression116,PgClassExpression117,JSONParse119,Access120,PgSelect121,First125,PgSelectSingle126,PgClassExpression127,PgClassExpression128,PgClassExpression129 bucket7
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    classDef unary fill:#fafffa,borderWidth:8px
    class Object19,Access17,Access18,__Value2,__Value4,Connection20,PgUnionAll21,Connection49,Connection102 unary
    end
