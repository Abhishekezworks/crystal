%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/polymorphic/only"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 7, 9, 10, 12, 20, 53, 85, 93, 11<br />2: Lambda[13], Lambda[61]"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 11, 13, 12, 20, 61, 85, 93<br /><br />ROOT Connectionᐸ8ᐳ[12]"):::bucket
    Bucket2("Bucket 2 (listItem)<br />Deps: 20, 11, 61, 85, 93<br /><br />ROOT __Item{2}ᐸ142ᐳ[16]"):::bucket
    Bucket3("Bucket 3 (polymorphic)<br />Deps: 11, 24, 23, 61, 85, 93<br /><br />1: 26, 40, 60, 70<br />2: PgSelectRows[35], PgSelectRows[49]<br />ᐳ: 34, 37, 48, 51, 52, 54, 63, 64"):::bucket
    Bucket4("Bucket 4 (polymorphicPartition)<br />AwsApplication<br />Deps: 11, 54, 61, 60, 85<br />ᐳAwsApplication"):::bucket
    Bucket5("Bucket 5 (polymorphicPartition)<br />GcpApplication<br />Deps: 11, 64, 61, 70, 93<br />ᐳGcpApplication"):::bucket
    Bucket6("Bucket 6 (listItem)<br />Deps: 85, 11<br /><br />ROOT __Item{6}ᐸ140ᐳ[77]"):::bucket
    Bucket7("Bucket 7 (listItem)<br />Deps: 93, 11<br /><br />ROOT __Item{7}ᐸ141ᐳ[79]"):::bucket
    Bucket8("Bucket 8 (combined)<br />Deps: 11"):::bucket
    Bucket9("Bucket 9 (polymorphic)<br />Deps: 11, 100, 98<br /><br />1: PgSelect[102], PgSelect[116]<br />2: PgSelectRows[111], PgSelectRows[125]<br />ᐳ: 110, 113, 124, 127, 128, 129, 130, 131, 132, 133"):::bucket
    Bucket10("Bucket 10 (polymorphicPartition)<br />FirstPartyVulnerability<br />Deps: 128, 129<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳFirstPartyVulnerability"):::bucket
    Bucket11("Bucket 11 (polymorphicPartition)<br />ThirdPartyVulnerability<br />Deps: 131, 132<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket5
    Bucket4 --> Bucket6
    Bucket5 --> Bucket7
    Bucket6 --> Bucket8
    Bucket7 --> Bucket8
    Bucket8 --> Bucket9
    Bucket9 --> Bucket10 & Bucket11

    %% plan dependencies
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access9 & Access10 --> Object11
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access9
    __Value2 --> Access10
    Lambda13[["Lambda[13∈0] ➊<br />ᐸlimitToTypesᐳ"]]:::unbatchedplan
    Constant7{{"Constant[7∈0] ➊<br />ᐸ[ 'GcpApplication', 'AwsApplication' ]ᐳ"}}:::plan
    Constant7 --> Lambda13
    Lambda61[["Lambda[61∈0] ➊<br />ᐸlimitToTypesᐳ"]]:::unbatchedplan
    Constant53{{"Constant[53∈0] ➊<br />ᐸ[ 'ThirdPartyVulnerability' ]ᐳ"}}:::plan
    Constant53 --> Lambda61
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection12{{"Connection[12∈0] ➊<br />ᐸ8ᐳ"}}:::plan
    Constant20{{"Constant[20∈0] ➊<br />ᐸ[HIDDEN]ᐳ"}}:::plan
    Constant85{{"Constant[85∈0] ➊<br />ᐸ[HIDDEN]ᐳ"}}:::plan
    Constant93{{"Constant[93∈0] ➊<br />ᐸ[HIDDEN]ᐳ"}}:::plan
    PgUnionAll14[["PgUnionAll[14∈1] ➊<br />ᐸAwsApplication,GcpApplicationᐳ"]]:::plan
    Object11 & Lambda13 & Connection12 --> PgUnionAll14
    Access142{{"Access[142∈1] ➊<br />ᐸ14.itemsᐳ"}}:::plan
    PgUnionAll14 --> Access142
    List21{{"List[21∈2]<br />ᐸ18,19,20ᐳ"}}:::plan
    Access18{{"Access[18∈2]<br />ᐸ17.0ᐳ"}}:::plan
    Access19{{"Access[19∈2]<br />ᐸ17.1ᐳ"}}:::plan
    Access18 & Access19 & Constant20 --> List21
    __Item16[/"__Item[16∈2]<br />ᐸ142ᐳ"\]:::itemplan
    Access142 ==> __Item16
    PgUnionAllSingle17["PgUnionAllSingle[17∈2]"]:::plan
    __Item16 --> PgUnionAllSingle17
    PgUnionAllSingle17 --> Access18
    PgUnionAllSingle17 --> Access19
    Lambda22{{"Lambda[22∈2]<br />ᐸtoSpecifierᐳ"}}:::plan
    List21 --> Lambda22
    Access23{{"Access[23∈2]<br />ᐸ22.__typenameᐳ"}}:::plan
    Lambda22 --> Access23
    Access24{{"Access[24∈2]<br />ᐸ22.idᐳ"}}:::plan
    Lambda22 --> Access24
    PgSelect26[["PgSelect[26∈3]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Object11 & Access24 --> PgSelect26
    PgSelect40[["PgSelect[40∈3]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Object11 & Access24 --> PgSelect40
    First34{{"First[34∈3]^"}}:::plan
    PgSelectRows35[["PgSelectRows[35∈3]^"]]:::plan
    PgSelectRows35 --> First34
    PgSelect26 --> PgSelectRows35
    PgSelectSingle37{{"PgSelectSingle[37∈3]^<br />ᐸaws_applicationsᐳ"}}:::plan
    First34 --> PgSelectSingle37
    First48{{"First[48∈3]^"}}:::plan
    PgSelectRows49[["PgSelectRows[49∈3]^"]]:::plan
    PgSelectRows49 --> First48
    PgSelect40 --> PgSelectRows49
    PgSelectSingle51{{"PgSelectSingle[51∈3]^<br />ᐸgcp_applicationsᐳ"}}:::plan
    First48 --> PgSelectSingle51
    PgClassExpression52{{"PgClassExpression[52∈3]^<br />ᐸ__aws_appl..._.”aws_id”ᐳ"}}:::plan
    PgSelectSingle37 --> PgClassExpression52
    PgClassExpression54{{"PgClassExpression[54∈3]^<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    PgSelectSingle37 --> PgClassExpression54
    PgClassExpression63{{"PgClassExpression[63∈3]^<br />ᐸ__gcp_appl..._.”gcp_id”ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression63
    PgClassExpression64{{"PgClassExpression[64∈3]^<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression64
    Connection60{{"Connection[60∈3] ➊<br />ᐸ55ᐳ<br />ᐳAwsApplication"}}:::plan
    Connection70{{"Connection[70∈3] ➊<br />ᐸ65ᐳ<br />ᐳGcpApplication"}}:::plan
    PgUnionAll73[["PgUnionAll[73∈4]<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ<br />ᐳAwsApplication"]]:::plan
    Object11 & PgClassExpression54 & Lambda61 & Connection60 --> PgUnionAll73
    Access140{{"Access[140∈4]^<br />ᐸ73.itemsᐳ"}}:::plan
    PgUnionAll73 --> Access140
    List86{{"List[86∈6]^<br />ᐸ81,83,85ᐳ"}}:::plan
    Access81{{"Access[81∈6]^<br />ᐸ78.0ᐳ"}}:::plan
    Access83{{"Access[83∈6]^<br />ᐸ78.1ᐳ"}}:::plan
    Access81 & Access83 & Constant85 --> List86
    __Item77[/"__Item[77∈6]<br />ᐸ140ᐳ<br />ᐳAwsApplication"\]:::itemplan
    Access140 ==> __Item77
    PgUnionAllSingle78["PgUnionAllSingle[78∈6]^"]:::plan
    __Item77 --> PgUnionAllSingle78
    PgUnionAllSingle78 --> Access81
    PgUnionAllSingle78 --> Access83
    Lambda87{{"Lambda[87∈6]^<br />ᐸtoSpecifierᐳ"}}:::plan
    List86 --> Lambda87
    Access98{{"Access[98∈8]^<br />ᐸ97.__typenameᐳ"}}:::plan
    __Value97:::plan@{shape: docs, label: "__Combined[97∈8]<br />ᐳAwsApplication<br />ᐳGcpApplication"}
    __Value97 --> Access98
    Access100{{"Access[100∈8]^<br />ᐸ97.idᐳ"}}:::plan
    __Value97 --> Access100
    PgSelect102[["PgSelect[102∈9]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Object11 & Access100 --> PgSelect102
    PgSelect116[["PgSelect[116∈9]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Object11 & Access100 --> PgSelect116
    First110{{"First[110∈9]^"}}:::plan
    PgSelectRows111[["PgSelectRows[111∈9]^"]]:::plan
    PgSelectRows111 --> First110
    PgSelect102 --> PgSelectRows111
    PgSelectSingle113{{"PgSelectSingle[113∈9]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First110 --> PgSelectSingle113
    First124{{"First[124∈9]^"}}:::plan
    PgSelectRows125[["PgSelectRows[125∈9]^"]]:::plan
    PgSelectRows125 --> First124
    PgSelect116 --> PgSelectRows125
    PgSelectSingle127{{"PgSelectSingle[127∈9]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First124 --> PgSelectSingle127
    PgClassExpression128{{"PgClassExpression[128∈9]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle113 --> PgClassExpression128
    PgClassExpression129{{"PgClassExpression[129∈9]^<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle113 --> PgClassExpression129
    PgClassExpression130{{"PgClassExpression[130∈9]^<br />ᐸ__first_pa...team_name”ᐳ"}}:::plan
    PgSelectSingle113 --> PgClassExpression130
    PgClassExpression131{{"PgClassExpression[131∈9]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle127 --> PgClassExpression131
    PgClassExpression132{{"PgClassExpression[132∈9]^<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle127 --> PgClassExpression132
    PgClassExpression133{{"PgClassExpression[133∈9]^<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle127 --> PgClassExpression133
    PgUnionAll74[["PgUnionAll[74∈5]<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ<br />ᐳGcpApplication"]]:::plan
    Object11 & PgClassExpression64 & Lambda61 & Connection70 --> PgUnionAll74
    Access141{{"Access[141∈5]^<br />ᐸ74.itemsᐳ"}}:::plan
    PgUnionAll74 --> Access141
    List94{{"List[94∈7]^<br />ᐸ89,91,93ᐳ"}}:::plan
    Access89{{"Access[89∈7]^<br />ᐸ80.0ᐳ"}}:::plan
    Access91{{"Access[91∈7]^<br />ᐸ80.1ᐳ"}}:::plan
    Access89 & Access91 & Constant93 --> List94
    __Item79[/"__Item[79∈7]<br />ᐸ141ᐳ<br />ᐳGcpApplication"\]:::itemplan
    Access141 ==> __Item79
    PgUnionAllSingle80["PgUnionAllSingle[80∈7]^"]:::plan
    __Item79 --> PgUnionAllSingle80
    PgUnionAllSingle80 --> Access89
    PgUnionAllSingle80 --> Access91
    Lambda95{{"Lambda[95∈7]^<br />ᐸtoSpecifierᐳ"}}:::plan
    List94 --> Lambda95

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant7,Access9,Access10,Object11,Connection12,Lambda13,Constant20,Constant53,Lambda61,Constant85,Constant93 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll14,Access142 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item16,PgUnionAllSingle17,Access18,Access19,List21,Lambda22,Access23,Access24 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgSelect26,First34,PgSelectRows35,PgSelectSingle37,PgSelect40,First48,PgSelectRows49,PgSelectSingle51,PgClassExpression52,PgClassExpression54,Connection60,PgClassExpression63,PgClassExpression64,Connection70 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgUnionAll73,Access140 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgUnionAll74,Access141 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item77,PgUnionAllSingle78,Access81,Access83,List86,Lambda87 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7,__Item79,PgUnionAllSingle80,Access89,Access91,List94,Lambda95 bucket7
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Value97,Access98,Access100 bucket8
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgSelect102,First110,PgSelectRows111,PgSelectSingle113,PgSelect116,First124,PgSelectRows125,PgSelectSingle127,PgClassExpression128,PgClassExpression129,PgClassExpression130,PgClassExpression131,PgClassExpression132,PgClassExpression133 bucket9
    classDef bucket10 stroke:#ffff00
    class Bucket10 bucket10
    classDef bucket11 stroke:#00ffff
    class Bucket11 bucket11

    Lambda87 -.-x __Value97
    Lambda95 -.-x __Value97
