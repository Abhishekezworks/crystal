%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object19{{"Object[19∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access17{{"Access[17∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access18{{"Access[18∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access17 & Access18 --> Object19
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access17
    __Value2 --> Access18
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection20{{"Connection[20∈0] ➊<br />ᐸ16ᐳ"}}:::plan
    PgUnionAll21[["PgUnionAll[21∈1] ➊"]]:::plan
    Object19 & Connection20 --> PgUnionAll21
    __Item22[/"__Item[22∈2]<br />ᐸ21ᐳ"\]:::itemplan
    PgUnionAll21 ==> __Item22
    PgUnionAllSingle23["PgUnionAllSingle[23∈2]"]:::plan
    __Item22 --> PgUnionAllSingle23
    Access24{{"Access[24∈2]<br />ᐸ23.1ᐳ"}}:::plan
    PgUnionAllSingle23 --> Access24
    PgUnionAll49[["PgUnionAll[49∈3]<br />ᐳAwsApplication"]]:::plan
    PgClassExpression43{{"PgClassExpression[43∈3]<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    Connection48{{"Connection[48∈3] ➊<br />ᐸ44ᐳ<br />ᐳAwsApplication"}}:::plan
    Object19 & PgClassExpression43 & Connection48 --> PgUnionAll49
    PgUnionAll101[["PgUnionAll[101∈3]<br />ᐳGcpApplication"]]:::plan
    PgClassExpression95{{"PgClassExpression[95∈3]<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    Connection100{{"Connection[100∈3] ➊<br />ᐸ96ᐳ<br />ᐳGcpApplication"}}:::plan
    Object19 & PgClassExpression95 & Connection100 --> PgUnionAll101
    PgSelect27[["PgSelect[27∈3]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Access26{{"Access[26∈3]<br />ᐸ25.0ᐳ"}}:::plan
    Object19 & Access26 --> PgSelect27
    PgSelect79[["PgSelect[79∈3]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Access78{{"Access[78∈3]<br />ᐸ77.0ᐳ"}}:::plan
    Object19 & Access78 --> PgSelect79
    JSONParse25[["JSONParse[25∈3]<br />ᐸ24ᐳ<br />ᐳAwsApplication"]]:::plan
    Access24 --> JSONParse25
    JSONParse25 --> Access26
    First31{{"First[31∈3]"}}:::plan
    PgSelect27 --> First31
    PgSelectSingle32{{"PgSelectSingle[32∈3]<br />ᐸaws_applicationsᐳ"}}:::plan
    First31 --> PgSelectSingle32
    PgClassExpression33{{"PgClassExpression[33∈3]<br />ᐸ__aws_appl..._.”aws_id”ᐳ"}}:::plan
    PgSelectSingle32 --> PgClassExpression33
    PgSelectSingle32 --> PgClassExpression43
    JSONParse77[["JSONParse[77∈3]<br />ᐸ24ᐳ<br />ᐳGcpApplication"]]:::plan
    Access24 --> JSONParse77
    JSONParse77 --> Access78
    First83{{"First[83∈3]"}}:::plan
    PgSelect79 --> First83
    PgSelectSingle84{{"PgSelectSingle[84∈3]<br />ᐸgcp_applicationsᐳ"}}:::plan
    First83 --> PgSelectSingle84
    PgClassExpression85{{"PgClassExpression[85∈3]<br />ᐸ__gcp_appl..._.”gcp_id”ᐳ"}}:::plan
    PgSelectSingle84 --> PgClassExpression85
    PgSelectSingle84 --> PgClassExpression95
    __Item50[/"__Item[50∈4]<br />ᐸ49ᐳ"\]:::itemplan
    PgUnionAll49 ==> __Item50
    PgUnionAllSingle51["PgUnionAllSingle[51∈4]"]:::plan
    __Item50 --> PgUnionAllSingle51
    Access52{{"Access[52∈4]<br />ᐸ51.1ᐳ"}}:::plan
    PgUnionAllSingle51 --> Access52
    PgSelect55[["PgSelect[55∈5]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access54{{"Access[54∈5]<br />ᐸ53.0ᐳ"}}:::plan
    Object19 & Access54 --> PgSelect55
    PgSelect67[["PgSelect[67∈5]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access66{{"Access[66∈5]<br />ᐸ65.0ᐳ"}}:::plan
    Object19 & Access66 --> PgSelect67
    JSONParse53[["JSONParse[53∈5]<br />ᐸ52ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access52 --> JSONParse53
    JSONParse53 --> Access54
    First59{{"First[59∈5]"}}:::plan
    PgSelect55 --> First59
    PgSelectSingle60{{"PgSelectSingle[60∈5]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First59 --> PgSelectSingle60
    PgClassExpression61{{"PgClassExpression[61∈5]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle60 --> PgClassExpression61
    PgClassExpression62{{"PgClassExpression[62∈5]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle60 --> PgClassExpression62
    PgClassExpression63{{"PgClassExpression[63∈5]<br />ᐸ__first_pa...team_name”ᐳ"}}:::plan
    PgSelectSingle60 --> PgClassExpression63
    JSONParse65[["JSONParse[65∈5]<br />ᐸ52ᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access52 --> JSONParse65
    JSONParse65 --> Access66
    First71{{"First[71∈5]"}}:::plan
    PgSelect67 --> First71
    PgSelectSingle72{{"PgSelectSingle[72∈5]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First71 --> PgSelectSingle72
    PgClassExpression73{{"PgClassExpression[73∈5]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle72 --> PgClassExpression73
    PgClassExpression74{{"PgClassExpression[74∈5]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle72 --> PgClassExpression74
    PgClassExpression75{{"PgClassExpression[75∈5]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle72 --> PgClassExpression75
    __Item102[/"__Item[102∈6]<br />ᐸ101ᐳ"\]:::itemplan
    PgUnionAll101 ==> __Item102
    PgUnionAllSingle103["PgUnionAllSingle[103∈6]"]:::plan
    __Item102 --> PgUnionAllSingle103
    Access104{{"Access[104∈6]<br />ᐸ103.1ᐳ"}}:::plan
    PgUnionAllSingle103 --> Access104
    PgSelect107[["PgSelect[107∈7]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access106{{"Access[106∈7]<br />ᐸ105.0ᐳ"}}:::plan
    Object19 & Access106 --> PgSelect107
    PgSelect119[["PgSelect[119∈7]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access118{{"Access[118∈7]<br />ᐸ117.0ᐳ"}}:::plan
    Object19 & Access118 --> PgSelect119
    JSONParse105[["JSONParse[105∈7]<br />ᐸ104ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access104 --> JSONParse105
    JSONParse105 --> Access106
    First111{{"First[111∈7]"}}:::plan
    PgSelect107 --> First111
    PgSelectSingle112{{"PgSelectSingle[112∈7]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First111 --> PgSelectSingle112
    PgClassExpression113{{"PgClassExpression[113∈7]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression113
    PgClassExpression114{{"PgClassExpression[114∈7]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression114
    PgClassExpression115{{"PgClassExpression[115∈7]<br />ᐸ__first_pa...team_name”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression115
    JSONParse117[["JSONParse[117∈7]<br />ᐸ104ᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access104 --> JSONParse117
    JSONParse117 --> Access118
    First123{{"First[123∈7]"}}:::plan
    PgSelect119 --> First123
    PgSelectSingle124{{"PgSelectSingle[124∈7]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First123 --> PgSelectSingle124
    PgClassExpression125{{"PgClassExpression[125∈7]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle124 --> PgClassExpression125
    PgClassExpression126{{"PgClassExpression[126∈7]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle124 --> PgClassExpression126
    PgClassExpression127{{"PgClassExpression[127∈7]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle124 --> PgClassExpression127

    %% define steps

    subgraph "Buckets for queries/polymorphic/only"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access17,Access18,Object19,Connection20 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 19, 20<br /><br />ROOT Connectionᐸ16ᐳ[20]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll21 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 19<br /><br />ROOT __Item{2}ᐸ21ᐳ[22]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item22,PgUnionAllSingle23,Access24 bucket2
    Bucket3("Bucket 3 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 24, 19, 23<br />ᐳAwsApplication<br />ᐳGcpApplication<br /><br />1: JSONParse[25], JSONParse[77]<br />ᐳ: 48, 100, 26, 78<br />2: PgSelect[27], PgSelect[79]<br />ᐳ: 31, 32, 33, 43, 83, 84, 85, 95<br />3: PgUnionAll[49], PgUnionAll[101]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,JSONParse25,Access26,PgSelect27,First31,PgSelectSingle32,PgClassExpression33,PgClassExpression43,Connection48,PgUnionAll49,JSONParse77,Access78,PgSelect79,First83,PgSelectSingle84,PgClassExpression85,PgClassExpression95,Connection100,PgUnionAll101 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 19<br /><br />ROOT __Item{4}ᐸ49ᐳ[50]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item50,PgUnionAllSingle51,Access52 bucket4
    Bucket5("Bucket 5 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 52, 19, 51<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br /><br />1: JSONParse[53], JSONParse[65]<br />ᐳ: Access[54], Access[66]<br />2: PgSelect[55], PgSelect[67]<br />ᐳ: 59, 60, 61, 62, 63, 71, 72, 73, 74, 75"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,JSONParse53,Access54,PgSelect55,First59,PgSelectSingle60,PgClassExpression61,PgClassExpression62,PgClassExpression63,JSONParse65,Access66,PgSelect67,First71,PgSelectSingle72,PgClassExpression73,PgClassExpression74,PgClassExpression75 bucket5
    Bucket6("Bucket 6 (listItem)<br />Deps: 19<br /><br />ROOT __Item{6}ᐸ101ᐳ[102]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item102,PgUnionAllSingle103,Access104 bucket6
    Bucket7("Bucket 7 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 104, 19, 103<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br /><br />1: JSONParse[105], JSONParse[117]<br />ᐳ: Access[106], Access[118]<br />2: PgSelect[107], PgSelect[119]<br />ᐳ: 111, 112, 113, 114, 115, 123, 124, 125, 126, 127"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,JSONParse105,Access106,PgSelect107,First111,PgSelectSingle112,PgClassExpression113,PgClassExpression114,PgClassExpression115,JSONParse117,Access118,PgSelect119,First123,PgSelectSingle124,PgClassExpression125,PgClassExpression126,PgClassExpression127 bucket7
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    end
