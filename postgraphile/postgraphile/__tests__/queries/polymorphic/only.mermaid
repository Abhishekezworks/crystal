%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object19{{"Object[19∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access17{{"Access[17∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access18{{"Access[18∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access17 & Access18 --> Object19
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access17
    __Value2 --> Access18
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Connection20{{"Connection[20∈0] ➊<br />ᐸ16ᐳ"}}:::plan
    PgUnionAll21[["PgUnionAll[21∈1] ➊"]]:::plan
    Object19 & Connection20 --> PgUnionAll21
    __Item22[/"__Item[22∈2]<br />ᐸ21ᐳ"\]:::itemplan
    PgUnionAll21 ==> __Item22
    PgUnionAllSingle23["PgUnionAllSingle[23∈2]"]:::plan
    __Item22 --> PgUnionAllSingle23
    Access24{{"Access[24∈2]<br />ᐸ23.1ᐳ"}}:::plan
    PgUnionAllSingle23 --> Access24
    PgUnionAll47[["PgUnionAll[47∈3]<br />ᐳAwsApplication"]]:::plan
    PgClassExpression43{{"PgClassExpression[43∈3]<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    Connection46{{"Connection[46∈3] ➊<br />ᐸ44ᐳ<br />ᐳAwsApplication"}}:::plan
    Object19 & PgClassExpression43 & Connection46 --> PgUnionAll47
    PgUnionAll93[["PgUnionAll[93∈3]<br />ᐳGcpApplication"]]:::plan
    PgClassExpression89{{"PgClassExpression[89∈3]<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    Connection92{{"Connection[92∈3] ➊<br />ᐸ90ᐳ<br />ᐳGcpApplication"}}:::plan
    Object19 & PgClassExpression89 & Connection92 --> PgUnionAll93
    PgSelect27[["PgSelect[27∈3]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Access26{{"Access[26∈3]<br />ᐸ25.0ᐳ"}}:::plan
    Object19 & Access26 --> PgSelect27
    PgSelect75[["PgSelect[75∈3]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Access74{{"Access[74∈3]<br />ᐸ73.0ᐳ"}}:::plan
    Object19 & Access74 --> PgSelect75
    JSONParse25[["JSONParse[25∈3]<br />ᐸ24ᐳ<br />ᐳAwsApplication"]]:::plan
    Access24 --> JSONParse25
    JSONParse25 --> Access26
    First31{{"First[31∈3]"}}:::plan
    PgSelect27 --> First31
    PgSelectSingle32{{"PgSelectSingle[32∈3]<br />ᐸaws_applicationsᐳ"}}:::plan
    First31 --> PgSelectSingle32
    PgClassExpression33{{"PgClassExpression[33∈3]<br />ᐸ__aws_appl..._.”aws_id”ᐳ"}}:::plan
    PgSelectSingle32 --> PgClassExpression33
    PgSelectSingle32 --> PgClassExpression43
    JSONParse73[["JSONParse[73∈3]<br />ᐸ24ᐳ<br />ᐳGcpApplication"]]:::plan
    Access24 --> JSONParse73
    JSONParse73 --> Access74
    First77{{"First[77∈3]"}}:::plan
    PgSelect75 --> First77
    PgSelectSingle78{{"PgSelectSingle[78∈3]<br />ᐸgcp_applicationsᐳ"}}:::plan
    First77 --> PgSelectSingle78
    PgClassExpression79{{"PgClassExpression[79∈3]<br />ᐸ__gcp_appl..._.”gcp_id”ᐳ"}}:::plan
    PgSelectSingle78 --> PgClassExpression79
    PgSelectSingle78 --> PgClassExpression89
    __Item48[/"__Item[48∈4]<br />ᐸ47ᐳ"\]:::itemplan
    PgUnionAll47 ==> __Item48
    PgUnionAllSingle49["PgUnionAllSingle[49∈4]"]:::plan
    __Item48 --> PgUnionAllSingle49
    Access50{{"Access[50∈4]<br />ᐸ49.1ᐳ"}}:::plan
    PgUnionAllSingle49 --> Access50
    PgSelect53[["PgSelect[53∈5]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access52{{"Access[52∈5]<br />ᐸ51.0ᐳ"}}:::plan
    Object19 & Access52 --> PgSelect53
    PgSelect65[["PgSelect[65∈5]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access64{{"Access[64∈5]<br />ᐸ63.0ᐳ"}}:::plan
    Object19 & Access64 --> PgSelect65
    JSONParse51[["JSONParse[51∈5]<br />ᐸ50ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access50 --> JSONParse51
    JSONParse51 --> Access52
    First57{{"First[57∈5]"}}:::plan
    PgSelect53 --> First57
    PgSelectSingle58{{"PgSelectSingle[58∈5]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First57 --> PgSelectSingle58
    PgClassExpression59{{"PgClassExpression[59∈5]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression59
    PgClassExpression60{{"PgClassExpression[60∈5]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression60
    PgClassExpression61{{"PgClassExpression[61∈5]<br />ᐸ__first_pa...team_name”ᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression61
    JSONParse63[["JSONParse[63∈5]<br />ᐸ50ᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access50 --> JSONParse63
    JSONParse63 --> Access64
    First67{{"First[67∈5]"}}:::plan
    PgSelect65 --> First67
    PgSelectSingle68{{"PgSelectSingle[68∈5]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First67 --> PgSelectSingle68
    PgClassExpression69{{"PgClassExpression[69∈5]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle68 --> PgClassExpression69
    PgClassExpression70{{"PgClassExpression[70∈5]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle68 --> PgClassExpression70
    PgClassExpression71{{"PgClassExpression[71∈5]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle68 --> PgClassExpression71
    __Item94[/"__Item[94∈6]<br />ᐸ93ᐳ"\]:::itemplan
    PgUnionAll93 ==> __Item94
    PgUnionAllSingle95["PgUnionAllSingle[95∈6]"]:::plan
    __Item94 --> PgUnionAllSingle95
    Access96{{"Access[96∈6]<br />ᐸ95.1ᐳ"}}:::plan
    PgUnionAllSingle95 --> Access96
    PgSelect99[["PgSelect[99∈7]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access98{{"Access[98∈7]<br />ᐸ97.0ᐳ"}}:::plan
    Object19 & Access98 --> PgSelect99
    PgSelect111[["PgSelect[111∈7]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access110{{"Access[110∈7]<br />ᐸ109.0ᐳ"}}:::plan
    Object19 & Access110 --> PgSelect111
    JSONParse97[["JSONParse[97∈7]<br />ᐸ96ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access96 --> JSONParse97
    JSONParse97 --> Access98
    First103{{"First[103∈7]"}}:::plan
    PgSelect99 --> First103
    PgSelectSingle104{{"PgSelectSingle[104∈7]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First103 --> PgSelectSingle104
    PgClassExpression105{{"PgClassExpression[105∈7]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle104 --> PgClassExpression105
    PgClassExpression106{{"PgClassExpression[106∈7]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle104 --> PgClassExpression106
    PgClassExpression107{{"PgClassExpression[107∈7]<br />ᐸ__first_pa...team_name”ᐳ"}}:::plan
    PgSelectSingle104 --> PgClassExpression107
    JSONParse109[["JSONParse[109∈7]<br />ᐸ96ᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access96 --> JSONParse109
    JSONParse109 --> Access110
    First113{{"First[113∈7]"}}:::plan
    PgSelect111 --> First113
    PgSelectSingle114{{"PgSelectSingle[114∈7]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First113 --> PgSelectSingle114
    PgClassExpression115{{"PgClassExpression[115∈7]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression115
    PgClassExpression116{{"PgClassExpression[116∈7]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression116
    PgClassExpression117{{"PgClassExpression[117∈7]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression117

    %% define steps

    subgraph "Buckets for queries/polymorphic/only"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access17,Access18,Object19,Connection20 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 19, 20<br /><br />ROOT Connectionᐸ16ᐳ[20]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll21 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 19<br /><br />ROOT __Item{2}ᐸ21ᐳ[22]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item22,PgUnionAllSingle23,Access24 bucket2
    Bucket3("Bucket 3 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 24, 19, 23<br />ᐳAwsApplication<br />ᐳGcpApplication<br /><br />1: JSONParse[25], JSONParse[73]<br />ᐳ: 46, 92, 26, 74<br />2: PgSelect[27], PgSelect[75]<br />ᐳ: 31, 32, 33, 43, 77, 78, 79, 89<br />3: PgUnionAll[47], PgUnionAll[93]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,JSONParse25,Access26,PgSelect27,First31,PgSelectSingle32,PgClassExpression33,PgClassExpression43,Connection46,PgUnionAll47,JSONParse73,Access74,PgSelect75,First77,PgSelectSingle78,PgClassExpression79,PgClassExpression89,Connection92,PgUnionAll93 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 19<br /><br />ROOT __Item{4}ᐸ47ᐳ[48]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item48,PgUnionAllSingle49,Access50 bucket4
    Bucket5("Bucket 5 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 50, 19, 49<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br /><br />1: JSONParse[51], JSONParse[63]<br />ᐳ: Access[52], Access[64]<br />2: PgSelect[53], PgSelect[65]<br />ᐳ: 57, 58, 59, 60, 61, 67, 68, 69, 70, 71"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,JSONParse51,Access52,PgSelect53,First57,PgSelectSingle58,PgClassExpression59,PgClassExpression60,PgClassExpression61,JSONParse63,Access64,PgSelect65,First67,PgSelectSingle68,PgClassExpression69,PgClassExpression70,PgClassExpression71 bucket5
    Bucket6("Bucket 6 (listItem)<br />Deps: 19<br /><br />ROOT __Item{6}ᐸ93ᐳ[94]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item94,PgUnionAllSingle95,Access96 bucket6
    Bucket7("Bucket 7 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 96, 19, 95<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br /><br />1: JSONParse[97], JSONParse[109]<br />ᐳ: Access[98], Access[110]<br />2: PgSelect[99], PgSelect[111]<br />ᐳ: 103, 104, 105, 106, 107, 113, 114, 115, 116, 117"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,JSONParse97,Access98,PgSelect99,First103,PgSelectSingle104,PgClassExpression105,PgClassExpression106,PgClassExpression107,JSONParse109,Access110,PgSelect111,First113,PgSelectSingle114,PgClassExpression115,PgClassExpression116,PgClassExpression117 bucket7
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    end
