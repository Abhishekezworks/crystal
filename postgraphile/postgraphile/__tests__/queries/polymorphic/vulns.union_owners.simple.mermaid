%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/polymorphic/vulns.union_owners.simple"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 11, 12, 115, 34, 42, 92, 97<br /><br />ROOT Connectionᐸ8ᐳ[12]"):::bucket
    Bucket2("Bucket 2 (listItem)<br />Deps: 11, 34, 42, 92, 97<br /><br />ROOT __Item{2}ᐸ114ᐳ[15]"):::bucket
    Bucket3("Bucket 3 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 17, 11, 34, 42, 16, 92, 97<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability<br /><br />1: JSONParse[18]<br />ᐳ: 41, 49, 19<br />2: PgSelect[20], PgSelect[29]<br />3: PgSelectRows[25], PgSelectRows[32]<br />ᐳ: 24, 26, 31, 33, 35, 36, 37, 38, 43, 44, 45, 46<br />4: PgUnionAll[50], PgUnionAll[51]<br />ᐳ: Access[112], Access[113]"):::bucket
    Bucket4("Bucket 4 (listItem)<br />Deps: 11, 92, 97<br /><br />ROOT __Item{4}ᐸ112ᐳ[53]"):::bucket
    Bucket5("Bucket 5 (listItem)<br />Deps: 11, 92, 97<br /><br />ROOT __Item{5}ᐸ113ᐳ[56]"):::bucket
    Bucket6("Bucket 6 (polymorphic)<br />Organization,Person<br />Deps: 58, 11, 92, 97, 54<br />ᐳFirstPartyVulnerabilityᐳOrganization<br />ᐳFirstPartyVulnerabilityᐳPerson<br /><br />1: JSONParse[59]<br />ᐳ: Access[60]<br />2: PgSelect[61], PgSelect[70]<br />3: PgSelectRows[66], PgSelectRows[73]<br />ᐳ: 65, 67, 72, 74, 93, 94, 95, 96, 98, 99, 100, 101"):::bucket
    Bucket7("Bucket 7 (polymorphic)<br />Organization,Person<br />Deps: 75, 11, 92, 97, 57<br />ᐳThirdPartyVulnerabilityᐳOrganization<br />ᐳThirdPartyVulnerabilityᐳPerson<br /><br />1: JSONParse[76]<br />ᐳ: Access[77]<br />2: PgSelect[78], PgSelect[87]<br />3: PgSelectRows[83], PgSelectRows[90]<br />ᐳ: 82, 84, 89, 91, 103, 104, 105, 106, 108, 109, 110, 111"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket5
    Bucket4 --> Bucket6
    Bucket5 --> Bucket7

    %% plan dependencies
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access9 & Access10 --> Object11
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access9
    __Value2 --> Access10
    Connection12{{"Connection[12∈0] ➊<br />ᐸ8ᐳ"}}:::plan
    Constant115{{"Constant[115∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Constant115 --> Connection12
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant34{{"Constant[34∈0] ➊<br />ᐸ'first_party_vulnerabilities'ᐳ"}}:::plan
    Constant42{{"Constant[42∈0] ➊<br />ᐸ'third_party_vulnerabilities'ᐳ"}}:::plan
    Constant92{{"Constant[92∈0] ➊<br />ᐸ'organizations'ᐳ"}}:::plan
    Constant97{{"Constant[97∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    PgUnionAll13[["PgUnionAll[13∈1] ➊<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    Object11 & Connection12 & Constant115 --> PgUnionAll13
    Access114{{"Access[114∈1] ➊<br />ᐸ13.itemsᐳ"}}:::plan
    PgUnionAll13 --> Access114
    __Item15[/"__Item[15∈2]<br />ᐸ114ᐳ"\]:::itemplan
    Access114 ==> __Item15
    PgUnionAllSingle16["PgUnionAllSingle[16∈2]"]:::plan
    __Item15 --> PgUnionAllSingle16
    Access17{{"Access[17∈2]<br />ᐸ16.1ᐳ"}}:::plan
    PgUnionAllSingle16 --> Access17
    PgUnionAll50[["PgUnionAll[50∈3]^<br />ᐸPerson,Organization,Person,Organizationᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    PgClassExpression35{{"PgClassExpression[35∈3]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    Connection41{{"Connection[41∈3] ➊<br />ᐸ39ᐳ<br />ᐳFirstPartyVulnerability"}}:::plan
    Object11 & PgClassExpression35 & Connection41 --> PgUnionAll50
    PgUnionAll51[["PgUnionAll[51∈3]^<br />ᐸPerson,Organization,Person,Organizationᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    PgClassExpression43{{"PgClassExpression[43∈3]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    Connection49{{"Connection[49∈3] ➊<br />ᐸ47ᐳ<br />ᐳThirdPartyVulnerability"}}:::plan
    Object11 & PgClassExpression43 & Connection49 --> PgUnionAll51
    PgSelect20[["PgSelect[20∈3]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access19{{"Access[19∈3]^<br />ᐸ18.0ᐳ"}}:::plan
    Object11 & Access19 --> PgSelect20
    PgSelect29[["PgSelect[29∈3]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Object11 & Access19 --> PgSelect29
    List36{{"List[36∈3]^<br />ᐸ34,35ᐳ"}}:::plan
    Constant34 & PgClassExpression35 --> List36
    List44{{"List[44∈3]^<br />ᐸ42,43ᐳ"}}:::plan
    Constant42 & PgClassExpression43 --> List44
    JSONParse18[["JSONParse[18∈3]<br />ᐸ17ᐳ<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability"]]:::plan
    Access17 --> JSONParse18
    JSONParse18 --> Access19
    First24{{"First[24∈3]^"}}:::plan
    PgSelectRows25[["PgSelectRows[25∈3]^"]]:::plan
    PgSelectRows25 --> First24
    PgSelect20 --> PgSelectRows25
    PgSelectSingle26{{"PgSelectSingle[26∈3]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First24 --> PgSelectSingle26
    First31{{"First[31∈3]^"}}:::plan
    PgSelectRows32[["PgSelectRows[32∈3]^"]]:::plan
    PgSelectRows32 --> First31
    PgSelect29 --> PgSelectRows32
    PgSelectSingle33{{"PgSelectSingle[33∈3]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First31 --> PgSelectSingle33
    PgSelectSingle26 --> PgClassExpression35
    Lambda37{{"Lambda[37∈3]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List36 --> Lambda37
    PgClassExpression38{{"PgClassExpression[38∈3]^<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle26 --> PgClassExpression38
    PgSelectSingle33 --> PgClassExpression43
    Lambda45{{"Lambda[45∈3]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List44 --> Lambda45
    PgClassExpression46{{"PgClassExpression[46∈3]^<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle33 --> PgClassExpression46
    Access112{{"Access[112∈3]^<br />ᐸ50.itemsᐳ"}}:::plan
    PgUnionAll50 --> Access112
    Access113{{"Access[113∈3]^<br />ᐸ51.itemsᐳ"}}:::plan
    PgUnionAll51 --> Access113
    __Item53[/"__Item[53∈4]<br />ᐸ112ᐳ<br />ᐳFirstPartyVulnerability"\]:::itemplan
    Access112 ==> __Item53
    PgUnionAllSingle54["PgUnionAllSingle[54∈4]^"]:::plan
    __Item53 --> PgUnionAllSingle54
    Access58{{"Access[58∈4]^<br />ᐸ54.1ᐳ"}}:::plan
    PgUnionAllSingle54 --> Access58
    PgSelect61[["PgSelect[61∈6]<br />ᐸorganizationsᐳ<br />ᐳFirstPartyVulnerabilityᐳOrganization"]]:::plan
    Access60{{"Access[60∈6]^<br />ᐸ59.0ᐳ"}}:::plan
    Object11 & Access60 --> PgSelect61
    PgSelect70[["PgSelect[70∈6]<br />ᐸpeopleᐳ<br />ᐳFirstPartyVulnerabilityᐳPerson"]]:::plan
    Object11 & Access60 --> PgSelect70
    List94{{"List[94∈6]^<br />ᐸ92,93ᐳ"}}:::plan
    PgClassExpression93{{"PgClassExpression[93∈6]^<br />ᐸ__organiza...zation_id”ᐳ"}}:::plan
    Constant92 & PgClassExpression93 --> List94
    List99{{"List[99∈6]^<br />ᐸ97,98ᐳ"}}:::plan
    PgClassExpression98{{"PgClassExpression[98∈6]^<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Constant97 & PgClassExpression98 --> List99
    JSONParse59[["JSONParse[59∈6]<br />ᐸ58ᐳ<br />ᐳFirstPartyVulnerabilityᐳOrganization<br />ᐳFirstPartyVulnerabilityᐳPerson"]]:::plan
    Access58 --> JSONParse59
    JSONParse59 --> Access60
    First65{{"First[65∈6]^"}}:::plan
    PgSelectRows66[["PgSelectRows[66∈6]^"]]:::plan
    PgSelectRows66 --> First65
    PgSelect61 --> PgSelectRows66
    PgSelectSingle67{{"PgSelectSingle[67∈6]^<br />ᐸorganizationsᐳ"}}:::plan
    First65 --> PgSelectSingle67
    First72{{"First[72∈6]^"}}:::plan
    PgSelectRows73[["PgSelectRows[73∈6]^"]]:::plan
    PgSelectRows73 --> First72
    PgSelect70 --> PgSelectRows73
    PgSelectSingle74{{"PgSelectSingle[74∈6]^<br />ᐸpeopleᐳ"}}:::plan
    First72 --> PgSelectSingle74
    PgSelectSingle67 --> PgClassExpression93
    Lambda95{{"Lambda[95∈6]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List94 --> Lambda95
    PgClassExpression96{{"PgClassExpression[96∈6]^<br />ᐸ__organiza...s__.”name”ᐳ"}}:::plan
    PgSelectSingle67 --> PgClassExpression96
    PgSelectSingle74 --> PgClassExpression98
    Lambda100{{"Lambda[100∈6]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List99 --> Lambda100
    PgClassExpression101{{"PgClassExpression[101∈6]^<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle74 --> PgClassExpression101
    __Item56[/"__Item[56∈5]<br />ᐸ113ᐳ<br />ᐳThirdPartyVulnerability"\]:::itemplan
    Access113 ==> __Item56
    PgUnionAllSingle57["PgUnionAllSingle[57∈5]^"]:::plan
    __Item56 --> PgUnionAllSingle57
    Access75{{"Access[75∈5]^<br />ᐸ57.1ᐳ"}}:::plan
    PgUnionAllSingle57 --> Access75
    PgSelect78[["PgSelect[78∈7]<br />ᐸorganizationsᐳ<br />ᐳThirdPartyVulnerabilityᐳOrganization"]]:::plan
    Access77{{"Access[77∈7]^<br />ᐸ76.0ᐳ"}}:::plan
    Object11 & Access77 --> PgSelect78
    PgSelect87[["PgSelect[87∈7]<br />ᐸpeopleᐳ<br />ᐳThirdPartyVulnerabilityᐳPerson"]]:::plan
    Object11 & Access77 --> PgSelect87
    List104{{"List[104∈7]^<br />ᐸ92,103ᐳ"}}:::plan
    PgClassExpression103{{"PgClassExpression[103∈7]^<br />ᐸ__organiza...zation_id”ᐳ"}}:::plan
    Constant92 & PgClassExpression103 --> List104
    List109{{"List[109∈7]^<br />ᐸ97,108ᐳ"}}:::plan
    PgClassExpression108{{"PgClassExpression[108∈7]^<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Constant97 & PgClassExpression108 --> List109
    JSONParse76[["JSONParse[76∈7]<br />ᐸ75ᐳ<br />ᐳThirdPartyVulnerabilityᐳOrganization<br />ᐳThirdPartyVulnerabilityᐳPerson"]]:::plan
    Access75 --> JSONParse76
    JSONParse76 --> Access77
    First82{{"First[82∈7]^"}}:::plan
    PgSelectRows83[["PgSelectRows[83∈7]^"]]:::plan
    PgSelectRows83 --> First82
    PgSelect78 --> PgSelectRows83
    PgSelectSingle84{{"PgSelectSingle[84∈7]^<br />ᐸorganizationsᐳ"}}:::plan
    First82 --> PgSelectSingle84
    First89{{"First[89∈7]^"}}:::plan
    PgSelectRows90[["PgSelectRows[90∈7]^"]]:::plan
    PgSelectRows90 --> First89
    PgSelect87 --> PgSelectRows90
    PgSelectSingle91{{"PgSelectSingle[91∈7]^<br />ᐸpeopleᐳ"}}:::plan
    First89 --> PgSelectSingle91
    PgSelectSingle84 --> PgClassExpression103
    Lambda105{{"Lambda[105∈7]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List104 --> Lambda105
    PgClassExpression106{{"PgClassExpression[106∈7]^<br />ᐸ__organiza...s__.”name”ᐳ"}}:::plan
    PgSelectSingle84 --> PgClassExpression106
    PgSelectSingle91 --> PgClassExpression108
    Lambda110{{"Lambda[110∈7]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List109 --> Lambda110
    PgClassExpression111{{"PgClassExpression[111∈7]^<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle91 --> PgClassExpression111

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access9,Access10,Object11,Connection12,Constant34,Constant42,Constant92,Constant97,Constant115 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll13,Access114 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item15,PgUnionAllSingle16,Access17 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,JSONParse18,Access19,PgSelect20,First24,PgSelectRows25,PgSelectSingle26,PgSelect29,First31,PgSelectRows32,PgSelectSingle33,PgClassExpression35,List36,Lambda37,PgClassExpression38,Connection41,PgClassExpression43,List44,Lambda45,PgClassExpression46,Connection49,PgUnionAll50,PgUnionAll51,Access112,Access113 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item53,PgUnionAllSingle54,Access58 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item56,PgUnionAllSingle57,Access75 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,JSONParse59,Access60,PgSelect61,First65,PgSelectRows66,PgSelectSingle67,PgSelect70,First72,PgSelectRows73,PgSelectSingle74,PgClassExpression93,List94,Lambda95,PgClassExpression96,PgClassExpression98,List99,Lambda100,PgClassExpression101 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7,JSONParse76,Access77,PgSelect78,First82,PgSelectRows83,PgSelectSingle84,PgSelect87,First89,PgSelectRows90,PgSelectSingle91,PgClassExpression103,List104,Lambda105,PgClassExpression106,PgClassExpression108,List109,Lambda110,PgClassExpression111 bucket7

