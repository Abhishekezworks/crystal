%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/polymorphic/vulns.union_owners.simple"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 11, 12, 161, 19, 51, 65, 91, 99, 134, 140<br /><br />ROOT Connectionᐸ8ᐳ[12]"):::bucket
    Bucket2("Bucket 2 (listItem)<br />Deps: 19, 11, 51, 65, 91, 99, 134, 140<br /><br />ROOT __Item{2}ᐸ160ᐳ[15]"):::bucket
    Bucket3("Bucket 3 (polymorphic)<br />__typename: Access[22]<br />Deps: 11, 23, 51, 65, 22, 91, 99, 134, 140<br /><br />1: 25, 39, 64, 78<br />2: PgSelectRows[34], PgSelectRows[48]<br />ᐳ: 33, 36, 47, 50, 52, 53, 56, 66, 67, 70<br />3: __DataOnly[55]<br />ᐳ: Lambda[54]"):::bucket
    Bucket4("Bucket 4 (polymorphicPartition)<br />|FirstPartyVulnerability<br />Deps: 11, 52, 64, 91, 134, 140, 56<br />ᐳFirstPartyVulnerability"):::bucket
    Bucket5("Bucket 5 (polymorphicPartition)<br />|ThirdPartyVulnerability<br />Deps: 11, 66, 78, 99, 134, 140, 70<br />ᐳThirdPartyVulnerability"):::bucket
    Bucket6("Bucket 6 (listItem)<br />Deps: 91, 11, 134, 140<br /><br />ROOT __Item{6}ᐸ158ᐳ[83]"):::bucket
    Bucket7("Bucket 7 (listItem)<br />Deps: 99, 11, 134, 140<br /><br />ROOT __Item{7}ᐸ159ᐳ[85]"):::bucket
    Bucket8("Bucket 8 (combined)<br />Deps: 11, 134, 140"):::bucket
    Bucket9("Bucket 9 (polymorphic)<br />__typename: Access[104]<br />Deps: 103, 11, 134, 140, 104<br /><br />1: <br />ᐳ: Access[106], Access[120]<br />2: PgSelect[108], PgSelect[122]<br />3: PgSelectRows[117], PgSelectRows[131]<br />ᐳ: 116, 119, 130, 133, 135, 136, 139, 141, 142, 145<br />4: __DataOnly[138]<br />ᐳ: Lambda[137]"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket5
    Bucket4 --> Bucket6
    Bucket5 --> Bucket7
    Bucket6 --> Bucket8
    Bucket7 --> Bucket8
    Bucket8 --> Bucket9

    %% plan dependencies
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access9 & Access10 --> Object11
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access9
    __Value2 --> Access10
    Connection12{{"Connection[12∈0] ➊<br />ᐸ8ᐳ"}}:::plan
    Constant161{{"Constant[161∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Constant161 --> Connection12
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant19{{"Constant[19∈0] ➊<br />ᐸ[HIDDEN]ᐳ"}}:::plan
    Constant51{{"Constant[51∈0] ➊<br />ᐸ'first_party_vulnerabilities'ᐳ"}}:::plan
    Constant65{{"Constant[65∈0] ➊<br />ᐸ'third_party_vulnerabilities'ᐳ"}}:::plan
    Constant91{{"Constant[91∈0] ➊<br />ᐸ[HIDDEN]ᐳ"}}:::plan
    Constant99{{"Constant[99∈0] ➊<br />ᐸ[HIDDEN]ᐳ"}}:::plan
    Constant134{{"Constant[134∈0] ➊<br />ᐸ'organizations'ᐳ"}}:::plan
    Constant140{{"Constant[140∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    PgUnionAll13[["PgUnionAll[13∈1] ➊<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    Object11 & Connection12 & Constant161 --> PgUnionAll13
    Access160{{"Access[160∈1] ➊<br />ᐸ13.itemsᐳ"}}:::plan
    PgUnionAll13 --> Access160
    List20{{"List[20∈2]<br />ᐸ17,18,19ᐳ"}}:::plan
    Access17{{"Access[17∈2]<br />ᐸ15.0ᐳ"}}:::plan
    Access18{{"Access[18∈2]<br />ᐸ15.1ᐳ"}}:::plan
    Access17 & Access18 & Constant19 --> List20
    __Item15[/"__Item[15∈2]<br />ᐸ160ᐳ"\]:::itemplan
    Access160 ==> __Item15
    __Item15 --> Access17
    __Item15 --> Access18
    Lambda21{{"Lambda[21∈2]<br />ᐸtoSpecifierᐳ"}}:::plan
    List20 --> Lambda21
    Access22{{"Access[22∈2]<br />ᐸ21.__typenameᐳ"}}:::plan
    Lambda21 --> Access22
    Access23{{"Access[23∈2]<br />ᐸ21.idᐳ"}}:::plan
    Lambda21 --> Access23
    PgSelect25[["PgSelect[25∈3]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Object11 & Access23 --> PgSelect25
    PgSelect39[["PgSelect[39∈3]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Object11 & Access23 --> PgSelect39
    List53{{"List[53∈3]^<br />ᐸ51,52ᐳ"}}:::plan
    PgClassExpression52{{"PgClassExpression[52∈3]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    Constant51 & PgClassExpression52 --> List53
    __DataOnly55["__DataOnly[55∈3]<br />ᐸ53,67ᐳ<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability"]:::plan
    List67{{"List[67∈3]^<br />ᐸ65,66ᐳ"}}:::plan
    List53 -->|"trapError;trapInhibited"| __DataOnly55
    List67 -->|"trapError;trapInhibited"| __DataOnly55
    PgClassExpression66{{"PgClassExpression[66∈3]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    Constant65 & PgClassExpression66 --> List67
    First33{{"First[33∈3]^"}}:::plan
    PgSelectRows34[["PgSelectRows[34∈3]^"]]:::plan
    PgSelectRows34 --> First33
    PgSelect25 --> PgSelectRows34
    PgSelectSingle36{{"PgSelectSingle[36∈3]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First33 --> PgSelectSingle36
    First47{{"First[47∈3]^"}}:::plan
    PgSelectRows48[["PgSelectRows[48∈3]^"]]:::plan
    PgSelectRows48 --> First47
    PgSelect39 --> PgSelectRows48
    PgSelectSingle50{{"PgSelectSingle[50∈3]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First47 --> PgSelectSingle50
    PgSelectSingle36 --> PgClassExpression52
    Lambda54{{"Lambda[54∈3]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    __DataOnly55 --> Lambda54
    PgClassExpression56{{"PgClassExpression[56∈3]^<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle36 --> PgClassExpression56
    PgSelectSingle50 --> PgClassExpression66
    PgClassExpression70{{"PgClassExpression[70∈3]^<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle50 --> PgClassExpression70
    Connection64{{"Connection[64∈3] ➊<br />ᐸ57ᐳ<br />ᐳFirstPartyVulnerability"}}:::plan
    Connection78{{"Connection[78∈3] ➊<br />ᐸ71ᐳ<br />ᐳThirdPartyVulnerability"}}:::plan
    PgUnionAll79[["PgUnionAll[79∈4]<br />ᐸPerson,Organization,Person,Organizationᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Object11 & PgClassExpression52 & Connection64 --> PgUnionAll79
    Access158{{"Access[158∈4]^<br />ᐸ79.itemsᐳ"}}:::plan
    PgUnionAll79 --> Access158
    List92{{"List[92∈6]^<br />ᐸ87,89,91ᐳ"}}:::plan
    Access87{{"Access[87∈6]^<br />ᐸ83.0ᐳ"}}:::plan
    Access89{{"Access[89∈6]^<br />ᐸ83.1ᐳ"}}:::plan
    Access87 & Access89 & Constant91 --> List92
    __Item83[/"__Item[83∈6]<br />ᐸ158ᐳ<br />ᐳFirstPartyVulnerability"\]:::itemplan
    Access158 ==> __Item83
    __Item83 --> Access87
    __Item83 --> Access89
    Lambda93{{"Lambda[93∈6]^<br />ᐸtoSpecifierᐳ"}}:::plan
    List92 --> Lambda93
    Access104{{"Access[104∈8]^<br />ᐸ103.__typenameᐳ"}}:::plan
    __Value103:::plan@{shape: docs, label: "__Combined[103∈8]<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability"}
    __Value103 --> Access104
    __DataOnly138["__DataOnly[138∈9]<br />ᐸ136,142,136,142ᐳ<br />(2) ...ᐳOrganization<br />(2) ...ᐳPerson"]:::plan
    List136{{"List[136∈9]^<br />ᐸ134,135ᐳ"}}:::plan
    List142{{"List[142∈9]^<br />ᐸ140,141ᐳ"}}:::plan
    List136 -->|"trapError;trapInhibited"| __DataOnly138
    List142 -->|"trapError;trapInhibited"| __DataOnly138
    List136 -->|"trapError;trapInhibited"| __DataOnly138
    List142 -->|"trapError;trapInhibited"| __DataOnly138
    PgSelect108[["PgSelect[108∈9]^<br />ᐸorganizationsᐳ"]]:::plan
    Access106{{"Access[106∈9]<br />ᐸ103.organization_idᐳ<br />(2) ...ᐳOrganization"}}:::plan
    Object11 & Access106 --> PgSelect108
    PgSelect122[["PgSelect[122∈9]^<br />ᐸpeopleᐳ"]]:::plan
    Access120{{"Access[120∈9]<br />ᐸ103.person_idᐳ<br />(2) ...ᐳPerson"}}:::plan
    Object11 & Access120 --> PgSelect122
    PgClassExpression135{{"PgClassExpression[135∈9]^<br />ᐸ__organiza...zation_id”ᐳ"}}:::plan
    Constant134 & PgClassExpression135 --> List136
    PgClassExpression141{{"PgClassExpression[141∈9]^<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Constant140 & PgClassExpression141 --> List142
    __Value103 --> Access106
    First116{{"First[116∈9]^"}}:::plan
    PgSelectRows117[["PgSelectRows[117∈9]^"]]:::plan
    PgSelectRows117 --> First116
    PgSelect108 --> PgSelectRows117
    PgSelectSingle119{{"PgSelectSingle[119∈9]^<br />ᐸorganizationsᐳ"}}:::plan
    First116 --> PgSelectSingle119
    __Value103 --> Access120
    First130{{"First[130∈9]^"}}:::plan
    PgSelectRows131[["PgSelectRows[131∈9]^"]]:::plan
    PgSelectRows131 --> First130
    PgSelect122 --> PgSelectRows131
    PgSelectSingle133{{"PgSelectSingle[133∈9]^<br />ᐸpeopleᐳ"}}:::plan
    First130 --> PgSelectSingle133
    PgSelectSingle119 --> PgClassExpression135
    Lambda137{{"Lambda[137∈9]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    __DataOnly138 --> Lambda137
    PgClassExpression139{{"PgClassExpression[139∈9]^<br />ᐸ__organiza...s__.”name”ᐳ"}}:::plan
    PgSelectSingle119 --> PgClassExpression139
    PgSelectSingle133 --> PgClassExpression141
    PgClassExpression145{{"PgClassExpression[145∈9]^<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle133 --> PgClassExpression145
    PgUnionAll80[["PgUnionAll[80∈5]<br />ᐸPerson,Organization,Person,Organizationᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Object11 & PgClassExpression66 & Connection78 --> PgUnionAll80
    Access159{{"Access[159∈5]^<br />ᐸ80.itemsᐳ"}}:::plan
    PgUnionAll80 --> Access159
    List100{{"List[100∈7]^<br />ᐸ95,97,99ᐳ"}}:::plan
    Access95{{"Access[95∈7]^<br />ᐸ85.0ᐳ"}}:::plan
    Access97{{"Access[97∈7]^<br />ᐸ85.1ᐳ"}}:::plan
    Access95 & Access97 & Constant99 --> List100
    __Item85[/"__Item[85∈7]<br />ᐸ159ᐳ<br />ᐳThirdPartyVulnerability"\]:::itemplan
    Access159 ==> __Item85
    __Item85 --> Access95
    __Item85 --> Access97
    Lambda101{{"Lambda[101∈7]^<br />ᐸtoSpecifierᐳ"}}:::plan
    List100 --> Lambda101

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access9,Access10,Object11,Connection12,Constant19,Constant51,Constant65,Constant91,Constant99,Constant134,Constant140,Constant161 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll13,Access160 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item15,Access17,Access18,List20,Lambda21,Access22,Access23 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgSelect25,First33,PgSelectRows34,PgSelectSingle36,PgSelect39,First47,PgSelectRows48,PgSelectSingle50,PgClassExpression52,List53,Lambda54,__DataOnly55,PgClassExpression56,Connection64,PgClassExpression66,List67,PgClassExpression70,Connection78 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgUnionAll79,Access158 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgUnionAll80,Access159 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item83,Access87,Access89,List92,Lambda93 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7,__Item85,Access95,Access97,List100,Lambda101 bucket7
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Value103,Access104 bucket8
    classDef bucket9 stroke:#ff0000
    class Bucket9,Access106,PgSelect108,First116,PgSelectRows117,PgSelectSingle119,Access120,PgSelect122,First130,PgSelectRows131,PgSelectSingle133,PgClassExpression135,List136,Lambda137,__DataOnly138,PgClassExpression139,PgClassExpression141,List142,PgClassExpression145 bucket9

    Lambda93 -.-x __Value103
    Lambda101 -.-x __Value103
