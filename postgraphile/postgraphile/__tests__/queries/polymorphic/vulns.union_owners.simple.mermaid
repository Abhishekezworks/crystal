%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/polymorphic/vulns.union_owners.simple"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 12, 14, 162, 48, 59, 135, 141<br /><br />ROOT Connectionᐸ8ᐳ[14]"):::bucket
    Bucket2("Bucket 2 (listItem)<br />Deps: 12, 48, 59, 135, 141<br /><br />ROOT __Item{2}ᐸ161ᐳ[18]"):::bucket
    Bucket3("Bucket 3 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 19, 12, 48, 59, 135, 141<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability<br /><br />1: Connection[58], Connection[69]<br />ᐳ: Access[20]<br />2: JSONParse[22]<br />ᐳ: Access[24]<br />3: PgSelect[26], PgSelect[40]<br />4: PgSelectRows[34], PgSelectRows[45]<br />ᐳ: 33, 36, 44, 47, 49, 50, 53, 60, 61, 64<br />5: 52, 70, 72<br />ᐳ: Lambda[51], Access[159], Access[160]"):::bucket
    Bucket4("Bucket 4 (listItem)<br />Deps: 12, 135, 141<br /><br />ROOT __Item{4}ᐸ159ᐳ[74]"):::bucket
    Bucket5("Bucket 5 (listItem)<br />Deps: 12, 135, 141<br /><br />ROOT __Item{5}ᐸ160ᐳ[77]"):::bucket
    Bucket6("Bucket 6 (polymorphic)<br />Organization,Person<br />Deps: 75, 12, 135, 141<br />ᐳFirstPartyVulnerabilityᐳOrganization<br />ᐳFirstPartyVulnerabilityᐳPerson<br /><br />1: <br />ᐳ: Access[79]<br />2: JSONParse[81]<br />ᐳ: Access[83]<br />3: PgSelect[85], PgSelect[99]<br />4: PgSelectRows[93], PgSelectRows[104]<br />ᐳ: 92, 95, 103, 106, 136, 137, 140, 142, 143, 146<br />5: __DataOnly[139]<br />ᐳ: Lambda[138]"):::bucket
    Bucket7("Bucket 7 (polymorphic)<br />Organization,Person<br />Deps: 78, 12, 135, 141<br />ᐳThirdPartyVulnerabilityᐳOrganization<br />ᐳThirdPartyVulnerabilityᐳPerson<br /><br />1: <br />ᐳ: Access[107]<br />2: JSONParse[109]<br />ᐳ: Access[111]<br />3: PgSelect[113], PgSelect[127]<br />4: PgSelectRows[121], PgSelectRows[132]<br />ᐳ: 120, 123, 131, 134, 148, 149, 152, 154, 155, 158<br />5: __DataOnly[151]<br />ᐳ: Lambda[150]"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket5
    Bucket4 --> Bucket6
    Bucket5 --> Bucket7

    %% plan dependencies
    Object12{{"Object[12∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access9 & Access11 --> Object12
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access9
    __Value2 --> Access11
    Connection14{{"Connection[14∈0] ➊<br />ᐸ8ᐳ"}}:::plan
    Constant162{{"Constant[162∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Constant162 --> Connection14
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant48{{"Constant[48∈0] ➊<br />ᐸ'first_party_vulnerabilities'ᐳ"}}:::plan
    Constant59{{"Constant[59∈0] ➊<br />ᐸ'third_party_vulnerabilities'ᐳ"}}:::plan
    Constant135{{"Constant[135∈0] ➊<br />ᐸ'organizations'ᐳ"}}:::plan
    Constant141{{"Constant[141∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    PgUnionAll15[["PgUnionAll[15∈1] ➊<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    Object12 & Connection14 & Constant162 --> PgUnionAll15
    Access161{{"Access[161∈1] ➊<br />ᐸ15.itemsᐳ"}}:::plan
    PgUnionAll15 --> Access161
    __Item18[/"__Item[18∈2]<br />ᐸ161ᐳ"\]:::itemplan
    Access161 ==> __Item18
    PgUnionAllSingle19["PgUnionAllSingle[19∈2]"]:::plan
    __Item18 --> PgUnionAllSingle19
    PgUnionAll70[["PgUnionAll[70∈3]^<br />ᐸPerson,Organization,Person,Organizationᐳ"]]:::plan
    PgClassExpression49{{"PgClassExpression[49∈3]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    Connection58{{"Connection[58∈3] ➊<br />ᐸ54ᐳ<br />ᐳFirstPartyVulnerability"}}:::plan
    Object12 & PgClassExpression49 & Connection58 --> PgUnionAll70
    PgUnionAll72[["PgUnionAll[72∈3]^<br />ᐸPerson,Organization,Person,Organizationᐳ"]]:::plan
    PgClassExpression60{{"PgClassExpression[60∈3]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    Connection69{{"Connection[69∈3] ➊<br />ᐸ65ᐳ<br />ᐳThirdPartyVulnerability"}}:::plan
    Object12 & PgClassExpression60 & Connection69 --> PgUnionAll72
    PgSelect26[["PgSelect[26∈3]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access24{{"Access[24∈3]^<br />ᐸ22.0ᐳ"}}:::plan
    Object12 & Access24 --> PgSelect26
    PgSelect40[["PgSelect[40∈3]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Object12 & Access24 --> PgSelect40
    List50{{"List[50∈3]^<br />ᐸ48,49ᐳ"}}:::plan
    Constant48 & PgClassExpression49 --> List50
    __DataOnly52["__DataOnly[52∈3]<br />ᐸ50,61ᐳ<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability"]:::plan
    List61{{"List[61∈3]^<br />ᐸ59,60ᐳ"}}:::plan
    List50 -->|"trapError;trapInhibited"| __DataOnly52
    List61 --> __DataOnly52
    Constant59 & PgClassExpression60 --> List61
    Access20{{"Access[20∈3]<br />ᐸ19.1ᐳ<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability"}}:::plan
    PgUnionAllSingle19 --> Access20
    JSONParse22[["JSONParse[22∈3]^<br />ᐸ20ᐳ"]]:::plan
    Access20 --> JSONParse22
    JSONParse22 --> Access24
    First33{{"First[33∈3]^"}}:::plan
    PgSelectRows34[["PgSelectRows[34∈3]^"]]:::plan
    PgSelectRows34 --> First33
    PgSelect26 --> PgSelectRows34
    PgSelectSingle36{{"PgSelectSingle[36∈3]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First33 --> PgSelectSingle36
    First44{{"First[44∈3]^"}}:::plan
    PgSelectRows45[["PgSelectRows[45∈3]^"]]:::plan
    PgSelectRows45 --> First44
    PgSelect40 --> PgSelectRows45
    PgSelectSingle47{{"PgSelectSingle[47∈3]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First44 --> PgSelectSingle47
    PgSelectSingle36 --> PgClassExpression49
    Lambda51{{"Lambda[51∈3]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    __DataOnly52 --> Lambda51
    PgClassExpression53{{"PgClassExpression[53∈3]^<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle36 --> PgClassExpression53
    PgSelectSingle47 --> PgClassExpression60
    PgClassExpression64{{"PgClassExpression[64∈3]^<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle47 --> PgClassExpression64
    Access159{{"Access[159∈3]^<br />ᐸ70.itemsᐳ"}}:::plan
    PgUnionAll70 --> Access159
    Access160{{"Access[160∈3]^<br />ᐸ72.itemsᐳ"}}:::plan
    PgUnionAll72 --> Access160
    __Item74[/"__Item[74∈4]<br />ᐸ159ᐳ<br />ᐳFirstPartyVulnerability"\]:::itemplan
    Access159 ==> __Item74
    PgUnionAllSingle75["PgUnionAllSingle[75∈4]^"]:::plan
    __Item74 --> PgUnionAllSingle75
    PgSelect85[["PgSelect[85∈6]<br />ᐸorganizationsᐳ<br />ᐳFirstPartyVulnerabilityᐳOrganization"]]:::plan
    Access83{{"Access[83∈6]^<br />ᐸ81.0ᐳ"}}:::plan
    Object12 & Access83 --> PgSelect85
    PgSelect99[["PgSelect[99∈6]<br />ᐸpeopleᐳ<br />ᐳFirstPartyVulnerabilityᐳPerson"]]:::plan
    Object12 & Access83 --> PgSelect99
    List137{{"List[137∈6]^<br />ᐸ135,136ᐳ"}}:::plan
    PgClassExpression136{{"PgClassExpression[136∈6]^<br />ᐸ__organiza...zation_id”ᐳ"}}:::plan
    Constant135 & PgClassExpression136 --> List137
    __DataOnly139["__DataOnly[139∈6]<br />ᐸ137,143ᐳ<br />ᐳFirstPartyVulnerabilityᐳOrganization<br />ᐳFirstPartyVulnerabilityᐳPerson"]:::plan
    List143{{"List[143∈6]^<br />ᐸ141,142ᐳ"}}:::plan
    List137 -->|"trapError;trapInhibited"| __DataOnly139
    List143 --> __DataOnly139
    PgClassExpression142{{"PgClassExpression[142∈6]^<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Constant141 & PgClassExpression142 --> List143
    Access79{{"Access[79∈6]<br />ᐸ75.1ᐳ<br />ᐳFirstPartyVulnerabilityᐳOrganization<br />ᐳFirstPartyVulnerabilityᐳPerson"}}:::plan
    PgUnionAllSingle75 --> Access79
    JSONParse81[["JSONParse[81∈6]^<br />ᐸ79ᐳ"]]:::plan
    Access79 --> JSONParse81
    JSONParse81 --> Access83
    First92{{"First[92∈6]^"}}:::plan
    PgSelectRows93[["PgSelectRows[93∈6]^"]]:::plan
    PgSelectRows93 --> First92
    PgSelect85 --> PgSelectRows93
    PgSelectSingle95{{"PgSelectSingle[95∈6]^<br />ᐸorganizationsᐳ"}}:::plan
    First92 --> PgSelectSingle95
    First103{{"First[103∈6]^"}}:::plan
    PgSelectRows104[["PgSelectRows[104∈6]^"]]:::plan
    PgSelectRows104 --> First103
    PgSelect99 --> PgSelectRows104
    PgSelectSingle106{{"PgSelectSingle[106∈6]^<br />ᐸpeopleᐳ"}}:::plan
    First103 --> PgSelectSingle106
    PgSelectSingle95 --> PgClassExpression136
    Lambda138{{"Lambda[138∈6]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    __DataOnly139 --> Lambda138
    PgClassExpression140{{"PgClassExpression[140∈6]^<br />ᐸ__organiza...s__.”name”ᐳ"}}:::plan
    PgSelectSingle95 --> PgClassExpression140
    PgSelectSingle106 --> PgClassExpression142
    PgClassExpression146{{"PgClassExpression[146∈6]^<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle106 --> PgClassExpression146
    __Item77[/"__Item[77∈5]<br />ᐸ160ᐳ<br />ᐳThirdPartyVulnerability"\]:::itemplan
    Access160 ==> __Item77
    PgUnionAllSingle78["PgUnionAllSingle[78∈5]^"]:::plan
    __Item77 --> PgUnionAllSingle78
    PgSelect113[["PgSelect[113∈7]<br />ᐸorganizationsᐳ<br />ᐳThirdPartyVulnerabilityᐳOrganization"]]:::plan
    Access111{{"Access[111∈7]^<br />ᐸ109.0ᐳ"}}:::plan
    Object12 & Access111 --> PgSelect113
    PgSelect127[["PgSelect[127∈7]<br />ᐸpeopleᐳ<br />ᐳThirdPartyVulnerabilityᐳPerson"]]:::plan
    Object12 & Access111 --> PgSelect127
    List149{{"List[149∈7]^<br />ᐸ135,148ᐳ"}}:::plan
    PgClassExpression148{{"PgClassExpression[148∈7]^<br />ᐸ__organiza...zation_id”ᐳ"}}:::plan
    Constant135 & PgClassExpression148 --> List149
    __DataOnly151["__DataOnly[151∈7]<br />ᐸ149,155ᐳ<br />ᐳThirdPartyVulnerabilityᐳOrganization<br />ᐳThirdPartyVulnerabilityᐳPerson"]:::plan
    List155{{"List[155∈7]^<br />ᐸ141,154ᐳ"}}:::plan
    List149 -->|"trapError;trapInhibited"| __DataOnly151
    List155 --> __DataOnly151
    PgClassExpression154{{"PgClassExpression[154∈7]^<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Constant141 & PgClassExpression154 --> List155
    Access107{{"Access[107∈7]<br />ᐸ78.1ᐳ<br />ᐳThirdPartyVulnerabilityᐳOrganization<br />ᐳThirdPartyVulnerabilityᐳPerson"}}:::plan
    PgUnionAllSingle78 --> Access107
    JSONParse109[["JSONParse[109∈7]^<br />ᐸ107ᐳ"]]:::plan
    Access107 --> JSONParse109
    JSONParse109 --> Access111
    First120{{"First[120∈7]^"}}:::plan
    PgSelectRows121[["PgSelectRows[121∈7]^"]]:::plan
    PgSelectRows121 --> First120
    PgSelect113 --> PgSelectRows121
    PgSelectSingle123{{"PgSelectSingle[123∈7]^<br />ᐸorganizationsᐳ"}}:::plan
    First120 --> PgSelectSingle123
    First131{{"First[131∈7]^"}}:::plan
    PgSelectRows132[["PgSelectRows[132∈7]^"]]:::plan
    PgSelectRows132 --> First131
    PgSelect127 --> PgSelectRows132
    PgSelectSingle134{{"PgSelectSingle[134∈7]^<br />ᐸpeopleᐳ"}}:::plan
    First131 --> PgSelectSingle134
    PgSelectSingle123 --> PgClassExpression148
    Lambda150{{"Lambda[150∈7]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    __DataOnly151 --> Lambda150
    PgClassExpression152{{"PgClassExpression[152∈7]^<br />ᐸ__organiza...s__.”name”ᐳ"}}:::plan
    PgSelectSingle123 --> PgClassExpression152
    PgSelectSingle134 --> PgClassExpression154
    PgClassExpression158{{"PgClassExpression[158∈7]^<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle134 --> PgClassExpression158

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access9,Access11,Object12,Connection14,Constant48,Constant59,Constant135,Constant141,Constant162 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll15,Access161 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item18,PgUnionAllSingle19 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,Access20,JSONParse22,Access24,PgSelect26,First33,PgSelectRows34,PgSelectSingle36,PgSelect40,First44,PgSelectRows45,PgSelectSingle47,PgClassExpression49,List50,Lambda51,__DataOnly52,PgClassExpression53,Connection58,PgClassExpression60,List61,PgClassExpression64,Connection69,PgUnionAll70,PgUnionAll72,Access159,Access160 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item74,PgUnionAllSingle75 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item77,PgUnionAllSingle78 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,Access79,JSONParse81,Access83,PgSelect85,First92,PgSelectRows93,PgSelectSingle95,PgSelect99,First103,PgSelectRows104,PgSelectSingle106,PgClassExpression136,List137,Lambda138,__DataOnly139,PgClassExpression140,PgClassExpression142,List143,PgClassExpression146 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7,Access107,JSONParse109,Access111,PgSelect113,First120,PgSelectRows121,PgSelectSingle123,PgSelect127,First131,PgSelectRows132,PgSelectSingle134,PgClassExpression148,List149,Lambda150,__DataOnly151,PgClassExpression152,PgClassExpression154,List155,PgClassExpression158 bucket7

