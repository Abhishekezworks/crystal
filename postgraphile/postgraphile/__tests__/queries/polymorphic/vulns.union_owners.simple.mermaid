%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access9 & Access10 --> Object11
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access9
    __Value2 --> Access10
    Connection12{{"Connection[12∈0] ➊<br />ᐸ8ᐳ"}}:::plan
    Constant115{{"Constant[115∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Constant115 --> Connection12
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant34{{"Constant[34∈0] ➊<br />ᐸ'first_party_vulnerabilities'ᐳ"}}:::plan
    Constant42{{"Constant[42∈0] ➊<br />ᐸ'third_party_vulnerabilities'ᐳ"}}:::plan
    Constant92{{"Constant[92∈0] ➊<br />ᐸ'organizations'ᐳ"}}:::plan
    Constant102{{"Constant[102∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    PgUnionAll13[["PgUnionAll[13∈1] ➊"]]:::plan
    Object11 & Connection12 & Constant115 --> PgUnionAll13
    Access114{{"Access[114∈1] ➊<br />ᐸ13.itemsᐳ"}}:::plan
    PgUnionAll13 --> Access114
    __Item15[/"__Item[15∈2]<br />ᐸ114ᐳ"\]:::itemplan
    Access114 ==> __Item15
    PgUnionAllSingle16["PgUnionAllSingle[16∈2]"]:::plan
    __Item15 --> PgUnionAllSingle16
    Access17{{"Access[17∈2]<br />ᐸ16.1ᐳ"}}:::plan
    PgUnionAllSingle16 --> Access17
    PgUnionAll50[["PgUnionAll[50∈3]^"]]:::plan
    PgClassExpression35{{"PgClassExpression[35∈3]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    Connection41{{"Connection[41∈3] ➊<br />ᐸ39ᐳ<br />ᐳFirstPartyVulnerability"}}:::plan
    Object11 & PgClassExpression35 & Connection41 --> PgUnionAll50
    PgUnionAll71[["PgUnionAll[71∈3]^"]]:::plan
    PgClassExpression43{{"PgClassExpression[43∈3]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    Connection49{{"Connection[49∈3] ➊<br />ᐸ47ᐳ<br />ᐳThirdPartyVulnerability"}}:::plan
    Object11 & PgClassExpression43 & Connection49 --> PgUnionAll71
    PgSelect20[["PgSelect[20∈3]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access19{{"Access[19∈3]^<br />ᐸ18.0ᐳ"}}:::plan
    Object11 & Access19 --> PgSelect20
    PgSelect29[["PgSelect[29∈3]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Object11 & Access19 --> PgSelect29
    List36{{"List[36∈3]^<br />ᐸ34,35ᐳ"}}:::plan
    Constant34 & PgClassExpression35 --> List36
    List44{{"List[44∈3]^<br />ᐸ42,43ᐳ"}}:::plan
    Constant42 & PgClassExpression43 --> List44
    JSONParse18[["JSONParse[18∈3]<br />ᐸ17ᐳ<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability"]]:::plan
    Access17 --> JSONParse18
    JSONParse18 --> Access19
    First24{{"First[24∈3]^"}}:::plan
    PgSelectRows25[["PgSelectRows[25∈3]^"]]:::plan
    PgSelectRows25 --> First24
    PgSelect20 --> PgSelectRows25
    PgSelectSingle26{{"PgSelectSingle[26∈3]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First24 --> PgSelectSingle26
    First31{{"First[31∈3]^"}}:::plan
    PgSelectRows32[["PgSelectRows[32∈3]^"]]:::plan
    PgSelectRows32 --> First31
    PgSelect29 --> PgSelectRows32
    PgSelectSingle33{{"PgSelectSingle[33∈3]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First31 --> PgSelectSingle33
    PgSelectSingle26 --> PgClassExpression35
    Lambda37{{"Lambda[37∈3]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List36 --> Lambda37
    PgClassExpression38{{"PgClassExpression[38∈3]^<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle26 --> PgClassExpression38
    PgSelectSingle33 --> PgClassExpression43
    Lambda45{{"Lambda[45∈3]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List44 --> Lambda45
    PgClassExpression46{{"PgClassExpression[46∈3]^<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle33 --> PgClassExpression46
    Access112{{"Access[112∈3]^<br />ᐸ50.itemsᐳ"}}:::plan
    PgUnionAll50 --> Access112
    Access113{{"Access[113∈3]^<br />ᐸ71.itemsᐳ"}}:::plan
    PgUnionAll71 --> Access113
    __Item52[/"__Item[52∈4]<br />ᐸ112ᐳ<br />ᐳFirstPartyVulnerability"\]:::itemplan
    Access112 ==> __Item52
    PgUnionAllSingle53["PgUnionAllSingle[53∈4]^"]:::plan
    __Item52 --> PgUnionAllSingle53
    Access54{{"Access[54∈4]^<br />ᐸ53.1ᐳ"}}:::plan
    PgUnionAllSingle53 --> Access54
    PgSelect57[["PgSelect[57∈5]<br />ᐸorganizationsᐳ<br />ᐳFirstPartyVulnerabilityᐳOrganization"]]:::plan
    Access56{{"Access[56∈5]^<br />ᐸ55.0ᐳ"}}:::plan
    Object11 & Access56 --> PgSelect57
    PgSelect66[["PgSelect[66∈5]<br />ᐸpeopleᐳ<br />ᐳFirstPartyVulnerabilityᐳPerson"]]:::plan
    Object11 & Access56 --> PgSelect66
    List94{{"List[94∈5]^<br />ᐸ92,93ᐳ"}}:::plan
    PgClassExpression93{{"PgClassExpression[93∈5]^<br />ᐸ__organiza...zation_id”ᐳ"}}:::plan
    Constant92 & PgClassExpression93 --> List94
    List104{{"List[104∈5]^<br />ᐸ102,103ᐳ"}}:::plan
    PgClassExpression103{{"PgClassExpression[103∈5]^<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Constant102 & PgClassExpression103 --> List104
    JSONParse55[["JSONParse[55∈5]<br />ᐸ54ᐳ<br />ᐳFirstPartyVulnerabilityᐳOrganization<br />ᐳFirstPartyVulnerabilityᐳPerson"]]:::plan
    Access54 --> JSONParse55
    JSONParse55 --> Access56
    First61{{"First[61∈5]^"}}:::plan
    PgSelectRows62[["PgSelectRows[62∈5]^"]]:::plan
    PgSelectRows62 --> First61
    PgSelect57 --> PgSelectRows62
    PgSelectSingle63{{"PgSelectSingle[63∈5]^<br />ᐸorganizationsᐳ"}}:::plan
    First61 --> PgSelectSingle63
    First68{{"First[68∈5]^"}}:::plan
    PgSelectRows69[["PgSelectRows[69∈5]^"]]:::plan
    PgSelectRows69 --> First68
    PgSelect66 --> PgSelectRows69
    PgSelectSingle70{{"PgSelectSingle[70∈5]^<br />ᐸpeopleᐳ"}}:::plan
    First68 --> PgSelectSingle70
    PgSelectSingle63 --> PgClassExpression93
    Lambda95{{"Lambda[95∈5]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List94 --> Lambda95
    PgClassExpression96{{"PgClassExpression[96∈5]^<br />ᐸ__organiza...s__.”name”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression96
    PgSelectSingle70 --> PgClassExpression103
    Lambda105{{"Lambda[105∈5]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List104 --> Lambda105
    PgClassExpression106{{"PgClassExpression[106∈5]^<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression106
    __Item73[/"__Item[73∈6]<br />ᐸ113ᐳ<br />ᐳThirdPartyVulnerability"\]:::itemplan
    Access113 ==> __Item73
    PgUnionAllSingle74["PgUnionAllSingle[74∈6]^"]:::plan
    __Item73 --> PgUnionAllSingle74
    Access75{{"Access[75∈6]^<br />ᐸ74.1ᐳ"}}:::plan
    PgUnionAllSingle74 --> Access75
    PgSelect78[["PgSelect[78∈7]<br />ᐸorganizationsᐳ<br />ᐳThirdPartyVulnerabilityᐳOrganization"]]:::plan
    Access77{{"Access[77∈7]^<br />ᐸ76.0ᐳ"}}:::plan
    Object11 & Access77 --> PgSelect78
    PgSelect87[["PgSelect[87∈7]<br />ᐸpeopleᐳ<br />ᐳThirdPartyVulnerabilityᐳPerson"]]:::plan
    Object11 & Access77 --> PgSelect87
    List99{{"List[99∈7]^<br />ᐸ92,98ᐳ"}}:::plan
    PgClassExpression98{{"PgClassExpression[98∈7]^<br />ᐸ__organiza...zation_id”ᐳ"}}:::plan
    Constant92 & PgClassExpression98 --> List99
    List109{{"List[109∈7]^<br />ᐸ102,108ᐳ"}}:::plan
    PgClassExpression108{{"PgClassExpression[108∈7]^<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Constant102 & PgClassExpression108 --> List109
    JSONParse76[["JSONParse[76∈7]<br />ᐸ75ᐳ<br />ᐳThirdPartyVulnerabilityᐳOrganization<br />ᐳThirdPartyVulnerabilityᐳPerson"]]:::plan
    Access75 --> JSONParse76
    JSONParse76 --> Access77
    First82{{"First[82∈7]^"}}:::plan
    PgSelectRows83[["PgSelectRows[83∈7]^"]]:::plan
    PgSelectRows83 --> First82
    PgSelect78 --> PgSelectRows83
    PgSelectSingle84{{"PgSelectSingle[84∈7]^<br />ᐸorganizationsᐳ"}}:::plan
    First82 --> PgSelectSingle84
    First89{{"First[89∈7]^"}}:::plan
    PgSelectRows90[["PgSelectRows[90∈7]^"]]:::plan
    PgSelectRows90 --> First89
    PgSelect87 --> PgSelectRows90
    PgSelectSingle91{{"PgSelectSingle[91∈7]^<br />ᐸpeopleᐳ"}}:::plan
    First89 --> PgSelectSingle91
    PgSelectSingle84 --> PgClassExpression98
    Lambda100{{"Lambda[100∈7]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List99 --> Lambda100
    PgClassExpression101{{"PgClassExpression[101∈7]^<br />ᐸ__organiza...s__.”name”ᐳ"}}:::plan
    PgSelectSingle84 --> PgClassExpression101
    PgSelectSingle91 --> PgClassExpression108
    Lambda110{{"Lambda[110∈7]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List109 --> Lambda110
    PgClassExpression111{{"PgClassExpression[111∈7]^<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle91 --> PgClassExpression111

    %% define steps

    subgraph "Buckets for queries/polymorphic/vulns.union_owners.simple"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access9,Access10,Object11,Connection12,Constant34,Constant42,Constant92,Constant102,Constant115 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 11, 12, 115, 34, 42, 92, 102<br /><br />ROOT Connectionᐸ8ᐳ[12]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll13,Access114 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 11, 34, 42, 92, 102<br /><br />ROOT __Item{2}ᐸ114ᐳ[15]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item15,PgUnionAllSingle16,Access17 bucket2
    Bucket3("Bucket 3 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 17, 11, 34, 42, 16, 92, 102<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability<br /><br />1: JSONParse[18]<br />ᐳ: 41, 49, 19<br />2: PgSelect[20], PgSelect[29]<br />3: PgSelectRows[25], PgSelectRows[32]<br />ᐳ: 24, 26, 31, 33, 35, 36, 37, 38, 43, 44, 45, 46<br />4: PgUnionAll[50], PgUnionAll[71]<br />ᐳ: Access[112], Access[113]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,JSONParse18,Access19,PgSelect20,First24,PgSelectRows25,PgSelectSingle26,PgSelect29,First31,PgSelectRows32,PgSelectSingle33,PgClassExpression35,List36,Lambda37,PgClassExpression38,Connection41,PgClassExpression43,List44,Lambda45,PgClassExpression46,Connection49,PgUnionAll50,PgUnionAll71,Access112,Access113 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 11, 92, 102<br /><br />ROOT __Item{4}ᐸ112ᐳ[52]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item52,PgUnionAllSingle53,Access54 bucket4
    Bucket5("Bucket 5 (polymorphic)<br />Organization,Person<br />Deps: 54, 11, 92, 102, 53<br />ᐳFirstPartyVulnerabilityᐳOrganization<br />ᐳFirstPartyVulnerabilityᐳPerson<br /><br />1: JSONParse[55]<br />ᐳ: Access[56]<br />2: PgSelect[57], PgSelect[66]<br />3: PgSelectRows[62], PgSelectRows[69]<br />ᐳ: 61, 63, 68, 70, 93, 94, 95, 96, 103, 104, 105, 106"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,JSONParse55,Access56,PgSelect57,First61,PgSelectRows62,PgSelectSingle63,PgSelect66,First68,PgSelectRows69,PgSelectSingle70,PgClassExpression93,List94,Lambda95,PgClassExpression96,PgClassExpression103,List104,Lambda105,PgClassExpression106 bucket5
    Bucket6("Bucket 6 (listItem)<br />Deps: 11, 92, 102<br /><br />ROOT __Item{6}ᐸ113ᐳ[73]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item73,PgUnionAllSingle74,Access75 bucket6
    Bucket7("Bucket 7 (polymorphic)<br />Organization,Person<br />Deps: 75, 11, 92, 102, 74<br />ᐳThirdPartyVulnerabilityᐳOrganization<br />ᐳThirdPartyVulnerabilityᐳPerson<br /><br />1: JSONParse[76]<br />ᐳ: Access[77]<br />2: PgSelect[78], PgSelect[87]<br />3: PgSelectRows[83], PgSelectRows[90]<br />ᐳ: 82, 84, 89, 91, 98, 99, 100, 101, 108, 109, 110, 111"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,JSONParse76,Access77,PgSelect78,First82,PgSelectRows83,PgSelectSingle84,PgSelect87,First89,PgSelectRows90,PgSelectSingle91,PgClassExpression98,List99,Lambda100,PgClassExpression101,PgClassExpression108,List109,Lambda110,PgClassExpression111 bucket7
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    end
