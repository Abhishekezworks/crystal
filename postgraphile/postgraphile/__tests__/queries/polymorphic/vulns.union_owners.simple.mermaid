%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access9 & Access10 --> Object11
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access9
    __Value2 --> Access10
    Connection12{{"Connection[12∈0] ➊<br />ᐸ8ᐳ"}}:::plan
    Constant124{{"Constant[124∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Constant124 --> Connection12
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant27{{"Constant[27∈0] ➊<br />ᐸ'first_party_vulnerabilities'ᐳ"}}:::plan
    Constant49{{"Constant[49∈0] ➊<br />ᐸ'organizations'ᐳ"}}:::plan
    Constant64{{"Constant[64∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    Constant79{{"Constant[79∈0] ➊<br />ᐸ'third_party_vulnerabilities'ᐳ"}}:::plan
    PgUnionAll13[["PgUnionAll[13∈1] ➊"]]:::plan
    Object11 & Connection12 & Constant124 --> PgUnionAll13
    Access123{{"Access[123∈1] ➊<br />ᐸ13.itemsᐳ"}}:::plan
    PgUnionAll13 --> Access123
    __Item15[/"__Item[15∈2]<br />ᐸ123ᐳ"\]:::itemplan
    Access123 ==> __Item15
    PgUnionAllSingle16["PgUnionAllSingle[16∈2]"]:::plan
    __Item15 --> PgUnionAllSingle16
    Access17{{"Access[17∈2]<br />ᐸ16.1ᐳ"}}:::plan
    PgUnionAllSingle16 --> Access17
    PgUnionAll35[["PgUnionAll[35∈3]^"]]:::plan
    PgClassExpression28{{"PgClassExpression[28∈3]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    Connection34{{"Connection[34∈3] ➊<br />ᐸ32ᐳ<br />ᐳFirstPartyVulnerability"}}:::plan
    Object11 & PgClassExpression28 & Connection34 --> PgUnionAll35
    PgUnionAll87[["PgUnionAll[87∈3]^"]]:::plan
    PgClassExpression80{{"PgClassExpression[80∈3]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    Connection86{{"Connection[86∈3] ➊<br />ᐸ84ᐳ<br />ᐳThirdPartyVulnerability"}}:::plan
    Object11 & PgClassExpression80 & Connection86 --> PgUnionAll87
    PgSelect20[["PgSelect[20∈3]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access19{{"Access[19∈3]^<br />ᐸ18.0ᐳ"}}:::plan
    Object11 & Access19 --> PgSelect20
    List29{{"List[29∈3]^<br />ᐸ27,28ᐳ"}}:::plan
    Constant27 & PgClassExpression28 --> List29
    PgSelect72[["PgSelect[72∈3]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Object11 & Access19 --> PgSelect72
    List81{{"List[81∈3]^<br />ᐸ79,80ᐳ"}}:::plan
    Constant79 & PgClassExpression80 --> List81
    JSONParse18[["JSONParse[18∈3]<br />ᐸ17ᐳ<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability"]]:::plan
    Access17 --> JSONParse18
    JSONParse18 --> Access19
    First24{{"First[24∈3]^"}}:::plan
    PgSelectRows25[["PgSelectRows[25∈3]^"]]:::plan
    PgSelectRows25 --> First24
    PgSelect20 --> PgSelectRows25
    PgSelectSingle26{{"PgSelectSingle[26∈3]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First24 --> PgSelectSingle26
    PgSelectSingle26 --> PgClassExpression28
    Lambda30{{"Lambda[30∈3]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List29 --> Lambda30
    PgClassExpression31{{"PgClassExpression[31∈3]^<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle26 --> PgClassExpression31
    First76{{"First[76∈3]^"}}:::plan
    PgSelectRows77[["PgSelectRows[77∈3]^"]]:::plan
    PgSelectRows77 --> First76
    PgSelect72 --> PgSelectRows77
    PgSelectSingle78{{"PgSelectSingle[78∈3]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First76 --> PgSelectSingle78
    PgSelectSingle78 --> PgClassExpression80
    Lambda82{{"Lambda[82∈3]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List81 --> Lambda82
    PgClassExpression83{{"PgClassExpression[83∈3]^<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle78 --> PgClassExpression83
    Access121{{"Access[121∈3]^<br />ᐸ35.itemsᐳ"}}:::plan
    PgUnionAll35 --> Access121
    Access122{{"Access[122∈3]^<br />ᐸ87.itemsᐳ"}}:::plan
    PgUnionAll87 --> Access122
    __Item37[/"__Item[37∈4]<br />ᐸ121ᐳ<br />ᐳFirstPartyVulnerability"\]:::itemplan
    Access121 ==> __Item37
    PgUnionAllSingle38["PgUnionAllSingle[38∈4]^"]:::plan
    __Item37 --> PgUnionAllSingle38
    Access39{{"Access[39∈4]^<br />ᐸ38.1ᐳ"}}:::plan
    PgUnionAllSingle38 --> Access39
    PgSelect42[["PgSelect[42∈5]<br />ᐸorganizationsᐳ<br />ᐳFirstPartyVulnerabilityᐳOrganization"]]:::plan
    Access41{{"Access[41∈5]^<br />ᐸ40.0ᐳ"}}:::plan
    Object11 & Access41 --> PgSelect42
    List51{{"List[51∈5]^<br />ᐸ49,50ᐳ"}}:::plan
    PgClassExpression50{{"PgClassExpression[50∈5]^<br />ᐸ__organiza...zation_id”ᐳ"}}:::plan
    Constant49 & PgClassExpression50 --> List51
    PgSelect57[["PgSelect[57∈5]<br />ᐸpeopleᐳ<br />ᐳFirstPartyVulnerabilityᐳPerson"]]:::plan
    Object11 & Access41 --> PgSelect57
    List66{{"List[66∈5]^<br />ᐸ64,65ᐳ"}}:::plan
    PgClassExpression65{{"PgClassExpression[65∈5]^<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Constant64 & PgClassExpression65 --> List66
    JSONParse40[["JSONParse[40∈5]<br />ᐸ39ᐳ<br />ᐳFirstPartyVulnerabilityᐳOrganization<br />ᐳFirstPartyVulnerabilityᐳPerson"]]:::plan
    Access39 --> JSONParse40
    JSONParse40 --> Access41
    First46{{"First[46∈5]^"}}:::plan
    PgSelectRows47[["PgSelectRows[47∈5]^"]]:::plan
    PgSelectRows47 --> First46
    PgSelect42 --> PgSelectRows47
    PgSelectSingle48{{"PgSelectSingle[48∈5]^<br />ᐸorganizationsᐳ"}}:::plan
    First46 --> PgSelectSingle48
    PgSelectSingle48 --> PgClassExpression50
    Lambda52{{"Lambda[52∈5]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List51 --> Lambda52
    PgClassExpression53{{"PgClassExpression[53∈5]^<br />ᐸ__organiza...s__.”name”ᐳ"}}:::plan
    PgSelectSingle48 --> PgClassExpression53
    First61{{"First[61∈5]^"}}:::plan
    PgSelectRows62[["PgSelectRows[62∈5]^"]]:::plan
    PgSelectRows62 --> First61
    PgSelect57 --> PgSelectRows62
    PgSelectSingle63{{"PgSelectSingle[63∈5]^<br />ᐸpeopleᐳ"}}:::plan
    First61 --> PgSelectSingle63
    PgSelectSingle63 --> PgClassExpression65
    Lambda67{{"Lambda[67∈5]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List66 --> Lambda67
    PgClassExpression68{{"PgClassExpression[68∈5]^<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression68
    __Item89[/"__Item[89∈6]<br />ᐸ122ᐳ<br />ᐳThirdPartyVulnerability"\]:::itemplan
    Access122 ==> __Item89
    PgUnionAllSingle90["PgUnionAllSingle[90∈6]^"]:::plan
    __Item89 --> PgUnionAllSingle90
    Access91{{"Access[91∈6]^<br />ᐸ90.1ᐳ"}}:::plan
    PgUnionAllSingle90 --> Access91
    PgSelect94[["PgSelect[94∈7]<br />ᐸorganizationsᐳ<br />ᐳThirdPartyVulnerabilityᐳOrganization"]]:::plan
    Access93{{"Access[93∈7]^<br />ᐸ92.0ᐳ"}}:::plan
    Object11 & Access93 --> PgSelect94
    List103{{"List[103∈7]^<br />ᐸ49,102ᐳ"}}:::plan
    PgClassExpression102{{"PgClassExpression[102∈7]^<br />ᐸ__organiza...zation_id”ᐳ"}}:::plan
    Constant49 & PgClassExpression102 --> List103
    PgSelect109[["PgSelect[109∈7]<br />ᐸpeopleᐳ<br />ᐳThirdPartyVulnerabilityᐳPerson"]]:::plan
    Object11 & Access93 --> PgSelect109
    List118{{"List[118∈7]^<br />ᐸ64,117ᐳ"}}:::plan
    PgClassExpression117{{"PgClassExpression[117∈7]^<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Constant64 & PgClassExpression117 --> List118
    JSONParse92[["JSONParse[92∈7]<br />ᐸ91ᐳ<br />ᐳThirdPartyVulnerabilityᐳOrganization<br />ᐳThirdPartyVulnerabilityᐳPerson"]]:::plan
    Access91 --> JSONParse92
    JSONParse92 --> Access93
    First98{{"First[98∈7]^"}}:::plan
    PgSelectRows99[["PgSelectRows[99∈7]^"]]:::plan
    PgSelectRows99 --> First98
    PgSelect94 --> PgSelectRows99
    PgSelectSingle100{{"PgSelectSingle[100∈7]^<br />ᐸorganizationsᐳ"}}:::plan
    First98 --> PgSelectSingle100
    PgSelectSingle100 --> PgClassExpression102
    Lambda104{{"Lambda[104∈7]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List103 --> Lambda104
    PgClassExpression105{{"PgClassExpression[105∈7]^<br />ᐸ__organiza...s__.”name”ᐳ"}}:::plan
    PgSelectSingle100 --> PgClassExpression105
    First113{{"First[113∈7]^"}}:::plan
    PgSelectRows114[["PgSelectRows[114∈7]^"]]:::plan
    PgSelectRows114 --> First113
    PgSelect109 --> PgSelectRows114
    PgSelectSingle115{{"PgSelectSingle[115∈7]^<br />ᐸpeopleᐳ"}}:::plan
    First113 --> PgSelectSingle115
    PgSelectSingle115 --> PgClassExpression117
    Lambda119{{"Lambda[119∈7]^<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List118 --> Lambda119
    PgClassExpression120{{"PgClassExpression[120∈7]^<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle115 --> PgClassExpression120

    %% define steps

    subgraph "Buckets for queries/polymorphic/vulns.union_owners.simple"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access9,Access10,Object11,Connection12,Constant27,Constant49,Constant64,Constant79,Constant124 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 11, 12, 124, 27, 79, 49, 64<br /><br />ROOT Connectionᐸ8ᐳ[12]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll13,Access123 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 11, 27, 79, 49, 64<br /><br />ROOT __Item{2}ᐸ123ᐳ[15]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item15,PgUnionAllSingle16,Access17 bucket2
    Bucket3("Bucket 3 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 17, 11, 27, 79, 16, 49, 64<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability<br /><br />1: JSONParse[18]<br />ᐳ: 34, 86, 19<br />2: PgSelect[20], PgSelect[72]<br />3: PgSelectRows[25], PgSelectRows[77]<br />ᐳ: 24, 26, 28, 29, 30, 31, 76, 78, 80, 81, 82, 83<br />4: PgUnionAll[35], PgUnionAll[87]<br />ᐳ: Access[121], Access[122]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,JSONParse18,Access19,PgSelect20,First24,PgSelectRows25,PgSelectSingle26,PgClassExpression28,List29,Lambda30,PgClassExpression31,Connection34,PgUnionAll35,PgSelect72,First76,PgSelectRows77,PgSelectSingle78,PgClassExpression80,List81,Lambda82,PgClassExpression83,Connection86,PgUnionAll87,Access121,Access122 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 11, 49, 64<br /><br />ROOT __Item{4}ᐸ121ᐳ[37]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item37,PgUnionAllSingle38,Access39 bucket4
    Bucket5("Bucket 5 (polymorphic)<br />Organization,Person<br />Deps: 39, 11, 49, 64, 38<br />ᐳFirstPartyVulnerabilityᐳOrganization<br />ᐳFirstPartyVulnerabilityᐳPerson<br /><br />1: JSONParse[40]<br />ᐳ: Access[41]<br />2: PgSelect[42], PgSelect[57]<br />3: PgSelectRows[47], PgSelectRows[62]<br />ᐳ: 46, 48, 50, 51, 52, 53, 61, 63, 65, 66, 67, 68"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,JSONParse40,Access41,PgSelect42,First46,PgSelectRows47,PgSelectSingle48,PgClassExpression50,List51,Lambda52,PgClassExpression53,PgSelect57,First61,PgSelectRows62,PgSelectSingle63,PgClassExpression65,List66,Lambda67,PgClassExpression68 bucket5
    Bucket6("Bucket 6 (listItem)<br />Deps: 11, 49, 64<br /><br />ROOT __Item{6}ᐸ122ᐳ[89]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,__Item89,PgUnionAllSingle90,Access91 bucket6
    Bucket7("Bucket 7 (polymorphic)<br />Organization,Person<br />Deps: 91, 11, 49, 64, 90<br />ᐳThirdPartyVulnerabilityᐳOrganization<br />ᐳThirdPartyVulnerabilityᐳPerson<br /><br />1: JSONParse[92]<br />ᐳ: Access[93]<br />2: PgSelect[94], PgSelect[109]<br />3: PgSelectRows[99], PgSelectRows[114]<br />ᐳ: 98, 100, 102, 103, 104, 105, 113, 115, 117, 118, 119, 120"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,JSONParse92,Access93,PgSelect94,First98,PgSelectRows99,PgSelectSingle100,PgClassExpression102,List103,Lambda104,PgClassExpression105,PgSelect109,First113,PgSelectRows114,PgSelectSingle115,PgClassExpression117,List118,Lambda119,PgClassExpression120 bucket7
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket6
    Bucket4 --> Bucket5
    Bucket6 --> Bucket7
    end
