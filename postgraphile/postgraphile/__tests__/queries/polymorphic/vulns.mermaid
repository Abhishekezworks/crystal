%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/polymorphic/vulns"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 7, 11, 12, 16, 22, 139, 140, 141, 13, 15, 14<br />2: PgUnionAll[20]<br />ᐳ: Access[134]"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 13, 16, 14, 15, 139, 7<br /><br />ROOT Connectionᐸ10ᐳ[14]<br />1: 26, 27, 74, 80, 87, 91<br />ᐳ: 33, 78, 84, 88, 89, 90, 92, 93, 94, 95, 135, 136, 137, 138, 28, 75, 81<br />2: 30, 77, 83<br />ᐳ: 31, 79, 85"):::bucket
    Bucket2("Bucket 2 (listItem)<br />Deps: 13<br /><br />ROOT __Item{2}ᐸ134ᐳ[24]"):::bucket
    Bucket3("Bucket 3 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 34, 13, 25<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability<br /><br />1: JSONParse[36]<br />ᐳ: Access[38]<br />2: PgSelect[40], PgSelect[56]<br />3: PgSelectRows[49], PgSelectRows[61]<br />ᐳ: 48, 51, 60, 63, 67, 68, 69, 70, 71, 72, 73"):::bucket
    Bucket4("Bucket 4 (listItem)<br />Deps: 95, 13<br /><br />ROOT __Item{4}ᐸ135ᐳ[65]"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 66, 95, 13<br /><br />ROOT PgUnionAllSingle{4}[66]"):::bucket
    Bucket6("Bucket 6 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 97, 13, 66<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability<br /><br />1: JSONParse[99]<br />ᐳ: Access[101]<br />2: PgSelect[103], PgSelect[119]<br />3: PgSelectRows[112], PgSelectRows[124]<br />ᐳ: 111, 114, 123, 126, 127, 128, 129, 130, 131, 132, 133"):::bucket
    end
    Bucket0 --> Bucket1 & Bucket2
    Bucket1 --> Bucket4
    Bucket2 --> Bucket3
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6

    %% plan dependencies
    PgUnionAll20[["PgUnionAll[20∈0] ➊<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    Object13{{"Object[13∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant139{{"Constant[139∈0] ➊<br />ᐸ3ᐳ"}}:::plan
    Constant141{{"Constant[141∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Constant22{{"Constant[22∈0] ➊<br />ᐸ[Function: applyInputConstant]ᐳ"}}:::plan
    Object13 & Constant139 & Constant141 & Constant22 --> PgUnionAll20
    Access11{{"Access[11∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access11 & Access12 --> Object13
    Connection14{{"Connection[14∈0] ➊<br />ᐸ10ᐳ"}}:::plan
    Lambda15{{"Lambda[15∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant139 & Lambda15 --> Connection14
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access11
    __Value2 --> Access12
    Constant140{{"Constant[140∈0] ➊<br />ᐸ'WyJkNGRlODQ2NjQ3IiwiMTAiLCJUaGlyZFBhcnR5VnVsbmVyYWJpbGl0eSIᐳ"}}:::plan
    Constant140 --> Lambda15
    Access134{{"Access[134∈0] ➊<br />ᐸ20.itemsᐳ"}}:::plan
    PgUnionAll20 --> Access134
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant16{{"Constant[16∈0] ➊<br />ᐸ[Function: applyInputConstant]ᐳ"}}:::plan
    PgUnionAll26[["PgUnionAll[26∈1] ➊<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    Object13 & Constant16 & Connection14 & Lambda15 & Constant139 --> PgUnionAll26
    PgUnionAll74[["PgUnionAll[74∈1] ➊<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    Object13 & Constant16 & Connection14 & Lambda15 & Constant139 --> PgUnionAll74
    PgUnionAll80[["PgUnionAll[80∈1] ➊<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    Object13 & Constant16 & Connection14 & Lambda15 & Constant139 --> PgUnionAll80
    PgUnionAll87[["PgUnionAll[87∈1] ➊<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    Object13 & Constant16 & Connection14 & Lambda15 & Constant139 --> PgUnionAll87
    PgUnionAll91[["PgUnionAll[91∈1] ➊<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    Object13 & Constant16 & Connection14 & Lambda15 & Constant139 --> PgUnionAll91
    Object93{{"Object[93∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access92{{"Access[92∈1] ➊<br />ᐸ91.hasMoreᐳ"}}:::plan
    Constant139 & Access92 --> Object93
    PgUnionAll27[["PgUnionAll[27∈1] ➊<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    Object13 & Constant16 & Connection14 --> PgUnionAll27
    Object89{{"Object[89∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Access88{{"Access[88∈1] ➊<br />ᐸ87.hasMoreᐳ"}}:::plan
    Constant139 & Access88 --> Object89
    PgCursor79{{"PgCursor[79∈1] ➊"}}:::plan
    PgUnionAllSingle77["PgUnionAllSingle[77∈1] ➊"]:::plan
    Access78{{"Access[78∈1] ➊<br />ᐸ74.cursorDetailsᐳ"}}:::plan
    PgUnionAllSingle77 & Access78 --> PgCursor79
    PgCursor85{{"PgCursor[85∈1] ➊"}}:::plan
    PgUnionAllSingle83["PgUnionAllSingle[83∈1] ➊"]:::plan
    Access84{{"Access[84∈1] ➊<br />ᐸ80.cursorDetailsᐳ"}}:::plan
    PgUnionAllSingle83 & Access84 --> PgCursor85
    First28{{"First[28∈1] ➊"}}:::plan
    Access136{{"Access[136∈1] ➊<br />ᐸ27.itemsᐳ"}}:::plan
    Access136 --> First28
    PgUnionAllSingle30["PgUnionAllSingle[30∈1] ➊"]:::plan
    First28 --> PgUnionAllSingle30
    PgClassExpression31{{"PgClassExpression[31∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgUnionAllSingle30 --> PgClassExpression31
    PgPageInfo33{{"PgPageInfo[33∈1] ➊"}}:::plan
    Connection14 --> PgPageInfo33
    First75{{"First[75∈1] ➊"}}:::plan
    Access137{{"Access[137∈1] ➊<br />ᐸ74.itemsᐳ"}}:::plan
    Access137 --> First75
    First75 --> PgUnionAllSingle77
    PgUnionAll74 --> Access78
    Last81{{"Last[81∈1] ➊"}}:::plan
    Access138{{"Access[138∈1] ➊<br />ᐸ80.itemsᐳ"}}:::plan
    Access138 --> Last81
    Last81 --> PgUnionAllSingle83
    PgUnionAll80 --> Access84
    PgUnionAll87 --> Access88
    Lambda90{{"Lambda[90∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object89 --> Lambda90
    PgUnionAll91 --> Access92
    Lambda94{{"Lambda[94∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object93 --> Lambda94
    Access95{{"Access[95∈1] ➊<br />ᐸ26.cursorDetailsᐳ"}}:::plan
    PgUnionAll26 --> Access95
    Access135{{"Access[135∈1] ➊<br />ᐸ26.itemsᐳ"}}:::plan
    PgUnionAll26 --> Access135
    PgUnionAll27 --> Access136
    PgUnionAll74 --> Access137
    PgUnionAll80 --> Access138
    __Item65[/"__Item[65∈4]<br />ᐸ135ᐳ"\]:::itemplan
    Access135 ==> __Item65
    PgUnionAllSingle66["PgUnionAllSingle[66∈4]"]:::plan
    __Item65 --> PgUnionAllSingle66
    PgCursor96{{"PgCursor[96∈5]"}}:::plan
    PgUnionAllSingle66 & Access95 --> PgCursor96
    Access97{{"Access[97∈5]<br />ᐸ66.1ᐳ"}}:::plan
    PgUnionAllSingle66 --> Access97
    PgSelect103[["PgSelect[103∈6]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access101{{"Access[101∈6]^<br />ᐸ99.0ᐳ"}}:::plan
    Object13 & Access101 --> PgSelect103
    PgSelect119[["PgSelect[119∈6]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Object13 & Access101 --> PgSelect119
    JSONParse99[["JSONParse[99∈6]<br />ᐸ97ᐳ<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability"]]:::plan
    Access97 --> JSONParse99
    JSONParse99 --> Access101
    First111{{"First[111∈6]^"}}:::plan
    PgSelectRows112[["PgSelectRows[112∈6]^"]]:::plan
    PgSelectRows112 --> First111
    PgSelect103 --> PgSelectRows112
    PgSelectSingle114{{"PgSelectSingle[114∈6]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First111 --> PgSelectSingle114
    First123{{"First[123∈6]^"}}:::plan
    PgSelectRows124[["PgSelectRows[124∈6]^"]]:::plan
    PgSelectRows124 --> First123
    PgSelect119 --> PgSelectRows124
    PgSelectSingle126{{"PgSelectSingle[126∈6]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First123 --> PgSelectSingle126
    PgClassExpression127{{"PgClassExpression[127∈6]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression127
    PgClassExpression128{{"PgClassExpression[128∈6]^<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression128
    PgClassExpression129{{"PgClassExpression[129∈6]^<br />ᐸ__first_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression129
    PgClassExpression130{{"PgClassExpression[130∈6]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle126 --> PgClassExpression130
    PgClassExpression131{{"PgClassExpression[131∈6]^<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle126 --> PgClassExpression131
    PgClassExpression132{{"PgClassExpression[132∈6]^<br />ᐸ__third_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle126 --> PgClassExpression132
    PgClassExpression133{{"PgClassExpression[133∈6]^<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle126 --> PgClassExpression133
    __Item24[/"__Item[24∈2]<br />ᐸ134ᐳ"\]:::itemplan
    Access134 ==> __Item24
    PgUnionAllSingle25["PgUnionAllSingle[25∈2]"]:::plan
    __Item24 --> PgUnionAllSingle25
    Access34{{"Access[34∈2]<br />ᐸ25.1ᐳ"}}:::plan
    PgUnionAllSingle25 --> Access34
    PgSelect40[["PgSelect[40∈3]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access38{{"Access[38∈3]^<br />ᐸ36.0ᐳ"}}:::plan
    Object13 & Access38 --> PgSelect40
    PgSelect56[["PgSelect[56∈3]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Object13 & Access38 --> PgSelect56
    JSONParse36[["JSONParse[36∈3]<br />ᐸ34ᐳ<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability"]]:::plan
    Access34 --> JSONParse36
    JSONParse36 --> Access38
    First48{{"First[48∈3]^"}}:::plan
    PgSelectRows49[["PgSelectRows[49∈3]^"]]:::plan
    PgSelectRows49 --> First48
    PgSelect40 --> PgSelectRows49
    PgSelectSingle51{{"PgSelectSingle[51∈3]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First48 --> PgSelectSingle51
    First60{{"First[60∈3]^"}}:::plan
    PgSelectRows61[["PgSelectRows[61∈3]^"]]:::plan
    PgSelectRows61 --> First60
    PgSelect56 --> PgSelectRows61
    PgSelectSingle63{{"PgSelectSingle[63∈3]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First60 --> PgSelectSingle63
    PgClassExpression67{{"PgClassExpression[67∈3]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression67
    PgClassExpression68{{"PgClassExpression[68∈3]^<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression68
    PgClassExpression69{{"PgClassExpression[69∈3]^<br />ᐸ__first_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle51 --> PgClassExpression69
    PgClassExpression70{{"PgClassExpression[70∈3]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression70
    PgClassExpression71{{"PgClassExpression[71∈3]^<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression71
    PgClassExpression72{{"PgClassExpression[72∈3]^<br />ᐸ__third_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression72
    PgClassExpression73{{"PgClassExpression[73∈3]^<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle63 --> PgClassExpression73

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access11,Access12,Object13,Connection14,Lambda15,Constant16,PgUnionAll20,Constant22,Access134,Constant139,Constant140,Constant141 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll26,PgUnionAll27,First28,PgUnionAllSingle30,PgClassExpression31,PgPageInfo33,PgUnionAll74,First75,PgUnionAllSingle77,Access78,PgCursor79,PgUnionAll80,Last81,PgUnionAllSingle83,Access84,PgCursor85,PgUnionAll87,Access88,Object89,Lambda90,PgUnionAll91,Access92,Object93,Lambda94,Access95,Access135,Access136,Access137,Access138 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item24,PgUnionAllSingle25,Access34 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,JSONParse36,Access38,PgSelect40,First48,PgSelectRows49,PgSelectSingle51,PgSelect56,First60,PgSelectRows61,PgSelectSingle63,PgClassExpression67,PgClassExpression68,PgClassExpression69,PgClassExpression70,PgClassExpression71,PgClassExpression72,PgClassExpression73 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item65,PgUnionAllSingle66 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgCursor96,Access97 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,JSONParse99,Access101,PgSelect103,First111,PgSelectRows112,PgSelectSingle114,PgSelect119,First123,PgSelectRows124,PgSelectSingle126,PgClassExpression127,PgClassExpression128,PgClassExpression129,PgClassExpression130,PgClassExpression131,PgClassExpression132,PgClassExpression133 bucket6

