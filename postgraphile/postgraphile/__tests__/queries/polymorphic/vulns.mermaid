%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection19{{"Connection[19∈0] ➊<br />ᐸ15ᐳ"}}:::plan
    Constant125{{"Constant[125∈0] ➊<br />ᐸ3ᐳ"}}:::plan
    Lambda20{{"Lambda[20∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor25["PgValidateParsedCursor[25∈0] ➊"]:::plan
    Constant125 & Lambda20 & PgValidateParsedCursor25 & PgValidateParsedCursor25 & PgValidateParsedCursor25 & PgValidateParsedCursor25 --> Connection19
    Object18{{"Object[18∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access17{{"Access[17∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access16 & Access17 --> Object18
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access16
    __Value2 --> Access17
    Constant126{{"Constant[126∈0] ➊<br />ᐸ'WyIzMDY3N2Q5ZTIyIiwiMTAiLCJUaGlyZFBhcnR5VnVsbmVyYWJpbGl0eSIᐳ"}}:::plan
    Constant126 --> Lambda20
    Lambda20 --> PgValidateParsedCursor25
    PgUnionAll93[["PgUnionAll[93∈0] ➊"]]:::plan
    Object18 --> PgUnionAll93
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgUnionAll21[["PgUnionAll[21∈1] ➊"]]:::plan
    ToPg27{{"ToPg[27∈1] ➊"}}:::plan
    ToPg29{{"ToPg[29∈1] ➊"}}:::plan
    Access30{{"Access[30∈1] ➊<br />ᐸ20.3ᐳ"}}:::plan
    Object18 & Connection19 & Lambda20 & ToPg27 & ToPg29 & Access30 --> PgUnionAll21
    PgUnionAll62[["PgUnionAll[62∈1] ➊"]]:::plan
    Object18 & Connection19 & Lambda20 & ToPg27 & ToPg29 & Access30 --> PgUnionAll62
    PgUnionAll73[["PgUnionAll[73∈1] ➊"]]:::plan
    Object18 & Connection19 & Lambda20 & ToPg27 & ToPg29 & Access30 --> PgUnionAll73
    PgUnionAll84[["PgUnionAll[84∈1] ➊"]]:::plan
    Object18 & Connection19 & Lambda20 & ToPg27 & ToPg29 & Access30 --> PgUnionAll84
    List72{{"List[72∈1] ➊<br />ᐸ69,70,71ᐳ"}}:::plan
    Access69{{"Access[69∈1] ➊<br />ᐸ64.0ᐳ"}}:::plan
    Access70{{"Access[70∈1] ➊<br />ᐸ64.1ᐳ"}}:::plan
    Access71{{"Access[71∈1] ➊<br />ᐸ64.2ᐳ"}}:::plan
    Access69 & Access70 & Access71 --> List72
    List83{{"List[83∈1] ➊<br />ᐸ80,81,82ᐳ"}}:::plan
    Access80{{"Access[80∈1] ➊<br />ᐸ75.0ᐳ"}}:::plan
    Access81{{"Access[81∈1] ➊<br />ᐸ75.1ᐳ"}}:::plan
    Access82{{"Access[82∈1] ➊<br />ᐸ75.2ᐳ"}}:::plan
    Access80 & Access81 & Access82 --> List83
    PgUnionAll57[["PgUnionAll[57∈1] ➊"]]:::plan
    Object18 & Connection19 --> PgUnionAll57
    Access26{{"Access[26∈1] ➊<br />ᐸ20.1ᐳ"}}:::plan
    Lambda20 --> Access26
    Access26 --> ToPg27
    Access28{{"Access[28∈1] ➊<br />ᐸ20.2ᐳ"}}:::plan
    Lambda20 --> Access28
    Access28 --> ToPg29
    Lambda20 --> Access30
    First58{{"First[58∈1] ➊"}}:::plan
    PgUnionAll57 --> First58
    PgUnionAllSingle59["PgUnionAllSingle[59∈1] ➊"]:::plan
    First58 --> PgUnionAllSingle59
    PgClassExpression60{{"PgClassExpression[60∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgUnionAllSingle59 --> PgClassExpression60
    PgPageInfo61{{"PgPageInfo[61∈1] ➊"}}:::plan
    Connection19 --> PgPageInfo61
    First63{{"First[63∈1] ➊"}}:::plan
    PgUnionAll62 --> First63
    PgUnionAllSingle64["PgUnionAllSingle[64∈1] ➊"]:::plan
    First63 --> PgUnionAllSingle64
    PgCursor65{{"PgCursor[65∈1] ➊"}}:::plan
    List72 --> PgCursor65
    PgUnionAllSingle64 --> Access69
    PgUnionAllSingle64 --> Access70
    PgUnionAllSingle64 --> Access71
    Last74{{"Last[74∈1] ➊"}}:::plan
    PgUnionAll73 --> Last74
    PgUnionAllSingle75["PgUnionAllSingle[75∈1] ➊"]:::plan
    Last74 --> PgUnionAllSingle75
    PgCursor76{{"PgCursor[76∈1] ➊"}}:::plan
    List83 --> PgCursor76
    PgUnionAllSingle75 --> Access80
    PgUnionAllSingle75 --> Access81
    PgUnionAllSingle75 --> Access82
    Access85{{"Access[85∈1] ➊<br />ᐸ84.hasMoreᐳ"}}:::plan
    PgUnionAll84 --> Access85
    Constant86{{"Constant[86∈1] ➊<br />ᐸfalseᐳ"}}:::plan
    __Item22[/"__Item[22∈2]<br />ᐸ21ᐳ"\]:::itemplan
    PgUnionAll21 ==> __Item22
    PgUnionAllSingle23["PgUnionAllSingle[23∈2]"]:::plan
    __Item22 --> PgUnionAllSingle23
    List34{{"List[34∈3]<br />ᐸ31,32,33ᐳ"}}:::plan
    Access31{{"Access[31∈3]<br />ᐸ23.0ᐳ"}}:::plan
    Access32{{"Access[32∈3]<br />ᐸ23.1ᐳ"}}:::plan
    Access33{{"Access[33∈3]<br />ᐸ23.2ᐳ"}}:::plan
    Access31 & Access32 & Access33 --> List34
    PgCursor24{{"PgCursor[24∈3]"}}:::plan
    List34 --> PgCursor24
    PgUnionAllSingle23 --> Access31
    PgUnionAllSingle23 --> Access32
    PgUnionAllSingle23 --> Access33
    PgSelect38[["PgSelect[38∈4]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access37{{"Access[37∈4]<br />ᐸ36.0ᐳ"}}:::plan
    Object18 & Access37 --> PgSelect38
    PgSelect49[["PgSelect[49∈4]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Access48{{"Access[48∈4]<br />ᐸ47.0ᐳ"}}:::plan
    Object18 & Access48 --> PgSelect49
    JSONParse36[["JSONParse[36∈4]<br />ᐸ33ᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access33 --> JSONParse36
    JSONParse36 --> Access37
    First42{{"First[42∈4]"}}:::plan
    PgSelect38 --> First42
    PgSelectSingle43{{"PgSelectSingle[43∈4]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First42 --> PgSelectSingle43
    PgClassExpression44{{"PgClassExpression[44∈4]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression44
    PgClassExpression45{{"PgClassExpression[45∈4]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression45
    PgClassExpression46{{"PgClassExpression[46∈4]<br />ᐸ__first_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression46
    JSONParse47[["JSONParse[47∈4]<br />ᐸ33ᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Access33 --> JSONParse47
    JSONParse47 --> Access48
    First51{{"First[51∈4]"}}:::plan
    PgSelect49 --> First51
    PgSelectSingle52{{"PgSelectSingle[52∈4]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First51 --> PgSelectSingle52
    PgClassExpression53{{"PgClassExpression[53∈4]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression53
    PgClassExpression54{{"PgClassExpression[54∈4]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression54
    PgClassExpression55{{"PgClassExpression[55∈4]<br />ᐸ__third_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression55
    PgClassExpression56{{"PgClassExpression[56∈4]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle52 --> PgClassExpression56
    __Item95[/"__Item[95∈5]<br />ᐸ93ᐳ"\]:::itemplan
    PgUnionAll93 ==> __Item95
    PgUnionAllSingle96["PgUnionAllSingle[96∈5]"]:::plan
    __Item95 --> PgUnionAllSingle96
    PgSelect100[["PgSelect[100∈6]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access99{{"Access[99∈6]<br />ᐸ98.0ᐳ"}}:::plan
    Object18 & Access99 --> PgSelect100
    PgSelect111[["PgSelect[111∈6]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Access110{{"Access[110∈6]<br />ᐸ109.0ᐳ"}}:::plan
    Object18 & Access110 --> PgSelect111
    Access97{{"Access[97∈6]<br />ᐸ96.2ᐳ<br />ᐳFirstPartyVulnerability"}}:::plan
    PgUnionAllSingle96 --> Access97
    JSONParse98[["JSONParse[98∈6]<br />ᐸ97ᐳ"]]:::plan
    Access97 --> JSONParse98
    JSONParse98 --> Access99
    First104{{"First[104∈6]"}}:::plan
    PgSelect100 --> First104
    PgSelectSingle105{{"PgSelectSingle[105∈6]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First104 --> PgSelectSingle105
    PgClassExpression106{{"PgClassExpression[106∈6]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle105 --> PgClassExpression106
    PgClassExpression107{{"PgClassExpression[107∈6]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle105 --> PgClassExpression107
    PgClassExpression108{{"PgClassExpression[108∈6]<br />ᐸ__first_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle105 --> PgClassExpression108
    JSONParse109[["JSONParse[109∈6]<br />ᐸ97ᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Access97 --> JSONParse109
    JSONParse109 --> Access110
    First113{{"First[113∈6]"}}:::plan
    PgSelect111 --> First113
    PgSelectSingle114{{"PgSelectSingle[114∈6]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First113 --> PgSelectSingle114
    PgClassExpression115{{"PgClassExpression[115∈6]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression115
    PgClassExpression116{{"PgClassExpression[116∈6]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression116
    PgClassExpression117{{"PgClassExpression[117∈6]<br />ᐸ__third_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression117
    PgClassExpression118{{"PgClassExpression[118∈6]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle114 --> PgClassExpression118

    %% define steps

    subgraph "Buckets for queries/polymorphic/vulns"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 16, 17, 125, 126, 18, 20<br />2: 25, 93<br />ᐳ: Connection[19]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access16,Access17,Object18,Connection19,Lambda20,PgValidateParsedCursor25,PgUnionAll93,Constant125,Constant126 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 18, 19, 20<br /><br />ROOT Connectionᐸ15ᐳ[19]<br />1: PgUnionAll[57]<br />ᐳ: 26, 28, 30, 61, 86, 27, 29, 58<br />2: 21, 59, 62, 73, 84<br />ᐳ: 60, 63, 74, 85<br />3: 64, 75<br />ᐳ: 69, 70, 71, 72, 80, 81, 82, 83, 65, 76"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll21,Access26,ToPg27,Access28,ToPg29,Access30,PgUnionAll57,First58,PgUnionAllSingle59,PgClassExpression60,PgPageInfo61,PgUnionAll62,First63,PgUnionAllSingle64,PgCursor65,Access69,Access70,Access71,List72,PgUnionAll73,Last74,PgUnionAllSingle75,PgCursor76,Access80,Access81,Access82,List83,PgUnionAll84,Access85,Constant86 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 18<br /><br />ROOT __Item{2}ᐸ21ᐳ[22]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item22,PgUnionAllSingle23 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 23, 18<br /><br />ROOT PgUnionAllSingle{2}[23]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor24,Access31,Access32,Access33,List34 bucket3
    Bucket4("Bucket 4 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 33, 18, 23<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability<br /><br />1: JSONParse[36], JSONParse[47]<br />ᐳ: Access[37], Access[48]<br />2: PgSelect[38], PgSelect[49]<br />ᐳ: 42, 43, 44, 45, 46, 51, 52, 53, 54, 55, 56"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,JSONParse36,Access37,PgSelect38,First42,PgSelectSingle43,PgClassExpression44,PgClassExpression45,PgClassExpression46,JSONParse47,Access48,PgSelect49,First51,PgSelectSingle52,PgClassExpression53,PgClassExpression54,PgClassExpression55,PgClassExpression56 bucket4
    Bucket5("Bucket 5 (listItem)<br />Deps: 18<br /><br />ROOT __Item{5}ᐸ93ᐳ[95]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item95,PgUnionAllSingle96 bucket5
    Bucket6("Bucket 6 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 96, 18<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability<br /><br />1: <br />ᐳ: Access[97]<br />2: JSONParse[98], JSONParse[109]<br />ᐳ: Access[99], Access[110]<br />3: PgSelect[100], PgSelect[111]<br />ᐳ: 104, 105, 106, 107, 108, 113, 114, 115, 116, 117, 118"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,Access97,JSONParse98,Access99,PgSelect100,First104,PgSelectSingle105,PgClassExpression106,PgClassExpression107,PgClassExpression108,JSONParse109,Access110,PgSelect111,First113,PgSelectSingle114,PgClassExpression115,PgClassExpression116,PgClassExpression117,PgClassExpression118 bucket6
    Bucket0 --> Bucket1 & Bucket5
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket5 --> Bucket6
    end
