%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Connection19{{"Connection[19∈0] ➊<br />ᐸ15ᐳ"}}:::plan
    Constant133{{"Constant[133∈0] ➊<br />ᐸ3ᐳ"}}:::plan
    Lambda20{{"Lambda[20∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    PgValidateParsedCursor25["PgValidateParsedCursor[25∈0] ➊"]:::plan
    Constant133 & Lambda20 & PgValidateParsedCursor25 & PgValidateParsedCursor25 & PgValidateParsedCursor25 & PgValidateParsedCursor25 --> Connection19
    Object18{{"Object[18∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access17{{"Access[17∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access16 & Access17 --> Object18
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access16
    __Value2 --> Access17
    Constant134{{"Constant[134∈0] ➊<br />ᐸ'WyIzMDY3N2Q5ZTIyIiwiMTAiLCJUaGlyZFBhcnR5VnVsbmVyYWJpbGl0eSIᐳ"}}:::plan
    Constant134 --> Lambda20
    Lambda20 --> PgValidateParsedCursor25
    PgUnionAll100[["PgUnionAll[100∈0] ➊"]]:::plan
    Object18 --> PgUnionAll100
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgUnionAll21[["PgUnionAll[21∈1] ➊"]]:::plan
    ToPg27{{"ToPg[27∈1] ➊"}}:::plan
    ToPg29{{"ToPg[29∈1] ➊"}}:::plan
    Access30{{"Access[30∈1] ➊<br />ᐸ20.3ᐳ"}}:::plan
    Object18 & Connection19 & Lambda20 & ToPg27 & ToPg29 & Access30 --> PgUnionAll21
    PgUnionAll63[["PgUnionAll[63∈1] ➊"]]:::plan
    Object18 & Connection19 & Lambda20 & ToPg27 & ToPg29 & Access30 --> PgUnionAll63
    PgUnionAll77[["PgUnionAll[77∈1] ➊"]]:::plan
    Object18 & Connection19 & Lambda20 & ToPg27 & ToPg29 & Access30 --> PgUnionAll77
    PgUnionAll91[["PgUnionAll[91∈1] ➊"]]:::plan
    Object18 & Connection19 & Lambda20 & ToPg27 & ToPg29 & Access30 --> PgUnionAll91
    List76{{"List[76∈1] ➊<br />ᐸ73,74,75ᐳ"}}:::plan
    Access73{{"Access[73∈1] ➊<br />ᐸ65.0ᐳ"}}:::plan
    Access74{{"Access[74∈1] ➊<br />ᐸ65.1ᐳ"}}:::plan
    Access75{{"Access[75∈1] ➊<br />ᐸ65.2ᐳ"}}:::plan
    Access73 & Access74 & Access75 --> List76
    List90{{"List[90∈1] ➊<br />ᐸ87,88,89ᐳ"}}:::plan
    Access87{{"Access[87∈1] ➊<br />ᐸ79.0ᐳ"}}:::plan
    Access88{{"Access[88∈1] ➊<br />ᐸ79.1ᐳ"}}:::plan
    Access89{{"Access[89∈1] ➊<br />ᐸ79.2ᐳ"}}:::plan
    Access87 & Access88 & Access89 --> List90
    PgUnionAll58[["PgUnionAll[58∈1] ➊"]]:::plan
    Object18 & Connection19 --> PgUnionAll58
    Access26{{"Access[26∈1] ➊<br />ᐸ20.1ᐳ"}}:::plan
    Lambda20 --> Access26
    Access26 --> ToPg27
    Access28{{"Access[28∈1] ➊<br />ᐸ20.2ᐳ"}}:::plan
    Lambda20 --> Access28
    Access28 --> ToPg29
    Lambda20 --> Access30
    First59{{"First[59∈1] ➊"}}:::plan
    PgUnionAll58 --> First59
    PgUnionAllSingle60["PgUnionAllSingle[60∈1] ➊"]:::plan
    First59 --> PgUnionAllSingle60
    PgClassExpression61{{"PgClassExpression[61∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgUnionAllSingle60 --> PgClassExpression61
    PgPageInfo62{{"PgPageInfo[62∈1] ➊"}}:::plan
    Connection19 --> PgPageInfo62
    First64{{"First[64∈1] ➊"}}:::plan
    PgUnionAll63 --> First64
    PgUnionAllSingle65["PgUnionAllSingle[65∈1] ➊"]:::plan
    First64 --> PgUnionAllSingle65
    PgCursor66{{"PgCursor[66∈1] ➊"}}:::plan
    List76 --> PgCursor66
    PgUnionAllSingle65 --> Access73
    PgUnionAllSingle65 --> Access74
    PgUnionAllSingle65 --> Access75
    Last78{{"Last[78∈1] ➊"}}:::plan
    PgUnionAll77 --> Last78
    PgUnionAllSingle79["PgUnionAllSingle[79∈1] ➊"]:::plan
    Last78 --> PgUnionAllSingle79
    PgCursor80{{"PgCursor[80∈1] ➊"}}:::plan
    List90 --> PgCursor80
    PgUnionAllSingle79 --> Access87
    PgUnionAllSingle79 --> Access88
    PgUnionAllSingle79 --> Access89
    Access92{{"Access[92∈1] ➊<br />ᐸ91.hasMoreᐳ"}}:::plan
    PgUnionAll91 --> Access92
    Constant93{{"Constant[93∈1] ➊<br />ᐸfalseᐳ"}}:::plan
    __Item22[/"__Item[22∈2]<br />ᐸ21ᐳ"\]:::itemplan
    PgUnionAll21 ==> __Item22
    PgUnionAllSingle23["PgUnionAllSingle[23∈2]"]:::plan
    __Item22 --> PgUnionAllSingle23
    List34{{"List[34∈3]<br />ᐸ31,32,33ᐳ"}}:::plan
    Access31{{"Access[31∈3]<br />ᐸ23.0ᐳ"}}:::plan
    Access32{{"Access[32∈3]<br />ᐸ23.1ᐳ"}}:::plan
    Access33{{"Access[33∈3]<br />ᐸ23.2ᐳ"}}:::plan
    Access31 & Access32 & Access33 --> List34
    PgCursor24{{"PgCursor[24∈3]"}}:::plan
    List34 --> PgCursor24
    PgUnionAllSingle23 --> Access31
    PgUnionAllSingle23 --> Access32
    PgUnionAllSingle23 --> Access33
    PgSelect38[["PgSelect[38∈4]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access37{{"Access[37∈4]<br />ᐸ36.0ᐳ"}}:::plan
    Object18 & Access37 --> PgSelect38
    PgSelect50[["PgSelect[50∈4]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Access49{{"Access[49∈4]<br />ᐸ48.0ᐳ"}}:::plan
    Object18 & Access49 --> PgSelect50
    JSONParse36[["JSONParse[36∈4]<br />ᐸ33ᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access33 --> JSONParse36
    JSONParse36 --> Access37
    First42{{"First[42∈4]"}}:::plan
    PgSelect38 --> First42
    PgSelectSingle43{{"PgSelectSingle[43∈4]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First42 --> PgSelectSingle43
    PgClassExpression44{{"PgClassExpression[44∈4]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression44
    PgClassExpression45{{"PgClassExpression[45∈4]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression45
    PgClassExpression46{{"PgClassExpression[46∈4]<br />ᐸ__first_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression46
    JSONParse48[["JSONParse[48∈4]<br />ᐸ33ᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Access33 --> JSONParse48
    JSONParse48 --> Access49
    First52{{"First[52∈4]"}}:::plan
    PgSelect50 --> First52
    PgSelectSingle53{{"PgSelectSingle[53∈4]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First52 --> PgSelectSingle53
    PgClassExpression54{{"PgClassExpression[54∈4]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression54
    PgClassExpression55{{"PgClassExpression[55∈4]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression55
    PgClassExpression56{{"PgClassExpression[56∈4]<br />ᐸ__third_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression56
    PgClassExpression57{{"PgClassExpression[57∈4]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression57
    __Item102[/"__Item[102∈5]<br />ᐸ100ᐳ"\]:::itemplan
    PgUnionAll100 ==> __Item102
    PgUnionAllSingle103["PgUnionAllSingle[103∈5]"]:::plan
    __Item102 --> PgUnionAllSingle103
    Access104{{"Access[104∈5]<br />ᐸ103.2ᐳ"}}:::plan
    PgUnionAllSingle103 --> Access104
    PgSelect107[["PgSelect[107∈6]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access106{{"Access[106∈6]<br />ᐸ105.0ᐳ"}}:::plan
    Object18 & Access106 --> PgSelect107
    PgSelect119[["PgSelect[119∈6]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Access118{{"Access[118∈6]<br />ᐸ117.0ᐳ"}}:::plan
    Object18 & Access118 --> PgSelect119
    JSONParse105[["JSONParse[105∈6]<br />ᐸ104ᐳ<br />ᐳFirstPartyVulnerability"]]:::plan
    Access104 --> JSONParse105
    JSONParse105 --> Access106
    First111{{"First[111∈6]"}}:::plan
    PgSelect107 --> First111
    PgSelectSingle112{{"PgSelectSingle[112∈6]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First111 --> PgSelectSingle112
    PgClassExpression113{{"PgClassExpression[113∈6]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression113
    PgClassExpression114{{"PgClassExpression[114∈6]<br />ᐸ__first_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression114
    PgClassExpression115{{"PgClassExpression[115∈6]<br />ᐸ__first_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression115
    JSONParse117[["JSONParse[117∈6]<br />ᐸ104ᐳ<br />ᐳThirdPartyVulnerability"]]:::plan
    Access104 --> JSONParse117
    JSONParse117 --> Access118
    First121{{"First[121∈6]"}}:::plan
    PgSelect119 --> First121
    PgSelectSingle122{{"PgSelectSingle[122∈6]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First121 --> PgSelectSingle122
    PgClassExpression123{{"PgClassExpression[123∈6]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle122 --> PgClassExpression123
    PgClassExpression124{{"PgClassExpression[124∈6]<br />ᐸ__third_pa...s__.”name”ᐳ"}}:::plan
    PgSelectSingle122 --> PgClassExpression124
    PgClassExpression125{{"PgClassExpression[125∈6]<br />ᐸ__third_pa...vss_score”ᐳ"}}:::plan
    PgSelectSingle122 --> PgClassExpression125
    PgClassExpression126{{"PgClassExpression[126∈6]<br />ᐸ__third_pa...ndor_name”ᐳ"}}:::plan
    PgSelectSingle122 --> PgClassExpression126

    %% define steps

    subgraph "Buckets for queries/polymorphic/vulns"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 16, 17, 133, 134, 18, 20<br />2: 25, 100<br />ᐳ: Connection[19]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access16,Access17,Object18,Connection19,Lambda20,PgValidateParsedCursor25,PgUnionAll100,Constant133,Constant134 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 18, 19, 20<br /><br />ROOT Connectionᐸ15ᐳ[19]<br />1: PgUnionAll[58]<br />ᐳ: 26, 28, 30, 62, 93, 27, 29, 59<br />2: 21, 60, 63, 77, 91<br />ᐳ: 61, 64, 78, 92<br />3: 65, 79<br />ᐳ: 73, 74, 75, 76, 87, 88, 89, 90, 66, 80"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUnionAll21,Access26,ToPg27,Access28,ToPg29,Access30,PgUnionAll58,First59,PgUnionAllSingle60,PgClassExpression61,PgPageInfo62,PgUnionAll63,First64,PgUnionAllSingle65,PgCursor66,Access73,Access74,Access75,List76,PgUnionAll77,Last78,PgUnionAllSingle79,PgCursor80,Access87,Access88,Access89,List90,PgUnionAll91,Access92,Constant93 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 18<br /><br />ROOT __Item{2}ᐸ21ᐳ[22]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item22,PgUnionAllSingle23 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 23, 18<br /><br />ROOT PgUnionAllSingle{2}[23]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor24,Access31,Access32,Access33,List34 bucket3
    Bucket4("Bucket 4 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 33, 18, 23<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability<br /><br />1: JSONParse[36], JSONParse[48]<br />ᐳ: Access[37], Access[49]<br />2: PgSelect[38], PgSelect[50]<br />ᐳ: 42, 43, 44, 45, 46, 52, 53, 54, 55, 56, 57"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,JSONParse36,Access37,PgSelect38,First42,PgSelectSingle43,PgClassExpression44,PgClassExpression45,PgClassExpression46,JSONParse48,Access49,PgSelect50,First52,PgSelectSingle53,PgClassExpression54,PgClassExpression55,PgClassExpression56,PgClassExpression57 bucket4
    Bucket5("Bucket 5 (listItem)<br />Deps: 18<br /><br />ROOT __Item{5}ᐸ100ᐳ[102]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,__Item102,PgUnionAllSingle103,Access104 bucket5
    Bucket6("Bucket 6 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 104, 18, 103<br />ᐳFirstPartyVulnerability<br />ᐳThirdPartyVulnerability<br /><br />1: JSONParse[105], JSONParse[117]<br />ᐳ: Access[106], Access[118]<br />2: PgSelect[107], PgSelect[119]<br />ᐳ: 111, 112, 113, 114, 115, 121, 122, 123, 124, 125, 126"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,JSONParse105,Access106,PgSelect107,First111,PgSelectSingle112,PgClassExpression113,PgClassExpression114,PgClassExpression115,JSONParse117,Access118,PgSelect119,First121,PgSelectSingle122,PgClassExpression123,PgClassExpression124,PgClassExpression125,PgClassExpression126 bucket6
    Bucket0 --> Bucket1 & Bucket5
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket5 --> Bucket6
    end
