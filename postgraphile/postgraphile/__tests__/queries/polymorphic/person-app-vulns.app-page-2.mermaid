%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/polymorphic/person-app-vulns.app-page-2"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 12, 13, 162, 27, 28, 163<br /><br />ROOT Connectionᐸ9ᐳ[13]<br />1: PgSelect[15]<br />2: PgSelectRows[16]"):::bucket
    Bucket2("Bucket 2 (listItem)<br />Deps: 12, 27, 28, 163<br /><br />ROOT __Item{2}ᐸ16ᐳ[17]"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 18, 12, 27, 28, 163<br /><br />ROOT PgSelectSingle{2}ᐸpeopleᐳ[18]<br />1: <br />ᐳ: 19, 20<br />2: PgUnionAll[29]<br />ᐳ: Access[161]"):::bucket
    Bucket4("Bucket 4 (listItem)<br />Deps: 29, 12, 163<br /><br />ROOT __Item{4}ᐸ161ᐳ[31]"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 32, 33, 12, 163<br /><br />ROOT PgUnionAllSingle{4}[32]"):::bucket
    Bucket6("Bucket 6 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 35, 12, 163, 32<br />ᐳAwsApplication<br />ᐳGcpApplication<br /><br />1: 37, 72, 80<br />ᐳ: Access[39]<br />2: PgSelect[41], PgSelect[57]<br />3: PgSelectRows[50], PgSelectRows[62]<br />ᐳ: 49, 52, 61, 64, 65, 73<br />4: PgUnionAll[81], PgUnionAll[82]<br />ᐳ: Access[159], Access[160]"):::bucket
    Bucket7("Bucket 7 (listItem)<br />Deps: 81, 12<br /><br />ROOT __Item{7}ᐸ159ᐳ[84]"):::bucket
    Bucket8("Bucket 8 (listItem)<br />Deps: 82, 12<br /><br />ROOT __Item{8}ᐸ160ᐳ[87]"):::bucket
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 85, 89, 12<br /><br />ROOT PgUnionAllSingle{7}[85]"):::bucket
    Bucket10("Bucket 10 (nullableBoundary)<br />Deps: 88, 92, 12<br /><br />ROOT PgUnionAllSingle{8}[88]"):::bucket
    Bucket11("Bucket 11 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 95, 12, 85<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br /><br />1: JSONParse[97]<br />ᐳ: Access[99]<br />2: PgSelect[101], PgSelect[117]<br />3: PgSelectRows[110], PgSelectRows[122]<br />ᐳ: 109, 112, 121, 124, 155, 156"):::bucket
    Bucket12("Bucket 12 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 125, 12, 88<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br /><br />1: JSONParse[127]<br />ᐳ: Access[129]<br />2: PgSelect[131], PgSelect[147]<br />3: PgSelectRows[140], PgSelectRows[152]<br />ᐳ: 139, 142, 151, 154, 157, 158"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket6 --> Bucket7 & Bucket8
    Bucket7 --> Bucket9
    Bucket8 --> Bucket10
    Bucket9 --> Bucket11
    Bucket10 --> Bucket12

    %% plan dependencies
    Object12{{"Object[12∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access10 & Access11 --> Object12
    Connection27{{"Connection[27∈0] ➊<br />ᐸ23ᐳ"}}:::plan
    Constant163{{"Constant[163∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Lambda28{{"Lambda[28∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant163 & Lambda28 --> Connection27
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access10
    __Value2 --> Access11
    Connection13{{"Connection[13∈0] ➊<br />ᐸ9ᐳ"}}:::plan
    Constant162{{"Constant[162∈0] ➊<br />ᐸ4ᐳ"}}:::plan
    Constant162 --> Connection13
    Constant164{{"Constant[164∈0] ➊<br />ᐸ'WyI0OTgwM2MxZTJiIiwiQXdzQXBwbGljYXRpb24iLCJbXCI0XCJdIl0='ᐳ"}}:::plan
    Constant164 --> Lambda28
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgSelect15[["PgSelect[15∈1] ➊<br />ᐸpeopleᐳ"]]:::plan
    Object12 & Connection13 & Constant162 --> PgSelect15
    PgSelectRows16[["PgSelectRows[16∈1] ➊"]]:::plan
    PgSelect15 --> PgSelectRows16
    __Item17[/"__Item[17∈2]<br />ᐸ16ᐳ"\]:::itemplan
    PgSelectRows16 ==> __Item17
    PgSelectSingle18{{"PgSelectSingle[18∈2]<br />ᐸpeopleᐳ"}}:::plan
    __Item17 --> PgSelectSingle18
    PgUnionAll29[["PgUnionAll[29∈3]<br />ᐸAwsApplication,GcpApplicationᐳ"]]:::plan
    PgClassExpression19{{"PgClassExpression[19∈3]<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Object12 & PgClassExpression19 & Connection27 & Lambda28 & Constant163 --> PgUnionAll29
    PgSelectSingle18 --> PgClassExpression19
    PgClassExpression20{{"PgClassExpression[20∈3]<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle18 --> PgClassExpression20
    Access161{{"Access[161∈3]<br />ᐸ29.itemsᐳ"}}:::plan
    PgUnionAll29 --> Access161
    __Item31[/"__Item[31∈4]<br />ᐸ161ᐳ"\]:::itemplan
    Access161 ==> __Item31
    PgUnionAllSingle32["PgUnionAllSingle[32∈4]"]:::plan
    __Item31 --> PgUnionAllSingle32
    Access33{{"Access[33∈4]<br />ᐸ29.cursorDetailsᐳ"}}:::plan
    PgUnionAll29 --> Access33
    PgCursor34{{"PgCursor[34∈5]"}}:::plan
    PgUnionAllSingle32 & Access33 --> PgCursor34
    Access35{{"Access[35∈5]<br />ᐸ32.1ᐳ"}}:::plan
    PgUnionAllSingle32 --> Access35
    PgUnionAll81[["PgUnionAll[81∈6]^<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    PgClassExpression65{{"PgClassExpression[65∈6]^<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    Connection72{{"Connection[72∈6] ➊<br />ᐸ67ᐳ<br />ᐳAwsApplication"}}:::plan
    Object12 & PgClassExpression65 & Connection72 & Constant163 --> PgUnionAll81
    PgUnionAll82[["PgUnionAll[82∈6]^<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    PgClassExpression73{{"PgClassExpression[73∈6]^<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    Connection80{{"Connection[80∈6] ➊<br />ᐸ75ᐳ<br />ᐳGcpApplication"}}:::plan
    Object12 & PgClassExpression73 & Connection80 & Constant163 --> PgUnionAll82
    PgSelect41[["PgSelect[41∈6]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Access39{{"Access[39∈6]^<br />ᐸ37.0ᐳ"}}:::plan
    Object12 & Access39 --> PgSelect41
    PgSelect57[["PgSelect[57∈6]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Object12 & Access39 --> PgSelect57
    JSONParse37[["JSONParse[37∈6]<br />ᐸ35ᐳ<br />ᐳAwsApplication<br />ᐳGcpApplication"]]:::plan
    Access35 --> JSONParse37
    JSONParse37 --> Access39
    First49{{"First[49∈6]^"}}:::plan
    PgSelectRows50[["PgSelectRows[50∈6]^"]]:::plan
    PgSelectRows50 --> First49
    PgSelect41 --> PgSelectRows50
    PgSelectSingle52{{"PgSelectSingle[52∈6]^<br />ᐸaws_applicationsᐳ"}}:::plan
    First49 --> PgSelectSingle52
    First61{{"First[61∈6]^"}}:::plan
    PgSelectRows62[["PgSelectRows[62∈6]^"]]:::plan
    PgSelectRows62 --> First61
    PgSelect57 --> PgSelectRows62
    PgSelectSingle64{{"PgSelectSingle[64∈6]^<br />ᐸgcp_applicationsᐳ"}}:::plan
    First61 --> PgSelectSingle64
    PgSelectSingle52 --> PgClassExpression65
    Constant163 --> Connection72
    PgSelectSingle64 --> PgClassExpression73
    Constant163 --> Connection80
    Access159{{"Access[159∈6]^<br />ᐸ81.itemsᐳ"}}:::plan
    PgUnionAll81 --> Access159
    Access160{{"Access[160∈6]^<br />ᐸ82.itemsᐳ"}}:::plan
    PgUnionAll82 --> Access160
    __Item84[/"__Item[84∈7]<br />ᐸ159ᐳ<br />ᐳAwsApplication"\]:::itemplan
    Access159 ==> __Item84
    PgUnionAllSingle85["PgUnionAllSingle[85∈7]^"]:::plan
    __Item84 --> PgUnionAllSingle85
    Access89{{"Access[89∈7]<br />ᐸ81.cursorDetailsᐳ<br />ᐳAwsApplication"}}:::plan
    PgUnionAll81 --> Access89
    PgCursor91{{"PgCursor[91∈9]<br />ᐳAwsApplication"}}:::plan
    PgUnionAllSingle85 & Access89 --> PgCursor91
    Access95{{"Access[95∈9]<br />ᐸ85.1ᐳ<br />ᐳAwsApplication"}}:::plan
    PgUnionAllSingle85 --> Access95
    PgSelect101[["PgSelect[101∈11]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access99{{"Access[99∈11]^<br />ᐸ97.0ᐳ"}}:::plan
    Object12 & Access99 --> PgSelect101
    PgSelect117[["PgSelect[117∈11]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Object12 & Access99 --> PgSelect117
    JSONParse97[["JSONParse[97∈11]<br />ᐸ95ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access95 --> JSONParse97
    JSONParse97 --> Access99
    First109{{"First[109∈11]^"}}:::plan
    PgSelectRows110[["PgSelectRows[110∈11]^"]]:::plan
    PgSelectRows110 --> First109
    PgSelect101 --> PgSelectRows110
    PgSelectSingle112{{"PgSelectSingle[112∈11]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First109 --> PgSelectSingle112
    First121{{"First[121∈11]^"}}:::plan
    PgSelectRows122[["PgSelectRows[122∈11]^"]]:::plan
    PgSelectRows122 --> First121
    PgSelect117 --> PgSelectRows122
    PgSelectSingle124{{"PgSelectSingle[124∈11]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First121 --> PgSelectSingle124
    PgClassExpression155{{"PgClassExpression[155∈11]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle112 --> PgClassExpression155
    PgClassExpression156{{"PgClassExpression[156∈11]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle124 --> PgClassExpression156
    __Item87[/"__Item[87∈8]<br />ᐸ160ᐳ<br />ᐳGcpApplication"\]:::itemplan
    Access160 ==> __Item87
    PgUnionAllSingle88["PgUnionAllSingle[88∈8]^"]:::plan
    __Item87 --> PgUnionAllSingle88
    Access92{{"Access[92∈8]<br />ᐸ82.cursorDetailsᐳ<br />ᐳGcpApplication"}}:::plan
    PgUnionAll82 --> Access92
    PgCursor94{{"PgCursor[94∈10]<br />ᐳGcpApplication"}}:::plan
    PgUnionAllSingle88 & Access92 --> PgCursor94
    Access125{{"Access[125∈10]<br />ᐸ88.1ᐳ<br />ᐳGcpApplication"}}:::plan
    PgUnionAllSingle88 --> Access125
    PgSelect131[["PgSelect[131∈12]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access129{{"Access[129∈12]^<br />ᐸ127.0ᐳ"}}:::plan
    Object12 & Access129 --> PgSelect131
    PgSelect147[["PgSelect[147∈12]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Object12 & Access129 --> PgSelect147
    JSONParse127[["JSONParse[127∈12]<br />ᐸ125ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access125 --> JSONParse127
    JSONParse127 --> Access129
    First139{{"First[139∈12]^"}}:::plan
    PgSelectRows140[["PgSelectRows[140∈12]^"]]:::plan
    PgSelectRows140 --> First139
    PgSelect131 --> PgSelectRows140
    PgSelectSingle142{{"PgSelectSingle[142∈12]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First139 --> PgSelectSingle142
    First151{{"First[151∈12]^"}}:::plan
    PgSelectRows152[["PgSelectRows[152∈12]^"]]:::plan
    PgSelectRows152 --> First151
    PgSelect147 --> PgSelectRows152
    PgSelectSingle154{{"PgSelectSingle[154∈12]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First151 --> PgSelectSingle154
    PgClassExpression157{{"PgClassExpression[157∈12]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle142 --> PgClassExpression157
    PgClassExpression158{{"PgClassExpression[158∈12]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle154 --> PgClassExpression158

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access10,Access11,Object12,Connection13,Connection27,Lambda28,Constant162,Constant163,Constant164 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect15,PgSelectRows16 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item17,PgSelectSingle18 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression19,PgClassExpression20,PgUnionAll29,Access161 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item31,PgUnionAllSingle32,Access33 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgCursor34,Access35 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,JSONParse37,Access39,PgSelect41,First49,PgSelectRows50,PgSelectSingle52,PgSelect57,First61,PgSelectRows62,PgSelectSingle64,PgClassExpression65,Connection72,PgClassExpression73,Connection80,PgUnionAll81,PgUnionAll82,Access159,Access160 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7,__Item84,PgUnionAllSingle85,Access89 bucket7
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item87,PgUnionAllSingle88,Access92 bucket8
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgCursor91,Access95 bucket9
    classDef bucket10 stroke:#ffff00
    class Bucket10,PgCursor94,Access125 bucket10
    classDef bucket11 stroke:#00ffff
    class Bucket11,JSONParse97,Access99,PgSelect101,First109,PgSelectRows110,PgSelectSingle112,PgSelect117,First121,PgSelectRows122,PgSelectSingle124,PgClassExpression155,PgClassExpression156 bucket11
    classDef bucket12 stroke:#4169e1
    class Bucket12,JSONParse127,Access129,PgSelect131,First139,PgSelectRows140,PgSelectSingle142,PgSelect147,First151,PgSelectRows152,PgSelectSingle154,PgClassExpression157,PgClassExpression158 bucket12

