%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/polymorphic/person-app-vulns.app-page-2"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 13, 15, 167, 33, 34, 168<br /><br />ROOT Connectionᐸ9ᐳ[15]<br />1: PgSelect[17]<br />2: PgSelectRows[19]"):::bucket
    Bucket2("Bucket 2 (listItem)<br />Deps: 13, 33, 34, 168<br /><br />ROOT __Item{2}ᐸ19ᐳ[20]"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 21, 13, 33, 34, 168<br /><br />ROOT PgSelectSingle{2}ᐸpeopleᐳ[21]<br />1: <br />ᐳ: 22, 23<br />2: PgUnionAll[36]<br />ᐳ: Access[165]"):::bucket
    Bucket4("Bucket 4 (listItem)<br />Deps: 36, 13, 168<br /><br />ROOT __Item{4}ᐸ165ᐳ[39]"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 40, 41, 13, 168<br /><br />ROOT PgUnionAllSingle{4}[40]"):::bucket
    Bucket6("Bucket 6 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 40, 13, 168<br />ᐳAwsApplication<br />ᐳGcpApplication<br /><br />1: Connection[78], Connection[85]<br />ᐳ: Access[44]<br />2: JSONParse[46]<br />ᐳ: Access[48]<br />3: PgSelect[50], PgSelect[64]<br />4: PgSelectRows[58], PgSelectRows[69]<br />ᐳ: 57, 60, 68, 71, 72, 79<br />5: PgUnionAll[86], PgUnionAll[88]<br />ᐳ: Access[161], Access[163]"):::bucket
    Bucket7("Bucket 7 (listItem)<br />Deps: 86, 13<br /><br />ROOT __Item{7}ᐸ161ᐳ[90]"):::bucket
    Bucket8("Bucket 8 (listItem)<br />Deps: 88, 13<br /><br />ROOT __Item{8}ᐸ163ᐳ[93]"):::bucket
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 91, 95, 13<br /><br />ROOT PgUnionAllSingle{7}[91]"):::bucket
    Bucket10("Bucket 10 (nullableBoundary)<br />Deps: 94, 98, 13<br /><br />ROOT PgUnionAllSingle{8}[94]"):::bucket
    Bucket11("Bucket 11 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 91, 13<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br /><br />1: <br />ᐳ: Access[101]<br />2: JSONParse[103]<br />ᐳ: Access[105]<br />3: PgSelect[107], PgSelect[121]<br />4: PgSelectRows[115], PgSelectRows[126]<br />ᐳ: 114, 117, 125, 128, 157, 158"):::bucket
    Bucket12("Bucket 12 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 94, 13<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br /><br />1: <br />ᐳ: Access[129]<br />2: JSONParse[131]<br />ᐳ: Access[133]<br />3: PgSelect[135], PgSelect[149]<br />4: PgSelectRows[143], PgSelectRows[154]<br />ᐳ: 142, 145, 153, 156, 159, 160"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket6 --> Bucket7 & Bucket8
    Bucket7 --> Bucket9
    Bucket8 --> Bucket10
    Bucket9 --> Bucket11
    Bucket10 --> Bucket12

    %% plan dependencies
    Object13{{"Object[13∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access10 & Access12 --> Object13
    Connection33{{"Connection[33∈0] ➊<br />ᐸ26ᐳ"}}:::plan
    Constant168{{"Constant[168∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Lambda34{{"Lambda[34∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant168 & Lambda34 --> Connection33
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access10
    __Value2 --> Access12
    Connection15{{"Connection[15∈0] ➊<br />ᐸ9ᐳ"}}:::plan
    Constant167{{"Constant[167∈0] ➊<br />ᐸ4ᐳ"}}:::plan
    Constant167 --> Connection15
    Constant169{{"Constant[169∈0] ➊<br />ᐸ'WyI0OTgwM2MxZTJiIiwiQXdzQXBwbGljYXRpb24iLCJbXCI0XCJdIl0='ᐳ"}}:::plan
    Constant169 --> Lambda34
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgSelect17[["PgSelect[17∈1] ➊<br />ᐸpeopleᐳ"]]:::plan
    Object13 & Connection15 & Constant167 --> PgSelect17
    PgSelectRows19[["PgSelectRows[19∈1] ➊"]]:::plan
    PgSelect17 --> PgSelectRows19
    __Item20[/"__Item[20∈2]<br />ᐸ19ᐳ"\]:::itemplan
    PgSelectRows19 ==> __Item20
    PgSelectSingle21{{"PgSelectSingle[21∈2]<br />ᐸpeopleᐳ"}}:::plan
    __Item20 --> PgSelectSingle21
    PgUnionAll36[["PgUnionAll[36∈3]<br />ᐸAwsApplication,GcpApplicationᐳ"]]:::plan
    PgClassExpression22{{"PgClassExpression[22∈3]<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Object13 & PgClassExpression22 & Connection33 & Lambda34 & Constant168 --> PgUnionAll36
    PgSelectSingle21 --> PgClassExpression22
    PgClassExpression23{{"PgClassExpression[23∈3]<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression23
    Access165{{"Access[165∈3]<br />ᐸ36.itemsᐳ"}}:::plan
    PgUnionAll36 --> Access165
    __Item39[/"__Item[39∈4]<br />ᐸ165ᐳ"\]:::itemplan
    Access165 ==> __Item39
    PgUnionAllSingle40["PgUnionAllSingle[40∈4]"]:::plan
    __Item39 --> PgUnionAllSingle40
    Access41{{"Access[41∈4]<br />ᐸ36.cursorDetailsᐳ"}}:::plan
    PgUnionAll36 --> Access41
    PgCursor43{{"PgCursor[43∈5]"}}:::plan
    PgUnionAllSingle40 & Access41 --> PgCursor43
    PgUnionAll86[["PgUnionAll[86∈6]^<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    PgClassExpression72{{"PgClassExpression[72∈6]^<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    Connection78{{"Connection[78∈6] ➊<br />ᐸ74ᐳ<br />ᐳAwsApplication"}}:::plan
    Object13 & PgClassExpression72 & Connection78 & Constant168 --> PgUnionAll86
    PgUnionAll88[["PgUnionAll[88∈6]^<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    PgClassExpression79{{"PgClassExpression[79∈6]^<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    Connection85{{"Connection[85∈6] ➊<br />ᐸ81ᐳ<br />ᐳGcpApplication"}}:::plan
    Object13 & PgClassExpression79 & Connection85 & Constant168 --> PgUnionAll88
    PgSelect50[["PgSelect[50∈6]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Access48{{"Access[48∈6]^<br />ᐸ46.0ᐳ"}}:::plan
    Object13 & Access48 --> PgSelect50
    PgSelect64[["PgSelect[64∈6]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Object13 & Access48 --> PgSelect64
    Access44{{"Access[44∈6]<br />ᐸ40.1ᐳ<br />ᐳAwsApplication<br />ᐳGcpApplication"}}:::plan
    PgUnionAllSingle40 --> Access44
    JSONParse46[["JSONParse[46∈6]^<br />ᐸ44ᐳ"]]:::plan
    Access44 --> JSONParse46
    JSONParse46 --> Access48
    First57{{"First[57∈6]^"}}:::plan
    PgSelectRows58[["PgSelectRows[58∈6]^"]]:::plan
    PgSelectRows58 --> First57
    PgSelect50 --> PgSelectRows58
    PgSelectSingle60{{"PgSelectSingle[60∈6]^<br />ᐸaws_applicationsᐳ"}}:::plan
    First57 --> PgSelectSingle60
    First68{{"First[68∈6]^"}}:::plan
    PgSelectRows69[["PgSelectRows[69∈6]^"]]:::plan
    PgSelectRows69 --> First68
    PgSelect64 --> PgSelectRows69
    PgSelectSingle71{{"PgSelectSingle[71∈6]^<br />ᐸgcp_applicationsᐳ"}}:::plan
    First68 --> PgSelectSingle71
    PgSelectSingle60 --> PgClassExpression72
    Constant168 --> Connection78
    PgSelectSingle71 --> PgClassExpression79
    Constant168 --> Connection85
    Access161{{"Access[161∈6]^<br />ᐸ86.itemsᐳ"}}:::plan
    PgUnionAll86 --> Access161
    Access163{{"Access[163∈6]^<br />ᐸ88.itemsᐳ"}}:::plan
    PgUnionAll88 --> Access163
    __Item90[/"__Item[90∈7]<br />ᐸ161ᐳ<br />ᐳAwsApplication"\]:::itemplan
    Access161 ==> __Item90
    PgUnionAllSingle91["PgUnionAllSingle[91∈7]^"]:::plan
    __Item90 --> PgUnionAllSingle91
    Access95{{"Access[95∈7]<br />ᐸ86.cursorDetailsᐳ<br />ᐳAwsApplication"}}:::plan
    PgUnionAll86 --> Access95
    PgCursor97{{"PgCursor[97∈9]<br />ᐳAwsApplication"}}:::plan
    PgUnionAllSingle91 & Access95 --> PgCursor97
    PgSelect107[["PgSelect[107∈11]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access105{{"Access[105∈11]^<br />ᐸ103.0ᐳ"}}:::plan
    Object13 & Access105 --> PgSelect107
    PgSelect121[["PgSelect[121∈11]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Object13 & Access105 --> PgSelect121
    Access101{{"Access[101∈11]<br />ᐸ91.1ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability"}}:::plan
    PgUnionAllSingle91 --> Access101
    JSONParse103[["JSONParse[103∈11]^<br />ᐸ101ᐳ"]]:::plan
    Access101 --> JSONParse103
    JSONParse103 --> Access105
    First114{{"First[114∈11]^"}}:::plan
    PgSelectRows115[["PgSelectRows[115∈11]^"]]:::plan
    PgSelectRows115 --> First114
    PgSelect107 --> PgSelectRows115
    PgSelectSingle117{{"PgSelectSingle[117∈11]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First114 --> PgSelectSingle117
    First125{{"First[125∈11]^"}}:::plan
    PgSelectRows126[["PgSelectRows[126∈11]^"]]:::plan
    PgSelectRows126 --> First125
    PgSelect121 --> PgSelectRows126
    PgSelectSingle128{{"PgSelectSingle[128∈11]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First125 --> PgSelectSingle128
    PgClassExpression157{{"PgClassExpression[157∈11]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle117 --> PgClassExpression157
    PgClassExpression158{{"PgClassExpression[158∈11]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle128 --> PgClassExpression158
    __Item93[/"__Item[93∈8]<br />ᐸ163ᐳ<br />ᐳGcpApplication"\]:::itemplan
    Access163 ==> __Item93
    PgUnionAllSingle94["PgUnionAllSingle[94∈8]^"]:::plan
    __Item93 --> PgUnionAllSingle94
    Access98{{"Access[98∈8]<br />ᐸ88.cursorDetailsᐳ<br />ᐳGcpApplication"}}:::plan
    PgUnionAll88 --> Access98
    PgCursor100{{"PgCursor[100∈10]<br />ᐳGcpApplication"}}:::plan
    PgUnionAllSingle94 & Access98 --> PgCursor100
    PgSelect135[["PgSelect[135∈12]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access133{{"Access[133∈12]^<br />ᐸ131.0ᐳ"}}:::plan
    Object13 & Access133 --> PgSelect135
    PgSelect149[["PgSelect[149∈12]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Object13 & Access133 --> PgSelect149
    Access129{{"Access[129∈12]<br />ᐸ94.1ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability"}}:::plan
    PgUnionAllSingle94 --> Access129
    JSONParse131[["JSONParse[131∈12]^<br />ᐸ129ᐳ"]]:::plan
    Access129 --> JSONParse131
    JSONParse131 --> Access133
    First142{{"First[142∈12]^"}}:::plan
    PgSelectRows143[["PgSelectRows[143∈12]^"]]:::plan
    PgSelectRows143 --> First142
    PgSelect135 --> PgSelectRows143
    PgSelectSingle145{{"PgSelectSingle[145∈12]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First142 --> PgSelectSingle145
    First153{{"First[153∈12]^"}}:::plan
    PgSelectRows154[["PgSelectRows[154∈12]^"]]:::plan
    PgSelectRows154 --> First153
    PgSelect149 --> PgSelectRows154
    PgSelectSingle156{{"PgSelectSingle[156∈12]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First153 --> PgSelectSingle156
    PgClassExpression159{{"PgClassExpression[159∈12]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle145 --> PgClassExpression159
    PgClassExpression160{{"PgClassExpression[160∈12]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle156 --> PgClassExpression160

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access10,Access12,Object13,Connection15,Connection33,Lambda34,Constant167,Constant168,Constant169 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect17,PgSelectRows19 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item20,PgSelectSingle21 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression22,PgClassExpression23,PgUnionAll36,Access165 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item39,PgUnionAllSingle40,Access41 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgCursor43 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,Access44,JSONParse46,Access48,PgSelect50,First57,PgSelectRows58,PgSelectSingle60,PgSelect64,First68,PgSelectRows69,PgSelectSingle71,PgClassExpression72,Connection78,PgClassExpression79,Connection85,PgUnionAll86,PgUnionAll88,Access161,Access163 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7,__Item90,PgUnionAllSingle91,Access95 bucket7
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item93,PgUnionAllSingle94,Access98 bucket8
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgCursor97 bucket9
    classDef bucket10 stroke:#ffff00
    class Bucket10,PgCursor100 bucket10
    classDef bucket11 stroke:#00ffff
    class Bucket11,Access101,JSONParse103,Access105,PgSelect107,First114,PgSelectRows115,PgSelectSingle117,PgSelect121,First125,PgSelectRows126,PgSelectSingle128,PgClassExpression157,PgClassExpression158 bucket11
    classDef bucket12 stroke:#4169e1
    class Bucket12,Access129,JSONParse131,Access133,PgSelect135,First142,PgSelectRows143,PgSelectSingle145,PgSelect149,First153,PgSelectRows154,PgSelectSingle156,PgClassExpression159,PgClassExpression160 bucket12

