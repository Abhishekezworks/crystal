%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/polymorphic/person-app-vulns.app-page-2"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 13, 15, 162, 33, 34, 163<br /><br />ROOT Connectionᐸ9ᐳ[15]<br />1: PgSelect[17]<br />2: PgSelectRows[19]"):::bucket
    Bucket2("Bucket 2 (listItem)<br />Deps: 13, 33, 34, 163<br /><br />ROOT __Item{2}ᐸ19ᐳ[20]"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 21, 13, 33, 34, 163<br /><br />ROOT PgSelectSingle{2}ᐸpeopleᐳ[21]<br />1: <br />ᐳ: 22, 23<br />2: PgUnionAll[36]<br />ᐳ: Access[161]"):::bucket
    Bucket4("Bucket 4 (listItem)<br />Deps: 36, 13, 163<br /><br />ROOT __Item{4}ᐸ161ᐳ[38]"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 39, 40, 13, 163<br /><br />ROOT PgUnionAllSingle{4}[39]"):::bucket
    Bucket6("Bucket 6 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 43, 13, 163, 39<br />ᐳAwsApplication<br />ᐳGcpApplication<br /><br />1: 45, 77, 84<br />ᐳ: Access[47]<br />2: PgSelect[49], PgSelect[63]<br />3: PgSelectRows[57], PgSelectRows[68]<br />ᐳ: 56, 59, 67, 70, 71, 78<br />4: PgUnionAll[85], PgUnionAll[86]<br />ᐳ: Access[159], Access[160]"):::bucket
    Bucket7("Bucket 7 (listItem)<br />Deps: 85, 13<br /><br />ROOT __Item{7}ᐸ159ᐳ[88]"):::bucket
    Bucket8("Bucket 8 (listItem)<br />Deps: 86, 13<br /><br />ROOT __Item{8}ᐸ160ᐳ[91]"):::bucket
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 89, 93, 13<br /><br />ROOT PgUnionAllSingle{7}[89]"):::bucket
    Bucket10("Bucket 10 (nullableBoundary)<br />Deps: 92, 96, 13<br /><br />ROOT PgUnionAllSingle{8}[92]"):::bucket
    Bucket11("Bucket 11 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 99, 13, 89<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br /><br />1: JSONParse[101]<br />ᐳ: Access[103]<br />2: PgSelect[105], PgSelect[119]<br />3: PgSelectRows[113], PgSelectRows[124]<br />ᐳ: 112, 115, 123, 126, 155, 156"):::bucket
    Bucket12("Bucket 12 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 127, 13, 92<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br /><br />1: JSONParse[129]<br />ᐳ: Access[131]<br />2: PgSelect[133], PgSelect[147]<br />3: PgSelectRows[141], PgSelectRows[152]<br />ᐳ: 140, 143, 151, 154, 157, 158"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket6 --> Bucket7 & Bucket8
    Bucket7 --> Bucket9
    Bucket8 --> Bucket10
    Bucket9 --> Bucket11
    Bucket10 --> Bucket12

    %% plan dependencies
    Object13{{"Object[13∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access12{{"Access[12∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access10 & Access12 --> Object13
    Connection33{{"Connection[33∈0] ➊<br />ᐸ26ᐳ"}}:::plan
    Constant163{{"Constant[163∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Lambda34{{"Lambda[34∈0] ➊<br />ᐸparseCursorᐳ"}}:::plan
    Constant163 & Lambda34 --> Connection33
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access10
    __Value2 --> Access12
    Connection15{{"Connection[15∈0] ➊<br />ᐸ9ᐳ"}}:::plan
    Constant162{{"Constant[162∈0] ➊<br />ᐸ4ᐳ"}}:::plan
    Constant162 --> Connection15
    Constant164{{"Constant[164∈0] ➊<br />ᐸ'WyI0OTgwM2MxZTJiIiwiQXdzQXBwbGljYXRpb24iLCJbXCI0XCJdIl0='ᐳ"}}:::plan
    Constant164 --> Lambda34
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgSelect17[["PgSelect[17∈1] ➊<br />ᐸpeopleᐳ"]]:::plan
    Object13 & Connection15 & Constant162 --> PgSelect17
    PgSelectRows19[["PgSelectRows[19∈1] ➊"]]:::plan
    PgSelect17 --> PgSelectRows19
    __Item20[/"__Item[20∈2]<br />ᐸ19ᐳ"\]:::itemplan
    PgSelectRows19 ==> __Item20
    PgSelectSingle21{{"PgSelectSingle[21∈2]<br />ᐸpeopleᐳ"}}:::plan
    __Item20 --> PgSelectSingle21
    PgUnionAll36[["PgUnionAll[36∈3]<br />ᐸAwsApplication,GcpApplicationᐳ"]]:::plan
    PgClassExpression22{{"PgClassExpression[22∈3]<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Object13 & PgClassExpression22 & Connection33 & Lambda34 & Constant163 --> PgUnionAll36
    PgSelectSingle21 --> PgClassExpression22
    PgClassExpression23{{"PgClassExpression[23∈3]<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression23
    Access161{{"Access[161∈3]<br />ᐸ36.itemsᐳ"}}:::plan
    PgUnionAll36 --> Access161
    __Item38[/"__Item[38∈4]<br />ᐸ161ᐳ"\]:::itemplan
    Access161 ==> __Item38
    PgUnionAllSingle39["PgUnionAllSingle[39∈4]"]:::plan
    __Item38 --> PgUnionAllSingle39
    Access40{{"Access[40∈4]<br />ᐸ36.cursorDetailsᐳ"}}:::plan
    PgUnionAll36 --> Access40
    PgCursor42{{"PgCursor[42∈5]"}}:::plan
    PgUnionAllSingle39 & Access40 --> PgCursor42
    Access43{{"Access[43∈5]<br />ᐸ39.1ᐳ"}}:::plan
    PgUnionAllSingle39 --> Access43
    PgUnionAll85[["PgUnionAll[85∈6]^<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    PgClassExpression71{{"PgClassExpression[71∈6]^<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    Connection77{{"Connection[77∈6] ➊<br />ᐸ73ᐳ<br />ᐳAwsApplication"}}:::plan
    Object13 & PgClassExpression71 & Connection77 & Constant163 --> PgUnionAll85
    PgUnionAll86[["PgUnionAll[86∈6]^<br />ᐸFirstPartyVulnerability,ThirdPartyVulnerabilityᐳ"]]:::plan
    PgClassExpression78{{"PgClassExpression[78∈6]^<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    Connection84{{"Connection[84∈6] ➊<br />ᐸ80ᐳ<br />ᐳGcpApplication"}}:::plan
    Object13 & PgClassExpression78 & Connection84 & Constant163 --> PgUnionAll86
    PgSelect49[["PgSelect[49∈6]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Access47{{"Access[47∈6]^<br />ᐸ45.0ᐳ"}}:::plan
    Object13 & Access47 --> PgSelect49
    PgSelect63[["PgSelect[63∈6]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Object13 & Access47 --> PgSelect63
    JSONParse45[["JSONParse[45∈6]<br />ᐸ43ᐳ<br />ᐳAwsApplication<br />ᐳGcpApplication"]]:::plan
    Access43 --> JSONParse45
    JSONParse45 --> Access47
    First56{{"First[56∈6]^"}}:::plan
    PgSelectRows57[["PgSelectRows[57∈6]^"]]:::plan
    PgSelectRows57 --> First56
    PgSelect49 --> PgSelectRows57
    PgSelectSingle59{{"PgSelectSingle[59∈6]^<br />ᐸaws_applicationsᐳ"}}:::plan
    First56 --> PgSelectSingle59
    First67{{"First[67∈6]^"}}:::plan
    PgSelectRows68[["PgSelectRows[68∈6]^"]]:::plan
    PgSelectRows68 --> First67
    PgSelect63 --> PgSelectRows68
    PgSelectSingle70{{"PgSelectSingle[70∈6]^<br />ᐸgcp_applicationsᐳ"}}:::plan
    First67 --> PgSelectSingle70
    PgSelectSingle59 --> PgClassExpression71
    Constant163 --> Connection77
    PgSelectSingle70 --> PgClassExpression78
    Constant163 --> Connection84
    Access159{{"Access[159∈6]^<br />ᐸ85.itemsᐳ"}}:::plan
    PgUnionAll85 --> Access159
    Access160{{"Access[160∈6]^<br />ᐸ86.itemsᐳ"}}:::plan
    PgUnionAll86 --> Access160
    __Item88[/"__Item[88∈7]<br />ᐸ159ᐳ<br />ᐳAwsApplication"\]:::itemplan
    Access159 ==> __Item88
    PgUnionAllSingle89["PgUnionAllSingle[89∈7]^"]:::plan
    __Item88 --> PgUnionAllSingle89
    Access93{{"Access[93∈7]<br />ᐸ85.cursorDetailsᐳ<br />ᐳAwsApplication"}}:::plan
    PgUnionAll85 --> Access93
    PgCursor95{{"PgCursor[95∈9]<br />ᐳAwsApplication"}}:::plan
    PgUnionAllSingle89 & Access93 --> PgCursor95
    Access99{{"Access[99∈9]<br />ᐸ89.1ᐳ<br />ᐳAwsApplication"}}:::plan
    PgUnionAllSingle89 --> Access99
    PgSelect105[["PgSelect[105∈11]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access103{{"Access[103∈11]^<br />ᐸ101.0ᐳ"}}:::plan
    Object13 & Access103 --> PgSelect105
    PgSelect119[["PgSelect[119∈11]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Object13 & Access103 --> PgSelect119
    JSONParse101[["JSONParse[101∈11]<br />ᐸ99ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access99 --> JSONParse101
    JSONParse101 --> Access103
    First112{{"First[112∈11]^"}}:::plan
    PgSelectRows113[["PgSelectRows[113∈11]^"]]:::plan
    PgSelectRows113 --> First112
    PgSelect105 --> PgSelectRows113
    PgSelectSingle115{{"PgSelectSingle[115∈11]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First112 --> PgSelectSingle115
    First123{{"First[123∈11]^"}}:::plan
    PgSelectRows124[["PgSelectRows[124∈11]^"]]:::plan
    PgSelectRows124 --> First123
    PgSelect119 --> PgSelectRows124
    PgSelectSingle126{{"PgSelectSingle[126∈11]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First123 --> PgSelectSingle126
    PgClassExpression155{{"PgClassExpression[155∈11]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle115 --> PgClassExpression155
    PgClassExpression156{{"PgClassExpression[156∈11]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle126 --> PgClassExpression156
    __Item91[/"__Item[91∈8]<br />ᐸ160ᐳ<br />ᐳGcpApplication"\]:::itemplan
    Access160 ==> __Item91
    PgUnionAllSingle92["PgUnionAllSingle[92∈8]^"]:::plan
    __Item91 --> PgUnionAllSingle92
    Access96{{"Access[96∈8]<br />ᐸ86.cursorDetailsᐳ<br />ᐳGcpApplication"}}:::plan
    PgUnionAll86 --> Access96
    PgCursor98{{"PgCursor[98∈10]<br />ᐳGcpApplication"}}:::plan
    PgUnionAllSingle92 & Access96 --> PgCursor98
    Access127{{"Access[127∈10]<br />ᐸ92.1ᐳ<br />ᐳGcpApplication"}}:::plan
    PgUnionAllSingle92 --> Access127
    PgSelect133[["PgSelect[133∈12]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access131{{"Access[131∈12]^<br />ᐸ129.0ᐳ"}}:::plan
    Object13 & Access131 --> PgSelect133
    PgSelect147[["PgSelect[147∈12]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Object13 & Access131 --> PgSelect147
    JSONParse129[["JSONParse[129∈12]<br />ᐸ127ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access127 --> JSONParse129
    JSONParse129 --> Access131
    First140{{"First[140∈12]^"}}:::plan
    PgSelectRows141[["PgSelectRows[141∈12]^"]]:::plan
    PgSelectRows141 --> First140
    PgSelect133 --> PgSelectRows141
    PgSelectSingle143{{"PgSelectSingle[143∈12]^<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First140 --> PgSelectSingle143
    First151{{"First[151∈12]^"}}:::plan
    PgSelectRows152[["PgSelectRows[152∈12]^"]]:::plan
    PgSelectRows152 --> First151
    PgSelect147 --> PgSelectRows152
    PgSelectSingle154{{"PgSelectSingle[154∈12]^<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First151 --> PgSelectSingle154
    PgClassExpression157{{"PgClassExpression[157∈12]^<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle143 --> PgClassExpression157
    PgClassExpression158{{"PgClassExpression[158∈12]^<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle154 --> PgClassExpression158

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access10,Access12,Object13,Connection15,Connection33,Lambda34,Constant162,Constant163,Constant164 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect17,PgSelectRows19 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item20,PgSelectSingle21 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression22,PgClassExpression23,PgUnionAll36,Access161 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item38,PgUnionAllSingle39,Access40 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgCursor42,Access43 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,JSONParse45,Access47,PgSelect49,First56,PgSelectRows57,PgSelectSingle59,PgSelect63,First67,PgSelectRows68,PgSelectSingle70,PgClassExpression71,Connection77,PgClassExpression78,Connection84,PgUnionAll85,PgUnionAll86,Access159,Access160 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7,__Item88,PgUnionAllSingle89,Access93 bucket7
    classDef bucket8 stroke:#dda0dd
    class Bucket8,__Item91,PgUnionAllSingle92,Access96 bucket8
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgCursor95,Access99 bucket9
    classDef bucket10 stroke:#ffff00
    class Bucket10,PgCursor98,Access127 bucket10
    classDef bucket11 stroke:#00ffff
    class Bucket11,JSONParse101,Access103,PgSelect105,First112,PgSelectRows113,PgSelectSingle115,PgSelect119,First123,PgSelectRows124,PgSelectSingle126,PgClassExpression155,PgClassExpression156 bucket11
    classDef bucket12 stroke:#4169e1
    class Bucket12,JSONParse129,Access131,PgSelect133,First140,PgSelectRows141,PgSelectSingle143,PgSelect147,First151,PgSelectRows152,PgSelectSingle154,PgClassExpression157,PgClassExpression158 bucket12

