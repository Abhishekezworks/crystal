%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object17{{"Object[17∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access15{{"Access[15∈0]<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access16{{"Access[16∈0]<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access15 & Access16 --> Object17
    __Value2["__Value[2∈0]<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access15
    __Value2 --> Access16
    Connection18{{"Connection[18∈0]<br />ᐸ14ᐳ"}}:::plan
    Constant155{{"Constant[155∈0]<br />ᐸ4ᐳ"}}:::plan
    Constant155 --> Connection18
    Lambda39{{"Lambda[39∈0]<br />ᐸparseCursorᐳ"}}:::plan
    Constant157{{"Constant[157∈0]<br />ᐸ'WyJjMDM4YzQzNTYwIiwiQXdzQXBwbGljYXRpb24iLCJbXCI0XCJdIl0='ᐳ"}}:::plan
    Constant157 --> Lambda39
    __Value4["__Value[4∈0]<br />ᐸrootValueᐳ"]:::plan
    Constant156{{"Constant[156∈0]<br />ᐸ1ᐳ"}}:::plan
    Connection38{{"Connection[38∈1]<br />ᐸ34ᐳ"}}:::plan
    PgValidateParsedCursor44["PgValidateParsedCursor[44∈1]"]:::plan
    Constant156 & Lambda39 & PgValidateParsedCursor44 --> Connection38
    PgSelect19[["PgSelect[19∈1]<br />ᐸpeopleᐳ"]]:::plan
    Object17 & Connection18 --> PgSelect19
    Lambda39 --> PgValidateParsedCursor44
    Access45{{"Access[45∈1]<br />ᐸ39.1ᐳ"}}:::plan
    Lambda39 --> Access45
    ToPg46{{"ToPg[46∈1]"}}:::plan
    Access45 --> ToPg46
    Access47{{"Access[47∈1]<br />ᐸ39.2ᐳ"}}:::plan
    Lambda39 --> Access47
    __Item20[/"__Item[20∈2]<br />ᐸ19ᐳ"\]:::itemplan
    PgSelect19 ==> __Item20
    PgSelectSingle21{{"PgSelectSingle[21∈2]<br />ᐸpeopleᐳ"}}:::plan
    __Item20 --> PgSelectSingle21
    PgUnionAll40[["PgUnionAll[40∈3]"]]:::plan
    PgClassExpression22{{"PgClassExpression[22∈3]<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Object17 & PgClassExpression22 & PgClassExpression22 & Connection38 & Lambda39 & ToPg46 & Access47 --> PgUnionAll40
    PgSelectSingle21 --> PgClassExpression22
    PgClassExpression23{{"PgClassExpression[23∈3]<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle21 --> PgClassExpression23
    __Item41[/"__Item[41∈4]<br />ᐸ40ᐳ"\]:::itemplan
    PgUnionAll40 ==> __Item41
    PgUnionAllSingle42["PgUnionAllSingle[42∈4]"]:::plan
    __Item41 --> PgUnionAllSingle42
    List50{{"List[50∈5]<br />ᐸ48,49ᐳ"}}:::plan
    Access48{{"Access[48∈5]<br />ᐸ42.0ᐳ"}}:::plan
    Access49{{"Access[49∈5]<br />ᐸ42.1ᐳ"}}:::plan
    Access48 & Access49 --> List50
    PgCursor43{{"PgCursor[43∈5]"}}:::plan
    List50 --> PgCursor43
    PgUnionAllSingle42 --> Access48
    PgUnionAllSingle42 --> Access49
    PgUnionAll76[["PgUnionAll[76∈6]<br />ᐳAwsApplication"]]:::plan
    PgClassExpression60{{"PgClassExpression[60∈6]<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    Connection75{{"Connection[75∈6]<br />ᐸ71ᐳ<br />ᐳAwsApplication"}}:::plan
    Object17 & PgClassExpression60 & PgClassExpression60 & Connection75 --> PgUnionAll76
    PgUnionAll128[["PgUnionAll[128∈6]<br />ᐳGcpApplication"]]:::plan
    PgClassExpression112{{"PgClassExpression[112∈6]<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    Connection127{{"Connection[127∈6]<br />ᐸ123ᐳ<br />ᐳGcpApplication"}}:::plan
    Object17 & PgClassExpression112 & PgClassExpression112 & Connection127 --> PgUnionAll128
    PgSelect54[["PgSelect[54∈6]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Access53{{"Access[53∈6]<br />ᐸ52.0ᐳ"}}:::plan
    Object17 & Access53 --> PgSelect54
    PgSelect106[["PgSelect[106∈6]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Access105{{"Access[105∈6]<br />ᐸ104.0ᐳ"}}:::plan
    Object17 & Access105 --> PgSelect106
    JSONParse52[["JSONParse[52∈6]<br />ᐸ49ᐳ<br />ᐳAwsApplication"]]:::plan
    Access49 --> JSONParse52
    JSONParse52 --> Access53
    First58{{"First[58∈6]"}}:::plan
    PgSelect54 --> First58
    PgSelectSingle59{{"PgSelectSingle[59∈6]<br />ᐸaws_applicationsᐳ"}}:::plan
    First58 --> PgSelectSingle59
    PgSelectSingle59 --> PgClassExpression60
    Constant156 --> Connection75
    JSONParse104[["JSONParse[104∈6]<br />ᐸ49ᐳ<br />ᐳGcpApplication"]]:::plan
    Access49 --> JSONParse104
    JSONParse104 --> Access105
    First110{{"First[110∈6]"}}:::plan
    PgSelect106 --> First110
    PgSelectSingle111{{"PgSelectSingle[111∈6]<br />ᐸgcp_applicationsᐳ"}}:::plan
    First110 --> PgSelectSingle111
    PgSelectSingle111 --> PgClassExpression112
    Constant156 --> Connection127
    __Item77[/"__Item[77∈7]<br />ᐸ76ᐳ"\]:::itemplan
    PgUnionAll76 ==> __Item77
    PgUnionAllSingle78["PgUnionAllSingle[78∈7]"]:::plan
    __Item77 --> PgUnionAllSingle78
    List82{{"List[82∈8]<br />ᐸ80,81ᐳ<br />ᐳAwsApplication"}}:::plan
    Access80{{"Access[80∈8]<br />ᐸ78.0ᐳ"}}:::plan
    Access81{{"Access[81∈8]<br />ᐸ78.1ᐳ"}}:::plan
    Access80 & Access81 --> List82
    PgCursor79{{"PgCursor[79∈8]"}}:::plan
    List82 --> PgCursor79
    PgUnionAllSingle78 --> Access80
    PgUnionAllSingle78 --> Access81
    PgSelect86[["PgSelect[86∈9]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access85{{"Access[85∈9]<br />ᐸ84.0ᐳ"}}:::plan
    Object17 & Access85 --> PgSelect86
    PgSelect96[["PgSelect[96∈9]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access95{{"Access[95∈9]<br />ᐸ94.0ᐳ"}}:::plan
    Object17 & Access95 --> PgSelect96
    JSONParse84[["JSONParse[84∈9]<br />ᐸ81ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access81 --> JSONParse84
    JSONParse84 --> Access85
    First90{{"First[90∈9]"}}:::plan
    PgSelect86 --> First90
    PgSelectSingle91{{"PgSelectSingle[91∈9]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First90 --> PgSelectSingle91
    PgClassExpression92{{"PgClassExpression[92∈9]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle91 --> PgClassExpression92
    JSONParse94[["JSONParse[94∈9]<br />ᐸ81ᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access81 --> JSONParse94
    JSONParse94 --> Access95
    First100{{"First[100∈9]"}}:::plan
    PgSelect96 --> First100
    PgSelectSingle101{{"PgSelectSingle[101∈9]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First100 --> PgSelectSingle101
    PgClassExpression102{{"PgClassExpression[102∈9]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle101 --> PgClassExpression102
    __Item129[/"__Item[129∈10]<br />ᐸ128ᐳ"\]:::itemplan
    PgUnionAll128 ==> __Item129
    PgUnionAllSingle130["PgUnionAllSingle[130∈10]"]:::plan
    __Item129 --> PgUnionAllSingle130
    List134{{"List[134∈11]<br />ᐸ132,133ᐳ<br />ᐳGcpApplication"}}:::plan
    Access132{{"Access[132∈11]<br />ᐸ130.0ᐳ"}}:::plan
    Access133{{"Access[133∈11]<br />ᐸ130.1ᐳ"}}:::plan
    Access132 & Access133 --> List134
    PgCursor131{{"PgCursor[131∈11]"}}:::plan
    List134 --> PgCursor131
    PgUnionAllSingle130 --> Access132
    PgUnionAllSingle130 --> Access133
    PgSelect138[["PgSelect[138∈12]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access137{{"Access[137∈12]<br />ᐸ136.0ᐳ"}}:::plan
    Object17 & Access137 --> PgSelect138
    PgSelect148[["PgSelect[148∈12]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access147{{"Access[147∈12]<br />ᐸ146.0ᐳ"}}:::plan
    Object17 & Access147 --> PgSelect148
    JSONParse136[["JSONParse[136∈12]<br />ᐸ133ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access133 --> JSONParse136
    JSONParse136 --> Access137
    First142{{"First[142∈12]"}}:::plan
    PgSelect138 --> First142
    PgSelectSingle143{{"PgSelectSingle[143∈12]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First142 --> PgSelectSingle143
    PgClassExpression144{{"PgClassExpression[144∈12]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle143 --> PgClassExpression144
    JSONParse146[["JSONParse[146∈12]<br />ᐸ133ᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access133 --> JSONParse146
    JSONParse146 --> Access147
    First152{{"First[152∈12]"}}:::plan
    PgSelect148 --> First152
    PgSelectSingle153{{"PgSelectSingle[153∈12]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First152 --> PgSelectSingle153
    PgClassExpression154{{"PgClassExpression[154∈12]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle153 --> PgClassExpression154

    %% define steps

    subgraph "Buckets for queries/polymorphic/person-app-vulns.app-page-2"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access15,Access16,Object17,Connection18,Lambda39,Constant155,Constant156,Constant157 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 17, 18, 156, 39<br /><br />ROOT Connectionᐸ14ᐳ[18]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect19,Connection38,PgValidateParsedCursor44,Access45,ToPg46,Access47 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 17, 38, 39, 46, 47, 156<br /><br />ROOT __Item{2}ᐸ19ᐳ[20]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item20,PgSelectSingle21 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 21, 17, 38, 39, 46, 47, 156<br /><br />ROOT PgSelectSingle{2}ᐸpeopleᐳ[21]<br />1: <br />ᐳ: 22, 23<br />2: PgUnionAll[40]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression22,PgClassExpression23,PgUnionAll40 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 17, 156<br /><br />ROOT __Item{4}ᐸ40ᐳ[41]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item41,PgUnionAllSingle42 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 42, 17, 156<br /><br />ROOT PgUnionAllSingle{4}[42]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgCursor43,Access48,Access49,List50 bucket5
    Bucket6("Bucket 6 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 49, 17, 156, 42<br />ᐳAwsApplication<br />ᐳGcpApplication<br />1: JSONParse[52], JSONParse[104]<br />ᐳ: 75, 127, 53, 105<br />2: PgSelect[54], PgSelect[106]<br />ᐳ: 58, 59, 60, 110, 111, 112<br />3: PgUnionAll[76], PgUnionAll[128]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,JSONParse52,Access53,PgSelect54,First58,PgSelectSingle59,PgClassExpression60,Connection75,PgUnionAll76,JSONParse104,Access105,PgSelect106,First110,PgSelectSingle111,PgClassExpression112,Connection127,PgUnionAll128 bucket6
    Bucket7("Bucket 7 (listItem)<br />Deps: 17<br /><br />ROOT __Item{7}ᐸ76ᐳ[77]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item77,PgUnionAllSingle78 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 78, 17<br /><br />ROOT PgUnionAllSingle{7}[78]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgCursor79,Access80,Access81,List82 bucket8
    Bucket9("Bucket 9 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 81, 17, 78<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br />1: JSONParse[84], JSONParse[94]<br />ᐳ: Access[85], Access[95]<br />2: PgSelect[86], PgSelect[96]<br />ᐳ: 90, 91, 92, 100, 101, 102"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,JSONParse84,Access85,PgSelect86,First90,PgSelectSingle91,PgClassExpression92,JSONParse94,Access95,PgSelect96,First100,PgSelectSingle101,PgClassExpression102 bucket9
    Bucket10("Bucket 10 (listItem)<br />Deps: 17<br /><br />ROOT __Item{10}ᐸ128ᐳ[129]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item129,PgUnionAllSingle130 bucket10
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 130, 17<br /><br />ROOT PgUnionAllSingle{10}[130]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgCursor131,Access132,Access133,List134 bucket11
    Bucket12("Bucket 12 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 133, 17, 130<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br />1: JSONParse[136], JSONParse[146]<br />ᐳ: Access[137], Access[147]<br />2: PgSelect[138], PgSelect[148]<br />ᐳ: 142, 143, 144, 152, 153, 154"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,JSONParse136,Access137,PgSelect138,First142,PgSelectSingle143,PgClassExpression144,JSONParse146,Access147,PgSelect148,First152,PgSelectSingle153,PgClassExpression154 bucket12
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket6 --> Bucket7 & Bucket10
    Bucket7 --> Bucket8
    Bucket8 --> Bucket9
    Bucket10 --> Bucket11
    Bucket11 --> Bucket12
    classDef unary fill:#fafffa,borderWidth:8px
    class Object17,Access15,Access16,Connection18,Lambda39,__Value2,__Value4,Constant155,Constant156,Constant157,Connection38,PgSelect19,PgValidateParsedCursor44,Access45,ToPg46,Access47,Connection75,Connection127 unary
    end
