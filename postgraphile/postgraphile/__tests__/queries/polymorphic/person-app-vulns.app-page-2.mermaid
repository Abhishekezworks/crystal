%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object18{{"Object[18∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access16{{"Access[16∈0]<br />ᐸ3.pgSettingsᐳ"}}:::plan
    Access17{{"Access[17∈0]<br />ᐸ3.withPgClientᐳ"}}:::plan
    Access16 & Access17 --> Object18
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value3 --> Access16
    __Value3 --> Access17
    Connection19{{"Connection[19∈0]<br />ᐸ15ᐳ"}}:::plan
    Constant153{{"Constant[153∈0]<br />ᐸ4ᐳ"}}:::plan
    Constant153 --> Connection19
    Lambda39{{"Lambda[39∈0]<br />ᐸparseCursorᐳ"}}:::plan
    Constant155{{"Constant[155∈0]<br />ᐸ'WyJjMDM4YzQzNTYwIiwiQXdzQXBwbGljYXRpb24iLCJbXCI0XCJdIl0='ᐳ"}}:::plan
    Constant155 --> Lambda39
    __Value0["__Value[0∈0]"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    Constant154{{"Constant[154∈0]<br />ᐸ1ᐳ"}}:::plan
    Connection38{{"Connection[38∈1]<br />ᐸ34ᐳ"}}:::plan
    PgValidateParsedCursor44["PgValidateParsedCursor[44∈1]"]:::plan
    Constant154 & Lambda39 & PgValidateParsedCursor44 --> Connection38
    PgSelect20[["PgSelect[20∈1]<br />ᐸpeopleᐳ"]]:::plan
    Object18 & Connection19 --> PgSelect20
    Lambda39 --> PgValidateParsedCursor44
    Access45{{"Access[45∈1]<br />ᐸ39.1ᐳ"}}:::plan
    Lambda39 --> Access45
    ToPg46{{"ToPg[46∈1]"}}:::plan
    Access45 --> ToPg46
    Access47{{"Access[47∈1]<br />ᐸ39.2ᐳ"}}:::plan
    Lambda39 --> Access47
    __Item21[/"__Item[21∈2]<br />ᐸ20ᐳ"\]:::itemplan
    PgSelect20 ==> __Item21
    PgSelectSingle22{{"PgSelectSingle[22∈2]<br />ᐸpeopleᐳ"}}:::plan
    __Item21 --> PgSelectSingle22
    PgUnionAll40[["PgUnionAll[40∈3]"]]:::plan
    PgClassExpression23{{"PgClassExpression[23∈3]<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Object18 & PgClassExpression23 & PgClassExpression23 & Connection38 & Lambda39 & ToPg46 & Access47 --> PgUnionAll40
    PgSelectSingle22 --> PgClassExpression23
    PgClassExpression24{{"PgClassExpression[24∈3]<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle22 --> PgClassExpression24
    __Item41[/"__Item[41∈4]<br />ᐸ40ᐳ"\]:::itemplan
    PgUnionAll40 ==> __Item41
    PgUnionAllSingle42["PgUnionAllSingle[42∈4]"]:::plan
    __Item41 --> PgUnionAllSingle42
    List50{{"List[50∈5]<br />ᐸ48,49ᐳ"}}:::plan
    Access48{{"Access[48∈5]<br />ᐸ42.0ᐳ"}}:::plan
    Access49{{"Access[49∈5]<br />ᐸ42.1ᐳ"}}:::plan
    Access48 & Access49 --> List50
    PgCursor43{{"PgCursor[43∈5]"}}:::plan
    List50 --> PgCursor43
    PgUnionAllSingle42 --> Access48
    PgUnionAllSingle42 --> Access49
    PgUnionAll75[["PgUnionAll[75∈6]<br />ᐳAwsApplication"]]:::plan
    PgClassExpression60{{"PgClassExpression[60∈6]<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    Connection74{{"Connection[74∈6]<br />ᐸ70ᐳ<br />ᐳAwsApplication"}}:::plan
    Object18 & PgClassExpression60 & PgClassExpression60 & Connection74 --> PgUnionAll75
    PgUnionAll126[["PgUnionAll[126∈6]<br />ᐳGcpApplication"]]:::plan
    PgClassExpression111{{"PgClassExpression[111∈6]<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    Connection125{{"Connection[125∈6]<br />ᐸ121ᐳ<br />ᐳGcpApplication"}}:::plan
    Object18 & PgClassExpression111 & PgClassExpression111 & Connection125 --> PgUnionAll126
    PgSelect54[["PgSelect[54∈6]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Access53{{"Access[53∈6]<br />ᐸ52.0ᐳ"}}:::plan
    Object18 & Access53 --> PgSelect54
    PgSelect105[["PgSelect[105∈6]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Access104{{"Access[104∈6]<br />ᐸ103.0ᐳ"}}:::plan
    Object18 & Access104 --> PgSelect105
    JSONParse52[["JSONParse[52∈6]<br />ᐸ49ᐳ<br />ᐳAwsApplication"]]:::plan
    Access49 --> JSONParse52
    JSONParse52 --> Access53
    First58{{"First[58∈6]"}}:::plan
    PgSelect54 --> First58
    PgSelectSingle59{{"PgSelectSingle[59∈6]<br />ᐸaws_applicationsᐳ"}}:::plan
    First58 --> PgSelectSingle59
    PgSelectSingle59 --> PgClassExpression60
    Constant154 --> Connection74
    JSONParse103[["JSONParse[103∈6]<br />ᐸ49ᐳ<br />ᐳGcpApplication"]]:::plan
    Access49 --> JSONParse103
    JSONParse103 --> Access104
    First109{{"First[109∈6]"}}:::plan
    PgSelect105 --> First109
    PgSelectSingle110{{"PgSelectSingle[110∈6]<br />ᐸgcp_applicationsᐳ"}}:::plan
    First109 --> PgSelectSingle110
    PgSelectSingle110 --> PgClassExpression111
    Constant154 --> Connection125
    __Item76[/"__Item[76∈7]<br />ᐸ75ᐳ"\]:::itemplan
    PgUnionAll75 ==> __Item76
    PgUnionAllSingle77["PgUnionAllSingle[77∈7]"]:::plan
    __Item76 --> PgUnionAllSingle77
    List81{{"List[81∈8]<br />ᐸ79,80ᐳ<br />ᐳAwsApplication"}}:::plan
    Access79{{"Access[79∈8]<br />ᐸ77.0ᐳ"}}:::plan
    Access80{{"Access[80∈8]<br />ᐸ77.1ᐳ"}}:::plan
    Access79 & Access80 --> List81
    PgCursor78{{"PgCursor[78∈8]"}}:::plan
    List81 --> PgCursor78
    PgUnionAllSingle77 --> Access79
    PgUnionAllSingle77 --> Access80
    PgSelect85[["PgSelect[85∈9]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access84{{"Access[84∈9]<br />ᐸ83.0ᐳ"}}:::plan
    Object18 & Access84 --> PgSelect85
    PgSelect95[["PgSelect[95∈9]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access94{{"Access[94∈9]<br />ᐸ93.0ᐳ"}}:::plan
    Object18 & Access94 --> PgSelect95
    JSONParse83[["JSONParse[83∈9]<br />ᐸ80ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access80 --> JSONParse83
    JSONParse83 --> Access84
    First89{{"First[89∈9]"}}:::plan
    PgSelect85 --> First89
    PgSelectSingle90{{"PgSelectSingle[90∈9]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First89 --> PgSelectSingle90
    PgClassExpression91{{"PgClassExpression[91∈9]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle90 --> PgClassExpression91
    JSONParse93[["JSONParse[93∈9]<br />ᐸ80ᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access80 --> JSONParse93
    JSONParse93 --> Access94
    First99{{"First[99∈9]"}}:::plan
    PgSelect95 --> First99
    PgSelectSingle100{{"PgSelectSingle[100∈9]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First99 --> PgSelectSingle100
    PgClassExpression101{{"PgClassExpression[101∈9]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle100 --> PgClassExpression101
    __Item127[/"__Item[127∈10]<br />ᐸ126ᐳ"\]:::itemplan
    PgUnionAll126 ==> __Item127
    PgUnionAllSingle128["PgUnionAllSingle[128∈10]"]:::plan
    __Item127 --> PgUnionAllSingle128
    List132{{"List[132∈11]<br />ᐸ130,131ᐳ<br />ᐳGcpApplication"}}:::plan
    Access130{{"Access[130∈11]<br />ᐸ128.0ᐳ"}}:::plan
    Access131{{"Access[131∈11]<br />ᐸ128.1ᐳ"}}:::plan
    Access130 & Access131 --> List132
    PgCursor129{{"PgCursor[129∈11]"}}:::plan
    List132 --> PgCursor129
    PgUnionAllSingle128 --> Access130
    PgUnionAllSingle128 --> Access131
    PgSelect136[["PgSelect[136∈12]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access135{{"Access[135∈12]<br />ᐸ134.0ᐳ"}}:::plan
    Object18 & Access135 --> PgSelect136
    PgSelect146[["PgSelect[146∈12]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access145{{"Access[145∈12]<br />ᐸ144.0ᐳ"}}:::plan
    Object18 & Access145 --> PgSelect146
    JSONParse134[["JSONParse[134∈12]<br />ᐸ131ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access131 --> JSONParse134
    JSONParse134 --> Access135
    First140{{"First[140∈12]"}}:::plan
    PgSelect136 --> First140
    PgSelectSingle141{{"PgSelectSingle[141∈12]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First140 --> PgSelectSingle141
    PgClassExpression142{{"PgClassExpression[142∈12]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle141 --> PgClassExpression142
    JSONParse144[["JSONParse[144∈12]<br />ᐸ131ᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access131 --> JSONParse144
    JSONParse144 --> Access145
    First150{{"First[150∈12]"}}:::plan
    PgSelect146 --> First150
    PgSelectSingle151{{"PgSelectSingle[151∈12]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First150 --> PgSelectSingle151
    PgClassExpression152{{"PgClassExpression[152∈12]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle151 --> PgClassExpression152

    %% define steps

    subgraph "Buckets for queries/polymorphic/person-app-vulns.app-page-2"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value3,__Value5,Access16,Access17,Object18,Connection19,Lambda39,Constant153,Constant154,Constant155 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 18, 19, 154, 39<br /><br />ROOT Connectionᐸ15ᐳ[19]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect20,Connection38,PgValidateParsedCursor44,Access45,ToPg46,Access47 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 18, 38, 39, 46, 47, 154<br /><br />ROOT __Item{2}ᐸ20ᐳ[21]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item21,PgSelectSingle22 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 22, 18, 38, 39, 46, 47, 154<br /><br />ROOT PgSelectSingle{2}ᐸpeopleᐳ[22]<br />1: <br />ᐳ: 23, 24<br />2: PgUnionAll[40]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression23,PgClassExpression24,PgUnionAll40 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 18, 154<br /><br />ROOT __Item{4}ᐸ40ᐳ[41]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item41,PgUnionAllSingle42 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 42, 18, 154<br /><br />ROOT PgUnionAllSingle{4}[42]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgCursor43,Access48,Access49,List50 bucket5
    Bucket6("Bucket 6 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 49, 18, 154, 42<br />ᐳAwsApplication<br />ᐳGcpApplication<br />1: JSONParse[52], JSONParse[103]<br />ᐳ: 74, 125, 53, 104<br />2: PgSelect[54], PgSelect[105]<br />ᐳ: 58, 59, 60, 109, 110, 111<br />3: PgUnionAll[75], PgUnionAll[126]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,JSONParse52,Access53,PgSelect54,First58,PgSelectSingle59,PgClassExpression60,Connection74,PgUnionAll75,JSONParse103,Access104,PgSelect105,First109,PgSelectSingle110,PgClassExpression111,Connection125,PgUnionAll126 bucket6
    Bucket7("Bucket 7 (listItem)<br />Deps: 18<br /><br />ROOT __Item{7}ᐸ75ᐳ[76]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item76,PgUnionAllSingle77 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 77, 18<br /><br />ROOT PgUnionAllSingle{7}[77]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgCursor78,Access79,Access80,List81 bucket8
    Bucket9("Bucket 9 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 80, 18, 77<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br />1: JSONParse[83], JSONParse[93]<br />ᐳ: Access[84], Access[94]<br />2: PgSelect[85], PgSelect[95]<br />ᐳ: 89, 90, 91, 99, 100, 101"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,JSONParse83,Access84,PgSelect85,First89,PgSelectSingle90,PgClassExpression91,JSONParse93,Access94,PgSelect95,First99,PgSelectSingle100,PgClassExpression101 bucket9
    Bucket10("Bucket 10 (listItem)<br />Deps: 18<br /><br />ROOT __Item{10}ᐸ126ᐳ[127]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item127,PgUnionAllSingle128 bucket10
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 128, 18<br /><br />ROOT PgUnionAllSingle{10}[128]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgCursor129,Access130,Access131,List132 bucket11
    Bucket12("Bucket 12 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 131, 18, 128<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br />1: JSONParse[134], JSONParse[144]<br />ᐳ: Access[135], Access[145]<br />2: PgSelect[136], PgSelect[146]<br />ᐳ: 140, 141, 142, 150, 151, 152"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,JSONParse134,Access135,PgSelect136,First140,PgSelectSingle141,PgClassExpression142,JSONParse144,Access145,PgSelect146,First150,PgSelectSingle151,PgClassExpression152 bucket12
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket6 --> Bucket7 & Bucket10
    Bucket7 --> Bucket8
    Bucket8 --> Bucket9
    Bucket10 --> Bucket11
    Bucket11 --> Bucket12
    end
