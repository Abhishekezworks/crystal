%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object18{{"Object[18∈0]<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access16{{"Access[16∈0]<br />ᐸ3.pgSettingsᐳ"}}:::plan
    Access17{{"Access[17∈0]<br />ᐸ3.withPgClientᐳ"}}:::plan
    Access16 & Access17 --> Object18
    __Value3["__Value[3∈0]<br />ᐸcontextᐳ"]:::plan
    __Value3 --> Access16
    __Value3 --> Access17
    Connection19{{"Connection[19∈0]<br />ᐸ15ᐳ"}}:::plan
    Constant156{{"Constant[156∈0]<br />ᐸ4ᐳ"}}:::plan
    Constant156 --> Connection19
    Lambda40{{"Lambda[40∈0]<br />ᐸparseCursorᐳ"}}:::plan
    Constant158{{"Constant[158∈0]<br />ᐸ'WyJjMDM4YzQzNTYwIiwiQXdzQXBwbGljYXRpb24iLCJbXCI0XCJdIl0='ᐳ"}}:::plan
    Constant158 --> Lambda40
    __Value0["__Value[0∈0]"]:::plan
    __Value5["__Value[5∈0]<br />ᐸrootValueᐳ"]:::plan
    Constant157{{"Constant[157∈0]<br />ᐸ1ᐳ"}}:::plan
    Connection39{{"Connection[39∈1]<br />ᐸ35ᐳ"}}:::plan
    PgValidateParsedCursor45["PgValidateParsedCursor[45∈1]"]:::plan
    Constant157 & Lambda40 & PgValidateParsedCursor45 --> Connection39
    PgSelect20[["PgSelect[20∈1]<br />ᐸpeopleᐳ"]]:::plan
    Object18 & Connection19 --> PgSelect20
    Lambda40 --> PgValidateParsedCursor45
    Access46{{"Access[46∈1]<br />ᐸ40.1ᐳ"}}:::plan
    Lambda40 --> Access46
    ToPg47{{"ToPg[47∈1]"}}:::plan
    Access46 --> ToPg47
    Access48{{"Access[48∈1]<br />ᐸ40.2ᐳ"}}:::plan
    Lambda40 --> Access48
    __Item21[/"__Item[21∈2]<br />ᐸ20ᐳ"\]:::itemplan
    PgSelect20 ==> __Item21
    PgSelectSingle22{{"PgSelectSingle[22∈2]<br />ᐸpeopleᐳ"}}:::plan
    __Item21 --> PgSelectSingle22
    PgUnionAll41[["PgUnionAll[41∈3]"]]:::plan
    PgClassExpression23{{"PgClassExpression[23∈3]<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Object18 & PgClassExpression23 & PgClassExpression23 & Connection39 & Lambda40 & ToPg47 & Access48 --> PgUnionAll41
    PgSelectSingle22 --> PgClassExpression23
    PgClassExpression24{{"PgClassExpression[24∈3]<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle22 --> PgClassExpression24
    __Item42[/"__Item[42∈4]<br />ᐸ41ᐳ"\]:::itemplan
    PgUnionAll41 ==> __Item42
    PgUnionAllSingle43["PgUnionAllSingle[43∈4]"]:::plan
    __Item42 --> PgUnionAllSingle43
    List51{{"List[51∈5]<br />ᐸ49,50ᐳ"}}:::plan
    Access49{{"Access[49∈5]<br />ᐸ43.0ᐳ"}}:::plan
    Access50{{"Access[50∈5]<br />ᐸ43.1ᐳ"}}:::plan
    Access49 & Access50 --> List51
    PgCursor44{{"PgCursor[44∈5]"}}:::plan
    List51 --> PgCursor44
    PgUnionAllSingle43 --> Access49
    PgUnionAllSingle43 --> Access50
    PgUnionAll77[["PgUnionAll[77∈6]<br />ᐳAwsApplication"]]:::plan
    PgClassExpression61{{"PgClassExpression[61∈6]<br />ᐸ__aws_appl...ons__.”id”ᐳ"}}:::plan
    Connection76{{"Connection[76∈6]<br />ᐸ72ᐳ<br />ᐳAwsApplication"}}:::plan
    Object18 & PgClassExpression61 & PgClassExpression61 & Connection76 --> PgUnionAll77
    PgUnionAll129[["PgUnionAll[129∈6]<br />ᐳGcpApplication"]]:::plan
    PgClassExpression113{{"PgClassExpression[113∈6]<br />ᐸ__gcp_appl...ons__.”id”ᐳ"}}:::plan
    Connection128{{"Connection[128∈6]<br />ᐸ124ᐳ<br />ᐳGcpApplication"}}:::plan
    Object18 & PgClassExpression113 & PgClassExpression113 & Connection128 --> PgUnionAll129
    PgSelect55[["PgSelect[55∈6]<br />ᐸaws_applicationsᐳ<br />ᐳAwsApplication"]]:::plan
    Access54{{"Access[54∈6]<br />ᐸ53.0ᐳ"}}:::plan
    Object18 & Access54 --> PgSelect55
    PgSelect107[["PgSelect[107∈6]<br />ᐸgcp_applicationsᐳ<br />ᐳGcpApplication"]]:::plan
    Access106{{"Access[106∈6]<br />ᐸ105.0ᐳ"}}:::plan
    Object18 & Access106 --> PgSelect107
    JSONParse53[["JSONParse[53∈6]<br />ᐸ50ᐳ<br />ᐳAwsApplication"]]:::plan
    Access50 --> JSONParse53
    JSONParse53 --> Access54
    First59{{"First[59∈6]"}}:::plan
    PgSelect55 --> First59
    PgSelectSingle60{{"PgSelectSingle[60∈6]<br />ᐸaws_applicationsᐳ"}}:::plan
    First59 --> PgSelectSingle60
    PgSelectSingle60 --> PgClassExpression61
    Constant157 --> Connection76
    JSONParse105[["JSONParse[105∈6]<br />ᐸ50ᐳ<br />ᐳGcpApplication"]]:::plan
    Access50 --> JSONParse105
    JSONParse105 --> Access106
    First111{{"First[111∈6]"}}:::plan
    PgSelect107 --> First111
    PgSelectSingle112{{"PgSelectSingle[112∈6]<br />ᐸgcp_applicationsᐳ"}}:::plan
    First111 --> PgSelectSingle112
    PgSelectSingle112 --> PgClassExpression113
    Constant157 --> Connection128
    __Item78[/"__Item[78∈7]<br />ᐸ77ᐳ"\]:::itemplan
    PgUnionAll77 ==> __Item78
    PgUnionAllSingle79["PgUnionAllSingle[79∈7]"]:::plan
    __Item78 --> PgUnionAllSingle79
    List83{{"List[83∈8]<br />ᐸ81,82ᐳ<br />ᐳAwsApplication"}}:::plan
    Access81{{"Access[81∈8]<br />ᐸ79.0ᐳ"}}:::plan
    Access82{{"Access[82∈8]<br />ᐸ79.1ᐳ"}}:::plan
    Access81 & Access82 --> List83
    PgCursor80{{"PgCursor[80∈8]"}}:::plan
    List83 --> PgCursor80
    PgUnionAllSingle79 --> Access81
    PgUnionAllSingle79 --> Access82
    PgSelect87[["PgSelect[87∈9]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access86{{"Access[86∈9]<br />ᐸ85.0ᐳ"}}:::plan
    Object18 & Access86 --> PgSelect87
    PgSelect97[["PgSelect[97∈9]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access96{{"Access[96∈9]<br />ᐸ95.0ᐳ"}}:::plan
    Object18 & Access96 --> PgSelect97
    JSONParse85[["JSONParse[85∈9]<br />ᐸ82ᐳ<br />ᐳAwsApplicationᐳFirstPartyVulnerability"]]:::plan
    Access82 --> JSONParse85
    JSONParse85 --> Access86
    First91{{"First[91∈9]"}}:::plan
    PgSelect87 --> First91
    PgSelectSingle92{{"PgSelectSingle[92∈9]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First91 --> PgSelectSingle92
    PgClassExpression93{{"PgClassExpression[93∈9]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle92 --> PgClassExpression93
    JSONParse95[["JSONParse[95∈9]<br />ᐸ82ᐳ<br />ᐳAwsApplicationᐳThirdPartyVulnerability"]]:::plan
    Access82 --> JSONParse95
    JSONParse95 --> Access96
    First101{{"First[101∈9]"}}:::plan
    PgSelect97 --> First101
    PgSelectSingle102{{"PgSelectSingle[102∈9]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First101 --> PgSelectSingle102
    PgClassExpression103{{"PgClassExpression[103∈9]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle102 --> PgClassExpression103
    __Item130[/"__Item[130∈10]<br />ᐸ129ᐳ"\]:::itemplan
    PgUnionAll129 ==> __Item130
    PgUnionAllSingle131["PgUnionAllSingle[131∈10]"]:::plan
    __Item130 --> PgUnionAllSingle131
    List135{{"List[135∈11]<br />ᐸ133,134ᐳ<br />ᐳGcpApplication"}}:::plan
    Access133{{"Access[133∈11]<br />ᐸ131.0ᐳ"}}:::plan
    Access134{{"Access[134∈11]<br />ᐸ131.1ᐳ"}}:::plan
    Access133 & Access134 --> List135
    PgCursor132{{"PgCursor[132∈11]"}}:::plan
    List135 --> PgCursor132
    PgUnionAllSingle131 --> Access133
    PgUnionAllSingle131 --> Access134
    PgSelect139[["PgSelect[139∈12]<br />ᐸfirst_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access138{{"Access[138∈12]<br />ᐸ137.0ᐳ"}}:::plan
    Object18 & Access138 --> PgSelect139
    PgSelect149[["PgSelect[149∈12]<br />ᐸthird_party_vulnerabilitiesᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access148{{"Access[148∈12]<br />ᐸ147.0ᐳ"}}:::plan
    Object18 & Access148 --> PgSelect149
    JSONParse137[["JSONParse[137∈12]<br />ᐸ134ᐳ<br />ᐳGcpApplicationᐳFirstPartyVulnerability"]]:::plan
    Access134 --> JSONParse137
    JSONParse137 --> Access138
    First143{{"First[143∈12]"}}:::plan
    PgSelect139 --> First143
    PgSelectSingle144{{"PgSelectSingle[144∈12]<br />ᐸfirst_party_vulnerabilitiesᐳ"}}:::plan
    First143 --> PgSelectSingle144
    PgClassExpression145{{"PgClassExpression[145∈12]<br />ᐸ__first_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle144 --> PgClassExpression145
    JSONParse147[["JSONParse[147∈12]<br />ᐸ134ᐳ<br />ᐳGcpApplicationᐳThirdPartyVulnerability"]]:::plan
    Access134 --> JSONParse147
    JSONParse147 --> Access148
    First153{{"First[153∈12]"}}:::plan
    PgSelect149 --> First153
    PgSelectSingle154{{"PgSelectSingle[154∈12]<br />ᐸthird_party_vulnerabilitiesᐳ"}}:::plan
    First153 --> PgSelectSingle154
    PgClassExpression155{{"PgClassExpression[155∈12]<br />ᐸ__third_pa...ies__.”id”ᐳ"}}:::plan
    PgSelectSingle154 --> PgClassExpression155

    %% define steps

    subgraph "Buckets for queries/polymorphic/person-app-vulns.app-page-2"
    Bucket0("Bucket 0 (root)"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value3,__Value5,Access16,Access17,Object18,Connection19,Lambda40,Constant156,Constant157,Constant158 bucket0
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 18, 19, 157, 40<br /><br />ROOT Connectionᐸ15ᐳ[19]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect20,Connection39,PgValidateParsedCursor45,Access46,ToPg47,Access48 bucket1
    Bucket2("Bucket 2 (listItem)<br />Deps: 18, 39, 40, 47, 48, 157<br /><br />ROOT __Item{2}ᐸ20ᐳ[21]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item21,PgSelectSingle22 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 22, 18, 39, 40, 47, 48, 157<br /><br />ROOT PgSelectSingle{2}ᐸpeopleᐳ[22]<br />1: <br />ᐳ: 23, 24<br />2: PgUnionAll[41]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression23,PgClassExpression24,PgUnionAll41 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 18, 157<br /><br />ROOT __Item{4}ᐸ41ᐳ[42]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item42,PgUnionAllSingle43 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 43, 18, 157<br /><br />ROOT PgUnionAllSingle{4}[43]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgCursor44,Access49,Access50,List51 bucket5
    Bucket6("Bucket 6 (polymorphic)<br />AwsApplication,GcpApplication<br />Deps: 50, 18, 157, 43<br />ᐳAwsApplication<br />ᐳGcpApplication<br />1: JSONParse[53], JSONParse[105]<br />ᐳ: 76, 128, 54, 106<br />2: PgSelect[55], PgSelect[107]<br />ᐳ: 59, 60, 61, 111, 112, 113<br />3: PgUnionAll[77], PgUnionAll[129]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,JSONParse53,Access54,PgSelect55,First59,PgSelectSingle60,PgClassExpression61,Connection76,PgUnionAll77,JSONParse105,Access106,PgSelect107,First111,PgSelectSingle112,PgClassExpression113,Connection128,PgUnionAll129 bucket6
    Bucket7("Bucket 7 (listItem)<br />Deps: 18<br /><br />ROOT __Item{7}ᐸ77ᐳ[78]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item78,PgUnionAllSingle79 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 79, 18<br /><br />ROOT PgUnionAllSingle{7}[79]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgCursor80,Access81,Access82,List83 bucket8
    Bucket9("Bucket 9 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 82, 18, 79<br />ᐳAwsApplicationᐳFirstPartyVulnerability<br />ᐳAwsApplicationᐳThirdPartyVulnerability<br />1: JSONParse[85], JSONParse[95]<br />ᐳ: Access[86], Access[96]<br />2: PgSelect[87], PgSelect[97]<br />ᐳ: 91, 92, 93, 101, 102, 103"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,JSONParse85,Access86,PgSelect87,First91,PgSelectSingle92,PgClassExpression93,JSONParse95,Access96,PgSelect97,First101,PgSelectSingle102,PgClassExpression103 bucket9
    Bucket10("Bucket 10 (listItem)<br />Deps: 18<br /><br />ROOT __Item{10}ᐸ129ᐳ[130]"):::bucket
    classDef bucket10 stroke:#ffff00
    class Bucket10,__Item130,PgUnionAllSingle131 bucket10
    Bucket11("Bucket 11 (nullableBoundary)<br />Deps: 131, 18<br /><br />ROOT PgUnionAllSingle{10}[131]"):::bucket
    classDef bucket11 stroke:#00ffff
    class Bucket11,PgCursor132,Access133,Access134,List135 bucket11
    Bucket12("Bucket 12 (polymorphic)<br />FirstPartyVulnerability,ThirdPartyVulnerability<br />Deps: 134, 18, 131<br />ᐳGcpApplicationᐳFirstPartyVulnerability<br />ᐳGcpApplicationᐳThirdPartyVulnerability<br />1: JSONParse[137], JSONParse[147]<br />ᐳ: Access[138], Access[148]<br />2: PgSelect[139], PgSelect[149]<br />ᐳ: 143, 144, 145, 153, 154, 155"):::bucket
    classDef bucket12 stroke:#4169e1
    class Bucket12,JSONParse137,Access138,PgSelect139,First143,PgSelectSingle144,PgClassExpression145,JSONParse147,Access148,PgSelect149,First153,PgSelectSingle154,PgClassExpression155 bucket12
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket6 --> Bucket7 & Bucket10
    Bucket7 --> Bucket8
    Bucket8 --> Bucket9
    Bucket10 --> Bucket11
    Bucket11 --> Bucket12
    end
