%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for mutations/v4/mutation-create.single-variables"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (mutationField)<br />Deps: 21, 22, 39, 57, 67, 4, 70<br /><br />1: PgInsertSingle[17]<br />2: <br />ᐳ: Object[23]"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 17, 21, 39, 57, 67, 23, 4, 70<br /><br />ROOT Object{1}ᐸ{result}ᐳ[23]<br />1: <br />ᐳ: 30, 40, 58, 68, 29<br />2: PgSelect[32], PgSelect[53]<br />ᐳ: Access[46], Access[64]<br />3: PgSelectRows[42], PgSelectRows[60]<br />ᐳ: 41, 44, 48, 59, 62, 66, 45, 63"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 45, 44, 70, 48<br /><br />ROOT Edge{2}[45]"):::bucket
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 63, 62, 70, 66<br /><br />ROOT Edge{2}[63]"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 4, 68<br /><br />ROOT __ValueᐸrootValueᐳ[4]"):::bucket
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 44, 70<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[44]"):::bucket
    Bucket7("Bucket 7 (nullableBoundary)<br />Deps: 62, 70<br /><br />ROOT PgSelectSingle{2}ᐸpersonᐳ[62]"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3 & Bucket4 & Bucket5
    Bucket3 --> Bucket6
    Bucket4 --> Bucket7

    %% plan dependencies
    __InputObject8{{"__InputObject[8∈0] ➊"}}:::plan
    Constant82{{"Constant[82∈0] ➊<br />ᐸ9000ᐳ"}}:::plan
    Constant83{{"Constant[83∈0] ➊<br />ᐸ'John Smith Jr.'ᐳ"}}:::plan
    Constant84{{"Constant[84∈0] ➊<br />ᐸ'Son of Sara and John Smith.'ᐳ"}}:::plan
    Constant85{{"Constant[85∈0] ➊<br />ᐸ'johnny.boy.smith@email.com'ᐳ"}}:::plan
    __InputDynamicScalar13{{"__InputDynamicScalar[13∈0] ➊"}}:::plan
    Constant86{{"Constant[86∈0] ➊<br />ᐸ'172.16.1.2'ᐳ"}}:::plan
    Constant87{{"Constant[87∈0] ➊<br />ᐸ'172.16.0.0/12'ᐳ"}}:::plan
    Constant88{{"Constant[88∈0] ➊<br />ᐸ'00:00:00:00:00:00'ᐳ"}}:::plan
    Constant82 & Constant83 & Constant84 & Constant85 & __InputDynamicScalar13 & Constant86 & Constant87 & Constant88 --> __InputObject8
    __InputObject6{{"__InputObject[6∈0] ➊"}}:::plan
    __InputObject8 --> __InputObject6
    Object21{{"Object[21∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access18{{"Access[18∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access20{{"Access[20∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access18 & Access20 --> Object21
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access18
    __Value2 --> Access20
    ApplyInput22{{"ApplyInput[22∈0] ➊"}}:::plan
    __InputObject6 --> ApplyInput22
    Access26{{"Access[26∈0] ➊<br />ᐸ0.order1ᐳ"}}:::plan
    __Value0["__Value[0∈0] ➊<br />ᐸvariableValuesᐳ"]:::plan
    __Value0 --> Access26
    ApplyInput39{{"ApplyInput[39∈0] ➊"}}:::plan
    Access26 --> ApplyInput39
    Access49{{"Access[49∈0] ➊<br />ᐸ0.order2ᐳ"}}:::plan
    __Value0 --> Access49
    ApplyInput57{{"ApplyInput[57∈0] ➊"}}:::plan
    Access49 --> ApplyInput57
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant67{{"Constant[67∈0] ➊<br />ᐸ'query'ᐳ"}}:::plan
    Constant70{{"Constant[70∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    PgInsertSingle17[["PgInsertSingle[17∈1] ➊<br />ᐸperson()ᐳ"]]:::sideeffectplan
    Object21 & ApplyInput22 --> PgInsertSingle17
    Object23{{"Object[23∈1] ➊<br />ᐸ{result}ᐳ"}}:::plan
    PgInsertSingle17 --> Object23
    PgSelect32[["PgSelect[32∈2] ➊<br />ᐸpersonᐳ"]]:::plan
    PgClassExpression29{{"PgClassExpression[29∈2] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Object21 & PgClassExpression29 & ApplyInput39 --> PgSelect32
    Edge45{{"Edge[45∈2] ➊"}}:::plan
    PgSelectSingle44{{"PgSelectSingle[44∈2] ➊<br />ᐸpersonᐳ"}}:::plan
    PgCursor48{{"PgCursor[48∈2] ➊"}}:::plan
    Connection40{{"Connection[40∈2] ➊<br />ᐸ32ᐳ"}}:::plan
    PgSelectSingle44 & PgCursor48 & Connection40 --> Edge45
    PgSelect53[["PgSelect[53∈2] ➊<br />ᐸpersonᐳ"]]:::plan
    Object21 & PgClassExpression29 & ApplyInput57 --> PgSelect53
    Edge63{{"Edge[63∈2] ➊"}}:::plan
    PgSelectSingle62{{"PgSelectSingle[62∈2] ➊<br />ᐸpersonᐳ"}}:::plan
    PgCursor66{{"PgCursor[66∈2] ➊"}}:::plan
    Connection58{{"Connection[58∈2] ➊<br />ᐸ53ᐳ"}}:::plan
    PgSelectSingle62 & PgCursor66 & Connection58 --> Edge63
    Access46{{"Access[46∈2] ➊<br />ᐸ32.cursorDetailsᐳ"}}:::plan
    PgSelectSingle44 & Access46 --> PgCursor48
    Access64{{"Access[64∈2] ➊<br />ᐸ53.cursorDetailsᐳ"}}:::plan
    PgSelectSingle62 & Access64 --> PgCursor66
    Access30{{"Access[30∈2] ➊<br />ᐸ17.tᐳ"}}:::plan
    Access30 --> PgClassExpression29
    PgInsertSingle17 --> Access30
    First41{{"First[41∈2] ➊"}}:::plan
    PgSelectRows42[["PgSelectRows[42∈2] ➊"]]:::plan
    PgSelectRows42 --> First41
    PgSelect32 --> PgSelectRows42
    First41 --> PgSelectSingle44
    PgSelect32 --> Access46
    First59{{"First[59∈2] ➊"}}:::plan
    PgSelectRows60[["PgSelectRows[60∈2] ➊"]]:::plan
    PgSelectRows60 --> First59
    PgSelect53 --> PgSelectRows60
    First59 --> PgSelectSingle62
    PgSelect53 --> Access64
    Lambda68{{"Lambda[68∈2] ➊<br />ᐸrawEncodeᐳ"}}:::plan
    Constant67 --> Lambda68
    List72{{"List[72∈6] ➊<br />ᐸ70,71ᐳ"}}:::plan
    PgClassExpression71{{"PgClassExpression[71∈6] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant70 & PgClassExpression71 --> List72
    PgSelectSingle44 --> PgClassExpression71
    Lambda73{{"Lambda[73∈6] ➊<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List72 --> Lambda73
    PgClassExpression75{{"PgClassExpression[75∈6] ➊<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle44 --> PgClassExpression75
    List78{{"List[78∈7] ➊<br />ᐸ70,77ᐳ"}}:::plan
    PgClassExpression77{{"PgClassExpression[77∈7] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant70 & PgClassExpression77 --> List78
    PgSelectSingle62 --> PgClassExpression77
    Lambda79{{"Lambda[79∈7] ➊<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List78 --> Lambda79
    PgClassExpression81{{"PgClassExpression[81∈7] ➊<br />ᐸ__person__...full_name”ᐳ"}}:::plan
    PgSelectSingle62 --> PgClassExpression81

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value2,__Value4,__InputObject6,__InputObject8,__InputDynamicScalar13,Access18,Access20,Object21,ApplyInput22,Access26,ApplyInput39,Access49,ApplyInput57,Constant67,Constant70,Constant82,Constant83,Constant84,Constant85,Constant86,Constant87,Constant88 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgInsertSingle17,Object23 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgClassExpression29,Access30,PgSelect32,Connection40,First41,PgSelectRows42,PgSelectSingle44,Edge45,Access46,PgCursor48,PgSelect53,Connection58,First59,PgSelectRows60,PgSelectSingle62,Edge63,Access64,PgCursor66,Lambda68 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgClassExpression71,List72,Lambda73,PgClassExpression75 bucket6
    classDef bucket7 stroke:#808000
    class Bucket7,PgClassExpression77,List78,Lambda79,PgClassExpression81 bucket7

