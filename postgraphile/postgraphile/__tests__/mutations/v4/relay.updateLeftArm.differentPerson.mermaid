%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Object18{{"Object[18∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access16{{"Access[16∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access17{{"Access[17∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access16 & Access17 --> Object18
    __Flag25[["__Flag[25∈0] ➊<br />ᐸ24, if(20), rejectNull, onReject: Error: Invali…ᐳ"]]:::plan
    __Flag24[["__Flag[24∈0] ➊<br />ᐸ23, trapInhibited, onReject: INHIBITᐳ"]]:::plan
    Condition20{{"Condition[20∈0] ➊<br />ᐸexistsᐳ"}}:::plan
    __Flag24 & Condition20 --> __Flag25
    Lambda12{{"Lambda[12∈0] ➊<br />ᐸdecode_LeftArm_base64JSONᐳ"}}:::plan
    Constant43{{"Constant[43∈0] ➊<br />ᐸ'WyJsZWZ0X2FybXMiLDQyXQ=='ᐳ"}}:::plan
    Constant43 --> Lambda12
    Access13{{"Access[13∈0] ➊<br />ᐸ12.1ᐳ"}}:::plan
    Lambda12 --> Access13
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access16
    __Value2 --> Access17
    Constant45{{"Constant[45∈0] ➊<br />ᐸ'WyJwZW9wbGUiLDNd'ᐳ"}}:::plan
    Constant45 --> Condition20
    Lambda21{{"Lambda[21∈0] ➊<br />ᐸspecifier_Person_base64JSONᐳ"}}:::plan
    Constant45 --> Lambda21
    Access22{{"Access[22∈0] ➊<br />ᐸ21.1ᐳ"}}:::plan
    Lambda21 --> Access22
    __Flag23[["__Flag[23∈0] ➊<br />ᐸ22, rejectNull, onReject: INHIBITᐳ"]]:::plan
    Access22 --> __Flag23
    __Flag23 --> __Flag24
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant26{{"Constant[26∈0] ➊<br />ᐸ'left_arms'ᐳ"}}:::plan
    Constant37{{"Constant[37∈0] ➊<br />ᐸ'people'ᐳ"}}:::plan
    Constant44{{"Constant[44∈0] ➊<br />ᐸ0.74ᐳ"}}:::plan
    PgUpdateSingle15[["PgUpdateSingle[15∈1] ➊<br />ᐸleft_arm(id;length_in_metres,person_id)ᐳ"]]:::sideeffectplan
    Object18 -->|rejectNull| PgUpdateSingle15
    Access13 & Constant44 & __Flag25 --> PgUpdateSingle15
    Object19{{"Object[19∈1] ➊<br />ᐸ{result}ᐳ"}}:::plan
    PgUpdateSingle15 --> Object19
    List28{{"List[28∈3] ➊<br />ᐸ26,27ᐳ"}}:::plan
    PgClassExpression27{{"PgClassExpression[27∈3] ➊<br />ᐸ__left_arm__.”id”ᐳ"}}:::plan
    Constant26 & PgClassExpression27 --> List28
    PgSelect31[["PgSelect[31∈3] ➊<br />ᐸpersonᐳ"]]:::plan
    PgClassExpression30{{"PgClassExpression[30∈3] ➊<br />ᐸ__left_arm...person_id”ᐳ"}}:::plan
    Object18 & PgClassExpression30 --> PgSelect31
    PgUpdateSingle15 --> PgClassExpression27
    Lambda29{{"Lambda[29∈3] ➊<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List28 --> Lambda29
    PgUpdateSingle15 --> PgClassExpression30
    First35{{"First[35∈3] ➊"}}:::plan
    PgSelect31 --> First35
    PgSelectSingle36{{"PgSelectSingle[36∈3] ➊<br />ᐸpersonᐳ"}}:::plan
    First35 --> PgSelectSingle36
    PgClassExpression41{{"PgClassExpression[41∈3] ➊<br />ᐸ__left_arm...in_metres”ᐳ"}}:::plan
    PgUpdateSingle15 --> PgClassExpression41
    PgClassExpression42{{"PgClassExpression[42∈3] ➊<br />ᐸ__left_arm__.”mood”ᐳ"}}:::plan
    PgUpdateSingle15 --> PgClassExpression42
    List39{{"List[39∈4] ➊<br />ᐸ37,38ᐳ"}}:::plan
    PgClassExpression38{{"PgClassExpression[38∈4] ➊<br />ᐸ__person__.”id”ᐳ"}}:::plan
    Constant37 & PgClassExpression38 --> List39
    PgSelectSingle36 --> PgClassExpression38
    Lambda40{{"Lambda[40∈4] ➊<br />ᐸbase64JSONEncodeᐳ"}}:::plan
    List39 --> Lambda40

    %% define steps

    subgraph "Buckets for mutations/v4/relay.updateLeftArm.differentPerson"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 16, 17, 26, 37, 43, 44, 45, 12, 13, 18, 20, 21, 22<br />2: __Flag[23]<br />3: __Flag[24]<br />4: __Flag[25]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Lambda12,Access13,Access16,Access17,Object18,Condition20,Lambda21,Access22,__Flag23,__Flag24,__Flag25,Constant26,Constant37,Constant43,Constant44,Constant45 bucket0
    Bucket1("Bucket 1 (mutationField)<br />Deps: 18, 13, 44, 25, 26, 37<br /><br />1: PgUpdateSingle[15]<br />2: <br />ᐳ: Object[19]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgUpdateSingle15,Object19 bucket1
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 19, 15, 26, 18, 37<br /><br />ROOT Object{1}ᐸ{result}ᐳ[19]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 15, 26, 18, 37<br /><br />ROOT PgUpdateSingle{1}ᐸleft_arm(id;length_in_metres,person_id)ᐳ[15]<br />1: <br />ᐳ: 27, 30, 41, 42, 28, 29<br />2: PgSelect[31]<br />ᐳ: First[35], PgSelectSingle[36]"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression27,List28,Lambda29,PgClassExpression30,PgSelect31,First35,PgSelectSingle36,PgClassExpression41,PgClassExpression42 bucket3
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 36, 37<br /><br />ROOT PgSelectSingle{3}ᐸpersonᐳ[36]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression38,List39,Lambda40 bucket4
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    end
