%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/unions-table/by-id-1"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 8, 9, 92, 10<br />2: PgSelect[7]<br />3: PgSelectRows[12]<br />ᐳ: 11, 13, 14, 15, 16"):::bucket
    Bucket1("Bucket 1 (polymorphic)<br />Deps: 10, 16, 15<br /><br />1: 18, 30, 42, 54, 66<br />2: 27, 39, 51, 63, 75<br />ᐳ: 26, 29, 38, 41, 50, 53, 62, 65, 74, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91"):::bucket
    Bucket2("Bucket 2 (polymorphicPartition)<br />UnionTopic<br />Deps: 78, 79<br />ᐳUnionTopic"):::bucket
    Bucket3("Bucket 3 (polymorphicPartition)<br />UnionPost<br />Deps: 80, 81, 82, 83<br />ᐳUnionPost"):::bucket
    Bucket4("Bucket 4 (polymorphicPartition)<br />UnionDivider<br />Deps: 84, 85<br />ᐳUnionDivider"):::bucket
    Bucket5("Bucket 5 (polymorphicPartition)<br />UnionChecklist<br />Deps: 87, 88<br />ᐳUnionChecklist"):::bucket
    Bucket6("Bucket 6 (polymorphicPartition)<br />UnionChecklistItem<br />Deps: 89, 90, 91<br />ᐳUnionChecklistItem"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2 & Bucket3 & Bucket4 & Bucket5 & Bucket6

    %% plan dependencies
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸunion_itemsᐳ"]]:::plan
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant92{{"Constant[92∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Object10 & Constant92 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    First11{{"First[11∈0] ➊"}}:::plan
    PgSelectRows12[["PgSelectRows[12∈0] ➊"]]:::plan
    PgSelectRows12 --> First11
    PgSelect7 --> PgSelectRows12
    PgSelectSingle13{{"PgSelectSingle[13∈0] ➊<br />ᐸunion_itemsᐳ"}}:::plan
    First11 --> PgSelectSingle13
    PgClassExpression14{{"PgClassExpression[14∈0] ➊<br />ᐸ__union_items__.”type”ᐳ"}}:::plan
    PgSelectSingle13 --> PgClassExpression14
    Lambda15{{"Lambda[15∈0] ➊<br />ᐸunionItemTypeNameFromTypeᐳ"}}:::plan
    PgClassExpression14 --> Lambda15
    PgClassExpression16{{"PgClassExpression[16∈0] ➊<br />ᐸ__union_items__.”id”ᐳ"}}:::plan
    PgSelectSingle13 --> PgClassExpression16
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgSelect18[["PgSelect[18∈1] ➊<br />ᐸunion_topicsᐳ<br />ᐳUnionTopic"]]:::plan
    Object10 & PgClassExpression16 --> PgSelect18
    PgSelect30[["PgSelect[30∈1] ➊<br />ᐸunion_postsᐳ<br />ᐳUnionPost"]]:::plan
    Object10 & PgClassExpression16 --> PgSelect30
    PgSelect42[["PgSelect[42∈1] ➊<br />ᐸunion_dividersᐳ<br />ᐳUnionDivider"]]:::plan
    Object10 & PgClassExpression16 --> PgSelect42
    PgSelect54[["PgSelect[54∈1] ➊<br />ᐸunion_checklistsᐳ<br />ᐳUnionChecklist"]]:::plan
    Object10 & PgClassExpression16 --> PgSelect54
    PgSelect66[["PgSelect[66∈1] ➊<br />ᐸunion_checklist_itemsᐳ<br />ᐳUnionChecklistItem"]]:::plan
    Object10 & PgClassExpression16 --> PgSelect66
    First26{{"First[26∈1] ➊^"}}:::plan
    PgSelectRows27[["PgSelectRows[27∈1] ➊^"]]:::plan
    PgSelectRows27 --> First26
    PgSelect18 --> PgSelectRows27
    PgSelectSingle29{{"PgSelectSingle[29∈1] ➊^<br />ᐸunion_topicsᐳ"}}:::plan
    First26 --> PgSelectSingle29
    First38{{"First[38∈1] ➊^"}}:::plan
    PgSelectRows39[["PgSelectRows[39∈1] ➊^"]]:::plan
    PgSelectRows39 --> First38
    PgSelect30 --> PgSelectRows39
    PgSelectSingle41{{"PgSelectSingle[41∈1] ➊^<br />ᐸunion_postsᐳ"}}:::plan
    First38 --> PgSelectSingle41
    First50{{"First[50∈1] ➊^"}}:::plan
    PgSelectRows51[["PgSelectRows[51∈1] ➊^"]]:::plan
    PgSelectRows51 --> First50
    PgSelect42 --> PgSelectRows51
    PgSelectSingle53{{"PgSelectSingle[53∈1] ➊^<br />ᐸunion_dividersᐳ"}}:::plan
    First50 --> PgSelectSingle53
    First62{{"First[62∈1] ➊^"}}:::plan
    PgSelectRows63[["PgSelectRows[63∈1] ➊^"]]:::plan
    PgSelectRows63 --> First62
    PgSelect54 --> PgSelectRows63
    PgSelectSingle65{{"PgSelectSingle[65∈1] ➊^<br />ᐸunion_checklistsᐳ"}}:::plan
    First62 --> PgSelectSingle65
    First74{{"First[74∈1] ➊^"}}:::plan
    PgSelectRows75[["PgSelectRows[75∈1] ➊^"]]:::plan
    PgSelectRows75 --> First74
    PgSelect66 --> PgSelectRows75
    PgSelectSingle77{{"PgSelectSingle[77∈1] ➊^<br />ᐸunion_checklist_itemsᐳ"}}:::plan
    First74 --> PgSelectSingle77
    PgClassExpression78{{"PgClassExpression[78∈1] ➊^<br />ᐸ__union_topics__.”id”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression78
    PgClassExpression79{{"PgClassExpression[79∈1] ➊^<br />ᐸ__union_to...__.”title”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression79
    PgClassExpression80{{"PgClassExpression[80∈1] ➊^<br />ᐸ__union_posts__.”id”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression80
    PgClassExpression81{{"PgClassExpression[81∈1] ➊^<br />ᐸ__union_posts__.”title”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression81
    PgClassExpression82{{"PgClassExpression[82∈1] ➊^<br />ᐸ__union_po...scription”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression82
    PgClassExpression83{{"PgClassExpression[83∈1] ➊^<br />ᐸ__union_posts__.”note”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression83
    PgClassExpression84{{"PgClassExpression[84∈1] ➊^<br />ᐸ__union_dividers__.”id”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression84
    PgClassExpression85{{"PgClassExpression[85∈1] ➊^<br />ᐸ__union_di...__.”title”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression85
    PgClassExpression86{{"PgClassExpression[86∈1] ➊^<br />ᐸ__union_di...__.”color”ᐳ"}}:::plan
    PgSelectSingle53 --> PgClassExpression86
    PgClassExpression87{{"PgClassExpression[87∈1] ➊^<br />ᐸ__union_ch...sts__.”id”ᐳ"}}:::plan
    PgSelectSingle65 --> PgClassExpression87
    PgClassExpression88{{"PgClassExpression[88∈1] ➊^<br />ᐸ__union_ch...__.”title”ᐳ"}}:::plan
    PgSelectSingle65 --> PgClassExpression88
    PgClassExpression89{{"PgClassExpression[89∈1] ➊^<br />ᐸ__union_ch...ems__.”id”ᐳ"}}:::plan
    PgSelectSingle77 --> PgClassExpression89
    PgClassExpression90{{"PgClassExpression[90∈1] ➊^<br />ᐸ__union_ch...scription”ᐳ"}}:::plan
    PgSelectSingle77 --> PgClassExpression90
    PgClassExpression91{{"PgClassExpression[91∈1] ➊^<br />ᐸ__union_ch...s__.”note”ᐳ"}}:::plan
    PgSelectSingle77 --> PgClassExpression91

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access9,Object10,First11,PgSelectRows12,PgSelectSingle13,PgClassExpression14,Lambda15,PgClassExpression16,Constant92 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect18,First26,PgSelectRows27,PgSelectSingle29,PgSelect30,First38,PgSelectRows39,PgSelectSingle41,PgSelect42,First50,PgSelectRows51,PgSelectSingle53,PgSelect54,First62,PgSelectRows63,PgSelectSingle65,PgSelect66,First74,PgSelectRows75,PgSelectSingle77,PgClassExpression78,PgClassExpression79,PgClassExpression80,PgClassExpression81,PgClassExpression82,PgClassExpression83,PgClassExpression84,PgClassExpression85,PgClassExpression86,PgClassExpression87,PgClassExpression88,PgClassExpression89,PgClassExpression90,PgClassExpression91 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6 bucket6

