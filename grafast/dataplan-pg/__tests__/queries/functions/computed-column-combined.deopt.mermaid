%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/functions/computed-column-combined"
    Bucket0("Bucket 0 (root)<br /><br />1: PgSelectInlineApply[74]<br />ᐳ: 8, 10, 46, 80, 11, 72<br />2: PgSelect[7]<br />3: PgSelectRows[15]<br />ᐳ: First[14], PgSelectSingle[17]"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 17, 11, 72, 74<br /><br />ROOT PgSelectSingleᐸforumsᐳ[17]<br />1: <br />ᐳ: 18, 25<br />2: PgSelect[19]<br />3: PgSelectRows[28]<br />ᐳ: First[27], PgSelectSingle[30]"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 30, 11, 72, 74<br /><br />ROOT PgSelectSingle{1}ᐸusersᐳ[30]<br />1: <br />ᐳ: 31, 32, 33, 40<br />2: PgSelect[34]<br />ᐳ: Access[75]<br />3: PgSelectRows[43]<br />ᐳ: First[42], PgSelectSingle[45]"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 45, 11, 75<br /><br />ROOT PgSelectSingle{2}ᐸusers_most_recent_forumᐳ[45]<br />1: <br />ᐳ: 47, 77, 66, 78<br />2: PgSelectRows[58], PgSelect[63]<br />ᐳ: 57, 60, 61<br />3: PgSelectRows[68]"):::bucket
    Bucket4("Bucket 4 (listItem)<br /><br />ROOT __Item{4}ᐸ68ᐳ[69]"):::bucket
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 70<br /><br />ROOT PgSelectSingle{4}ᐸforums_featured_messagesᐳ[70]"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5

    %% plan dependencies
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸforumsᐳ"]]:::plan
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant80{{"Constant[80∈0] ➊<br />ᐸ'f1700000-0000-0000-0000-000000000f17'ᐳ"}}:::plan
    Object11 & Constant80 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access10 --> Object11
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access10
    First14{{"First[14∈0] ➊"}}:::plan
    PgSelectRows15[["PgSelectRows[15∈0] ➊"]]:::plan
    PgSelectRows15 --> First14
    PgSelect7 --> PgSelectRows15
    PgSelectSingle17{{"PgSelectSingle[17∈0] ➊<br />ᐸforumsᐳ"}}:::plan
    First14 --> PgSelectSingle17
    PgFromExpression72{{"PgFromExpression[72∈0] ➊"}}:::plan
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgSelectInlineApply74["PgSelectInlineApply[74∈0] ➊"]:::plan
    PgSelect19[["PgSelect[19∈1] ➊<br />ᐸforums_random_userᐳ"]]:::plan
    PgFromExpression25{{"PgFromExpression[25∈1] ➊"}}:::plan
    Object11 & PgFromExpression25 --> PgSelect19
    PgClassExpression18{{"PgClassExpression[18∈1] ➊<br />ᐸ__forums__ᐳ"}}:::plan
    PgSelectSingle17 --> PgClassExpression18
    PgClassExpression18 --> PgFromExpression25
    First27{{"First[27∈1] ➊"}}:::plan
    PgSelectRows28[["PgSelectRows[28∈1] ➊"]]:::plan
    PgSelectRows28 --> First27
    PgSelect19 --> PgSelectRows28
    PgSelectSingle30{{"PgSelectSingle[30∈1] ➊<br />ᐸusersᐳ"}}:::plan
    First27 --> PgSelectSingle30
    PgSelect34[["PgSelect[34∈2] ➊<br />ᐸusers_most_recent_forumᐳ"]]:::plan
    PgFromExpression40{{"PgFromExpression[40∈2] ➊"}}:::plan
    Object11 & PgFromExpression40 & PgFromExpression72 & PgSelectInlineApply74 --> PgSelect34
    PgClassExpression31{{"PgClassExpression[31∈2] ➊<br />ᐸ__forums_r...”username”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression31
    PgClassExpression32{{"PgClassExpression[32∈2] ➊<br />ᐸ__forums_r...vatar_url”ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression32
    PgClassExpression33{{"PgClassExpression[33∈2] ➊<br />ᐸ__forums_random_user__ᐳ"}}:::plan
    PgSelectSingle30 --> PgClassExpression33
    PgClassExpression33 --> PgFromExpression40
    First42{{"First[42∈2] ➊"}}:::plan
    PgSelectRows43[["PgSelectRows[43∈2] ➊"]]:::plan
    PgSelectRows43 --> First42
    PgSelect34 --> PgSelectRows43
    PgSelectSingle45{{"PgSelectSingle[45∈2] ➊<br />ᐸusers_most_recent_forumᐳ"}}:::plan
    First42 --> PgSelectSingle45
    Access75{{"Access[75∈2] ➊<br />ᐸ34.m.joinDetailsFor48ᐳ"}}:::plan
    PgSelect34 --> Access75
    PgSelect63[["PgSelect[63∈3] ➊<br />ᐸforums_featured_messagesᐳ"]]:::plan
    PgFromExpression66{{"PgFromExpression[66∈3] ➊"}}:::plan
    Object11 & PgFromExpression66 --> PgSelect63
    List77{{"List[77∈3] ➊<br />ᐸ75,45ᐳ"}}:::plan
    Access75 & PgSelectSingle45 --> List77
    PgClassExpression47{{"PgClassExpression[47∈3] ➊<br />ᐸ__users_mo...nt_forum__ᐳ"}}:::plan
    PgSelectSingle45 --> PgClassExpression47
    First57{{"First[57∈3] ➊"}}:::plan
    PgSelectRows58[["PgSelectRows[58∈3] ➊"]]:::plan
    PgSelectRows58 --> First57
    Lambda78{{"Lambda[78∈3] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda78 --> PgSelectRows58
    PgSelectSingle60{{"PgSelectSingle[60∈3] ➊<br />ᐸforums_unique_author_countᐳ"}}:::plan
    First57 --> PgSelectSingle60
    PgClassExpression61{{"PgClassExpression[61∈3] ➊<br />ᐸ__forums_u..._count__.vᐳ"}}:::plan
    PgSelectSingle60 --> PgClassExpression61
    PgClassExpression47 --> PgFromExpression66
    PgSelectRows68[["PgSelectRows[68∈3] ➊"]]:::plan
    PgSelect63 --> PgSelectRows68
    List77 --> Lambda78
    __Item69[/"__Item[69∈4]<br />ᐸ68ᐳ"\]:::itemplan
    PgSelectRows68 ==> __Item69
    PgSelectSingle70{{"PgSelectSingle[70∈4]<br />ᐸforums_featured_messagesᐳ"}}:::plan
    __Item69 --> PgSelectSingle70
    PgClassExpression71{{"PgClassExpression[71∈5]<br />ᐸ__forums_f...s__.”body”ᐳ"}}:::plan
    PgSelectSingle70 --> PgClassExpression71

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access10,Object11,First14,PgSelectRows15,PgSelectSingle17,PgFromExpression72,PgSelectInlineApply74,Constant80 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgClassExpression18,PgSelect19,PgFromExpression25,First27,PgSelectRows28,PgSelectSingle30 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgClassExpression31,PgClassExpression32,PgClassExpression33,PgSelect34,PgFromExpression40,First42,PgSelectRows43,PgSelectSingle45,Access75 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression47,First57,PgSelectRows58,PgSelectSingle60,PgClassExpression61,PgSelect63,PgFromExpression66,PgSelectRows68,List77,Lambda78 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item69,PgSelectSingle70 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression71 bucket5

