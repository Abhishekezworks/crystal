%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/functions/computed-column-scalar"
    Bucket0("Bucket 0 (root)<br /><br />1: 61, 66, 71<br />ᐳ: 8, 10, 18, 75, 76, 77, 11, 60, 65, 70<br />2: PgSelect[7]<br />ᐳ: Access[62], Access[67], Access[72]<br />3: PgSelectRows[15]<br />ᐳ: First[14], PgSelectSingle[17]"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 62, 17, 67, 72<br /><br />ROOT PgSelectSingleᐸforumsᐳ[17]<br />1: <br />ᐳ: 63, 68, 73, 64, 69, 74<br />2: 30, 43, 56<br />ᐳ: 29, 32, 33, 42, 45, 46, 55, 58, 59"):::bucket
    end
    Bucket0 --> Bucket1

    %% plan dependencies
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸforumsᐳ"]]:::plan
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant75{{"Constant[75∈0] ➊<br />ᐸ'f1700000-0000-0000-0000-000000000f17'ᐳ"}}:::plan
    PgFromExpression60{{"PgFromExpression[60∈0] ➊"}}:::plan
    PgSelectInlineApply61["PgSelectInlineApply[61∈0] ➊"]:::plan
    PgFromExpression65{{"PgFromExpression[65∈0] ➊"}}:::plan
    PgSelectInlineApply66["PgSelectInlineApply[66∈0] ➊"]:::plan
    PgFromExpression70{{"PgFromExpression[70∈0] ➊"}}:::plan
    PgSelectInlineApply71["PgSelectInlineApply[71∈0] ➊"]:::plan
    Object11 & Constant75 & PgFromExpression60 & PgSelectInlineApply61 & PgFromExpression65 & PgSelectInlineApply66 & PgFromExpression70 & PgSelectInlineApply71 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access10 --> Object11
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access10
    First14{{"First[14∈0] ➊"}}:::plan
    PgSelectRows15[["PgSelectRows[15∈0] ➊"]]:::plan
    PgSelectRows15 --> First14
    PgSelect7 --> PgSelectRows15
    PgSelectSingle17{{"PgSelectSingle[17∈0] ➊<br />ᐸforumsᐳ"}}:::plan
    First14 --> PgSelectSingle17
    Access62{{"Access[62∈0] ➊<br />ᐸ7.m.joinDetailsFor20ᐳ"}}:::plan
    PgSelect7 --> Access62
    Constant76{{"Constant[76∈0] ➊<br />ᐸtrueᐳ"}}:::plan
    Constant76 --> PgFromExpression65
    Access67{{"Access[67∈0] ➊<br />ᐸ7.m.joinDetailsFor36ᐳ"}}:::plan
    PgSelect7 --> Access67
    Constant77{{"Constant[77∈0] ➊<br />ᐸfalseᐳ"}}:::plan
    Constant77 --> PgFromExpression70
    Access72{{"Access[72∈0] ➊<br />ᐸ7.m.joinDetailsFor49ᐳ"}}:::plan
    PgSelect7 --> Access72
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    List63{{"List[63∈1] ➊<br />ᐸ62,17ᐳ"}}:::plan
    Access62 & PgSelectSingle17 --> List63
    List68{{"List[68∈1] ➊<br />ᐸ67,17ᐳ"}}:::plan
    Access67 & PgSelectSingle17 --> List68
    List73{{"List[73∈1] ➊<br />ᐸ72,17ᐳ"}}:::plan
    Access72 & PgSelectSingle17 --> List73
    First29{{"First[29∈1] ➊"}}:::plan
    PgSelectRows30[["PgSelectRows[30∈1] ➊"]]:::plan
    PgSelectRows30 --> First29
    Lambda64{{"Lambda[64∈1] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda64 --> PgSelectRows30
    PgSelectSingle32{{"PgSelectSingle[32∈1] ➊<br />ᐸforums_unique_author_countᐳ"}}:::plan
    First29 --> PgSelectSingle32
    PgClassExpression33{{"PgClassExpression[33∈1] ➊<br />ᐸ__forums_u..._count__.vᐳ"}}:::plan
    PgSelectSingle32 --> PgClassExpression33
    First42{{"First[42∈1] ➊"}}:::plan
    PgSelectRows43[["PgSelectRows[43∈1] ➊"]]:::plan
    PgSelectRows43 --> First42
    Lambda69{{"Lambda[69∈1] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda69 --> PgSelectRows43
    PgSelectSingle45{{"PgSelectSingle[45∈1] ➊<br />ᐸforums_unique_author_countᐳ"}}:::plan
    First42 --> PgSelectSingle45
    PgClassExpression46{{"PgClassExpression[46∈1] ➊<br />ᐸ__forums_u..._count__.vᐳ"}}:::plan
    PgSelectSingle45 --> PgClassExpression46
    First55{{"First[55∈1] ➊"}}:::plan
    PgSelectRows56[["PgSelectRows[56∈1] ➊"]]:::plan
    PgSelectRows56 --> First55
    Lambda74{{"Lambda[74∈1] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda74 --> PgSelectRows56
    PgSelectSingle58{{"PgSelectSingle[58∈1] ➊<br />ᐸforums_unique_author_countᐳ"}}:::plan
    First55 --> PgSelectSingle58
    PgClassExpression59{{"PgClassExpression[59∈1] ➊<br />ᐸ__forums_u..._count__.vᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression59
    List63 --> Lambda64
    List68 --> Lambda69
    List73 --> Lambda74

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access10,Object11,First14,PgSelectRows15,PgSelectSingle17,PgFromExpression60,PgSelectInlineApply61,Access62,PgFromExpression65,PgSelectInlineApply66,Access67,PgFromExpression70,PgSelectInlineApply71,Access72,Constant75,Constant76,Constant77 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,First29,PgSelectRows30,PgSelectSingle32,PgClassExpression33,First42,PgSelectRows43,PgSelectSingle45,PgClassExpression46,First55,PgSelectRows56,PgSelectSingle58,PgClassExpression59,List63,Lambda64,List68,Lambda69,List73,Lambda74 bucket1

