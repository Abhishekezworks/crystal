%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/functions/computed-column-scalar"
    Bucket0("Bucket 0 (root)<br /><br />1: 62, 70, 77<br />ᐳ: 8, 10, 18, 82, 83, 84, 11, 60, 68, 75<br />2: PgSelect[7]<br />ᐳ: Access[63], Access[71], Access[78]<br />3: PgSelectRows[15]<br />ᐳ: First[14], PgSelectSingle[17]"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 63, 17, 71, 78<br /><br />ROOT PgSelectSingleᐸforumsᐳ[17]<br />1: <br />ᐳ: 65, 72, 79, 66, 73, 80<br />2: 30, 43, 56<br />ᐳ: 29, 32, 33, 42, 45, 46, 55, 58, 59"):::bucket
    end
    Bucket0 --> Bucket1

    %% plan dependencies
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸforumsᐳ"]]:::plan
    Object11{{"Object[11∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant82{{"Constant[82∈0] ➊<br />ᐸ'f1700000-0000-0000-0000-000000000f17'ᐳ"}}:::plan
    PgFromExpression60{{"PgFromExpression[60∈0] ➊"}}:::plan
    PgSelectInlineApply62["PgSelectInlineApply[62∈0] ➊"]:::plan
    PgFromExpression68{{"PgFromExpression[68∈0] ➊"}}:::plan
    PgSelectInlineApply70["PgSelectInlineApply[70∈0] ➊"]:::plan
    PgFromExpression75{{"PgFromExpression[75∈0] ➊"}}:::plan
    PgSelectInlineApply77["PgSelectInlineApply[77∈0] ➊"]:::plan
    Object11 & Constant82 & PgFromExpression60 & PgSelectInlineApply62 & PgFromExpression68 & PgSelectInlineApply70 & PgFromExpression75 & PgSelectInlineApply77 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access10{{"Access[10∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access10 --> Object11
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access10
    First14{{"First[14∈0] ➊"}}:::plan
    PgSelectRows15[["PgSelectRows[15∈0] ➊"]]:::plan
    PgSelectRows15 --> First14
    PgSelect7 --> PgSelectRows15
    PgSelectSingle17{{"PgSelectSingle[17∈0] ➊<br />ᐸforumsᐳ"}}:::plan
    First14 --> PgSelectSingle17
    Access63{{"Access[63∈0] ➊<br />ᐸ7.m.joinDetailsFor20ᐳ"}}:::plan
    PgSelect7 --> Access63
    Constant83{{"Constant[83∈0] ➊<br />ᐸtrueᐳ"}}:::plan
    Constant83 --> PgFromExpression68
    Access71{{"Access[71∈0] ➊<br />ᐸ7.m.joinDetailsFor36ᐳ"}}:::plan
    PgSelect7 --> Access71
    Constant84{{"Constant[84∈0] ➊<br />ᐸfalseᐳ"}}:::plan
    Constant84 --> PgFromExpression75
    Access78{{"Access[78∈0] ➊<br />ᐸ7.m.joinDetailsFor49ᐳ"}}:::plan
    PgSelect7 --> Access78
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    List65{{"List[65∈1] ➊<br />ᐸ63,17ᐳ"}}:::plan
    Access63 & PgSelectSingle17 --> List65
    List72{{"List[72∈1] ➊<br />ᐸ71,17ᐳ"}}:::plan
    Access71 & PgSelectSingle17 --> List72
    List79{{"List[79∈1] ➊<br />ᐸ78,17ᐳ"}}:::plan
    Access78 & PgSelectSingle17 --> List79
    First29{{"First[29∈1] ➊"}}:::plan
    PgSelectRows30[["PgSelectRows[30∈1] ➊"]]:::plan
    PgSelectRows30 --> First29
    Lambda66{{"Lambda[66∈1] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda66 --> PgSelectRows30
    PgSelectSingle32{{"PgSelectSingle[32∈1] ➊<br />ᐸforums_unique_author_countᐳ"}}:::plan
    First29 --> PgSelectSingle32
    PgClassExpression33{{"PgClassExpression[33∈1] ➊<br />ᐸ__forums_u..._count__.vᐳ"}}:::plan
    PgSelectSingle32 --> PgClassExpression33
    First42{{"First[42∈1] ➊"}}:::plan
    PgSelectRows43[["PgSelectRows[43∈1] ➊"]]:::plan
    PgSelectRows43 --> First42
    Lambda73{{"Lambda[73∈1] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda73 --> PgSelectRows43
    PgSelectSingle45{{"PgSelectSingle[45∈1] ➊<br />ᐸforums_unique_author_countᐳ"}}:::plan
    First42 --> PgSelectSingle45
    PgClassExpression46{{"PgClassExpression[46∈1] ➊<br />ᐸ__forums_u..._count__.vᐳ"}}:::plan
    PgSelectSingle45 --> PgClassExpression46
    First55{{"First[55∈1] ➊"}}:::plan
    PgSelectRows56[["PgSelectRows[56∈1] ➊"]]:::plan
    PgSelectRows56 --> First55
    Lambda80{{"Lambda[80∈1] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda80 --> PgSelectRows56
    PgSelectSingle58{{"PgSelectSingle[58∈1] ➊<br />ᐸforums_unique_author_countᐳ"}}:::plan
    First55 --> PgSelectSingle58
    PgClassExpression59{{"PgClassExpression[59∈1] ➊<br />ᐸ__forums_u..._count__.vᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression59
    List65 --> Lambda66
    List72 --> Lambda73
    List79 --> Lambda80

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access10,Object11,First14,PgSelectRows15,PgSelectSingle17,PgFromExpression60,PgSelectInlineApply62,Access63,PgFromExpression68,PgSelectInlineApply70,Access71,PgFromExpression75,PgSelectInlineApply77,Access78,Constant82,Constant83,Constant84 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,First29,PgSelectRows30,PgSelectSingle32,PgClassExpression33,First42,PgSelectRows43,PgSelectSingle45,PgClassExpression46,First55,PgSelectRows56,PgSelectSingle58,PgClassExpression59,List65,Lambda66,List72,Lambda73,List79,Lambda80 bucket1

