%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/connections/order"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (nullableBoundary)<br />Deps: 14, 19, 16, 91, 86, 6<br /><br />ROOT Connectionᐸ10ᐳ[16]<br />1: PgSelect[21], PgSelect[26]<br />ᐳ: 25, 39, 41, 42, 48, 49, 57, 87<br />2: PgSelectRows[29], PgSelectRows[33]<br />ᐳ: 28, 31, 32, 53, 56, 59, 62, 64, 67"):::bucket
    Bucket2("Bucket 2 (listItem)<br />Deps: 57, 87<br /><br />ROOT __Item{2}ᐸ33ᐳ[34]"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 35, 57, 87<br /><br />ROOT PgSelectSingle{2}ᐸmessagesᐳ[35]<br />1: <br />ᐳ: 70, 71, 88, 89<br />2: PgSelectRows[81]<br />ᐳ: First[80], PgSelectSingle[83]"):::bucket
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 83<br /><br />ROOT PgSelectSingle{3}ᐸusersᐳ[83]"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4

    %% plan dependencies
    Object14{{"Object[14∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access11 & Access13 --> Object14
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access11
    __Value2 --> Access13
    Connection16{{"Connection[16∈0] ➊<br />ᐸ10ᐳ"}}:::plan
    Constant91{{"Constant[91∈0] ➊<br />ᐸ5ᐳ"}}:::plan
    Constant91 --> Connection16
    Lambda19{{"Lambda[19∈0] ➊<br />ᐸincludeArchivedConditionᐳ"}}:::plan
    Constant90{{"Constant[90∈0] ➊<br />ᐸ[ undefined, 'INHERIT' ]ᐳ"}}:::plan
    Constant90 --> Lambda19
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    PgSelectInlineApply86["PgSelectInlineApply[86∈0] ➊"]:::plan
    PgSelect21[["PgSelect[21∈1] ➊<br />ᐸmessages+1ᐳ"]]:::plan
    Object14 & Lambda19 & Connection16 & Constant91 & PgSelectInlineApply86 --> PgSelect21
    Object48{{"Object[48∈1] ➊<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access39{{"Access[39∈1] ➊<br />ᐸ21.hasMoreᐳ"}}:::plan
    Constant91 & Access39 --> Object48
    PgSelect26[["PgSelect[26∈1] ➊<br />ᐸmessages(aggregate)ᐳ"]]:::plan
    Object14 & Lambda19 & Connection16 --> PgSelect26
    Object41{{"Object[41∈1] ➊<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant91 & Access39 --> Object41
    PgCursor59{{"PgCursor[59∈1] ➊"}}:::plan
    PgSelectSingle56{{"PgSelectSingle[56∈1] ➊<br />ᐸmessagesᐳ"}}:::plan
    Access57{{"Access[57∈1] ➊<br />ᐸ21.cursorDetailsᐳ"}}:::plan
    PgSelectSingle56 & Access57 --> PgCursor59
    PgCursor67{{"PgCursor[67∈1] ➊"}}:::plan
    PgSelectSingle64{{"PgSelectSingle[64∈1] ➊<br />ᐸmessagesᐳ"}}:::plan
    PgSelectSingle64 & Access57 --> PgCursor67
    PgPageInfo25{{"PgPageInfo[25∈1] ➊"}}:::plan
    Connection16 --> PgPageInfo25
    First28{{"First[28∈1] ➊"}}:::plan
    PgSelectRows29[["PgSelectRows[29∈1] ➊"]]:::plan
    PgSelectRows29 --> First28
    PgSelect26 --> PgSelectRows29
    PgSelectSingle31{{"PgSelectSingle[31∈1] ➊<br />ᐸmessagesᐳ"}}:::plan
    First28 --> PgSelectSingle31
    PgClassExpression32{{"PgClassExpression[32∈1] ➊<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle31 --> PgClassExpression32
    PgSelectRows33[["PgSelectRows[33∈1] ➊"]]:::plan
    PgSelect21 --> PgSelectRows33
    PgSelect21 --> Access39
    Lambda42{{"Lambda[42∈1] ➊<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object41 --> Lambda42
    Lambda49{{"Lambda[49∈1] ➊<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object48 --> Lambda49
    First53{{"First[53∈1] ➊"}}:::plan
    PgSelectRows33 --> First53
    First53 --> PgSelectSingle56
    PgSelect21 --> Access57
    Last62{{"Last[62∈1] ➊"}}:::plan
    PgSelectRows33 --> Last62
    Last62 --> PgSelectSingle64
    Access87{{"Access[87∈1] ➊<br />ᐸ21.m.joinDetailsFor73ᐳ"}}:::plan
    PgSelect21 --> Access87
    __Item34[/"__Item[34∈2]<br />ᐸ33ᐳ"\]:::itemplan
    PgSelectRows33 ==> __Item34
    PgSelectSingle35{{"PgSelectSingle[35∈2]<br />ᐸmessagesᐳ"}}:::plan
    __Item34 --> PgSelectSingle35
    PgCursor70{{"PgCursor[70∈3]"}}:::plan
    PgSelectSingle35 & Access57 --> PgCursor70
    List88{{"List[88∈3]<br />ᐸ87,35ᐳ"}}:::plan
    Access87 & PgSelectSingle35 --> List88
    PgClassExpression71{{"PgClassExpression[71∈3]<br />ᐸ__messages__.”body”ᐳ"}}:::plan
    PgSelectSingle35 --> PgClassExpression71
    First80{{"First[80∈3]"}}:::plan
    PgSelectRows81[["PgSelectRows[81∈3]"]]:::plan
    PgSelectRows81 --> First80
    Lambda89{{"Lambda[89∈3]<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda89 --> PgSelectRows81
    PgSelectSingle83{{"PgSelectSingle[83∈3]<br />ᐸusersᐳ"}}:::plan
    First80 --> PgSelectSingle83
    List88 --> Lambda89
    PgClassExpression84{{"PgClassExpression[84∈4]<br />ᐸ__users__.”username”ᐳ"}}:::plan
    PgSelectSingle83 --> PgClassExpression84
    PgClassExpression85{{"PgClassExpression[85∈4]<br />ᐸ__users__....vatar_url”ᐳ"}}:::plan
    PgSelectSingle83 --> PgClassExpression85

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Access11,Access13,Object14,Connection16,Lambda19,PgSelectInlineApply86,Constant90,Constant91 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgSelect21,PgPageInfo25,PgSelect26,First28,PgSelectRows29,PgSelectSingle31,PgClassExpression32,PgSelectRows33,Access39,Object41,Lambda42,Object48,Lambda49,First53,PgSelectSingle56,Access57,PgCursor59,Last62,PgSelectSingle64,PgCursor67,Access87 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,__Item34,PgSelectSingle35 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgCursor70,PgClassExpression71,First80,PgSelectRows81,PgSelectSingle83,List88,Lambda89 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression84,PgClassExpression85 bucket4

