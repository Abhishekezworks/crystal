%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    PgSelect9[["PgSelect[9∈0] ➊<br />ᐸforumsᐳ"]]:::plan
    Object12{{"Object[12∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant166{{"Constant[166∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Lambda152{{"Lambda[152∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Access155{{"Access[155∈0] ➊<br />ᐸ154.0ᐳ"}}:::plan
    Lambda160{{"Lambda[160∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Lambda165{{"Lambda[165∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object12 & Constant166 & Lambda152 & Access155 & Lambda160 & Lambda165 --> PgSelect9
    Object98{{"Object[98∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda90{{"Lambda[90∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Constant95{{"Constant[95∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant96{{"Constant[96∈0] ➊<br />ᐸsql.identifier(”users”)ᐳ"}}:::plan
    Constant97{{"Constant[97∈0] ➊<br />ᐸRecordCodec(users)ᐳ"}}:::plan
    Lambda90 & Constant95 & Constant96 & Constant97 --> Object98
    Object113{{"Object[113∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant110{{"Constant[110∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Constant111{{"Constant[111∈0] ➊<br />ᐸsql.identifier(”users”)ᐳ"}}:::plan
    Lambda90 & Constant110 & Constant111 & Constant97 --> Object113
    Object129{{"Object[129∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Lambda121{{"Lambda[121∈0] ➊<br />ᐸcalculateShouldReverseOrderᐳ"}}:::plan
    Constant126{{"Constant[126∈0] ➊<br />ᐸ[ { fragment: { n: [Array], f: 0, c: 266, [Symbol(pg-sql2-tyᐳ"}}:::plan
    Constant127{{"Constant[127∈0] ➊<br />ᐸsql.identifier(”messages”)ᐳ"}}:::plan
    Constant128{{"Constant[128∈0] ➊<br />ᐸRecordCodec(messages)ᐳ"}}:::plan
    Lambda121 & Constant126 & Constant127 & Constant128 --> Object129
    Object144{{"Object[144∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant141{{"Constant[141∈0] ➊<br />ᐸ[]ᐳ"}}:::plan
    Lambda90 & Constant141 & Constant127 & Constant128 --> Object144
    Object159{{"Object[159∈0] ➊<br />ᐸ{reverse,orders,alias,codec}ᐳ"}}:::plan
    Constant156{{"Constant[156∈0] ➊<br />ᐸ[ { fragment: { n: [Array], f: 0, c: 266, [Symbol(pg-sql2-tyᐳ"}}:::plan
    Constant157{{"Constant[157∈0] ➊<br />ᐸsql.identifier(”forums”)ᐳ"}}:::plan
    Constant158{{"Constant[158∈0] ➊<br />ᐸRecordCodec(forums)ᐳ"}}:::plan
    Lambda152 & Constant156 & Constant157 & Constant158 --> Object159
    Access10{{"Access[10∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access11{{"Access[11∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access10 & Access11 --> Object12
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access10
    __Value2 --> Access11
    PgSelectRows13[["PgSelectRows[13∈0] ➊"]]:::plan
    PgSelect9 --> PgSelectRows13
    Connection24{{"Connection[24∈0] ➊<br />ᐸ20ᐳ"}}:::plan
    Constant166 --> Connection24
    Constant167{{"Constant[167∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant167 --> Lambda90
    Lambda93{{"Lambda[93∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant168{{"Constant[168∈0] ➊<br />ᐸ§{ first: null, last: null, cursorLower: null, cursorUpper: ᐳ"}}:::plan
    Constant168 --> Lambda93
    Access94{{"Access[94∈0] ➊<br />ᐸ93.0ᐳ"}}:::plan
    Lambda93 --> Access94
    Lambda99{{"Lambda[99∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object98 --> Lambda99
    Lambda104{{"Lambda[104∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant169{{"Constant[169∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”users”ᐳ"}}:::plan
    Constant169 --> Lambda104
    Lambda114{{"Lambda[114∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object113 --> Lambda114
    Lambda119{{"Lambda[119∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant170{{"Constant[170∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”users”ᐳ"}}:::plan
    Constant170 --> Lambda119
    Constant174{{"Constant[174∈0] ➊<br />ᐸ§{ first: null, last: 2, cursorLower: null, cursorUpper: nulᐳ"}}:::plan
    Constant174 --> Lambda121
    Lambda124{{"Lambda[124∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant175{{"Constant[175∈0] ➊<br />ᐸ§{ first: null, last: 2, cursorLower: null, cursorUpper: nulᐳ"}}:::plan
    Constant175 --> Lambda124
    Access125{{"Access[125∈0] ➊<br />ᐸ124.0ᐳ"}}:::plan
    Lambda124 --> Access125
    Lambda130{{"Lambda[130∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object129 --> Lambda130
    Lambda135{{"Lambda[135∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant171{{"Constant[171∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { fragment: [Object], codec: Coᐳ"}}:::plan
    Constant171 --> Lambda135
    Lambda145{{"Lambda[145∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Object144 --> Lambda145
    Lambda150{{"Lambda[150∈0] ➊<br />ᐸcalculateOrderBySQLᐳ"}}:::plan
    Constant172{{"Constant[172∈0] ➊<br />ᐸ§{ reverse: false, orders: [], alias: sql.identifier(”messagᐳ"}}:::plan
    Constant172 --> Lambda150
    Constant176{{"Constant[176∈0] ➊<br />ᐸ§{ first: 2, last: null, cursorLower: null, cursorUpper: nulᐳ"}}:::plan
    Constant176 --> Lambda152
    Lambda154{{"Lambda[154∈0] ➊<br />ᐸcalculateLimitAndOffsetSQLᐳ"}}:::plan
    Constant177{{"Constant[177∈0] ➊<br />ᐸ§{ first: 2, last: null, cursorLower: null, cursorUpper: nulᐳ"}}:::plan
    Constant177 --> Lambda154
    Lambda154 --> Access155
    Object159 --> Lambda160
    Constant173{{"Constant[173∈0] ➊<br />ᐸ§{ reverse: false, orders: [ { fragment: [Object], codec: Coᐳ"}}:::plan
    Constant173 --> Lambda165
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant8{{"Constant[8∈0] ➊<br />ᐸundefinedᐳ"}}:::plan
    __Item14[/"__Item[14∈1]<br />ᐸ13ᐳ"\]:::itemplan
    PgSelectRows13 ==> __Item14
    PgSelectSingle15{{"PgSelectSingle[15∈1]<br />ᐸforumsᐳ"}}:::plan
    __Item14 --> PgSelectSingle15
    PgClassExpression16{{"PgClassExpression[16∈2]<br />ᐸ__forums__.”name”ᐳ"}}:::plan
    PgSelectSingle15 --> PgClassExpression16
    PgSelect25[["PgSelect[25∈3]<br />ᐸmessages+1ᐳ"]]:::plan
    PgClassExpression19{{"PgClassExpression[19∈3]<br />ᐸ__forums__.”id”ᐳ"}}:::plan
    Object12 & PgClassExpression19 & Connection24 & Constant166 & Lambda121 & Access125 & Lambda130 & Lambda135 --> PgSelect25
    PgSelect83[["PgSelect[83∈3]<br />ᐸmessages(aggregate)ᐳ"]]:::plan
    Object12 & PgClassExpression19 & Connection24 & Lambda90 & Access94 & Lambda145 & Lambda150 --> PgSelect83
    Object67{{"Object[67∈3]<br />ᐸ{first,last,offset,hasMore}ᐳ"}}:::plan
    Access62{{"Access[62∈3]<br />ᐸ25.hasMoreᐳ"}}:::plan
    Constant8 & Constant166 & Constant8 & Access62 --> Object67
    Object63{{"Object[63∈3]<br />ᐸ{first,last,hasMore}ᐳ"}}:::plan
    Constant8 & Constant166 & Access62 --> Object63
    PgSelectSingle15 --> PgClassExpression19
    PgSelectRows26[["PgSelectRows[26∈3]"]]:::plan
    PgSelect25 --> PgSelectRows26
    PgSelectRows41[["PgSelectRows[41∈3]"]]:::plan
    PgSelect25 --> PgSelectRows41
    PgPageInfo59{{"PgPageInfo[59∈3] ➊"}}:::plan
    Connection24 --> PgPageInfo59
    PgSelect25 --> Access62
    Lambda64{{"Lambda[64∈3]<br />ᐸhasNextPageCbᐳ"}}:::plan
    Object63 --> Lambda64
    Lambda68{{"Lambda[68∈3]<br />ᐸhasPreviousPageCbᐳ"}}:::plan
    Object67 --> Lambda68
    First70{{"First[70∈3]"}}:::plan
    PgSelectRows71[["PgSelectRows[71∈3]"]]:::plan
    PgSelectRows71 --> First70
    PgSelect25 --> PgSelectRows71
    PgSelectSingle72{{"PgSelectSingle[72∈3]<br />ᐸmessagesᐳ"}}:::plan
    First70 --> PgSelectSingle72
    PgCursor73{{"PgCursor[73∈3]"}}:::plan
    List75{{"List[75∈3]<br />ᐸ74ᐳ"}}:::plan
    List75 --> PgCursor73
    PgClassExpression74{{"PgClassExpression[74∈3]<br />ᐸ__messages__.”id”ᐳ"}}:::plan
    PgSelectSingle72 --> PgClassExpression74
    PgClassExpression74 --> List75
    Last77{{"Last[77∈3]"}}:::plan
    PgSelectRows78[["PgSelectRows[78∈3]"]]:::plan
    PgSelectRows78 --> Last77
    PgSelect25 --> PgSelectRows78
    PgSelectSingle79{{"PgSelectSingle[79∈3]<br />ᐸmessagesᐳ"}}:::plan
    Last77 --> PgSelectSingle79
    PgCursor80{{"PgCursor[80∈3]"}}:::plan
    List82{{"List[82∈3]<br />ᐸ81ᐳ"}}:::plan
    List82 --> PgCursor80
    PgClassExpression81{{"PgClassExpression[81∈3]<br />ᐸ__messages__.”id”ᐳ"}}:::plan
    PgSelectSingle79 --> PgClassExpression81
    PgClassExpression81 --> List82
    First84{{"First[84∈3]"}}:::plan
    PgSelectRows85[["PgSelectRows[85∈3]"]]:::plan
    PgSelectRows85 --> First84
    PgSelect83 --> PgSelectRows85
    PgSelectSingle86{{"PgSelectSingle[86∈3]<br />ᐸmessagesᐳ"}}:::plan
    First84 --> PgSelectSingle86
    PgClassExpression87{{"PgClassExpression[87∈3]<br />ᐸcount(*)ᐳ"}}:::plan
    PgSelectSingle86 --> PgClassExpression87
    __Item27[/"__Item[27∈4]<br />ᐸ26ᐳ"\]:::itemplan
    PgSelectRows26 ==> __Item27
    PgSelectSingle28{{"PgSelectSingle[28∈4]<br />ᐸmessagesᐳ"}}:::plan
    __Item27 --> PgSelectSingle28
    PgSelect31[["PgSelect[31∈5]<br />ᐸusersᐳ"]]:::plan
    PgClassExpression30{{"PgClassExpression[30∈5]<br />ᐸ__messages...author_id”ᐳ"}}:::plan
    Object12 & PgClassExpression30 & Lambda90 & Access94 & Lambda99 & Lambda104 --> PgSelect31
    PgClassExpression29{{"PgClassExpression[29∈5]<br />ᐸ__messages__.”body”ᐳ"}}:::plan
    PgSelectSingle28 --> PgClassExpression29
    PgSelectSingle28 --> PgClassExpression30
    First35{{"First[35∈5]"}}:::plan
    PgSelectRows36[["PgSelectRows[36∈5]"]]:::plan
    PgSelectRows36 --> First35
    PgSelect31 --> PgSelectRows36
    PgSelectSingle37{{"PgSelectSingle[37∈5]<br />ᐸusersᐳ"}}:::plan
    First35 --> PgSelectSingle37
    PgClassExpression38{{"PgClassExpression[38∈6]<br />ᐸ__users__.”username”ᐳ"}}:::plan
    PgSelectSingle37 --> PgClassExpression38
    PgClassExpression39{{"PgClassExpression[39∈6]<br />ᐸ__users__....vatar_url”ᐳ"}}:::plan
    PgSelectSingle37 --> PgClassExpression39
    __Item42[/"__Item[42∈7]<br />ᐸ41ᐳ"\]:::itemplan
    PgSelectRows41 ==> __Item42
    PgSelectSingle43{{"PgSelectSingle[43∈7]<br />ᐸmessagesᐳ"}}:::plan
    __Item42 --> PgSelectSingle43
    PgSelect49[["PgSelect[49∈8]<br />ᐸusersᐳ"]]:::plan
    PgClassExpression48{{"PgClassExpression[48∈8]<br />ᐸ__messages...author_id”ᐳ"}}:::plan
    Object12 & PgClassExpression48 & Lambda90 & Access94 & Lambda114 & Lambda119 --> PgSelect49
    PgCursor44{{"PgCursor[44∈8]"}}:::plan
    List46{{"List[46∈8]<br />ᐸ45ᐳ"}}:::plan
    List46 --> PgCursor44
    PgClassExpression45{{"PgClassExpression[45∈8]<br />ᐸ__messages__.”id”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression45
    PgClassExpression45 --> List46
    PgClassExpression47{{"PgClassExpression[47∈8]<br />ᐸ__messages__.”body”ᐳ"}}:::plan
    PgSelectSingle43 --> PgClassExpression47
    PgSelectSingle43 --> PgClassExpression48
    First53{{"First[53∈8]"}}:::plan
    PgSelectRows54[["PgSelectRows[54∈8]"]]:::plan
    PgSelectRows54 --> First53
    PgSelect49 --> PgSelectRows54
    PgSelectSingle55{{"PgSelectSingle[55∈8]<br />ᐸusersᐳ"}}:::plan
    First53 --> PgSelectSingle55
    PgClassExpression56{{"PgClassExpression[56∈9]<br />ᐸ__users__.”username”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression56
    PgClassExpression57{{"PgClassExpression[57∈9]<br />ᐸ__users__....vatar_url”ᐳ"}}:::plan
    PgSelectSingle55 --> PgClassExpression57

    %% define steps

    subgraph "Buckets for queries/connections/pagination-when-inlined-backwards"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 8, 10, 11, 95, 96, 97, 110, 111, 126, 127, 128, 141, 156, 157, 158, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 12, 24, 90, 93, 94, 98, 99, 104, 113, 114, 119, 121, 124, 125, 129, 130, 135, 144, 145, 150, 152, 154, 155, 159, 160, 165<br />2: PgSelect[9]<br />3: PgSelectRows[13]"):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant8,PgSelect9,Access10,Access11,Object12,PgSelectRows13,Connection24,Lambda90,Lambda93,Access94,Constant95,Constant96,Constant97,Object98,Lambda99,Lambda104,Constant110,Constant111,Object113,Lambda114,Lambda119,Lambda121,Lambda124,Access125,Constant126,Constant127,Constant128,Object129,Lambda130,Lambda135,Constant141,Object144,Lambda145,Lambda150,Lambda152,Lambda154,Access155,Constant156,Constant157,Constant158,Object159,Lambda160,Lambda165,Constant166,Constant167,Constant168,Constant169,Constant170,Constant171,Constant172,Constant173,Constant174,Constant175,Constant176,Constant177 bucket0
    Bucket1("Bucket 1 (listItem)<br />Deps: 12, 24, 166, 121, 125, 130, 135, 8, 90, 94, 145, 150, 99, 104, 114, 119<br /><br />ROOT __Item{1}ᐸ13ᐳ[14]"):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item14,PgSelectSingle15 bucket1
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 15, 12, 24, 166, 121, 125, 130, 135, 8, 90, 94, 145, 150, 99, 104, 114, 119<br /><br />ROOT PgSelectSingle{1}ᐸforumsᐳ[15]"):::bucket
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgClassExpression16 bucket2
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 15, 12, 24, 166, 121, 125, 130, 135, 8, 90, 94, 145, 150, 99, 104, 114, 119<br /><br />ROOT Connectionᐸ20ᐳ[24]<br />1: <br />ᐳ: PgClassExpression[19], PgPageInfo[59]<br />2: PgSelect[25], PgSelect[83]<br />ᐳ: 62, 63, 64, 67, 68<br />3: 26, 41, 71, 78, 85<br />ᐳ: 70, 72, 74, 75, 77, 79, 81, 82, 84, 86, 87, 73, 80"):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression19,PgSelect25,PgSelectRows26,PgSelectRows41,PgPageInfo59,Access62,Object63,Lambda64,Object67,Lambda68,First70,PgSelectRows71,PgSelectSingle72,PgCursor73,PgClassExpression74,List75,Last77,PgSelectRows78,PgSelectSingle79,PgCursor80,PgClassExpression81,List82,PgSelect83,First84,PgSelectRows85,PgSelectSingle86,PgClassExpression87 bucket3
    Bucket4("Bucket 4 (listItem)<br />Deps: 12, 90, 94, 99, 104<br /><br />ROOT __Item{4}ᐸ26ᐳ[27]"):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item27,PgSelectSingle28 bucket4
    Bucket5("Bucket 5 (nullableBoundary)<br />Deps: 28, 12, 90, 94, 99, 104<br /><br />ROOT PgSelectSingle{4}ᐸmessagesᐳ[28]<br />1: <br />ᐳ: 29, 30<br />2: PgSelect[31]<br />3: PgSelectRows[36]<br />ᐳ: First[35], PgSelectSingle[37]"):::bucket
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgClassExpression29,PgClassExpression30,PgSelect31,First35,PgSelectRows36,PgSelectSingle37 bucket5
    Bucket6("Bucket 6 (nullableBoundary)<br />Deps: 37<br /><br />ROOT PgSelectSingle{5}ᐸusersᐳ[37]"):::bucket
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgClassExpression38,PgClassExpression39 bucket6
    Bucket7("Bucket 7 (listItem)<br />Deps: 12, 90, 94, 114, 119<br /><br />ROOT __Item{7}ᐸ41ᐳ[42]"):::bucket
    classDef bucket7 stroke:#808000
    class Bucket7,__Item42,PgSelectSingle43 bucket7
    Bucket8("Bucket 8 (nullableBoundary)<br />Deps: 43, 12, 90, 94, 114, 119<br /><br />ROOT PgSelectSingle{7}ᐸmessagesᐳ[43]<br />1: <br />ᐳ: 45, 47, 48, 46, 44<br />2: PgSelect[49]<br />3: PgSelectRows[54]<br />ᐳ: First[53], PgSelectSingle[55]"):::bucket
    classDef bucket8 stroke:#dda0dd
    class Bucket8,PgCursor44,PgClassExpression45,List46,PgClassExpression47,PgClassExpression48,PgSelect49,First53,PgSelectRows54,PgSelectSingle55 bucket8
    Bucket9("Bucket 9 (nullableBoundary)<br />Deps: 55<br /><br />ROOT PgSelectSingle{8}ᐸusersᐳ[55]"):::bucket
    classDef bucket9 stroke:#ff0000
    class Bucket9,PgClassExpression56,PgClassExpression57 bucket9
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4 & Bucket7
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6
    Bucket7 --> Bucket8
    Bucket8 --> Bucket9
    end
