%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/interfaces-relational/nested"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: Access[7], Access[9], Object[10]<br />2: PgSelect[6]<br />3: PgSelectRows[12]"):::bucket
    Bucket1("Bucket 1 (listItem)<br />Deps: 10<br /><br />ROOT __Item{1}ᐸ12ᐳ[13]"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 14, 10<br /><br />ROOT PgSelectSingle{1}ᐸpeopleᐳ[14]<br />1: <br />ᐳ: 15, 16<br />2: PgSelect[17]<br />3: PgSelectRows[25]<br />4: __ListTransform[24]"):::bucket
    Bucket3("Bucket 3 (subroutine)<br /><br />ROOT PgSelectSingle{3}ᐸrelational_itemsᐳ[27]"):::bucket
    Bucket4("Bucket 4 (listItem)<br />Deps: 10<br /><br />ROOT __Item{4}ᐸ24ᐳ[28]"):::bucket
    Bucket5("Bucket 5 (polymorphic)<br />RelationalTopic,RelationalPost,RelationalDivider,RelationalChecklist,RelationalChecklistItem<br />Deps: 10, 32, 72, 31, 30, 84<br />ᐳRelationalTopic<br />ᐳRelationalPost<br />ᐳRelationalDivider<br />ᐳRelationalChecklist<br />ᐳRelationalChecklistItem<br /><br />1: 33, 44, 51, 58, 65, 73<br />2: 41, 48, 55, 62, 69, 78<br />ᐳ: 40, 43, 47, 50, 54, 57, 61, 64, 68, 71, 77, 80, 81, 82, 121, 302"):::bucket
    Bucket6("Bucket 6 (polymorphic)<br />RelationalTopic,RelationalPost,RelationalDivider,RelationalChecklist,RelationalChecklistItem<br />Deps: 10, 121, 82, 81, 302<br />ᐳRelationalTopicᐳRelationalTopic<br />ᐳRelationalTopicᐳRelationalPost<br />ᐳRelationalTopicᐳRelationalDivider<br />ᐳRelationalTopicᐳRelationalChecklist<br />ᐳRelationalTopicᐳRelationalChecklistItem<br />ᐳRelationalPostᐳRelationalTopic<br />ᐳRelationalPostᐳRelationalPost<br />ᐳRelationalPostᐳRelationalDivider<br />ᐳRelationalPostᐳRelationalChecklist<br />ᐳRelationalPostᐳRelationalChecklistItem<br />ᐳRelationalDividerᐳRelationalTopic<br />ᐳRelationalDividerᐳRelationalPost<br />ᐳRelationalDividerᐳRelationalDivider<br />ᐳRelationalDividerᐳRelationalChecklist<br />ᐳRelationalDividerᐳRelationalChecklistItem<br />ᐳRelationalChecklistᐳRelationalTopic<br />ᐳRelationalChecklistᐳRelationalPost<br />ᐳRelationalChecklistᐳRelationalDivider<br />ᐳRelationalChecklistᐳRelationalChecklist<br />ᐳRelationalChecklistᐳRelationalChecklistItem<br />ᐳRelationalChecklistItemᐳRelationalTopic<br />ᐳRelationalChecklistItemᐳRelationalPost<br />ᐳRelationalChecklistItemᐳRelationalDivider<br />ᐳRelationalChecklistItemᐳRelationalChecklist<br />ᐳRelationalChecklistItemᐳRelationalChecklistItem<br /><br />1: 122, 133, 140, 147, 154<br />2: 130, 137, 144, 151, 158<br />ᐳ: 129, 132, 136, 139, 143, 146, 150, 153, 157, 160"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3 & Bucket4
    Bucket4 --> Bucket5
    Bucket5 --> Bucket6

    %% plan dependencies
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access7{{"Access[7∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access7 & Access9 --> Object10
    PgSelect6[["PgSelect[6∈0] ➊<br />ᐸpeopleᐳ"]]:::plan
    Object10 --> PgSelect6
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access7
    __Value2 --> Access9
    PgSelectRows12[["PgSelectRows[12∈0] ➊"]]:::plan
    PgSelect6 --> PgSelectRows12
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    __Item13[/"__Item[13∈1]<br />ᐸ12ᐳ"\]:::itemplan
    PgSelectRows12 ==> __Item13
    PgSelectSingle14{{"PgSelectSingle[14∈1]<br />ᐸpeopleᐳ"}}:::plan
    __Item13 --> PgSelectSingle14
    PgSelect17[["PgSelect[17∈2]<br />ᐸrelational_itemsᐳ"]]:::plan
    PgClassExpression16{{"PgClassExpression[16∈2]<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Object10 & PgClassExpression16 --> PgSelect17
    __ListTransform24[["__ListTransform[24∈2]<br />ᐸeach:17ᐳ"]]:::plan
    PgSelectRows25[["PgSelectRows[25∈2]"]]:::plan
    PgSelectRows25 & PgSelect17 --> __ListTransform24
    PgClassExpression15{{"PgClassExpression[15∈2]<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle14 --> PgClassExpression15
    PgSelectSingle14 --> PgClassExpression16
    PgSelect17 --> PgSelectRows25
    __Item26[/"__Item[26∈3]<br />ᐸ25ᐳ"\]:::itemplan
    PgSelectRows25 -.-> __Item26
    PgSelectSingle27{{"PgSelectSingle[27∈3]<br />ᐸrelational_itemsᐳ"}}:::plan
    __Item26 --> PgSelectSingle27
    PgPolymorphic31{{"PgPolymorphic[31∈4]"}}:::plan
    PgSelectSingle29{{"PgSelectSingle[29∈4]<br />ᐸrelational_itemsᐳ"}}:::plan
    PgClassExpression30{{"PgClassExpression[30∈4]<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle29 & PgClassExpression30 --> PgPolymorphic31
    __Item28[/"__Item[28∈4]<br />ᐸ24ᐳ"\]:::itemplan
    __ListTransform24 ==> __Item28
    __Item28 --> PgSelectSingle29
    PgSelectSingle29 --> PgClassExpression30
    PgClassExpression32{{"PgClassExpression[32∈4]<br />ᐸ__relation...ems__.”id”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression32
    PgClassExpression72{{"PgClassExpression[72∈4]<br />ᐸ__relation...parent_id”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression72
    PgClassExpression84{{"PgClassExpression[84∈4]<br />ᐸ__relation...__.”type2”ᐳ"}}:::plan
    PgSelectSingle29 --> PgClassExpression84
    PgSelect33[["PgSelect[33∈5]<br />ᐸrelational_topicsᐳ<br />ᐳRelationalTopic"]]:::plan
    Object10 & PgClassExpression32 --> PgSelect33
    PgSelect44[["PgSelect[44∈5]<br />ᐸrelational_postsᐳ<br />ᐳRelationalPost"]]:::plan
    Object10 & PgClassExpression32 --> PgSelect44
    PgSelect51[["PgSelect[51∈5]<br />ᐸrelational_dividersᐳ<br />ᐳRelationalDivider"]]:::plan
    Object10 & PgClassExpression32 --> PgSelect51
    PgSelect58[["PgSelect[58∈5]<br />ᐸrelational_checklistsᐳ<br />ᐳRelationalChecklist"]]:::plan
    Object10 & PgClassExpression32 --> PgSelect58
    PgSelect65[["PgSelect[65∈5]<br />ᐸrelational_checklist_itemsᐳ<br />ᐳRelationalChecklistItem"]]:::plan
    Object10 & PgClassExpression32 --> PgSelect65
    PgSelect73[["PgSelect[73∈5]<br />ᐸrelational_itemsᐳ<br />ᐳRelationalTopic<br />ᐳRelationalPost<br />ᐳRelationalDivider<br />ᐳRelationalChecklist<br />ᐳRelationalChecklistItem"]]:::plan
    Object10 & PgClassExpression72 --> PgSelect73
    PgPolymorphic82{{"PgPolymorphic[82∈5]<br />ᐳRelationalTopic<br />ᐳRelationalPost<br />ᐳRelationalDivider<br />ᐳRelationalChecklist<br />ᐳRelationalChecklistItem"}}:::plan
    PgSelectSingle80{{"PgSelectSingle[80∈5]^<br />ᐸrelational_itemsᐳ"}}:::plan
    PgClassExpression81{{"PgClassExpression[81∈5]<br />ᐸ__relation...s__.”type”ᐳ<br />ᐳRelationalTopic<br />ᐳRelationalPost<br />ᐳRelationalDivider<br />ᐳRelationalChecklist<br />ᐳRelationalChecklistItem<br />ᐳRelationalTopicᐳRelationalPost<br />ᐳRelationalTopicᐳRelationalDivider<br />ᐳRelationalTopicᐳRelationalChecklist<br />ᐳRelationalTopicᐳRelationalChecklistItem<br />ᐳRelationalPostᐳRelationalTopic<br />ᐳRelationalPostᐳRelationalPost<br />ᐳRelationalPostᐳRelationalDivider<br />ᐳRelationalPostᐳRelationalChecklist<br />ᐳRelationalPostᐳRelationalChecklistItem<br />ᐳRelationalDividerᐳRelationalTopic<br />ᐳRelationalDividerᐳRelationalPost<br />ᐳRelationalDividerᐳRelationalDivider<br />ᐳRelationalDividerᐳRelationalChecklist<br />ᐳRelationalDividerᐳRelationalChecklistItem<br />ᐳRelationalChecklistᐳRelationalTopic<br />ᐳRelationalChecklistᐳRelationalPost<br />ᐳRelationalChecklistᐳRelationalDivider<br />ᐳRelationalChecklistᐳRelationalChecklist<br />ᐳRelationalChecklistᐳRelationalChecklistItem<br />ᐳRelationalChecklistItemᐳRelationalTopic<br />ᐳRelationalChecklistItemᐳRelationalPost<br />ᐳRelationalChecklistItemᐳRelationalDivider<br />ᐳRelationalChecklistItemᐳRelationalChecklist<br />ᐳRelationalChecklistItemᐳRelationalChecklistItem"}}:::plan
    PgSelectSingle80 & PgClassExpression81 --> PgPolymorphic82
    First40{{"First[40∈5]^"}}:::plan
    PgSelectRows41[["PgSelectRows[41∈5]^"]]:::plan
    PgSelectRows41 --> First40
    PgSelect33 --> PgSelectRows41
    PgSelectSingle43{{"PgSelectSingle[43∈5]^<br />ᐸrelational_topicsᐳ"}}:::plan
    First40 --> PgSelectSingle43
    First47{{"First[47∈5]^"}}:::plan
    PgSelectRows48[["PgSelectRows[48∈5]^"]]:::plan
    PgSelectRows48 --> First47
    PgSelect44 --> PgSelectRows48
    PgSelectSingle50{{"PgSelectSingle[50∈5]^<br />ᐸrelational_postsᐳ"}}:::plan
    First47 --> PgSelectSingle50
    First54{{"First[54∈5]^"}}:::plan
    PgSelectRows55[["PgSelectRows[55∈5]^"]]:::plan
    PgSelectRows55 --> First54
    PgSelect51 --> PgSelectRows55
    PgSelectSingle57{{"PgSelectSingle[57∈5]^<br />ᐸrelational_dividersᐳ"}}:::plan
    First54 --> PgSelectSingle57
    First61{{"First[61∈5]^"}}:::plan
    PgSelectRows62[["PgSelectRows[62∈5]^"]]:::plan
    PgSelectRows62 --> First61
    PgSelect58 --> PgSelectRows62
    PgSelectSingle64{{"PgSelectSingle[64∈5]^<br />ᐸrelational_checklistsᐳ"}}:::plan
    First61 --> PgSelectSingle64
    First68{{"First[68∈5]^"}}:::plan
    PgSelectRows69[["PgSelectRows[69∈5]^"]]:::plan
    PgSelectRows69 --> First68
    PgSelect65 --> PgSelectRows69
    PgSelectSingle71{{"PgSelectSingle[71∈5]^<br />ᐸrelational_checklist_itemsᐳ"}}:::plan
    First68 --> PgSelectSingle71
    First77{{"First[77∈5]^"}}:::plan
    PgSelectRows78[["PgSelectRows[78∈5]^"]]:::plan
    PgSelectRows78 --> First77
    PgSelect73 --> PgSelectRows78
    First77 --> PgSelectSingle80
    PgSelectSingle80 --> PgClassExpression81
    PgClassExpression121{{"PgClassExpression[121∈5]^<br />ᐸ__relation...ems__.”id”ᐳ"}}:::plan
    PgSelectSingle80 --> PgClassExpression121
    PgClassExpression302{{"PgClassExpression[302∈5]^<br />ᐸ__relation...__.”type2”ᐳ"}}:::plan
    PgSelectSingle80 --> PgClassExpression302
    PgSelect122[["PgSelect[122∈6]<br />ᐸrelational_topicsᐳ<br />ᐳRelationalTopicᐳRelationalTopic<br />ᐳRelationalPostᐳRelationalTopic<br />ᐳRelationalDividerᐳRelationalTopic<br />ᐳRelationalChecklistᐳRelationalTopic<br />ᐳRelationalChecklistItemᐳRelationalTopic"]]:::plan
    Object10 & PgClassExpression121 --> PgSelect122
    PgSelect133[["PgSelect[133∈6]<br />ᐸrelational_postsᐳ<br />ᐳRelationalTopicᐳRelationalPost<br />ᐳRelationalPostᐳRelationalPost<br />ᐳRelationalDividerᐳRelationalPost<br />ᐳRelationalChecklistᐳRelationalPost<br />ᐳRelationalChecklistItemᐳRelationalPost"]]:::plan
    Object10 & PgClassExpression121 --> PgSelect133
    PgSelect140[["PgSelect[140∈6]<br />ᐸrelational_dividersᐳ<br />ᐳRelationalTopicᐳRelationalDivider<br />ᐳRelationalPostᐳRelationalDivider<br />ᐳRelationalDividerᐳRelationalDivider<br />ᐳRelationalChecklistᐳRelationalDivider<br />ᐳRelationalChecklistItemᐳRelationalDivider"]]:::plan
    Object10 & PgClassExpression121 --> PgSelect140
    PgSelect147[["PgSelect[147∈6]<br />ᐸrelational_checklistsᐳ<br />ᐳRelationalTopicᐳRelationalChecklist<br />ᐳRelationalPostᐳRelationalChecklist<br />ᐳRelationalDividerᐳRelationalChecklist<br />ᐳRelationalChecklistᐳRelationalChecklist<br />ᐳRelationalChecklistItemᐳRelationalChecklist"]]:::plan
    Object10 & PgClassExpression121 --> PgSelect147
    PgSelect154[["PgSelect[154∈6]<br />ᐸrelational_checklist_itemsᐳ<br />ᐳRelationalTopicᐳRelationalChecklistItem<br />ᐳRelationalPostᐳRelationalChecklistItem<br />ᐳRelationalDividerᐳRelationalChecklistItem<br />ᐳRelationalChecklistᐳRelationalChecklistItem<br />ᐳRelationalChecklistItemᐳRelationalChecklistItem"]]:::plan
    Object10 & PgClassExpression121 --> PgSelect154
    First129{{"First[129∈6]^"}}:::plan
    PgSelectRows130[["PgSelectRows[130∈6]^"]]:::plan
    PgSelectRows130 --> First129
    PgSelect122 --> PgSelectRows130
    PgSelectSingle132{{"PgSelectSingle[132∈6]^<br />ᐸrelational_topicsᐳ"}}:::plan
    First129 --> PgSelectSingle132
    First136{{"First[136∈6]^"}}:::plan
    PgSelectRows137[["PgSelectRows[137∈6]^"]]:::plan
    PgSelectRows137 --> First136
    PgSelect133 --> PgSelectRows137
    PgSelectSingle139{{"PgSelectSingle[139∈6]^<br />ᐸrelational_postsᐳ"}}:::plan
    First136 --> PgSelectSingle139
    First143{{"First[143∈6]^"}}:::plan
    PgSelectRows144[["PgSelectRows[144∈6]^"]]:::plan
    PgSelectRows144 --> First143
    PgSelect140 --> PgSelectRows144
    PgSelectSingle146{{"PgSelectSingle[146∈6]^<br />ᐸrelational_dividersᐳ"}}:::plan
    First143 --> PgSelectSingle146
    First150{{"First[150∈6]^"}}:::plan
    PgSelectRows151[["PgSelectRows[151∈6]^"]]:::plan
    PgSelectRows151 --> First150
    PgSelect147 --> PgSelectRows151
    PgSelectSingle153{{"PgSelectSingle[153∈6]^<br />ᐸrelational_checklistsᐳ"}}:::plan
    First150 --> PgSelectSingle153
    First157{{"First[157∈6]^"}}:::plan
    PgSelectRows158[["PgSelectRows[158∈6]^"]]:::plan
    PgSelectRows158 --> First157
    PgSelect154 --> PgSelectRows158
    PgSelectSingle160{{"PgSelectSingle[160∈6]^<br />ᐸrelational_checklist_itemsᐳ"}}:::plan
    First157 --> PgSelectSingle160

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect6,Access7,Access9,Object10,PgSelectRows12 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item13,PgSelectSingle14 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgClassExpression15,PgClassExpression16,PgSelect17,__ListTransform24,PgSelectRows25 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item26,PgSelectSingle27 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,__Item28,PgSelectSingle29,PgClassExpression30,PgPolymorphic31,PgClassExpression32,PgClassExpression72,PgClassExpression84 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgSelect33,First40,PgSelectRows41,PgSelectSingle43,PgSelect44,First47,PgSelectRows48,PgSelectSingle50,PgSelect51,First54,PgSelectRows55,PgSelectSingle57,PgSelect58,First61,PgSelectRows62,PgSelectSingle64,PgSelect65,First68,PgSelectRows69,PgSelectSingle71,PgSelect73,First77,PgSelectRows78,PgSelectSingle80,PgClassExpression81,PgPolymorphic82,PgClassExpression121,PgClassExpression302 bucket5
    classDef bucket6 stroke:#ff1493
    class Bucket6,PgSelect122,First129,PgSelectRows130,PgSelectSingle132,PgSelect133,First136,PgSelectRows137,PgSelectSingle139,PgSelect140,First143,PgSelectRows144,PgSelectSingle146,PgSelect147,First150,PgSelectRows151,PgSelectSingle153,PgSelect154,First157,PgSelectRows158,PgSelectSingle160 bucket6

