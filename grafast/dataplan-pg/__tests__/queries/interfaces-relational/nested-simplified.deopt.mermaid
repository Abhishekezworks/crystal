%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for queries/interfaces-relational/nested-simplified"
    Bucket0("Bucket 0 (root)<br /><br />1: <br />ᐳ: 8, 9, 290, 10<br />2: PgSelect[7]<br />3: PgSelectRows[11]"):::bucket
    Bucket1("Bucket 1 (listItem)<br />Deps: 10, 290<br /><br />ROOT __Item{1}ᐸ11ᐳ[12]"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 13, 10, 290<br /><br />ROOT PgSelectSingle{1}ᐸpeopleᐳ[13]<br />1: <br />ᐳ: 14, 17<br />2: PgSelect[18]<br />3: PgSelectRows[22]"):::bucket
    Bucket3("Bucket 3 (listItem)<br />Deps: 10<br /><br />ROOT __Item{3}ᐸ22ᐳ[23]<br />1: <br />ᐳ: 24, 25, 26, 27, 93, 94<br />2: PgSelect[95]<br />3: PgSelectRows[100]<br />ᐳ: 99, 102, 147, 148, 150, 217"):::bucket
    Bucket4("Bucket 4 (polymorphic)<br />Deps: 10, 27, 26, 150, 148, 25, 93, 147, 217<br /><br />1: 28, 41, 54, 67, 80<br />2: 37, 50, 63, 76, 89<br />ᐳ: 36, 39, 49, 52, 62, 65, 75, 78, 88, 91"):::bucket
    Bucket5("Bucket 5 (polymorphic)<br />Deps: 10, 150, 148, 147, 217<br /><br />1: 151, 164, 177, 190, 203<br />2: 160, 173, 186, 199, 212<br />ᐳ: 159, 162, 172, 175, 185, 188, 198, 201, 211, 214"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4
    Bucket4 --> Bucket5

    %% plan dependencies
    PgSelect7[["PgSelect[7∈0] ➊<br />ᐸpeopleᐳ"]]:::plan
    Object10{{"Object[10∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Constant290{{"Constant[290∈0] ➊<br />ᐸ1ᐳ"}}:::plan
    Object10 & Constant290 --> PgSelect7
    Access8{{"Access[8∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access9{{"Access[9∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access8 & Access9 --> Object10
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access8
    __Value2 --> Access9
    PgSelectRows11[["PgSelectRows[11∈0] ➊"]]:::plan
    PgSelect7 --> PgSelectRows11
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    __Item12[/"__Item[12∈1]<br />ᐸ11ᐳ"\]:::itemplan
    PgSelectRows11 ==> __Item12
    PgSelectSingle13{{"PgSelectSingle[13∈1]<br />ᐸpeopleᐳ"}}:::plan
    __Item12 --> PgSelectSingle13
    PgSelect18[["PgSelect[18∈2]<br />ᐸrelational_itemsᐳ"]]:::plan
    PgClassExpression17{{"PgClassExpression[17∈2]<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    Object10 & PgClassExpression17 --> PgSelect18
    Constant290 -- 2 --> PgSelect18
    PgClassExpression14{{"PgClassExpression[14∈2]<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle13 --> PgClassExpression14
    PgSelectSingle13 --> PgClassExpression17
    PgSelectRows22[["PgSelectRows[22∈2]"]]:::plan
    PgSelect18 --> PgSelectRows22
    PgSelect95[["PgSelect[95∈3]<br />ᐸrelational_itemsᐳ"]]:::plan
    PgClassExpression94{{"PgClassExpression[94∈3]<br />ᐸ__relation...parent_id”ᐳ"}}:::plan
    Object10 & PgClassExpression94 --> PgSelect95
    __Item23[/"__Item[23∈3]<br />ᐸ22ᐳ"\]:::itemplan
    PgSelectRows22 ==> __Item23
    PgSelectSingle24{{"PgSelectSingle[24∈3]<br />ᐸrelational_itemsᐳ"}}:::plan
    __Item23 --> PgSelectSingle24
    PgClassExpression25{{"PgClassExpression[25∈3]<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle24 --> PgClassExpression25
    Lambda26{{"Lambda[26∈3]<br />ᐸrelationalItemTypeNameFromTypeᐳ"}}:::plan
    PgClassExpression25 --> Lambda26
    PgClassExpression27{{"PgClassExpression[27∈3]<br />ᐸ__relation...ems__.”id”ᐳ"}}:::plan
    PgSelectSingle24 --> PgClassExpression27
    PgClassExpression93{{"PgClassExpression[93∈3]<br />ᐸ__relation...__.”type2”ᐳ"}}:::plan
    PgSelectSingle24 --> PgClassExpression93
    PgSelectSingle24 --> PgClassExpression94
    First99{{"First[99∈3]"}}:::plan
    PgSelectRows100[["PgSelectRows[100∈3]"]]:::plan
    PgSelectRows100 --> First99
    PgSelect95 --> PgSelectRows100
    PgSelectSingle102{{"PgSelectSingle[102∈3]<br />ᐸrelational_itemsᐳ"}}:::plan
    First99 --> PgSelectSingle102
    PgClassExpression147{{"PgClassExpression[147∈3]<br />ᐸ__relation...s__.”type”ᐳ"}}:::plan
    PgSelectSingle102 --> PgClassExpression147
    Lambda148{{"Lambda[148∈3]<br />ᐸrelationalItemTypeNameFromTypeᐳ"}}:::plan
    PgClassExpression147 --> Lambda148
    PgClassExpression150{{"PgClassExpression[150∈3]<br />ᐸ__relation...ems__.”id”ᐳ"}}:::plan
    PgSelectSingle102 --> PgClassExpression150
    PgClassExpression217{{"PgClassExpression[217∈3]<br />ᐸ__relation...__.”type2”ᐳ"}}:::plan
    PgSelectSingle102 --> PgClassExpression217
    PgSelect28[["PgSelect[28∈4]<br />ᐸrelational_topicsᐳ<br />ᐳRelationalTopic"]]:::plan
    Object10 & PgClassExpression27 --> PgSelect28
    PgSelect41[["PgSelect[41∈4]<br />ᐸrelational_postsᐳ<br />ᐳRelationalPost"]]:::plan
    Object10 & PgClassExpression27 --> PgSelect41
    PgSelect54[["PgSelect[54∈4]<br />ᐸrelational_dividersᐳ<br />ᐳRelationalDivider"]]:::plan
    Object10 & PgClassExpression27 --> PgSelect54
    PgSelect67[["PgSelect[67∈4]<br />ᐸrelational_checklistsᐳ<br />ᐳRelationalChecklist"]]:::plan
    Object10 & PgClassExpression27 --> PgSelect67
    PgSelect80[["PgSelect[80∈4]<br />ᐸrelational_checklist_itemsᐳ<br />ᐳRelationalChecklistItem"]]:::plan
    Object10 & PgClassExpression27 --> PgSelect80
    First36{{"First[36∈4]^"}}:::plan
    PgSelectRows37[["PgSelectRows[37∈4]^"]]:::plan
    PgSelectRows37 --> First36
    PgSelect28 --> PgSelectRows37
    PgSelectSingle39{{"PgSelectSingle[39∈4]^<br />ᐸrelational_topicsᐳ"}}:::plan
    First36 --> PgSelectSingle39
    First49{{"First[49∈4]^"}}:::plan
    PgSelectRows50[["PgSelectRows[50∈4]^"]]:::plan
    PgSelectRows50 --> First49
    PgSelect41 --> PgSelectRows50
    PgSelectSingle52{{"PgSelectSingle[52∈4]^<br />ᐸrelational_postsᐳ"}}:::plan
    First49 --> PgSelectSingle52
    First62{{"First[62∈4]^"}}:::plan
    PgSelectRows63[["PgSelectRows[63∈4]^"]]:::plan
    PgSelectRows63 --> First62
    PgSelect54 --> PgSelectRows63
    PgSelectSingle65{{"PgSelectSingle[65∈4]^<br />ᐸrelational_dividersᐳ"}}:::plan
    First62 --> PgSelectSingle65
    First75{{"First[75∈4]^"}}:::plan
    PgSelectRows76[["PgSelectRows[76∈4]^"]]:::plan
    PgSelectRows76 --> First75
    PgSelect67 --> PgSelectRows76
    PgSelectSingle78{{"PgSelectSingle[78∈4]^<br />ᐸrelational_checklistsᐳ"}}:::plan
    First75 --> PgSelectSingle78
    First88{{"First[88∈4]^"}}:::plan
    PgSelectRows89[["PgSelectRows[89∈4]^"]]:::plan
    PgSelectRows89 --> First88
    PgSelect80 --> PgSelectRows89
    PgSelectSingle91{{"PgSelectSingle[91∈4]^<br />ᐸrelational_checklist_itemsᐳ"}}:::plan
    First88 --> PgSelectSingle91
    PgSelect151[["PgSelect[151∈5]<br />ᐸrelational_topicsᐳ<br />ᐳRelationalTopicᐳRelationalTopic<br />ᐳRelationalPostᐳRelationalTopic<br />ᐳRelationalDividerᐳRelationalTopic<br />ᐳRelationalChecklistᐳRelationalTopic<br />ᐳRelationalChecklistItemᐳRelationalTopic"]]:::plan
    Object10 & PgClassExpression150 --> PgSelect151
    PgSelect164[["PgSelect[164∈5]<br />ᐸrelational_postsᐳ<br />ᐳRelationalTopicᐳRelationalPost<br />ᐳRelationalPostᐳRelationalPost<br />ᐳRelationalDividerᐳRelationalPost<br />ᐳRelationalChecklistᐳRelationalPost<br />ᐳRelationalChecklistItemᐳRelationalPost"]]:::plan
    Object10 & PgClassExpression150 --> PgSelect164
    PgSelect177[["PgSelect[177∈5]<br />ᐸrelational_dividersᐳ<br />ᐳRelationalTopicᐳRelationalDivider<br />ᐳRelationalPostᐳRelationalDivider<br />ᐳRelationalDividerᐳRelationalDivider<br />ᐳRelationalChecklistᐳRelationalDivider<br />ᐳRelationalChecklistItemᐳRelationalDivider"]]:::plan
    Object10 & PgClassExpression150 --> PgSelect177
    PgSelect190[["PgSelect[190∈5]<br />ᐸrelational_checklistsᐳ<br />ᐳRelationalTopicᐳRelationalChecklist<br />ᐳRelationalPostᐳRelationalChecklist<br />ᐳRelationalDividerᐳRelationalChecklist<br />ᐳRelationalChecklistᐳRelationalChecklist<br />ᐳRelationalChecklistItemᐳRelationalChecklist"]]:::plan
    Object10 & PgClassExpression150 --> PgSelect190
    PgSelect203[["PgSelect[203∈5]<br />ᐸrelational_checklist_itemsᐳ<br />ᐳRelationalTopicᐳRelationalChecklistItem<br />ᐳRelationalPostᐳRelationalChecklistItem<br />ᐳRelationalDividerᐳRelationalChecklistItem<br />ᐳRelationalChecklistᐳRelationalChecklistItem<br />ᐳRelationalChecklistItemᐳRelationalChecklistItem"]]:::plan
    Object10 & PgClassExpression150 --> PgSelect203
    First159{{"First[159∈5]^"}}:::plan
    PgSelectRows160[["PgSelectRows[160∈5]^"]]:::plan
    PgSelectRows160 --> First159
    PgSelect151 --> PgSelectRows160
    PgSelectSingle162{{"PgSelectSingle[162∈5]^<br />ᐸrelational_topicsᐳ"}}:::plan
    First159 --> PgSelectSingle162
    First172{{"First[172∈5]^"}}:::plan
    PgSelectRows173[["PgSelectRows[173∈5]^"]]:::plan
    PgSelectRows173 --> First172
    PgSelect164 --> PgSelectRows173
    PgSelectSingle175{{"PgSelectSingle[175∈5]^<br />ᐸrelational_postsᐳ"}}:::plan
    First172 --> PgSelectSingle175
    First185{{"First[185∈5]^"}}:::plan
    PgSelectRows186[["PgSelectRows[186∈5]^"]]:::plan
    PgSelectRows186 --> First185
    PgSelect177 --> PgSelectRows186
    PgSelectSingle188{{"PgSelectSingle[188∈5]^<br />ᐸrelational_dividersᐳ"}}:::plan
    First185 --> PgSelectSingle188
    First198{{"First[198∈5]^"}}:::plan
    PgSelectRows199[["PgSelectRows[199∈5]^"]]:::plan
    PgSelectRows199 --> First198
    PgSelect190 --> PgSelectRows199
    PgSelectSingle201{{"PgSelectSingle[201∈5]^<br />ᐸrelational_checklistsᐳ"}}:::plan
    First198 --> PgSelectSingle201
    First211{{"First[211∈5]^"}}:::plan
    PgSelectRows212[["PgSelectRows[212∈5]^"]]:::plan
    PgSelectRows212 --> First211
    PgSelect203 --> PgSelectRows212
    PgSelectSingle214{{"PgSelectSingle[214∈5]^<br />ᐸrelational_checklist_itemsᐳ"}}:::plan
    First211 --> PgSelectSingle214

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,PgSelect7,Access8,Access9,Object10,PgSelectRows11,Constant290 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,__Item12,PgSelectSingle13 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgClassExpression14,PgClassExpression17,PgSelect18,PgSelectRows22 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item23,PgSelectSingle24,PgClassExpression25,Lambda26,PgClassExpression27,PgClassExpression93,PgClassExpression94,PgSelect95,First99,PgSelectRows100,PgSelectSingle102,PgClassExpression147,Lambda148,PgClassExpression150,PgClassExpression217 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgSelect28,First36,PgSelectRows37,PgSelectSingle39,PgSelect41,First49,PgSelectRows50,PgSelectSingle52,PgSelect54,First62,PgSelectRows63,PgSelectSingle65,PgSelect67,First75,PgSelectRows76,PgSelectSingle78,PgSelect80,First88,PgSelectRows89,PgSelectSingle91 bucket4
    classDef bucket5 stroke:#7fff00
    class Bucket5,PgSelect151,First159,PgSelectRows160,PgSelectSingle162,PgSelect164,First172,PgSelectRows173,PgSelectSingle175,PgSelect177,First185,PgSelectRows186,PgSelectSingle188,PgSelect190,First198,PgSelectRows199,PgSelectSingle201,PgSelect203,First211,PgSelectRows212,PgSelectSingle214 bucket5

