%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%
graph TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left

    subgraph "Buckets for mutations/basics/create-relational-post"
    Bucket0("Bucket 0 (root)"):::bucket
    Bucket1("Bucket 1 (mutationField)<br />Deps: 16, 10, 11, 100, 101, 102<br /><br />1: PgInsertSingle[12]<br />2: Access[18]<br />3: PgClassExpression[17]<br />4: PgInsertSingle[20]<br />5: <br />ᐳ: Access[26], PgClassExpression[25]"):::bucket
    Bucket2("Bucket 2 (nullableBoundary)<br />Deps: 26, 16, 25<br /><br />ROOT PgClassExpression{1}ᐸ__relational_posts__ᐳ[25]<br />1: 87, 96<br />ᐳ: 28, 95<br />2: PgSelectInlineApply[91]<br />3: PgSelect[31]<br />ᐳ: Access[92], Access[97]<br />4: PgSelectRows[39]<br />ᐳ: First[38], PgSelectSingle[41]"):::bucket
    Bucket3("Bucket 3 (nullableBoundary)<br />Deps: 41, 92, 97<br /><br />ROOT PgSelectSingle{2}ᐸrelational_postsᐳ[41]<br />1: <br />ᐳ: 42, 43, 44, 45, 93, 98, 94, 99, 88<br />2: PgSelectRows[56], PgSelectRows[65]<br />ᐳ: 55, 58, 59, 64, 67, 68, 89, 90<br />3: PgSelectRows[82]<br />ᐳ: First[81], PgSelectSingle[84]"):::bucket
    Bucket4("Bucket 4 (nullableBoundary)<br />Deps: 84<br /><br />ROOT PgSelectSingle{3}ᐸpeopleᐳ[84]"):::bucket
    end
    Bucket0 --> Bucket1
    Bucket1 --> Bucket2
    Bucket2 --> Bucket3
    Bucket3 --> Bucket4

    %% plan dependencies
    Object16{{"Object[16∈0] ➊<br />ᐸ{pgSettings,withPgClient}ᐳ"}}:::plan
    Access13{{"Access[13∈0] ➊<br />ᐸ2.pgSettingsᐳ"}}:::plan
    Access15{{"Access[15∈0] ➊<br />ᐸ2.withPgClientᐳ"}}:::plan
    Access13 & Access15 --> Object16
    __Value2["__Value[2∈0] ➊<br />ᐸcontextᐳ"]:::plan
    __Value2 --> Access13
    __Value2 --> Access15
    __Value4["__Value[4∈0] ➊<br />ᐸrootValueᐳ"]:::plan
    Constant10{{"Constant[10∈0] ➊<br />ᐸ'POST'ᐳ"}}:::plan
    Constant11{{"Constant[11∈0] ➊<br />ᐸ2ᐳ"}}:::plan
    Constant100{{"Constant[100∈0] ➊<br />ᐸ'My Relational Post'ᐳ"}}:::plan
    Constant101{{"Constant[101∈0] ➊<br />ᐸ'A post, innit?'ᐳ"}}:::plan
    Constant102{{"Constant[102∈0] ➊<br />ᐸ'Such a great post.'ᐳ"}}:::plan
    PgInsertSingle20[["PgInsertSingle[20∈1] ➊<br />ᐸrelational_posts(id,title,description,note)ᐳ"]]:::sideeffectplan
    PgClassExpression17{{"PgClassExpression[17∈1] ➊<br />ᐸ__relation...ems__.”id”ᐳ"}}:::plan
    Object16 & PgClassExpression17 & Constant100 & Constant101 & Constant102 --> PgInsertSingle20
    PgInsertSingle12[["PgInsertSingle[12∈1] ➊<br />ᐸrelational_items(type,author_id)ᐳ"]]:::sideeffectplan
    Object16 & Constant10 & Constant11 --> PgInsertSingle12
    Access18{{"Access[18∈1] ➊<br />ᐸ12.tᐳ"}}:::plan
    Access18 --> PgClassExpression17
    PgInsertSingle12 --> Access18
    PgClassExpression25{{"PgClassExpression[25∈1] ➊<br />ᐸ__relational_posts__ᐳ"}}:::plan
    Access26{{"Access[26∈1] ➊<br />ᐸ20.tᐳ"}}:::plan
    Access26 --> PgClassExpression25
    PgInsertSingle20 --> Access26
    PgSelect31[["PgSelect[31∈2] ➊<br />ᐸrelational_postsᐳ"]]:::plan
    PgClassExpression28{{"PgClassExpression[28∈2] ➊<br />ᐸ(__relatio...ts__).”id”ᐳ"}}:::plan
    PgSelectInlineApply91["PgSelectInlineApply[91∈2] ➊"]:::plan
    PgFromExpression95{{"PgFromExpression[95∈2] ➊"}}:::plan
    PgSelectInlineApply96["PgSelectInlineApply[96∈2] ➊"]:::plan
    Object16 & PgClassExpression28 & PgSelectInlineApply91 & PgFromExpression95 & PgSelectInlineApply96 --> PgSelect31
    Access26 --> PgClassExpression28
    First38{{"First[38∈2] ➊"}}:::plan
    PgSelectRows39[["PgSelectRows[39∈2] ➊"]]:::plan
    PgSelectRows39 --> First38
    PgSelect31 --> PgSelectRows39
    PgSelectSingle41{{"PgSelectSingle[41∈2] ➊<br />ᐸrelational_postsᐳ"}}:::plan
    First38 --> PgSelectSingle41
    PgSelectInlineApply87["PgSelectInlineApply[87∈2] ➊"]:::plan
    PgSelectInlineApply87 --> PgSelectInlineApply91
    Access92{{"Access[92∈2] ➊<br />ᐸ31.m.joinDetailsFor60ᐳ"}}:::plan
    PgSelect31 --> Access92
    Access97{{"Access[97∈2] ➊<br />ᐸ31.m.joinDetailsFor47ᐳ"}}:::plan
    PgSelect31 --> Access97
    List89{{"List[89∈3] ➊<br />ᐸ88,67ᐳ"}}:::plan
    Access88{{"Access[88∈3] ➊<br />ᐸ94.m.joinDetailsFor77ᐳ"}}:::plan
    PgSelectSingle67{{"PgSelectSingle[67∈3] ➊<br />ᐸrelational_itemsᐳ"}}:::plan
    Access88 & PgSelectSingle67 --> List89
    List93{{"List[93∈3] ➊<br />ᐸ92,41ᐳ"}}:::plan
    Access92 & PgSelectSingle41 --> List93
    List98{{"List[98∈3] ➊<br />ᐸ97,41ᐳ"}}:::plan
    Access97 & PgSelectSingle41 --> List98
    PgClassExpression42{{"PgClassExpression[42∈3] ➊<br />ᐸ__relation...sts__.”id”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression42
    PgClassExpression43{{"PgClassExpression[43∈3] ➊<br />ᐸ__relation...__.”title”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression43
    PgClassExpression44{{"PgClassExpression[44∈3] ➊<br />ᐸ__relation...scription”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression44
    PgClassExpression45{{"PgClassExpression[45∈3] ➊<br />ᐸ__relation...s__.”note”ᐳ"}}:::plan
    PgSelectSingle41 --> PgClassExpression45
    First55{{"First[55∈3] ➊"}}:::plan
    PgSelectRows56[["PgSelectRows[56∈3] ➊"]]:::plan
    PgSelectRows56 --> First55
    Lambda99{{"Lambda[99∈3] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda99 --> PgSelectRows56
    PgSelectSingle58{{"PgSelectSingle[58∈3] ➊<br />ᐸtextᐳ"}}:::plan
    First55 --> PgSelectSingle58
    PgClassExpression59{{"PgClassExpression[59∈3] ➊<br />ᐸ__relation..._lower__.vᐳ"}}:::plan
    PgSelectSingle58 --> PgClassExpression59
    First64{{"First[64∈3] ➊"}}:::plan
    PgSelectRows65[["PgSelectRows[65∈3] ➊"]]:::plan
    PgSelectRows65 --> First64
    Lambda94{{"Lambda[94∈3] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda94 --> PgSelectRows65
    First64 --> PgSelectSingle67
    PgClassExpression68{{"PgClassExpression[68∈3] ➊<br />ᐸ__relation..._archived”ᐳ"}}:::plan
    PgSelectSingle67 --> PgClassExpression68
    First81{{"First[81∈3] ➊"}}:::plan
    PgSelectRows82[["PgSelectRows[82∈3] ➊"]]:::plan
    PgSelectRows82 --> First81
    Lambda90{{"Lambda[90∈3] ➊<br />ᐸpgInlineViaJoinTransformᐳ"}}:::plan
    Lambda90 --> PgSelectRows82
    PgSelectSingle84{{"PgSelectSingle[84∈3] ➊<br />ᐸpeopleᐳ"}}:::plan
    First81 --> PgSelectSingle84
    Lambda94 --> Access88
    List89 --> Lambda90
    List93 --> Lambda94
    List98 --> Lambda99
    PgClassExpression85{{"PgClassExpression[85∈4] ➊<br />ᐸ__people__.”person_id”ᐳ"}}:::plan
    PgSelectSingle84 --> PgClassExpression85
    PgClassExpression86{{"PgClassExpression[86∈4] ➊<br />ᐸ__people__.”username”ᐳ"}}:::plan
    PgSelectSingle84 --> PgClassExpression86

    %% define steps
    classDef bucket0 stroke:#696969
    class Bucket0,__Value2,__Value4,Constant10,Constant11,Access13,Access15,Object16,Constant100,Constant101,Constant102 bucket0
    classDef bucket1 stroke:#00bfff
    class Bucket1,PgInsertSingle12,PgClassExpression17,Access18,PgInsertSingle20,PgClassExpression25,Access26 bucket1
    classDef bucket2 stroke:#7f007f
    class Bucket2,PgClassExpression28,PgSelect31,First38,PgSelectRows39,PgSelectSingle41,PgSelectInlineApply87,PgSelectInlineApply91,Access92,PgFromExpression95,PgSelectInlineApply96,Access97 bucket2
    classDef bucket3 stroke:#ffa500
    class Bucket3,PgClassExpression42,PgClassExpression43,PgClassExpression44,PgClassExpression45,First55,PgSelectRows56,PgSelectSingle58,PgClassExpression59,First64,PgSelectRows65,PgSelectSingle67,PgClassExpression68,First81,PgSelectRows82,PgSelectSingle84,Access88,List89,Lambda90,List93,Lambda94,List98,Lambda99 bucket3
    classDef bucket4 stroke:#0000ff
    class Bucket4,PgClassExpression85,PgClassExpression86 bucket4

